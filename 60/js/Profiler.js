function Profiler(){function e(){for(var e in g_itemsets)for(var s in g_itemsets[e].setbonus)t(g_itemsets[e].setbonus[s]);for(var e in g_gems)t(g_gems[e].jsonequip);for(var e in g_enchants)t(g_enchants[e].jsonequip)}function t(e,t){for(var s in Ne){var i=e[s],a=Ne[s];if(i&&a.length){for(var n=0,r=a.length;n<r;++n)e[a[n]]="object"==typeof i?i.length?i.slice(0):$WH.dO(i):i;if(delete e[s],t)break}}}function s(e){var t;for(var s in Ne)for(var i=Ne[s],a=0,n=i.length;a<n;++a)(t=e[i[a]])&&(e[s]="object"==typeof t?t.length?t.slice(0):$WH.dO(t):t),delete e[i[a]]}function i(){var e,t,s;E=e=$WH.ce("div"),e.className="profiler-tabs",$WH.ae(w,e),le=new Tabs({parent:e,onShow:b}),ue=new ProfilerStatistics($e),pe=new ProfilerTalents($e),e=$WH.ce("div"),e.id="tab-inventory",e.style.display="none",O=t=$WH.ce("div"),t.style.display="none",$WH.ae(e,O),$WH.ae(w,e),ce=new ProfilerInventory($e),s=le.add(LANG.tab_character,{id:"inventory"}),ce.initialize(O,s),X=$WH.ce("div"),O.insertBefore(X,O.childNodes[3]),ue.initialize(X,s),e=$WH.ce("div"),e.id="tab-talents",e.style.display="none",Y=t=$WH.ce("div"),t.style.display="none",$WH.ae(e,Y),$WH.ae(w,e),s=le.add(LANG.tab_talents,{id:"talents"}),pe.initialize(Y,s),e=$WH.ce("div"),e.id="tab-pets",e.style.display="none",Z=t=$WH.ce("div"),t.style.display="none",$WH.ae(e,Z),$WH.ae(w,e),de=new ProfilerTalents($e),s=le.add(LANG.tab_pets,{id:"pets",hidden:1}),de.initialize(Z,s),e=$WH.ce("div"),e.id="tab-mounts",e.style.display="none",ne=t=$WH.ce("div"),t.style.display="none",$WH.ae(e,ne),$WH.ae(w,e),ve=new ProfilerCompletion($e),s=le.add(LANG.tab_mounts,{id:"mounts"}),ve.initialize(ne,s,{template:"gallery",noAd:1,onDemand:1,source:"g_spells",catgid:"skill",subcat:"cat",typeid:6,filter:function(e){return-5==e.cat||7==e.cat},models:1}),e=$WH.ce("div"),e.id="tab-companions",e.style.display="none",ae=t=$WH.ce("div"),t.style.display="none",$WH.ae(e,ae),$WH.ae(w,e),he=new ProfilerCompletion($e),s=le.add(LANG.tab_companions,{id:"companions"}),he.initialize(ae,s,{template:"gallery",noAd:1,onDemand:1,source:"g_spells",catgid:"skill",subcat:"cat",typeid:6,filter:function(e){return-6==e.cat},models:1}),e=$WH.ce("div"),e.id="tab-recipes",e.style.display="none",re=t=$WH.ce("div"),t.style.display="none",$WH.ae(e,re),$WH.ae(w,e),We=new ProfilerCompletion($e),s=le.add(LANG.tab_recipes,{id:"recipes"}),We.initialize(re,s,{template:"spell",onDemand:1,dataArgs:function(e){var t=[185,129,356];for(var s in e.skills)t.push(s);return"&skill="+t.join(",")},source:"g_spells",order:"g_skill_order",catgs:"g_spell_skills",catgid:"skill",subcat:"cat",typeid:6,filter:function(e){return 11==e.cat||9==e.cat},reqcatg:1,noempty:1}),e=$WH.ce("div"),e.id="tab-quests",e.style.display="none",ie=t=$WH.ce("div"),t.style.display="none",$WH.ae(e,ie),$WH.ae(w,e),ge=new ProfilerCompletion($e),s=le.add(LANG.tab_quests,{id:"quests"}),ge.initialize(ie,s,{template:"quest",onDemand:1,partial:1,dataArgs:function(e){return"&partial"},source:"g_quests",order:"g_quest_catorder",catgs:"g_quest_categories",catgid:"category2",subcat:"category",typeid:5,overall:-1,reqcatg:1,nosubcatg:[4],subname:function(e){return Listview.funcBox.getQuestCategory(e)}}),e=$WH.ce("div"),e.id="tab-achievements",e.style.display="none",te=t=$WH.ce("div"),t.style.display="none",$WH.ae(e,te),$WH.ae(w,e),_e=new ProfilerCompletion($e),s=le.add(LANG.tab_achievements,{id:"achievements"}),_e.initialize(te,s,{template:"achievement",source:"g_achievements",order:"g_achievement_catorder",catgs:"g_achievement_categories",catgid:"parentcat",subcat:"category",typeid:10,nototal:[81],points:1,overall:0,compute:function(e,t){return-1==e.parentcat&&(e.parentcat=e.category),t},subname:function(e){return g_achievement_categories[e]}}),e=$WH.ce("div"),e.id="tab-titles",e.style.display="none",se=t=$WH.ce("div"),t.style.display="none",$WH.ae(e,se),$WH.ae(w,e),fe=new ProfilerCompletion($e),s=le.add(LANG.tab_titles,{id:"titles"}),fe.initialize(se,s,{template:"title",noAd:1,source:"g_titles",catgid:"category",typeid:11}),e=$WH.ce("div"),e.id="tab-reputation",e.style.display="none",ee=t=$WH.ce("div"),t.style.display="none",$WH.ae(e,ee),$WH.ae(w,e),me=new ProfilerCompletion($e),s=le.add(LANG.tab_reputation,{id:"reputation"}),me.initialize(ee,s,{template:"faction",onDemand:"factions",source:"g_factions",order:"g_faction_order",catgs:"g_faction_categories",catgid:"category2",subcat:"category",typeid:8,compute:function(e,t){return e.standing=0|t,t>=42e3||_e.isComplete(e.achievement)}}),le.flush()}function a(e){e?(T.style.display="none",T.style.backgroundImage=""):(T.innerHTML=$WH.sprintf(LANG.message_profilenotsaved,'<span style="color: red">',"</span>"),T.style.display="",T.style.backgroundImage="none"),$WH.Browser.ie||(window.onbeforeunload=e?null:function(e){return LANG.message_savebeforeexit})}function n(){var e=$WH.g_getProfileIcon(He.race,He.classs,He.gender,He.level,0,"large");He.icon||(He.icon=e),He.defaulticon=He.icon==e}function r(){var e,t,s;oe=new Dialog,L=e=$WH.ce("div"),e.className="profiler-header",G=RedButton.create(LANG.button_customprofile,!0,c),A=RedButton.create(LANG.button_armorychar,!0,l),$WH.ae(e,A),$WH.ae(e,G),S=t=Icon.create(null,2),$WH.ae(e,t),x=t=$WH.ce("div"),t.className="profiler-header-line1",$WH.ae(e,t),I=t=$WH.ce("div"),t.className="profiler-header-line2",$WH.ae(e,t),q=t=$WH.ce("div"),t.className="profiler-header-line3",$WH.ae(t,$WH.ce("span")),M=s=$WH.ce("a"),s.className="profiler-header-editlink icon-edit",s.href="javascript:;",s.onclick=oe.show.bind(null,"profileredit",{data:He,onSubmit:H}),$WH.ae(s,$WH.ct(LANG.pr_header_edit)),$WH.ae(t,s),$WH.ae(e,t),$WH.ae(w,e),T=e=$WH.ce("div"),e.className="profiler-message",e.style.display="none",$WH.ae(w,e),C=e=$WH.ce("div"),e.className="profiler-tablinks",$WH.ae(w,e),j=e=$WH.ce("a"),e.className="profiler-tablinks-help",e.href="?help=profiler",e.target="_blank",$WH.ae(e,$WH.ct(LANG.pr_header_help)),$WH.ae(C,e),P=e=$WH.ce("a"),e.className="profiler-tablinks-armory",e.href="#",e.style.display="none",$WH.ae(e,$WH.ct(LANG.pr_header_armory)),$WH.ae(C,e)}function o(){var e;null==k&&(k=document.title);var t=He.name;if(u()&&(t+=" (",t+=He.realm[1]+LANG.hyphen+He.region[1],t+=")"),t+=LANG.hyphen+k,document.title=t,u(He.genuine)?PageTemplate.set({breadcrumb:[1,5,0,He.region[0],He.battlegroup[0],He.realm[0]]}):PageTemplate.set({breadcrumb:[1,5,1]}),u()||(A.style.display="none"),Icon.setTexture(S,2,He.icon),$WH.ee(x),u()&&He.title&&g_titles[He.title]){var s=g_titles[He.title].name,i=$WH.str_replace(s,"%s",""),a=$WH.ce("b");if($WH.st(a,He.name),le.tabs[8].hidden)n=$WH.ce("span");else{var n=$WH.ce("a");n.href="#titles",n.onclick=Tabs.onClick.bind(le.tabs[8],n),$WH.ns(n)}$WH.st(n,$WH.trim(i)),s.indexOf("%s")>0?($WH.ae(x,n),$WH.trim(i)!=i&&$WH.ae(x,$WH.ct(" ")),$WH.ae(x,a)):0==s.indexOf("%s")&&($WH.ae(x,a),$WH.trim(i)!=i&&$WH.ae(x,$WH.ct(" ")),$WH.ae(x,n))}else e=$WH.ce("b"),$WH.ae(e,$WH.ct(He.name)),$WH.ae(x,e);$WH.ee(I),u(He.genuine)&&!He.description?He.guild&&(e=$WH.ce("var"),$WH.ae(e,$WH.ct("<")),$WH.ae(I,e),e=$WH.ce("a"),e.href="?guild="+He.region[0]+"."+He.realm[0]+"."+g_urlize(He.guild),$WH.ae(e,$WH.ct(He.guild)),$WH.ae(I,e),e=$WH.ce("var"),$WH.ae(e,$WH.ct(">")),$WH.ae(I,e)):He.description&&$WH.ae(I,$WH.ct(He.description)),q.firstChild.innerHTML=$WH.sprintfa(LANG.pr_header_character,He.level,g_chr_races[He.race],g_chr_classes[He.classs],He.race,He.classs),u(He.genuine)?(P.href="http://"+He.region[0]+".battle.net/wow/"+Locale.getName().substr(0,2)+"/character/"+He.realm[0]+"/"+g_cleanCharacterName(He.name)+"/",P.style.display="",P.target="_blank"):P.style.display="none"}function l(e){if(u()){e=$WH.$E(e);var t=[[0,LANG.button_resync,$e.resync]];g_user.id&&($WH.array_index(He.bookmarks,g_user.id)?(t.push([1,LANG.button_remove,$e.unlink]),He.pinned?t.push([2,LANG.button_unpin,$e.unpin]):t.push([2,LANG.button_pin,$e.pin]),t.push([3,LANG.button_signature,$e.signature])):t.push([1,LANG.button_claimchar,$e.link]));var s=$WH.g_getCursorPos(e);Menu.showAtXY(t,s.x,s.y)}}function c(e){e=$WH.$E(e);var t=[[0,LANG.button_new,"?profile&new"]];g_user.id&&(He.id>0&&g_user.id==He.user&&t.push([1,LANG.button_save,$e.save]),t.push([2,LANG.button_saveas,$e.saveAs]),He.id>0&&g_user.id==He.user&&t.push([3,LANG.button_delete,$e.remove]));var s=$WH.g_getCursorPos(e);Menu.showAtXY(t,s.x,s.y)}function u(e){return He.region&&He.region[0]&&He.battlegroup&&He.battlegroup[0]&&He.realm&&He.realm[0]&&(e||!He.user)}function p(){var e=$WH.ce("tbody"),t=$WH.ce("tr"),s=$WH.ce("th"),i=$WH.ce("td"),a=$WH.ce("div"),n=$WH.ce("ul");D=$WH.ce("table"),D.className="infobox",s.colSpan=3,i.colSpan=3,$WH.ae(s,$WH.ct(LANG.pr_qf_quickfacts)),$WH.ae(t,s),$WH.ae(e,t),t=$WH.ce("tr"),a.className="infobox-spacer",$WH.ae(i,a),B=n,$WH.ae(i,n),$WH.ae(t,i),$WH.ae(e,t),U=t=$WH.ce("tr"),$WH.ae(e,t);var r=$WH.ce("a");r.className="tip",r.onclick=function(e){$WH.Tooltip.hide(),be=1-be,g()},r.onmouseover=function(e){$WH.Tooltip.showAtCursor(e,LANG["pr_qf_activitytip"+(be?1:2)],0,0,"q")},r.onmousemove=$WH.Tooltip.cursorUpdate,r.onmouseout=$WH.Tooltip.hide,s=$WH.ce("th"),s.style.paddingLeft="6px",s.style.paddingRight=0,$WH.ae(s,r),$WH.ae(t,s),s=$WH.ce("th"),s.colSpan=2,s.style.paddingLeft=0,s.style.paddingRight="6px",$WH.st(s,LANG.pr_qf_gearmeter),$WH.ae(t,s),t=$WH.ce("tr"),$WH.ae(e,t),K=$WH.ce("td"),K.className="profiler-infobox-raids",K.style.padding="0 0 0 6px",$WH.ae(t,K),Q=$WH.ce("td"),Q.className="profiler-infobox-gear",Q.style.padding=0,$WH.ae(t,Q),J=$WH.ce("td"),J.className="profiler-infobox-gear",J.style.padding="2px 6px 0 0",$WH.ae(t,J),$WH.ae(D,e),$WH.aef(O,D)}function d(){var e,t,s,i;if($WH.ee(B),He.lastupdated){var a=(g_serverTime-He.lastupdated)/1e3;e=$WH.ce("li"),t=$WH.ce("div"),s=$WH.ce("span"),$WH.ae(t,$WH.ct(u()?LANG.pr_qf_resynced:LANG.pr_qf_updated)),g_formatDate(s,a,new Date(He.lastupdated)),a>86400&&(s.style.color="red",s.style.fontWeight="bold"),$WH.ae(t,s),$WH.ae(e,t),$WH.ae(B,e)}if(He.user&&He.username&&(e=$WH.ce("li"),t=$WH.ce("div"),i=$WH.ce("a"),i.href="?user="+He.username,$WH.st(i,He.username),$WH.ae(t,$WH.ct(LANG.pr_qf_owner)),$WH.ae(t,i),$WH.ae(e,t),$WH.ae(B,e)),He.user&&He.source&&(e=$WH.ce("li"),t=$WH.ce("div"),i=$WH.ce("a"),i.href=g_getProfileUrl({id:He.id,region:He.region[0],realm:He.realm[0],name:He.sourcename}),$WH.st(i,He.sourcename+" ("+He.realm[1]+" - "+He.region[0].toUpperCase()+")"),$WH.ae(t,$WH.ct(LANG.pr_qf_character)),$WH.ae(t,i),$WH.ae(e,t),$WH.ae(B,e)),He.playedtime&&(e=$WH.ce("li"),t=$WH.ce("div"),$WH.st(t,LANG.pr_qf_playedtime+g_formatTimeElapsed(He.playedtime)),$WH.ae(e,t),$WH.ae(B,e)),u()&&He.customs){var n=$WH.ce("table"),r=$WH.ce("tbody"),e=$WH.ce("li"),t=$WH.ce("div"),o=0;n.className="iconlist",$WH.ae(n,r),$WH.ae(t,$WH.ct(LANG.pr_qf_profiles)),$WH.ae(t,n),$WH.ae(e,t);var l=[];for(var c in He.customs)l.push([c,He.customs[c][0]]);l.sort(function(e,t){return $WH.strcmp(e[1],t[1])});for(var p=0,d=l.length;p<d;++p)if(c=l[p][0],!He.customs[c][1]||He.customs[c][1]==g_user.id){var h=$WH.ce("tr"),v=$WH.ce("th"),W=$WH.ce("td"),i=$WH.ce("a");W.style.lineHeight="1em",$WH.ae(v,Icon.create(3==He.customs[c].length&&He.customs[c][2]?He.customs[c][2]:"inv_misc_questionmark",0,null,"?profile="+c)),$WH.ae(h,v),i.href="?profile="+c,$WH.st(i,He.customs[c][0]),$WH.ae(W,i),$WH.ae(h,W),$WH.ae(r,h),o++}o>0&&$WH.ae(B,e)}if(e=$WH.ce("li"),t=$WH.ce("div"),s=$WH.ce("a"),s.href="#gear-summary",$WH.ae(t,$WH.ct(LANG.pr_qf_gearscore)),F=s,$WH.ae(t,s),$WH.ae(e,t),$WH.ae(B,e),e=$WH.ce("li"),t=$WH.ce("div"),s=$WH.ce("a"),s.href="#gear-summary",$WH.ae(t,$WH.ct(LANG.pr_qf_itemlevel)),z=s,$WH.ae(t,s),$WH.ae(e,t),$WH.ae(B,e),m(),e=$WH.ce("li"),V=t=$WH.ce("div"),$WH.ae(t,$WH.ct(LANG.pr_qf_talents)),s=$WH.ce("a"),s.href="#talents",s.onclick=Tabs.onClick.bind(le.tabs[1],s),s.className="icontinyl q1 tip",s.onmousemove=$WH.Tooltip.cursorUpdate,s.onmouseout=$WH.Tooltip.hide,$WH.ae(t,s),$WH.ae(e,t),$WH.ae(B,e),_(),He.achievementpoints&&(e=$WH.ce("li"),t=$WH.ce("div"),s=$WH.ce("a"),s.href="#achievements",s.style.textDecoration="none",$WH.ns(s),s.onclick=Tabs.onClick.bind(le.tabs[7],s),$WH.ae(t,$WH.ct(LANG.pr_qf_achievements)),Listview.funcBox.appendMoney(s,0,null,0,0,He.achievementpoints),$WH.ae(t,s),$WH.ae(e,t),$WH.ae(B,e)),R=[],He.skills)for(var $=g_sortJsonArray(He.skills,g_spell_skills),c=0,d=$.length;c<d;++c){var H=$[c],y=He.skills[H];y[1]||(y[1]=525);var b={text:g_spell_skills[H],hoverText:y[0]+" / "+y[1],color:"rep"+Math.min(6,Math.ceil(y[1]/75)),width:Math.min(100,y[0]/y[1]*100)};e=$WH.ce("li"),t=$WH.ce("div"),e.className="profiler-infobox-skill";var s=g_createProgressBar(b);s.skill=H,s.rel="np",$WH.ns(s),R.push(s),$WH.ae(t,s),$WH.ae(e,t),$WH.ae(B,e)}if(f(),He.arenateams)for(var c in He.arenateams)c=parseInt(c),He.arenateams[c]&&(e=$WH.ce("li"),t=$WH.ce("div"),$WH.ae(t,$WH.ct($WH.sprintfa(LANG.pr_qf_xvxteam,c))),i=$WH.ce("a"),i.href="?arena-team="+He.region[0]+"."+He.realm[0]+"."+g_urlize(He.arenateams[c]),$WH.ae(i,$WH.ct(He.arenateams[c])),$WH.ae(t,i),$WH.ae(e,t),$WH.ae(B,e));g()}function m(){var e=F,t=z;if(e&&t){var s=ce.getGearScore(),i=ce.getAverageLevel();He.gearscore=s.item+s.ench+s.gems,He.gearsubtotal=s,e.className=t.className="q"+pr_getGearScoreQuality(He.level,He.gearscore,$WH.array_index([2,6,7,11],He.classs)),He.gearsubtotal?(e.className+=" tip",e.onmouseover=y.bind(0,He.gearsubtotal),e.onmousemove=$WH.Tooltip.cursorUpdate,e.onmouseout=$WH.Tooltip.hide):e.onmouseover=e.onmousemove=e.onmouseout=null,$WH.st(e,$WH.number_format(He.gearscore)),$WH.st(t,$WH.number_format(i)),g()}}function _(){if(V){var e=pe.getTalentBuilds(),t=pr_getSpecFromTalents(He.classs,e.spent),s=V.childNodes[1];s.style.backgroundImage="url("+g_staticDataUrl+"/images/wow/icons/tiny/"+t.icon.toLowerCase()+".gif)",$WH.st(s,e.spent?e.spent.join("/"):"0/0/0"),s.onmouseover=function(e){$WH.Tooltip.showAtCursor(e,t.name,0,0,"q")}}}function f(){for(var e=0,t=R.length;e<t;++e){var s=R[e];le.tabs[5].hidden?(s.className=s.className.replace("tip",""),s.href=null,s.onclick=$WH.rf):(s.className+=" tip",s.href="#recipes",s.onclick=function(e){Tabs.onClick.bind(le.tabs[5],this,e)(),We.filterData(0,this.skill)})}}function g(){if(U.style.display="none",$WH.ee(K),$WH.ee(Q),$WH.ee(J),u(He.genuine)&&80==He.level&&ke.length){U.style.display="";var e=$WH.gE(U,"a")[0];$WH.st(e,LANG["pr_qf_raidactivity"+(be?1:2)]);var t=ce.getAverageLevel(),s={},i=0,a=null;if(!be)for(var n in He.activity)i+=He.activity[n];for(var n=ke.length-1;n>=0;--n){var r=ke[n];if(s[r.level]||(s[r.level]=0),s[r.level]++,be)for(var o=0,l=r.kills.length;o<l;++o)i+=0|He.statistics[r.kills[o][0]]}for(var n=ke.length-1;n>=0;--n){for(var r=ke[n],c=!0,p=0,d=0,m=0,o=0,l=r.achievs.length;o<l;++o)c=c&&He.achievements[r.achievs[o]];for(var o=0,l=r.kills.length;o<l;++o)p+=0|He.statistics[r.kills[o][0]],d+=0|He.activity[r.kills[o][0]],m+=He.statistics[r.kills[o][0]]?1:0;c&&(m=r.kills.length),be&&(d=p);var _=t>=r.level?t-13>=r.level?0:1:t+27<r.level?5:t+18<r.level?4:t+9<r.level?3:2,f={text:r.zone?g_zones[r.zone]:r.name,hoverText:$WH.sprintf(LANG["pr_qf_activitypct"+(be?1:2)],i?Math.round(d/i*100):0),color:"ach0",width:i?Math.round(d/i*100):0},g=g_createProgressBar(f);g.className+=r.heroic?" icon-heroic":" icon-instance"+r.instance,g.onmouseover=h.bind(g,r,m),g.onmousemove=$WH.Tooltip.cursorUpdate,g.onmouseout=$WH.Tooltip.hide,$WH.ae(K,g);var g=$WH.ce("span");if(g.style.backgroundImage="url("+g_staticDataUrl+"/images/icons/"+(c?"tick.png":p?"cog.gif":"delete.gif")+")",g.className="completion",g.onmouseover=h.bind(g,r,m),g.onmousemove=$WH.Tooltip.cursorUpdate,g.onmouseout=$WH.Tooltip.hide,$WH.ae(Q,g),s[r.level]){var f={text:"",color:_<2?"ach"+(1-_):"rep"+(10-2*_)},g=g_createProgressBar(f);g.style.height=22*s[r.level]-(a?1:2)+"px",g.onmouseover=function(e,t){$WH.Tooltip.showAtCursor(t,LANG["pr_qf_gear"+e],0,0,"q")}.bind(g,_),g.onmousemove=$WH.Tooltip.cursorUpdate,g.onmouseout=$WH.Tooltip.hide,$WH.ae(J,g),a||(g.className+=" progressbar-first"),0==n&&(g.className+=" progressbar-last"),s[r.level]=null,a=!0}}}}function h(e,t){var s="";s+='<b class="q'+(e.heroic?" icon-heroic":"")+'">',s+=(e.heroic?LANG.pr_print_heroic:LANG.pr_print_normal)+" ",s+=(e.zone?g_zones[e.zone]:e.name)+"</b><br />",s+=$WH.sprintf(LANG.pr_qf_raidcomplete,Math.round(t/e.kills.length*100)),s+=" ("+t+"/"+e.kills.length+")<br />";for(var i=0,a=e.kills.length;i<a;++i){var n=e.kills[i][0],r=e.kills[i][1],o=0|He.statistics[n],l=g_zones[r]?g_zones[r]:g_npcs[r]["name_"+Locale.getName()];l&&(s+='<span class="q'+(o?1:0)+'" style="padding-left: 6px">'+o+" &times; "+l+"</span><br />")}$WH.Tooltip.setIcon(e.icon),$WH.Tooltip.show(this,s)}function v(e){if(e){var t="?profile=load&id="+e,s=$WH.g_getGets();s.items&&(ye=s.items.split(":"),t+="&items="+ye.join(":")),$WH.g_ajaxIshRequest(t)}}function W(e){$WH.eO(He),$WH.cO(He,e),He.genuine=!He.sourcename&&!He.user&&!He.username,He.pinned=!1,u()&&g_user&&g_user.characters&&g_user.characters.length&&$.each(g_user.characters,function(e,t){t.id==He.source&&t.pinned&&(He.pinned=!0)}),n(),o(),He.talents.builds&&He.talents.builds.length&&pe.setTalents(He.talents.active,He.talents.builds),He.pets&&He.pets.length&&(le.hide(2,1),de.setTalents(0,He.pets)),ce.setInventory(He.inventory),ce.addItems(ye);for(var s in g_spells)t(g_spells[s].modifier||0);ue.updateModifiers(),d(),u()?(le.hide(3,1),ve.setData(He.spells),le.hide(4,1),he.setData(He.spells),le.hide(5,1),We.setData(He.spells),le.hide(6,1),ge.setData(He.quests),le.hide(7,1),_e.setData(He.achievements),le.hide(8,1),fe.setData(He.titles),le.hide(9,1),me.setData(He.reputation)):(le.hide(2,3==He.classs),le.hide(3),le.hide(4),le.hide(5),le.hide(6),le.hide(7),le.hide(8),le.hide(9)),g_serverTime-e.lastupdated>=36e5&&setTimeout($e.resync,1e3),a(1),N()}function H(e){var t=He.name,s=He.race,i=He.gender,r=He.classs,l=He.level,c=u();e.description&&(e.description=$WH.str_replace(e.description,"\n"," ")),$WH.cO(He,e),He.gender=parseInt(He.gender),He.published=parseInt(He.published),He.user&&He.user==g_user.id||(He.sourcename=c?t:"",He.username=g_user.name,He.user=g_user.id,He.id=0,delete He.lastupdated),delete He.customs,He.classs!=r&&(pe.resetAll(),de.resetAll(),ce.updateAllIcons()),He.level!=l&&ce.updateAllHeirlooms(),pe.updateAll(),de.updateAll(),n(),o(),d(),a(),He.race==s&&He.gender==i||ce.updateModel(null,1),He.classs==r&&He.race==s&&He.level==l||ue.updateModifiers()}function y(e,t){var s="",i=parseInt(e.item+e.gems+e.ench);s+="<table>",s+='<tr><td class="q">'+LANG.pr_tt_items+"</td><th>"+e.item+'</th><th><small class="q0">'+(e.item?Math.round(e.item/i*100):0)+"%</small></th></tr>",s+='<tr><td class="q">'+LANG.pr_tt_gems+"</td><th>"+e.gems+'</th><th><small class="q0">'+(e.gems?Math.round(e.gems/i*100):0)+"%</small></th></tr>",s+='<tr><td class="q">'+LANG.pr_tt_enchants+"</td><th>"+e.ench+'</th><th><small class="q0">'+(e.ench?Math.round(e.ench/i*100):0)+"%</small></th></tr>",s+="</table>",$WH.Tooltip.showAtCursor(t,s)}function b(e,t){Tabs.onShow(e,t),t&&N(e.index)}function N(e){switch(null==e&&(e=le.getSelectedTab()),ce.showModel(0==e),e){case 0:O.style.display="";break;case 1:pe.onShow(),Y.style.display="";break;case 2:de.onShow(),Z.style.display="";break;case 3:ve.onShow(),ne.style.display="";break;case 4:he.onShow(),ae.style.display="";break;case 5:We.onShow(),re.style.display="";break;case 6:ge.onShow(),ie.style.display="";break;case 7:_e.onShow(),te.style.display="";break;case 8:fe.onShow(),se.style.display="";break;case 9:me.onShow(),ee.style.display=""}}$WowheadProfiler=this;var k,w,L,A,G,S,x,I,q,M,T,C,j,P,E,O,D,B,F,z,V,R,U,K,Q,J,X,Y,Z,ee,te,se,ie,ae,ne,re,oe,le,ce,ue,pe,de,me,_e,fe,ge,he,ve,We,$e=this,He={},ye=[],be=0,Ne={atkpwr:["mleatkpwr","rgdatkpwr"],critstrkrtng:["mlecritstrkrtng","rgdcritstrkrtng","arcsplcritstrkrtng","firsplcritstrkrtng","frosplcritstrkrtng","holsplcritstrkrtng","natsplcritstrkrtng","shasplcritstrkrtng"],hastertng:["mlehastertng","rgdhastertng","splhastertng"],hitrtng:["mlehitrtng","rgdhitrtng","splhitrtng"],splpwr:["splheal","arcspldmg","firspldmg","frospldmg","holspldmg","natspldmg","shaspldmg"],spldmg:["arcspldmg","firspldmg","frospldmg","holspldmg","natspldmg","shaspldmg"],splcritstrkpct:["arcsplcritstrkpct","firsplcritstrkpct","frosplcritstrkpct","holsplcritstrkpct","natsplcritstrkpct","shasplcritstrkpct"],splcritstrkrtng:["arcsplcritstrkrtng","firsplcritstrkrtng","frosplcritstrkrtng","holsplcritstrkrtng","natsplcritstrkrtng","shasplcritstrkrtng"],arcsplpwr:["arcspldmg"],firsplpwr:["firspldmg"],frosplpwr:["frospldmg"],holsplpwr:["holspldmg"],natsplpwr:["natspldmg"],shasplpwr:["shaspldmg"]},ke=[{level:284,instance:5,heroic:1,name:g_zones[4987]+$WH.sprintf(LANG.lvitem_dd,LANG.lvitem_raid25,""),icon:"spell_shadow_twilight",achievs:[4816],kills:[[4823,39863]]},{level:277,instance:5,heroic:1,name:g_zones[4812]+$WH.sprintf(LANG.lvitem_dd,LANG.lvitem_raid25,""),icon:"achievement_dungeon_icecrown_frostmourne",achievs:[4637],kills:[[4673,37970],[4682,37955],[4664,37813],[4667,36626],[4661,100001],[4656,36855],[4642,36612],[4679,36678],[4670,36627],[4685,36853],[4676,36789],[4688,36597]]},{level:271,instance:5,name:g_zones[4987]+$WH.sprintf(LANG.lvitem_dd,LANG.lvitem_raid25,""),icon:"spell_shadow_twilight",achievs:[4815],kills:[[4820,39863]]},{level:271,instance:3,heroic:1,name:g_zones[4987]+$WH.sprintf(LANG.lvitem_dd,LANG.lvitem_raid10,""),icon:"spell_shadow_twilight",achievs:[4818],kills:[[4822,39863]]},{level:264,instance:5,name:g_zones[4812]+$WH.sprintf(LANG.lvitem_dd,LANG.lvitem_raid25,""),icon:"achievement_dungeon_icecrown_frostmourne",achievs:[4608],kills:[[4672,37970],[4681,37955],[4663,37813],[4666,36626],[4660,100001],[4655,36855],[4641,36612],[4678,36678],[4669,36627],[4683,36853],[4675,36789],[4687,36597]]},{level:264,instance:3,heroic:1,name:g_zones[4812]+$WH.sprintf(LANG.lvitem_dd,LANG.lvitem_raid10,""),icon:"achievement_dungeon_icecrown_frostmourne",achievs:[4636],kills:[[4671,37970],[4680,37955],[4662,37813],[4665,36626],[4659,100001],[4654,36855],[4640,36612],[4677,36678],[4668,36627],[4684,36853],[4674,36789],[4686,36597]]},{level:258,instance:3,name:g_zones[4987]+$WH.sprintf(LANG.lvitem_dd,LANG.lvitem_raid10,""),icon:"spell_shadow_twilight",achievs:[4817],kills:[[4821,39863]]},{level:258,instance:5,heroic:1,name:g_zones[4722]+$WH.sprintf(LANG.lvitem_dd,LANG.lvitem_raid25,""),icon:"achievement_reputation_argentchampion",achievs:[3812],kills:[[4031,200001],[4034,34780],[4038,200002],[4042,200003],[4046,34564]]},{level:251,instance:3,name:g_zones[4812]+$WH.sprintf(LANG.lvitem_dd,LANG.lvitem_raid10,""),icon:"achievement_dungeon_icecrown_frostmourne",achievs:[4532],kills:[[4648,37970],[4651,37955],[4645,37813],[4646,36626],[4644,100001],[4643,36855],[4639,36612],[4650,36678],[4647,36627],[4652,36853],[4649,36789],[4653,36597]]},{level:245,instance:5,name:g_zones[4722]+$WH.sprintf(LANG.lvitem_dd,LANG.lvitem_raid25,""),icon:"achievement_reputation_argentchampion",achievs:[3916],kills:[[4029,200001],[4035,34780],[4039,200002],[4043,200003],[4047,34564]]},{level:245,instance:3,heroic:1,name:g_zones[4722]+$WH.sprintf(LANG.lvitem_dd,LANG.lvitem_raid10,""),icon:"achievement_reputation_argentchampion",achievs:[3918],kills:[[4030,200001],[4033,34780],[4037,200002],[4041,200003],[4045,34564]]},{level:245,instance:5,name:g_zones[2159]+$WH.sprintf(LANG.lvitem_dd,LANG.lvitem_raid25,""),icon:"achievement_boss_onyxia",achievs:[4397],kills:[[1756,10184]]},{level:232,instance:3,name:g_zones[4722]+$WH.sprintf(LANG.lvitem_dd,LANG.lvitem_raid10,""),icon:"achievement_reputation_argentchampion",achievs:[3917],kills:[[4028,200001],[4032,34780],[4036,200002],[4040,200003],[4044,34564]]},{level:232,instance:3,name:g_zones[2159]+$WH.sprintf(LANG.lvitem_dd,LANG.lvitem_raid10,""),icon:"achievement_boss_onyxia",achievs:[4396],kills:[[1098,10184]]}];g_items.add=function(e,s){if(s.jsonequip&&(t(s.jsonequip),s.jsonequip.socketbonusstat&&t(s.jsonequip.socketbonusstat),s.jsonequip.subitems))for(var i in s.jsonequip.subitems)s.jsonequip.subitems[i].jsonequip&&t(s.jsonequip.subitems[i].jsonequip);null!=g_items[e]?$WH.cO(g_items[e],s):g_items[e]=s},this.initialize=function(t,s){(w=$WH.ge(t))&&(e(),r(),i(),p(),s&&s.id?v(s.id):(W({id:0,name:LANG.pr_header_noname,region:["",""],battlegroup:["",""],realm:["",""],level:80,classs:1,race:1,faction:0,gender:0,source:0,sourcename:"",user:g_user.id,username:g_user.name,published:1,nomodel:0,talents:{},pets:[],skills:{},reputation:{},achievements:{},statistics:{},activity:{},titles:{},quests:{},spells:{},glyphs:{}}),pe.resetAll(),de.resetAll(),M.onclick()))},this.requestProfile=function(e){v(e)},this.registerProfile=function(e){W(e)},this.isArmoryProfile=function(e){return u(e)},this.showGearScoreTooltip=function(e,t){y(e,t)},this.updateInfoboxSpec=function(){_()},this.setPlayedTime=function(e){He.playedtime=e,d()},this.setGlyphs=function(e,t,s){He.glyphs=$WH.dO(e),pe.setGlyphData(He.glyphs,t,s)},this.resetExclusions=function(){confirm(LANG.confirm_resetexclusions)&&(g_user.excludegroups=1,g_user.excludes={},g_user.includes={},$.post("?account=exclude",{reset:1}),ve.updateExclusions(),he.updateExclusions(),We.updateExclusions(),ge.updateExclusions(),_e.updateExclusions(),fe.updateExclusions(),me.updateExclusions(),Lightbox.hide())},this.loadOnDemand=function(e,t){ve.onLoad(e,t),he.onLoad(e,t),We.onLoad(e,t),ge.onLoad(e,t),_e.onLoad(e,t),fe.onLoad(e,t),me.onLoad(e,t)},this.resync=function(){u()&&(T.innerHTML=LANG.pr_queue_addqueue,T.style.display="",new Ajax("?profile=resync&id="+He.source,{method:"POST",onSuccess:function(e,t){var s=parseInt(e.responseText);isNaN(s)?alert(LANG.message_resyncerror+" "+s):s<0&&-102!=s&&alert(LANG.message_resyncerror+"#"+s),pr_updateStatus("profile",T,He.source,!0)}}))},this.link=function(){u()&&g_user.id&&($WH.Tooltip.hide(),confirm(LANG.confirm_linkcharacter)&&(He.bookmarks.push(g_user.id),new Ajax("?profile=link&id="+He.source),confirm(LANG.confirm_linkedcharacter)&&window.open("?user="+g_user.name+"#characters")))},this.unlink=function(){u()&&g_user.id&&($WH.Tooltip.hide(),confirm(LANG.confirm_unlinkcharacter)&&($.each(g_user.characters,function(e,t){t.id==He.source&&(t.pinned=!1)}),He.bookmarks=$WH.array_filter(He.bookmarks,function(e){return e!=g_user.id}),new Ajax("?profile=unlink&id="+He.source)))},this.save=function(){if(He.user==g_user.id&&(0!=He.id||confirm(LANG.confirm_newprofile))){var e=pe.getTalentBuilds(),t=["name="+$WH.urlencode(He.name),"level="+$WH.urlencode(He.level),"class="+$WH.urlencode(He.classs),"race="+$WH.urlencode(He.race),"gender="+$WH.urlencode(He.gender),"nomodel="+$WH.urlencode(He.nomodel),"talenttree1="+$WH.urlencode(e.spent[0]),"talenttree2="+$WH.urlencode(e.spent[1]),"talenttree3="+$WH.urlencode(e.spent[2]),"activespec="+$WH.urlencode(e.active),"talentbuild1="+$WH.urlencode(e.talents[0]),"glyphs1="+$WH.urlencode(e.glyphs[0]),"talentbuild2="+$WH.urlencode(e.talents[1]),"glyphs2="+$WH.urlencode(e.glyphs[1]),"gearscore="+$WH.urlencode(He.gearscore),"icon="+$WH.urlencode(He.icon),"public="+$WH.urlencode(He.published)];He.description&&t.push("description="+$WH.urlencode(He.description)),He.source&&t.push("source="+He.source),He.copy&&t.push("copy="+He.copy);var s=ce.getInventory();for(var i in s)t.push("inv[]="+i+","+s[i].join(","));new Ajax("?profile=save&id="+He.id,{method:"POST",params:t.join("&"),onSuccess:function(e,t){var s=parseInt(e.responseText);isNaN(s)?alert(LANG.message_saveerror):s<0?alert(LANG.message_saveerror):s!=He.id?(a(1),location.href="?profile="+s):(He.lastupdated=g_serverTime,a(1),d(),alert(LANG.message_saveok))}})}},this.saveAs=function(){var e=prompt(LANG.prompt_nameprofile,He.name);if(e){if(e.match(/`~!@#$%^&*()_\-+={[}\]|:;"'<,>.?\/]/))return alert(LANG.message_saveasinvalidname);H({id:0,name:e,copy:He.id}),$e.save()}},this.remove=function(){He.user==g_user.id&&confirm(LANG.confirm_deleteprofile2)&&new Ajax("?profile=delete&id="+He.id,{method:"POST",onSuccess:function(e,t){location.href="?user="+g_user.name+"#profiles"}})},this.signature=function(){u()&&g_user.id&&g_user.premium&&window.open("?signature&profile="+$WH.g_getGets().profile)},this.pin=function(){u()&&g_user.id&&$WH.array_index(He.bookmarks,g_user.id)&&!He.pinned&&($WH.Tooltip.hide(),confirm(LANG.confirm_pincharacter)&&($.each(g_user.characters,function(e,t){t.pinned=t.id==He.source}),He.pinned=!0,new Ajax("?profile=pin&id="+He.source)))},this.unpin=function(){u()&&g_user.id&&$WH.array_index(He.bookmarks,g_user.id)&&He.pinned&&($WH.Tooltip.hide(),confirm(LANG.confirm_unpincharacter)&&($.each(g_user.characters,function(e,t){t.pinned=!1}),He.pinned=!1,new Ajax("?profile=unpin&id="+He.source)))},this.updateSavedChanges=function(e){return a(e)},this.updateGearScore=function(){return m()},this.equipItem=function(e,t){return ce.equipItem(e,t)},this.equipSubitem=function(e,t){return ce.equipSubitem(e,t)},this.socketItem=function(e,t,s){return ce.socketItem(e,t,s)},this.enchantItem=function(e,t){return ce.enchantItem(e,t)},this.selectPet=function(e){return Lightbox.hide(),_selectPet(e)},this.updateMenu=function(e,t){return ce.updateMenu(e,t)},this.onMouseUpSlot=function(e,t,s){return ce.onMouseUpSlot(e,t,s)},this.fixJson=function(e,s){t(e,s)},this.unfixJson=function(e){s(e)},this.getVars=function(){return{profile:He,statistics:ue,inventory:ce,talents:pe,tabs:le,dialog:oe}}}function ProfilerTalents(e){function t(e,t){h=e,v=$WH.dO(t),H=!1,x.onShow()}function s(e){return"pets"!=G?_.classs:(null==e&&(e=h),v[e].npc&&g_pets[v[e].npc]?g_pets[v[e].npc].family:void 0)}function i(){k=$WH.ce("div"),k.className="profiler-talents-specs",w=[];for(var e=0,t=v.length;e<t;++e){var s=$WH.ce("a");if(s.className="profiler-"+G+"-button",s.onclick=r.bind(0,e),s.href="javascript:;",w[e]=$WH.ce("span"),"pets"==G){var i=Icon.create("inv_misc_questionmark",0);i.style.position="absolute",$WH.ae(s,i),w[e].icon=i}$WH.ae(s,w[e]),$WH.ae(k,s)}var a=$WH.ce("div");a.className="clear",$WH.ae(k,a),$WH.ae(N,k)}function a(){if($){g_setSelectedLink(k.childNodes[h],"active"+G);for(var e=0,t=v.length;e<t;++e)n(e)}}function n(e){if(null==e&&(e=h),v[e]){v[e].spent=d.getSpentFromBlizzBuild(v[e].talents,_.classs);var t=w[e],i=$WH.ce("small");if(t&&$WH.ee(t),"pets"!=G){for(var a=Math.max(0,_.level-9),n=v[e].spent[0]+v[e].spent[1]+v[e].spent[2],r=n-a,o=2;o>=0&&!(r<=0);--o)v[e].spent[o]>=r?(v[e].spent[o]-=r,r=0):v[e].spent[o]>0&&(r-=v[e].spent[o],v[e].spent[o]=0);var l=pr_getSpecFromTalents(_.classs,v[e].spent);return t&&(t.style.backgroundImage="url("+g_staticDataUrl+"/images/wow/icons/tiny/"+l.icon.toLowerCase()+".gif)",$WH.ae(t,$WH.ct(l.name+" ")),$WH.st(i,"("+v[e].spent.join("/")+")"),$WH.ae(t,i)),l}var c=s(e);Icon.setTexture(t.icon,0,c?g_pet_icons[c]:"inv_misc_questionmark"),$WH.ae(t,$WH.ct(c?v[e].name:LANG.pr_nonepet))}}function r(e){h=e,H=!1,f.getSelectedTab()==g&&x.onShow()}function o(){L=$WH.ce("div"),L.style.display="none",$WH.ae(N,L),d=new TalentCalc,d.initialize(L,{onChange:c,noAd:1,profiler:1,mode:"pets"==G?TalentCalc.MODE_PET:TalentCalc.MODE_DEFAULT})}function l(){if($){var e=s();e&&(b=h,h=2,v[h]=$WH.dO(v[b]),d.setClass(e),v[b].talents?d.setBlizzBuild(e,v[b].talents):d.resetBuild(),v[b].glyphs?d.setBlizzGlyphs(v[b].glyphs):d.resetGlyphs(),"pets"==G?d.setPetModel(v[b].npc):(v[b].name=LANG.pr_queue_unknown,v[b].spec=-1,v[b].scale={},v[b].filter=""),y&&d.setLevelCap(_.level),h=b,b=null)}}function c(t,s,i){if(null===b&&(v[h].talents=d.getBlizzBuild(),v[h].spent=s.pointsSpent,"pets"!=G&&(v[h].glyphs=d.getBlizzGlyphs()),y&&e.updateSavedChanges()),y||("pets"!=G&&a(),y=!0,L.style.display=""),"pets"!=G){e.updateInfoboxSpec();var r=n(),o=v[h].spec!=r.id;u(o);e.updateGearScore();var l=t.getTalents();_statistics.removeAllModifiers("talent");for(var c=0,p=l.length;c<p;++c)l[c].j&&_statistics.addModifiers("talent",l[c].s[l[c].k-1],l[c].j[l[c].k-1]);_inventory.updateInventory()}else _talents.hasBeastMastery()&&!d.getBonusPoints()&&d.setBonusPoints();S=null}function u(t){if(wt_presets[_.classs]&&v[h]){var s=pr_getSpecFromTalents(_.classs,v[h].spent),i=s.id,a=(wt_presets[_.classs].pve,i-1);if(11==_.classs&&2==i){var n=[2241,2242];a+=2
;for(var r=0,o=n.length;r<o;++r)if(x.getTalentRanks(n[r])){a-=2;break}}var l=pr_getScaleFromSpec(_.classs,a),c=pr_getScaleFromSpec(_.classs,a,1);return t&&(v[h].name=c||LANG.pr_queue_unknown,v[h].spec=s.id,v[h].scale=l,v[h].filter=pr_getScaleFilter(l)),e.fixJson(l),l}}function p(){var t,s;t=$WH.ce("div"),t.className="clear pad",$WH.ae(N,t),t=$WH.ce("div"),t.className="text",t.style.display="none",s=$WH.ce("h2"),s.className="clear",$WH.st(s,LANG.tc_glyphs),$WH.ae(t,s),$WH.ae(N,t),A=s=$WH.ce("div"),$WH.ae(t,s),W=new ProfilerCompletion(e),W.initialize(A,g,{template:"item",noAd:1,source:"g_glyph_items",typeid:3,order:"g_glyph_order",catgs:"g_item_glyphs",catgid:"glyph",visibleCols:["glyph"],hiddenCols:["slot","type"]})}var d,m,_,f,g,h,v,W,$,H,y,b,N,k,w,L,A,G,S,x=this;this.initialize=function(t,s){(N=$WH.ge(t))&&(m=e.getVars(),_=m.profile,_statistics=m.statistics,_inventory=m.inventory,_talents=m.talents,f=m.tabs,g=s,f.tabs[g]&&(G=f.tabs[g].id,x.resetAll()))},this.setTalents=function(e,s){t(e,s)},this.setGlyphData=function(e,t,s){e&&(A.parentNode.style.display=""),W.setData(e,t,s)},this.resetAll=function(){h=0,v=[];for(var e=0,t="pets"==G?25:2;e<t;++e){var s={talents:""};"pets"==G?(s.spent=0,s.name="",s.family=0,s.npcId=0,s.displayId=0):(s.name=LANG.pr_queue_unknown,s.glyphs="",s.spent=[0,0,0],s.spec=-1,s.scale={},s.filter=""),v.push(s)}H=!1,y=!1,f.getSelectedTab()==g&&x.onShow()},this.updateAll=function(){a(),l()},this.getTalentBuilds=function(){if(!S){u(!0),S=$WH.dO(v[h]),S.active=h,S.talents=[],"pets"!=G&&(S.glyphs=[]);for(var e=0,t=v.length;e<t;++e)S.talents.push(v[e].talents),"pets"!=G&&S.glyphs.push(v[e].glyphs)}return S},this.getTalentRanks=function(e){if($)return d.getTalentRanks(e)},this.hasTitansGrip=function(){return _talents.getTalentRanks(1867)},this.hasBeastMastery=function(){return _talents.getTalentRanks(2139)},this.getWeightScale=function(e){return u(e)},this.onShow=function(e){$||(i(),o(),p(),$=!0),H||(a(),l(),H=!0)}}function ProfilerStatistics(e){function t(e){if(-1!=$WH.in_array(["rage","energy","runic","mana"],e))return e==t();switch(y.classs){case 1:return"rage";case 4:return"energy";case 6:return"runic";default:return"mana"}}function s(e,t,s){for(var i in s){var a=$WH.dO(s);a.source=e,a.sourceId=t,"class"!=e&&"talent"!=e&&(a.diminish=!0),G.push(a),p();break}}function i(e,t,s){for(var i=S[s],n=0,r=0,o=i.modifiers.length;r<o;++r){var l=i.modifiers[r],c=(i.slotMultiple[l.slot]||0)+i.multiple;l.source==e&&l.sourceId==t&&(n+=a(l,c))}return i.decimals||(n=Math.floor(n)),n.toFixed(i.decimals)}function a(e,t){return null!=e.subtotal?e.subtotal:(e.subtotal=0,e.functionOf&&(e.subtotal+=t*e.percent*e.functionOf(y,S)),e.percentOf&&(e.subtotal+=t*e.percent*("level"==e.percentOf?y.level:S[e.percentOf].total)+e.percentBase),e.add&&(e.subtotal+=t*(e.add-e.exclude)+e.exclude),e.subtotal)}function n(e,t){for(var s=[],i=0,a=G.length;i<a;++i)G[i].source==e&&G[i].sourceId==t||s.push(G[i]);G=s,p()}function r(e){for(var t=[],s=0,i=G.length;s<i;++s)G[s].source!=e&&t.push(G[s]);G=t,p()}function o(e){var t=S[e];t.modifiers=[];for(var s=0,i=G.length;s<i;++s)null!=G[s][e]&&t.modifiers.push(l(G[s],e));t.modifiers.sort(function(e,t){return e.multiple!=t.multiple?-$WH.strcmp(e.multiple,t.multiple):e.percentOf!=t.percentOf?-$WH.strcmp(e.percentOf,t.percentOf):$WH.strcmp(e.slot,t.slot)})}function l(e,t){var s=e[t],i=e.source,a=e.sourceId,n=S[t],r={};if("object"==typeof s&&s.length){for(var o=1,l=s.length;o<l;o+=2)r[s[o]]=s[o+1];if(null!=r.percentOf&&(r.percentBase=0,"object"==typeof r.percentOf&&r.percentOf.length&&(r.percentBase=r.percentOf[1],r.percentOf=r.percentOf[0]),r.percentOf==t?(r.multiple=s[0],r.percentBase&&(r.add=r.percentBase),delete r.percentOf,delete r.percentBase):r.percent=s[0]),null!=r.functionOf&&(r.percent=s[0]),r.percentOf&&"level"!=r.percentOf&&null==n.dependent[r.percentOf]&&(n.dependent[r.percentOf]=1,n.ndependent++),null!=r.forSlots){r.slotMultiple={};for(var o=0,l=r.forSlots.length;o<l;++o)r.slotMultiple[r.forSlots[o]]=s[0];delete r.forSlots}if(null!=r.forStance)return{};if(null!=r.forClass&&!b.hasItemClassQty(r.forClass[0],r.forClass[1],r.forClass[2]))return{};r.percent||r.multiple||r.forSlots||(r.add=s[0])}else isNaN(s)||(r={add:s});if(r.source=i,r.sourceId=a,"class"!=i&&"talent"!=i&&(r.diminish=!0),"item"==i&&null!=a&&(r.slot=a),r.exclude=0,n.excludeModifiers)for(var o=0,l=n.excludeModifiers.length;o<l;++o)r.exclude+=e[n.excludeModifiers[o]]||0;return r}function c(){r("stat");for(var i in S){var a=S[i];if(a.addModifiers&&s("stat",i,a.addModifiers()),a.rating){var n=(S[a.rating.stat],{});n[i]=[$WH.g_convertRatingToPercent(y.level,a.rating.id,1,y.classs),"percentOf",a.rating.stat],s("stat",a.rating.stat,n)}}r("race");var o=g_statistics.race[y.race],l={str:o?o[0]:0,agi:o?o[1]:0,sta:o?o[2]:0,int:o?o[3]:0,spi:o?o[4]:0};s("race",y.race,l),s("race",y.race,o?o[5]:0),s("race",y.race,o?o[6]:0),r("class");var c=g_statistics.classs[y.classs],u=g_statistics.combo[y.classs][y.level],l={str:u[0],agi:u[1],sta:u[2],int:u[3],spi:u[4],health:u[5],mleatkpwr:[c[0][3],"percentOf","level"],rgdatkpwr:[c[1][3],"percentOf","level"],dodgepct:c[4]+u[9]*((o?o[1]:0)+u[1]),parrypct:c[6],blockpct:c[8],def:5*y.level};l[t()]=u[6],s("class",y.classs,l),s("class",y.classs,c[9]),s("class",y.classs,c[10]),r("skill");for(var p in y.skills){var d=Math.max(1,75*Math.floor(y.skills[p][0]/75));g_statistics.skills[p]&&g_statistics.skills[p][d]&&(e.fixJson(g_statistics.skills[p][d]),s("skill",p,g_statistics.skills[p][d]))}}function u(){var e={};for(var t in S){var s=S[t];if(s.total=0,s.subtotal=[0,0],s.modifiers=[],null==s.decimals&&(s.decimals=0),null==s.multiple&&(s.multiple=1),null==s.slotMultiple&&(s.slotMultiple={}),null==s.dependent&&(s.dependent={},s.ndependent=0),s.magic){for(var i=0,a=A.length;i<a;++i){var n={total:0,subtotal:[0,0],modifiers:[],dependent:{},ndependent:0,decimals:s.decimals,multiple:s.multiple,slotMultiple:{}};if($WH.cO(n.slotMultiple,s.slotMultiple),s.rating){var r={total:0,subtotal:[0,0],modifiers:[],dependent:{},ndependent:0,decimals:0,multiple:1,slotMultiple:{}};n.rating={id:s.rating.id,stat:A[i]+s.rating.stat},n.tooltipRatings=[n.rating.stat],e[n.rating.stat]=r,n.dependent[n.rating.stat]=1,n.ndependent++}e[A[i]+t]=n,s.dependent[A[i]+t]=1,s.ndependent++}delete s.rating}else if(s.rating){var r={total:0,subtotal:[0,0],modifiers:[],dependent:{},ndependent:0,decimals:0,multiple:1,slotMultiple:{}};s.tooltipRatings||(s.tooltipRatings=[s.rating.stat]),e[s.rating.stat]=r,s.dependent[s.rating.stat]=1,s.ndependent++}}$WH.cO(S,e)}function p(){N>0&&(clearTimeout(N),N=0),N=setTimeout(d,750)}function d(){var e=[],t=[],s={};for(var i in S){var n=S[i];n.multiple=1,n.slotMultiple={},n.magic||o(i),t.push(i),s[i]=0}var r=function(t){for(var i=[],a=0,n=t.length;a<n;++a){var o=t[a],l=S[o],c=0;for(var u in l.dependent)s[u]&&c++;c==l.ndependent?(e.push(o),s[o]=1):i.push(o)}i.length&&i.length!=t.length&&r(i)};r(t);for(var l=0,c=e.length;l<c;++l){var i=e[l],n=S[i],u=[0,0];if(n.total=0,n.subtotal=[0,0],n.magic){n.subtotal[0]=S[A[0]+i].total;for(var p=1,d=A.length;p<d;++p){var m=S[A[p]+i];m.total<n.subtotal[0]&&(n.subtotal[0]=m.total),u[0]=n.subtotal[0]}}else for(var p=0,d=n.modifiers.length;p<d;++p){var f=n.modifiers[p];if(f.multiple)n.multiple+=f.multiple;else if(f.slotMultiple)for(var g in f.slotMultiple)null==n.slotMultiple[g]&&(n.slotMultiple[g]=0),n.slotMultiple[g]+=f.slotMultiple[g];else{var h=(n.slotMultiple[f.slot]||0)+n.multiple,v="race"==f.source||"class"==f.source||"stat"==f.source||"talent"==f.source&&"manargn"!=i||"item"==f.source&&"armor"==i?0:1,W=n.computeDiminished&&f.diminish?1:0;n.subtotal[v]+=a(f,h),u[W]+=a(f,h)}}if(!n.decimals)for(var p=0;p<2;++p)n.subtotal[p]=Math.floor(n.subtotal[p]),u[p]=Math.floor(u[p]);n.computeDiminished?(u[1]=n.computeDiminished(u[1]),n.total=parseFloat(u[0])+parseFloat(u[1])):n.total=parseFloat(n.subtotal[0])+parseFloat(n.subtotal[1]),n.total=n.total.toFixed(n.decimals)}_()}function m(){var e,t,s,i,a,n=$WH.ce("table"),r=$WH.ce("tbody"),o=$WH.ce("tr"),l=$WH.ce("td");n.className="profiler-inventory-stats",L=n,e=$WH.ce("div"),e.className="text",t=$WH.ce("h2"),t.className="clear",t.id="statistics",s=$WH.ce("a"),s.className="header-link",s.href="#statistics",$WH.ae(s,$WH.ct(LANG.pr_stats_title)),$WH.ae(t,s),$WH.ae(e,t),$WH.ae(_container,e),$WH.ae(t,$WH.ct(String.fromCharCode(160))),i=$WH.ce("small"),i.className="q0",$WH.ae(i,$WH.ct(LANG.pr_stats_beta)),$WH.ae(t,i),k=e=$WH.ce("div"),e.className="profiler-inventory-bars",$WH.ae(_container,k),w=e=$WH.ce("div"),e.className="profiler-inventory-resists",$WH.ae(_container,w),e=$WH.ce("div"),e.className="clear pad",$WH.ae(_container,e);for(var c=0,u=x.length;c<u;++c){l=$WH.ce("td"),i=$WH.ce("p"),a=$WH.ce("h3"),l.style.width=100/u+"%",c==u-1&&(i.style.marginRight="0"),$WH.ae(i,a);for(var p=x[c],d=0,m=p.length;d<m;++d){var s,_,g,v,H=p[d],y=H.id,b=S[y];switch(H.type){case"title":s=$WH.ce("a"),s.className="disclosure-off",s.href="javascript:;",$WH.ns(s),p.disclosure=s,s.onclick=f.bind(0,p),$WH.st(s,h(y,H)),$WH.ae(a,s);break;case"bar":var N=g_createProgressBar({color:y});N.style.display="none",H.bar=N,$WH.ae(k,N);break;case"resist":var A=Icon.create(b.icon,1,null,"javascript:;");A.style.cssFloat=A.style.styleFloat="left",s=Icon.getLink(A),s.onmouseover=W.bind(v,y,H),s.onmouseout=$WH.Tooltip.hide,H.icon=A,$WH.ae(w,A);break;default:s=$WH.ce("a"),s.href="javascript:;",s.onmouseover=W.bind(v,y,H),s.onmousemove=$WH.Tooltip.cursorUpdate,s.onmouseout=$WH.Tooltip.hide,v=$WH.ce("var"),$WH.ae(s,v),H.span=v,g=$WH.ce("em"),$WH.ae(g,$WH.ct(h(y))),$WH.ae(s,g),_=$WH.ce("div"),_.className="clear",$WH.ae(s,_),$WH.ae(i,s),_=$WH.ce("small"),_.className="q2",_.style.display="none",H.detail=_,s.onclick=$.bind(_,y,H,null,p),$WH.ae(i,_)}}$WH.ae(l,i),$WH.ae(o,l)}$WH.ae(r,o),$WH.ae(n,r),$WH.ae(_container,L),e=$WH.ce("div"),e.className="pad",$WH.ae(_container,e),_=$WH.ce("div"),_.className="text",$WH.ae(_,$WH.ct(LANG.pr_stats_warning)),$WH.ae(_container,_)}function _(){for(var e=0,s=x.length;e<s;++e)for(var i=x[e],a=0,n=i.length;a<n;++a){var r,o=i[a],l=o.id,c=S[l];switch(o.type){case"title":break;case"bar":t(l)?(r=g(l),$WH.st(o.bar.firstChild.firstChild,h(l)+" "+r),o.bar.style.display=r>0?"":"none"):o.bar.style.display="none";break;case"resist":r=[g(l)],Icon.setNumQty(o.icon,r);break;default:r=g(l),$WH.st(o.span,r),o.span.className=c.subtotal[1]>0?"q2":c.subtotal[1]<0?"q10":"",o.detail.innerHTML=v(l,o,!0)}}}function f(e){for(var t="disclosure-off"==e.disclosure.className,s=0,i=e.length;s<i;++s){var a=e[s],n=a.id;"title"!=a.type&&"bar"!=a.type&&"resist"!=a.type&&$.bind(div,n,a,t,e)()}e.disclosure.className="disclosure-"+(t?"on":"off")}function g(e){var t=S[e];return(t.total<0?0:t.total)+(t.decimals>0&&!t.nopct?"%":"")}function h(e,t){var s=t||S[e];return null!=s.label&&null!=LANG[s.label]?LANG[s.label]:null!=LANG["pr_stats_"+e]?LANG["pr_stats_"+e]:e}function v(e,t,s){var a=S[e],n=a.getTooltip?a.getTooltip():LANG["pr_statstt_"+e];if(buff="",s||(buff+="<b>"+h(e),buff+=" "+(a.total<0?0:a.total)+(a.decimals>0?"%":""),(a.subtotal[1]>0||a.subtotal[1]<0)&&(buff+=" ("+a.subtotal[0].toFixed(a.decimals)+'<span class="'+(a.subtotal[1]<0?'q10">':'q2">+')+a.subtotal[1].toFixed(a.decimals)+"</span>)"),buff+="</b>"),null!=n){var r=[n];if(a.magic){for(var o='<table width="100%">',l=[],c=0,u=A.length;c<u;++c){var p=A[c]+e,d=S[p];if(o+='<tr><td class="q"><span class="moneyschool'+A[c]+'">'+LANG["pr_statstt_"+A[c]]+'</span></td><td class="q" align="right">'+d.total+(a.decimals>0?"%":"")+"</td></tr>",d.tooltipRatings&&0==c)for(var m=0,_=d.tooltipRatings.length;m<_;++m)l.push(S[d.tooltipRatings[m]].total),l.push(i("stat",d.tooltipRatings[m],p))}o+="</table>",r.push(o),r=r.concat(l)}if(a.tooltipRatings)for(var c=0,u=a.tooltipRatings.length;c<u;++c)r.push(S[a.tooltipRatings[c]].total),r.push(i("stat",a.tooltipRatings[c],e));if(a.tooltipModifiers)for(var c=0,u=a.tooltipModifiers.length;c<u;++c)r.push(i("stat",e,a.tooltipModifiers[c]));a.tooltipCompute&&(r=r.concat(a.tooltipCompute(a.total))),r.push(a.total),r.push(y.level),s?buff=$WH.str_replace($WH.str_replace("- "+$WH.str_replace($WH.sprintfo(r),"<br />","\x3c!--br />- "),"\x3c!--br />","<br />"),"- <table","<table"):buff+='<br /><span class="q">'+$WH.sprintfo(r)+"</span>"}return buff}function W(e,t,s){"resist"==t.type?$WH.Tooltip.show(t.icon,v(e,t)):$WH.Tooltip.showAtCursor(s,v(e,t))}function $(e,t,s,i){null==s&&(s="none"==t.detail.style.display),t.detail.style.display=s?"block":"none";for(var a=0,n=i.length;a<n;++a)if(i[a].detail&&"none"==i[a].detail.style.display)return void(i.disclosure.className="disclosure-off");i.disclosure.className="disclosure-on"}var H,y,b,N,k,w,L,A=["arc","fir","fro","hol","nat","sha"],G={},S={str:{getTooltip:function(){return LANG["pr_statstt_str"+(1==y.classs||2==y.classs||7==y.classs?2:"")]},tooltipModifiers:["mleatkpwr","block"],addModifiers:function(){var e=g_statistics.classs[y.classs];return{mleatkpwr:[e[0][1],"percentOf",["str",e[0][1]?e[0][0]/(e[0][2]?2:1):0]],rgdatkpwr:[e[1][1],"percentOf",["str",e[1][1]?e[1][0]/(e[1][2]?2:1):0]],block:[.5,"percentOf",["str",-10]]}}},agi:{tooltipModifiers:["mleatkpwr","mlecritstrkpct","fullarmor"],addModifiers:function(){var e=g_statistics.race[y.race],t=g_statistics.classs[y.classs],s=g_statistics.combo[y.classs][y.level];return{mleatkpwr:[t[0][2],"percentOf",["agi",t[0][2]?t[0][0]/(t[0][1]?2:1):0]],rgdatkpwr:[t[1][2],"percentOf",["agi",t[1][2]?t[1][0]/(t[1][1]?2:1):0]],mlecritstrkpct:[s[7],"percentOf",["agi",t[2][0]]],rgdcritstrkpct:[s[7],"percentOf",["agi",t[2][0]]],fullarmor:[2,"percentOf","agi"],dodgepct:[s[9],"percentOf",["agi",-s[9]*((e?e[1]:0)+s[1])]]}}},sta:{getTooltip:function(){return LANG["pr_statstt_sta"+(3==y.classs||9==y.classs?2:"")]},tooltipModifiers:["health","petsta"],addModifiers:function(){return{health:[10+.8*(Math.max(y.level,80)-80),"percentOf",["sta",-180]],petsta:[.3,"percentOf","sta"]}}},int:{getTooltip:function(){return LANG["pr_statstt_int"+(9==y.classs?2:"")]},tooltipModifiers:["mana","arcsplcritstrkpct","petint"],addModifiers:function(){if(1==y.classs||4==y.classs||6==y.classs)return{};var e=g_statistics.classs[y.classs],t=g_statistics.combo[y.classs][y.level];return{mana:[15,"percentOf",["int",-280]],arcsplcritstrkpct:[t[8],"percentOf",["int",e[2][1]]],firsplcritstrkpct:[t[8],"percentOf",["int",e[2][1]]],frosplcritstrkpct:[t[8],"percentOf",["int",e[2][1]]],holsplcritstrkpct:[t[8],"percentOf",["int",e[2][1]]],natsplcritstrkpct:[t[8],"percentOf",["int",e[2][1]]],shasplcritstrkpct:[t[8],"percentOf",["int",e[2][1]]],petint:9==y.classs?[.3,"percentOf","int"]:0}}},spi:{tooltipModifiers:["healthrgn","spimanargn"],addModifiers:function(){return{healthrgn:[1,"functionOf",function(){var e=S.spi.subtotal[0],t=S.spi.subtotal[1];return e>50&&(t+=e-50,e=50),Math.round(e*g_statistics.combo[y.classs][y.level][10]+t*g_statistics.combo[y.classs][y.level][11])}],spimanargn:[5,"functionOf",function(){return.001+Math.sqrt(S.int.total)*S.spi.total*g_statistics.level[y.level]}]}}},health:{},mana:{},rage:{},energy:{},runic:{},mledps:{decimals:1},mleatkpwr:{tooltipModifiers:["mledps"],addModifiers:function(){return{mledps:[1/14,"percentOf","mleatkpwr"]}}},mlecritstrkpct:{decimals:2,rating:{id:19,stat:"mlecritstrkrtng"}},mlehastepct:{decimals:2,rating:{id:28,stat:"mlehastertng"}},mlehitpct:{decimals:2,rating:{id:16,stat:"mlehitrtng"}},armorpenpct:{rating:{id:44,stat:"armorpenrtng"},decimals:2},exp:{rating:{id:37,stat:"exprtng"},tooltipCompute:function(e){return[(.25*e).toFixed(2)]}},rgddps:{decimals:1},rgdatkpwr:{getTooltip:function(){return LANG["pr_statstt_rgdatkpwr"+(3==y.classs?2:"")]},tooltipModifiers:["rgddps","petatkpwr","petspldmg"],addModifiers:function(){return{rgddps:[1/14,"percentOf","rgdatkpwr"],petatkpwr:3==y.classs?[.22,"percentOf","rgdatkpwr"]:0,petspldmg:3==y.classs?[.1287,"percentOf","rgdatkpwr"]:0}}},rgdhitpct:{decimals:2,rating:{id:17,stat:"rgdhitrtng"}},rgdcritstrkpct:{decimals:2,rating:{id:20,stat:"rgdcritstrkrtng"}},rgdhastepct:{decimals:2,rating:{id:29,stat:"rgdhastertng"}},splheal:{},spldmg:{magic:1,getTooltip:function(){return LANG["pr_statstt_spldmg"+(9==y.classs?2:"")]},tooltipModifiers:["spldmg","petatkpwr","petspldmg"],addModifiers:function(){var e=function(){for(var e=S[A[0]+"spldmg"].total,t=1,s=A.length;t<s;++t)S[A[t]+"spldmg"].total>e&&(e=S[A[t]]);return e};return{petatkpwr:9==y.classs?[.57,"functionOf",e]:0,petspldmg:9==y.classs?[.15,"functionOf",e]:0}}},splhitpct:{decimals:2,rating:{id:18,stat:"splhitrtng"}},splcritstrkpct:{decimals:2,rating:{id:21,stat:"splcritstrkrtng"},magic:1},splhastepct:{decimals:2,rating:{id:30,stat:"splhastertng"}},splpen:{},healthrgn:{},manargn:{addModifiers:function(){return{oocmanargn:[1,"percentOf","manargn"],icmanargn:[1,"percentOf","manargn"]}}},spimanargn:{addModifiers:function(){return{oocmanargn:[1,"percentOf","spimanargn"]}}},oocmanargn:{tooltipCompute:function(e){return[e,S.icmanargn.total]}},icmanargn:{},fullarmor:{label:"pr_stats_armor",getTooltip:function(){return LANG["pr_statstt_armor"+(3==y.classs||9==y.classs?2:"")]},excludeModifiers:["armorbonus"],tooltipModifiers:["petarmor"],tooltipCompute:function(e){var t=y.level>59?y.level+4.5*(y.level-59):y.level,s=.1*e/(8.5*t+40);return s/=1+s,[Math.min(75,100*s).toFixed(2)]},addModifiers:function(){return{petarmor:[.35,"percentOf","fullarmor"]}}},armor:{addModifiers:function(){return{fullarmor:[1,"percentOf","armor"]}}},def:{rating:{id:12,stat:"defrtng"},tooltipModifiers:["parrypct","dodgepct"],addModifiers:function(){var e=function(){var e=g_statistics.classs[y.classs],t=S.def.total-5*y.level;return 16*t*.04/(16*e[3]+.04*t)};return{dodgepct:[1,"functionOf",e],parrypct:[1,"functionOf",e],blockpct:[1,"functionOf",e]}}},dodgepct:{decimals:2,rating:{id:13,stat:"dodgertng"},computeDiminished:function(e){var t=g_statistics.classs[y.classs];return e*t[5]/(t[5]*t[3]+e)}},parrypct:{decimals:2,rating:{id:14,stat:"parryrtng"},computeDiminished:function(e){var t=g_statistics.classs[y.classs];return t[7]?e*t[7]/(t[7]*t[3]+e):0}},blockpct:{decimals:2,rating:{id:15,stat:"blockrtng"},tooltipCompute:function(e){return[S.block.total]}},block:{},resipct:{decimals:2,rating:{id:35,stat:"resirtng"},tooltipCompute:function(e){return[e,(2.2*e).toFixed(2),(2*e).toFixed(2)]}},arcres:{icon:"spell_arcane_blast",getTooltip:function(){return $WH.sprintf(LANG.pr_statstt_resist,LANG.pr_statstt_arc)},tooltipCompute:function(e){return[Math.min(75,e/(5*y.level)*75).toFixed(2)]},addModifiers:function(){return{petarcres:[.4,"percentOf","arcres"]}}},firres:{icon:"spell_fire_burnout",getTooltip:function(){return $WH.sprintf(LANG.pr_statstt_resist,LANG.pr_statstt_fir)},tooltipCompute:function(e){return[Math.min(75,e/(5*y.level)*75).toFixed(2)]},addModifiers:function(){return{petfirres:[.4,"percentOf","firres"]}}},frores:{icon:"spell_frost_arcticwinds",getTooltip:function(){return $WH.sprintf(LANG.pr_statstt_resist,LANG.pr_statstt_fro)},tooltipCompute:function(e){return[Math.min(75,e/(5*y.level)*75).toFixed(2)]},addModifiers:function(){return{petfrores:[.4,"percentOf","frores"]}}},holres:{icon:"spell_holy_powerwordbarrier",getTooltip:function(){return $WH.sprintf(LANG.pr_statstt_resist,LANG.pr_statstt_hol)},tooltipCompute:function(e){return[Math.min(75,e/(5*y.level)*75).toFixed(2)]},addModifiers:function(){return{petholres:[.4,"percentOf","holres"]}}},natres:{icon:"ability_druid_flourish",getTooltip:function(){return $WH.sprintf(LANG.pr_statstt_resist,LANG.pr_statstt_nat)},tooltipCompute:function(e){return[Math.min(75,e/(5*y.level)*75).toFixed(2)]},addModifiers:function(){return{petnatres:[.4,"percentOf","natres"]}}},shares:{icon:"spell_shadow_shadowfury",getTooltip:function(){return $WH.sprintf(LANG.pr_statstt_resist,LANG.pr_statstt_sha)},tooltipCompute:function(e){return[Math.min(75,e/(5*y.level)*75).toFixed(2)]},addModifiers:function(){return{petshares:[.4,"percentOf","shares"]}}},petsta:{},petint:{},petatkpwr:{dependent:{rgdatkpwr:1,spldmg:1},ndependent:2},petspldmg:{dependent:{rgdatkpwr:1,spldmg:1},ndependent:2},petarmor:{},petarcres:{},petfirres:{},petfrores:{},petholres:{},petnatres:{},petshares:{}},x=[[{id:"base",type:"title"},{id:"health",type:"bar"},{id:"mana",type:"bar"},{id:"rage",type:"bar"},{id:"energy",type:"bar"},{id:"runic",type:"bar"},{id:"str"},{id:"agi"},{id:"sta"},{id:"int"},{id:"spi"}],[{id:"melee",type:"title"},{id:"mleatkpwr"},{id:"mlehitpct"},{id:"mlecritstrkpct"},{id:"mlehastepct"},{id:"armorpenpct"},{id:"exp"}],[{id:"ranged",type:"title"},{id:"rgdatkpwr"},{id:"rgdhitpct"},{id:"rgdcritstrkpct"},{id:"rgdhastepct"},{id:"armorpenpct"}],[{id:"spell",type:"title"},{id:"spldmg"},{id:"splheal"},{id:"splhitpct"},{id:"splcritstrkpct"},{id:"splhastepct"},{id:"splpen"},{id:"oocmanargn"}],[{id:"defenses",type:"title"},{id:"fullarmor"},{id:"def"},{id:"dodgepct"},{id:"parrypct"},{id:"blockpct"},{id:"resipct"},{id:"arcres",type:"resist"},{id:"firres",type:"resist"},{id:"frores",type:"resist"},{id:"natres",type:"resist"},{id:"shares",type:"resist"}]];this.initialize=function(t,s){_container=$WH.ge(t),_container&&(H=e.getVars(),y=H.profile,b=H.inventory,u(),m())},this.addModifiers=function(e,t,i){s(e,t,i)},this.removeModifiers=function(e,t){n(e,t)},this.removeAllModifiers=function(e){r(e)},this.updateModifiers=function(){c()}}function ProfilerInventory(_parent){function _isSlotNeeded(e,t){var s=!0;if(s=s&&(!_data[e].classes||-1!=_profile.classs&&$WH.array_index(_data[e].classes,_profile.classs)),t&&17==e&&!_talents.hasTitansGrip()){var i=_getSlotItem(16)[0];s=s&&(!i||!g_items[i]||17!=g_items[i].jsonequip.slotbak)}return s}function _setInventory(e){if(_inited=!1,e)for(var t=0,s=_data.length;t<s;++t){var i=_getSlotItem(t);if(_data[t].history=[],null!=e[_data[t].id]&&8==e[_data[t].id].length){var i=e[_slots[t].id];_equipItem(i[0],t,1),_equipSubitem(i[1],t),_enchantItem(i[2],t);for(var a=4;a<8;++a)_socketItem(i[a],a,t)}}else for(var t=0,s=_data.length;t<s;++t)_unequipItem(t);_inited=!0,_updateInventory()}function _updateInventory(){for(var e=0,t=_data.length;e<t;++e)$WH.cO(_data[e],_slots[e]),2!=_slots[e].nomodel&&(_data[e].nomodel=_profile.nomodel&1<<e?1:0);_talents.hasTitansGrip()&&_data[17].itemslots.push(17),3==_profile.classs?(_data[16].nomodel=_data[17].nomodel=1,_data[18].nomodel=0):_data[18].nomodel=1,5976!=_getSlotItem(6)[0]&&69209!=_getSlotItem(6)[0]&&69210!=_getSlotItem(6)[0]||(_data[6].nomodel=1),_updateModel(),_updateAllIcons(),_updateAllMenus(),_updateListview()}function _getInventory(){for(var e={},t=0,s=_data.length;t<s;++t)_isSlotNeeded(t)&&(e[_data[t].id]=_getSlotItem(t));return e}function _getGearScore(e){for(var t,s,e=_getValidSlot(e),i=_talents.getTalentBuilds(),a={},n=1,r=1,o=0,l=_data.length;o<l;++o){var c=_getSlotItem(o);a[o]={item:0,ench:0,gems:0},c[0]&&g_items[c[0]]&&(16==o?t=g_items[c[0]].jsonequip:17==o?s=g_items[c[0]].jsonequip:a[o].item+=Math.round(g_items[c[0]].jsonequip.gearscore));var u=0;c[2]&&g_enchants[c[2]]&&(u=Math.round(g_enchants[c[2]].gearscore)),18==_data[o].id&&3!=_profile.classs&&(a[o].bonus=u=Math.max(u,20)),c[2]&&g_enchants[c[2]]?a[o].ench+=u:c[0]&&(a[o].item+=u);for(var p=0;p<4;++p)c[p+4]&&g_gems[c[p+4]]&&(a[o].gems+=Math.round(g_gems[c[p+4]].gearscore))}if(t&&(s?21!=t.slotbak&&13!=t.slotbak||(22==s.slotbak||13==s.slotbak?(6==_profile.classs||3==_profile.classs||4==_profile.classs||7==_profile.classs&&i.spent[1]>30&&2==i.spec||1==_profile.classs&&i.spent[1]<51&&2==i.spec)&&(n=64/27,r=64/27):23!=s.slotbak&&14!=s.slotbak||(5==_profile.classs||9==_profile.classs||8==_profile.classs||11==_profile.classs&&(1==i.spec||3==i.spec)||7==_profile.classs&&(1==i.spec||3==i.spec)||2==_profile.classs&&(1==i.spec||2==i.spec)||1==_profile.classs&&3==i.spec)&&(n=64/27,r=16/9)):17==t.slotbak&&(5==_profile.classs||9==_profile.classs||8==_profile.classs||11==_profile.classs||3==_profile.classs||6==_profile.classs||7==_profile.classs&&i.spent[1]<31&&2==i.spec||2==_profile.classs&&3==i.spec||1==_profile.classs&&1==i.spec)&&(n=2,r=0)),t&&(a[16].item+=Math.round(t.gearscore*n)),s&&(a[17].item+=Math.round(s.gearscore*r)),-1!=e)return a[e];var d={item:0,ench:0,gems:0};for(var o in a)_isSlotNeeded(o)&&(d.item+=a[o].item,d.ench+=a[o].ench,d.gems+=a[o].gems);return d}function _getAverageLevel(){for(var e=0,t=0,s=0,i=_data.length;s<i;++s)if(5!=s&&6!=s){var a=_getSlotItem(s);a[0]&&g_items[a[0]]?(e+=g_items[a[0]].jsonequip.level,t++):_isSlotNeeded(s,1)&&t++}return Math.floor(e/t)}function _showUpgradesMenu(e){e=$WH.$E(e);var t=_getInventory(),s=_talents.getTalentBuilds(),i=[],a=[];for(var n in t)t[n][0]&&i.push(t[n][0]);var r="?items&filter=maxrl="+_profile.level+";si="+(_profile.faction+1)+";ub="+_profile.classs+";cr=161;crs=1;crv=0$1;gb=1;upg="+i.join(":");if(a.push([0,s.name,$WH.sprintf(r,s.filter),null,{newWindow:!0}]),g_user.weightscales&&g_user.weightscales.length)for(var n=0,o=g_user.weightscales.length;n<o;++n){var l=g_user.weightscales[n];a.push([0,l.name,$WH.sprintf(r,pr_getScaleFilter(l)),null,{newWindow:!0}])}var c=$WH.g_getCursorPos(e);Menu.showAtXY(a,c.x,c.y)}function _compare(){var e=_getInventory(),t=[];for(var s in e)e[s][0]&&t.push(e[s].join(".").replace(/(\.0)+$/,""));su_addToSaved(t.join(":"),t.length,!0,_profile.level)}function _initModel(){var e=$WH.ce("div"),t=_divModel=$WH.ce("div");e.className="profiler-model-outer",t.className="profiler-model",_swfModel=$WH.ce("div"),_swfModel.id="hsae8y8hjidj",$WH.ae(t,_swfModel),$WH.ae(e,t),_container.parentNode.parentNode.insertBefore(e,_container.parentNode),function(){var e=$WH.Tooltip.hide;oldShow=$WH.Tooltip.show,$WH.Tooltip.hide=function(){e.apply(this);var t=$WH.ge(_swfModel.id);t&&(t.style.visibility="visible")},$WH.Tooltip.show=function(e,t,s,i,a,n){if(oldShow.apply(this,[e,t,s,i,a,n]),"visible"==$WH.Tooltip.tooltip.style.visibility){var r=$WH.ge(_swfModel.id);if(r){try{var o=r.getBoundingClientRect(),l=$WH.Tooltip.tooltip.getBoundingClientRect()}catch(e){return}var c=!0;c&=l.bottom>o.top&&l.top<o.bottom,c&=l.right>o.left&&l.left<o.right;var u=c?"hidden":"visible";u!=r.style.visibility&&(r.style.visibility=u)}}}}(window)}function _updateModel(e,t){if(g_user.cookies&&0==g_user.cookies.profiler3d){if(!_mvInited){$WH.ee(_swfModel);var s=RedButton.create(LANG.button_viewin3d,!0);s.onclick=function(){g_user.cookies.profiler3d=1,_updateModel(-1,1)},$WH.ae(_swfModel,s),_mvInited=!0}}else{for(var e=_getValidSlot(e),i=[],a=[],n=0,r=_data.length;n<r;++n)if(-1==e||n==e){var o=_getSlotItem(n)[0];!_data[n].nomodel&&g_items[o]?(i.push(16!=n&&17!=n||14==g_items[o].jsonequip.slotbak?g_items[o].jsonequip.slotbak:_data[n].itemslots[0]),i.push(g_items[o].jsonequip.displayid)):a.push(_data[n].itemslots[0])}if(!_mvInited||t){var l={model:g_file_races[_profile.race]+g_file_genders[_profile.gender],modelType:16,equipList:i,sk:_profile.skincolor,ha:_profile.hairstyle,hc:_profile.haircolor,fa:_profile.facetype,fh:_profile.features,fc:_profile.haircolor,mode:3,contentPath:g_staticDataUrl+"/modelviewer/"},c={wmode:"direct",quality:"high",allowscriptaccess:"always",allowfullscreen:!0,menu:!1,bgcolor:"#141414"},u={style:"outline: none"};swfobject.embedSWF(g_staticDataUrl+"/modelviewer/ZAMviewerfp11.swf",_swfModel.id,"100%","100%","10.0.0",g_staticDataUrl+"/modelviewer/expressInstall.swf",l,c,u),_mvInited=!0}else if(_swfModel=$WH.ge(_swfModel.id),_swfModel.clearSlots){_swfModel.setAppearance(_profile.hairstyle,_profile.haircolor,_profile.facetype,_profile.skincolor,_profile.features,_profile.haircolor);try{_swfModel.clearSlots(a)}catch(e){}i.length&&_swfModel.attachList(i)}}}function _toggleDisplay(e){var e=_getValidSlot(e,1);2!=_data[e].nomodel&&(_data[e].nomodel=!_data[e].nomodel,_profile.nomodel^=1<<e,_data[e].nomodel||(16!=e&&17!=e||2==_data[18].nomodel?18==e&&(_data[16].nomodel=_data[17].nomodel=1,_updateModel(16),_updateMenu(16),_updateModel(17),_updateMenu(17)):(_data[18].nomodel=1,_updateModel(18),_updateMenu(18))),_updateModel(e),_updateIcon(e),_updateMenu(e))}function _initCharacter(){var e,t,s,i=$WH.ce("div"),a=$WH.ce("div"),n=$WH.ce("div"),r=$WH.ce("div");_divInventory=e=$WH.ce("div"),e.className="profiler-inventory",t=$WH.ce("div"),t.className="profiler-inventory-inner",i.className="profiler-inventory-left",a.className="profiler-inventory-right",n.className="profiler-inventory-bottom",r.className="profiler-inventory-buttons",_btnCompare=RedButton.create(LANG.button_compare,!0,_compare),_btnUpgrades=RedButton.create(LANG.button_upgrades,!0,_showUpgradesMenu),$WH.ae(r,_btnCompare),$WH.ae(r,_btnUpgrades),$WH.ae(t,i),$WH.ae(t,a),$WH.ae(t,n),$WH.ae(t,r),$WH.ae(_divInventory,t),$WH.ae(_container,_divInventory);for(var o=0,l=_slots.length;o<l;++o)_data[o]=$WH.dO(_slots[o]),_data[o].history=[[0,0,0,0,0,0,0,0]];for(var o=0,l=_data.length;o<l;++o)_data[o].icon=Icon.create("inventoryslot_"+_data[o].name,1,null,"javascript:;"),$WH.ae(o<8?i:o<16?a:n,_data[o].icon),s=Icon.getLink(_data[o].icon),s.oncontextmenu=s.onclick=$WH.rf,s.onmouseup=_onMouseUpSlot.bind(0,o,s);e=$WH.ce("div"),e.style.clear="left",$WH.ae(_container,e),div=$WH.ce("div"),div.className="text",div.style.width="290px",div.style.marginTop="25px",$WH.ae(div,$WH.ct(_shiftClick?LANG.pr_tip_sclkopt:LANG.pr_tip_rclkopt)),$WH.ae(_container,div)}function _getValidSlot(e,t,s){var i=-1;if(t&&-1!=_currentSlot?i=_currentSlot:"number"==typeof e?i=e:"string"!=typeof e||isNaN(parseInt(e))||(i=parseInt(e)),-1!=i&&s)for(var a=0,n=_data.length;a<n;++a)if($WH.array_index(_data[a].itemslots,i))return a;return(s||i>=_data.length)&&(i=-1),i}function _getValidSocket(e,t){var s=-1;return t&&-1!=_currentSocket?s=_currentSocket:"number"==typeof e?s=e:"string"!=typeof e||isNaN(parseInt(e))||(s=parseInt(e)),(s<4||s>8)&&(s=-1),s}function _getSlotItem(e){var e=_getValidSlot(e),t=_data[e];return-1!=e&&t.history.length?t.history[t.history.length-1]:[0,0,0,0,0,0,0,0]}function _isSlotEmpty(e){var t=_getSlotItem(e)[0];return!t||!g_items[t]}function _hasEnhancements(e){for(var t=_getSlotItem(e),s=1;s<9;++s)if(0!=t[s])return!0;return!1}function _clearEnhancements(e){_unsocketAllItem(e),_unenchantItem(e)}function _equipItem(e,t,s){var i=t,t=_getValidSlot(t,1),a=_getSlotItem(t);if(e!=a[0]){if(!e)return _unequipItem(t);a[0]||_data[t].history.splice(-1,1),_clearEnhancements(t),_data[t].history.push([e,0,0,0,0,0,0,0]),a[2]&&_enchantItem(a[2],t);for(var n=4;n<8;++n)a[n]&&_socketItem(a[n],n,t);_parent.updateSavedChanges(),_updateModel(i),_updateAllIcons(),_updateHeirloom(t),_updateMenu(t),_updateListview(),_updateItemSets(),_statistics.removeModifiers("item",t),_isSlotNeeded(t)&&g_items[e]&&_statistics.addModifiers("item",t,g_items[e].jsonequip),g_items[e]&&g_items[e].jsonequip.subitems&&!s&&_openSubitemPicker(t)}}function _unequipItem(e){var e=_getValidSlot(e,1);_isSlotEmpty(e)||(_clearEnhancements(e),_data[e].history.push([0,0,0,0,0,0,0,0]),_parent.updateSavedChanges(),_updateModel(e),_updateAllIcons(),_updateMenu(e),_updateListview(),_updateItemSets(),_statistics.removeModifiers("item",e))}function _updateItemSets(){for(var e={},t={},s=0,i=_data.length;s<i;++s)if(_isSlotNeeded(s)){var a=_getSlotItem(s)[0];if(g_items[a]){var n=g_items[a].jsonequip.itemset,r=g_itemsets[n];r&&(n=r.idbak,null==e[n]&&(e[n]={}),e[n][a]=1,t[n]=r)}}_statistics.removeAllModifiers("itemset");for(var n in e){var o=t[n],l=0;if(o.setbonus){for(var a in e[n])l++;for(var c in o.setbonus){if(c>l)break;_statistics.addModifiers("itemset",10*n+c,o.setbonus[c])}}}}function _getItemClassQty(e,t){for(var s=0,i=0,a=_data.length;i<a;++i){var n=_getSlotItem(i)[0];g_items[n]&&g_items[n].jsonequip.classs==e&&1<<g_items[n].jsonequip.subclass&t&&s++}return s}function _hasItemClassQty(e,t,s){return _getItemClassQty(e,t)>=s}function _equipSubitem(e,t){var s=_getSlotItem(t);if(e!=s[1]&&g_items[s[0]].jsonequip.subitems&&g_items[s[0]].jsonequip.subitems[e]){if(!e)return _unequipSubitem(t);s=s.slice(0),s[1]=e,_data[t].history.push(s),_parent.updateSavedChanges(),_updateIcon(t),_updateMenu(t),_updateListview(),_statistics.removeModifiers("subitem",t),
_isSlotNeeded(t)&&_statistics.addModifiers("subitem",t,g_items[s[0]].jsonequip.subitems[e].jsonequip)}}function _unequipSubitem(e){var t=_getSlotItem(e);!_isSlotEmpty(e)&&t[1]&&(t=t.slice(0),t[1]=0,_data[e].history.push(t),_parent.updateSavedChanges(),_updateIcon(e),_updateMenu(e),_updateListview(),_statistics.removeModifiers("subitem",e))}function _socketItem(e,t,s){var i=_getSlotItem(s);if(e!=i[t]){if(!e||t>=_getExtraSocketPos(i[0])+(_canBeSocketed(s)?1:0))return _unsocketItem(t,s,!0);i=i.slice(0),i[t]=e,_data[s].history.push(i),_parent.updateSavedChanges(),_updateIcon(s),_updateMenu(s),_updateListview(),_statistics.removeModifiers("gem",10*s+(t-4)),g_gems[e]&&(_isSlotNeeded(s)&&_statistics.addModifiers("gem",10*s+(t-4),g_gems[e].jsonequip),_statistics.removeModifiers("socket",s),_isSlotNeeded(s)&&_hasSocketBonus(s)&&_statistics.addModifiers("socket",s,g_items[i[0]].jsonequip.socketbonusstat))}}function _unsocketItem(e,t,s){var i=_getSlotItem(t);if(!_isSlotEmpty(t)&&i[e]){var a=_getExtraSocketPos(i[0]);i=i.slice(0),i[e]=e==a&&s?-1:0,_data[t].history.push(i),_parent.updateSavedChanges(),_updateIcon(t),_updateMenu(t),_updateListview(),_statistics.removeModifiers("gem",10*t+(e-4)),_statistics.removeModifiers("socket",t),_isSlotNeeded(t)&&_hasSocketBonus(t)&&_statistics.addModifiers("socket",t,g_items[i[0]].jsonequip.socketbonusstat)}}function _unsocketAllItem(e){for(var t=4;t<8;++t)_unsocketItem(t,e,!1);_hasExtraSocket(e)&&_toggleExtraSocket(e)}function _toggleExtraSocket(e){var t=_getSlotItem(e),s=_getExtraSocketPos(t[0]);_hasExtraSocket(e)?_unsocketItem(s,e,!1):_socketItem(-1,s,e)}function _getExtraSocketPos(e){return e&&g_items[e]?4+(0|g_items[e].jsonequip.nsockets):4}function _hasExtraSocket(e){var t=_getSlotItem(e),s=_getExtraSocketPos(t[0]);return _canBeSocketed(e)&&t[s]?1:0}function _canBeSocketed(e){var e=_getValidSlot(e);_getSlotItem(e)[0];return 1==_data[e].socket&&(null==_data[e].socketlevel||_data[e].socketlevel<=_profile.level)||2==_data[e].socket&&(_profile.user||_profile.skills&&_profile.skills[_data[e].socketskill]&&_profile.skills[_data[e].socketskill][0]>=400)}function _getMetaCondition(){for(var e={t:0},t=0,s=_data.length;t<s;++t){var i=_getSlotItem(t);if(g_items[i[0]])for(var a=0;a<4;++a){var n=i[a+4];if(n&&g_gems[n]&&g_gems[n].condition)for(var r in g_gems[n].condition)e[r]||(e[r]=0),e[r]+=g_gems[n].condition[r],e.t+=g_gems[n].condition[r]}}return e}function _enchantItem(e,t){var s=_getSlotItem(t);if(e!=s[2])return e?void(g_enchants[e]&&(s=s.slice(0),s[2]=e,_data[t].history.push(s),_parent.updateSavedChanges(),_updateIcon(t),_updateMenu(t),_updateListview(),_statistics.removeModifiers("enchant",t),_isSlotNeeded(t)&&_statistics.addModifiers("enchant",t,g_enchants[e].jsonequip))):_unenchantItem(t)}function _unenchantItem(e){var t=_getSlotItem(e);!_isSlotEmpty(e)&&t[2]&&(t=t.slice(0),t[2]=0,_data[e].history.push(t),_parent.updateSavedChanges(),_updateIcon(e),_updateMenu(e),_updateListview(),_statistics.removeModifiers("enchant",e))}function _canBeEnchanted(e){var e=_getValidSlot(e),t=_getSlotItem(e)[0];return 1==_data[e].enchant&&(null==_data[e].enchantlevel||_data[e].enchantlevel<=_profile.level)||2==_data[e].enchant&&(_profile.user||_profile.skills&&_profile.skills[_data[e].enchantskill]&&_profile.skills[_data[e].enchantskill][0]>=360)||3==_data[e].enchant&&g_items[t]&&!$WH.array_index(_data[e].noenchantclasses,g_items[t].jsonequip.subclass)}function _onMouseUpSlot(e,t,s){if(s=$WH.$E(s),_currentSlot=e,3==s._button||s.shiftKey||s.ctrlKey){var i=$WH.g_getCursorPos(s);setTimeout(Menu.showAtXY.bind(null,t.menu,i.x,i.y),1),$WH.Tooltip.hide()}return!1}function _onKeyUpSearch(e){var t=$WH.trim(_spSearchName.value.replace(/\s+/g," "));t==_currentSearch&&isNaN(e)||(_currentSearch=t,_prepareSearch(t,e))}function _onKeyDownSearch(e){e=$WH.$E(e);e._target;switch(e.keyCode){case 13:_lvItems.submitSearch(e);break;case 27:hide();break;case 38:cycle(0);break;case 40:cycle(1)}}function _updateAllMenus(){for(var e=0,t=_data.length;e<t;++e)_updateMenu(e)}function _updateMenu(e,t){if(_inited){var e=_getValidSlot(e),s=_getSlotItem(e),i=s[0],a=s[0]+"",n=_hasExtraSocket(e),r=_talents.getTalentBuilds();if(null==t&&(t=Icon.getLink(_data[e].icon)),t.menu=[[,g_item_slots[_data[e].itemslots[0]]],[0,s[0]?LANG.pr_menu_replace:LANG.pr_menu_equip,_openItemPicker.bind(this,e)]],!_isSlotEmpty(e)){if(t.menu.push([0,LANG.pr_menu_unequip,_unequipItem.bind(this,e)]),(s[1]||null!=g_items[i].jsonequip.subitems)&&t.menu.push([0,s[1]?LANG.pr_menu_repsubitem:LANG.pr_menu_addsubitem,_openSubitemPicker.bind(this,e)]),a+="."+(s[1]||"0"),s[2]||_canBeEnchanted(e)){var o=[0,s[2]?LANG.pr_menu_repenchant:LANG.pr_menu_addenchant,_openEnchantPicker.bind(this,e),null,{}];s[2]&&g_enchants[s[2]]&&(o[4].tinyIcon=g_enchants[s[2]].icon),t.menu.push(o)}if(a+="."+(s[2]||"0"),a+="."+(s[3]||"0"),g_items[i].jsonequip.nsockets||n)for(var l=0,c=(0|g_items[i].jsonequip.nsockets)+n;l<c;++l){var u=s[l+4]>0?s[l+4]:0,p=n&&l==c-1?14:g_items[i].jsonequip["socket"+(l+1)],o=[0,u?LANG.pr_menu_repgem:LANG.pr_menu_addgem,_openGemPicker.bind(this,p,4+l,e),null,{}];g_gems[u]?o[4].tinyIcon=g_gems[u].icon:o[4].socketColor=p,t.menu.push(o),a+="."+(u||(n&&l==c-1?-1:0))}if(n||_canBeSocketed(e)){var o=[0,LANG.pr_menu_extrasock,_toggleExtraSocket.bind(this,e)];o.checked=n,t.menu.push(o)}if(_hasEnhancements(e)&&t.menu.push([0,LANG.pr_menu_clearenh,_clearEnhancements.bind(this,e)]),2!=_data[e].nomodel){var o=[0,LANG.pr_menu_display,_toggleDisplay.bind(this,e)];o.checked=!_data[e].nomodel,t.menu.push(o)}t.menu.push([,LANG.pr_menu_links]),t.menu.push([0,LANG.pr_menu_compare,su_addToSaved.bind(this,a.replace(/(\.0)+$/,""),1,!0,_profile.level)])}if(1!=_data[e].noupgrade){_isSlotEmpty(e)&&t.menu.push([,LANG.pr_menu_links]);var d="?items"+(_data[e].weapon?1==_data[e].weapon?"=2":"":"=4")+"&filter="+(_data[e].noupgrade&&g_items[i]?"sl="+_data[e].itemslots.join(":")+";minle="+g_items[i].jsonequip.level+";":"")+"maxrl="+_profile.level+";si="+(_profile.faction+1)+";ub="+_profile.classs+";cr=161;crs=1;crv=0"+(_data[e].noupgrade?"":"$1"+(_data[e].weapon?";gb=1":";gb=3")+(i?";upg="+i+(_data[e].weapon&&g_items[i]?"#"+g_urlize(g_item_slots[g_items[i].jsonequip.slot]):""):"")),o=[0,LANG.pr_menu_upgrades,null,[]];if(o[3].push([0,r.name,$WH.sprintf(d,r.filter),null,{newWindow:!0}]),g_user.weightscales&&g_user.weightscales.length)for(var l=0,c=g_user.weightscales.length;l<c;++l){var m=g_user.weightscales[l];o[3].push([0,m.name,$WH.sprintf(d,pr_getScaleFilter(m)),null,{newWindow:!0}])}t.menu.push(o)}if(!_isSlotEmpty(e)){var o=[0,LANG.pr_menu_whowears,"?profiles&filter=cr=21;crs=0;crv="+i+"&sort=2",null,{newWindow:!0}];t.menu.push(o)}}}function _updateAllHeirlooms(){for(var e=0,t=_data.length;e<t;++e)_updateHeirloom(e)}function _updateHeirloom(e){var e=_getValidSlot(e),t=_getSlotItem(e)[0];g_items[t]&&7==g_items[t].quality&&($WH.g_setJsonItemLevel(g_items[t].jsonequip,_profile.level),g_items.add(t,g_items[t]),_statistics.removeModifiers("item",e),_isSlotNeeded(e)&&_statistics.addModifiers("item",e,g_items[t].jsonequip))}function _updateAllIcons(){for(var e=0,t=_data.length;e<t;++e)_updateIcon(e)}function _updateIcon(e){var e=_getValidSlot(e),t=_getSlotItem(e),s=t[0],i=_data[e].icon,a=Icon.getLink(i);i.className=i.className.replace(/ iconmedium-q[0-9]+/,""),_isSlotEmpty(e)?(Icon.setTexture(i,1,"inventoryslot_"+_data[e].name),a.onclick=$WH.rf,a.onmouseover=_showEmptyItemTooltip.bind(a,e),a.onmouseout=$WH.Tooltip.hide,a._fixTooltip=null,a.href="javascript:;",a.className="",a.rel=""):(Icon.setTexture(i,1,g_items[s].icon.toLowerCase()),a.onclick=$WH.Browser.opera||$WH.OS.mac?function(e){if(e=$WH.$E(e),e.shiftKey||e.ctrlKey)return!1}:null,a.onmouseover=null,a.onmouseout=null,a._fixTooltip=_fixItemTooltip.bind(a,e),a.href="?item="+s,a.rel=_getItemRel(e),i.className+=" iconmedium-"+_getItemHilite(e)),i.style.display=_isSlotNeeded(e)?"":"none"}function _updateWeightedSort(e){if(!_spSortWeighted){var t=$WH.ce("small");t.style.display="none";var s=$WH.ce("span");s.style.padding="0 8px",s.style.color="white",$WH.ae(s,$WH.ct("|")),$WH.ae(t,s),$WH.ae(t,$WH.ct(LANG.pr_note_sort+" "));var i=$WH.ce("select");$WH.ae(t,i),_spSortWeighted=t}var i=$("select",_spSortWeighted)[0],a=$WH.ce("option");$WH.ee(i),$WH.ae(i,a);var n=_talents.getTalentBuilds();if(n.scale&&(a=$WH.ce("option"),a.scale=n.scale,a.selected=a.scale==_currentScale,$WH.st(a,n.name),$WH.ae(i,a)),g_user.weightscales&&g_user.weightscales.length)for(var r=0,o=g_user.weightscales.length;r<o;++r)a=$WH.ce("option"),a.scale=g_user.weightscales[r],a.selected=a.scale==_currentScale,$WH.st(a,g_user.weightscales[r].name),$WH.ae(i,a);_spSortWeighted.style.display=i.childNodes.length>1?"":"none",e&&($WH.ae($WH.ce("div"),_spSortWeighted),$("span",_spSortWeighted)[0].style.display=$("small",e.getNoteTopDiv()).length?"":"none",$WH.ae(e.getNoteTopDiv(),_spSortWeighted),i.onchange=_sortPickerWindow.bind(this,e,1),i.onchange())}function _showEmptyItemTooltip(e){$WH.Tooltip.show(this,"<b>"+g_item_slots[_data[e].itemslots[0]]+"</b>",0,0,"q")}function _showEmptyGemTooltip(e){$WH.Tooltip.show(this,"<b>"+g_socket_names[e]+"</b>",0,0,"q")}function _fixItemTooltip(e,t){var s=_getSlotItem(e),i=[];if(g_items[s[0]]){var a=g_enchants[s[2]];a&&a.jsonequip.reqlevel>g_items[s[0]].jsonequip.level&&(t=t.replace(new RegExp('<span class="q2">\x3c!--ee--\x3e(.+?)</span>',"g"),'<span class="q10">$1<br />'+$WH.sprintf(LANG.pr_tt_enchreq,a.jsonequip.reqlevel)+"</span>"));var n=t.match(new RegExp('<(a|span)( href=.+?)? class="[^"]*socket.+?</(a|span)>',"g"));if(null!=n)for(var r=0;r<4;++r)n[r]&&s[r+4]&&g_gems[s[r+4]]&&g_gems[s[r+4]].socketlevel>g_items[s[0]].jsonequip.level&&(t=t.replace(n[r],n[r].replace(new RegExp("q[0-9]+","g"),"q10")));if(g_items[s[0]].jsonequip.itemset)for(var o=0,l=_data.length;o<l;++o){var c=_getSlotItem(o)[0];g_items[c]&&g_items[c].jsonequip.itemset==g_items[s[0]].jsonequip.itemset&&i.push(c)}var u=_getItemErrors(e),p=u.errors;return(p.level||p.ench||p.gems||p.sock)&&(t+='<br /><span class="q10">'),p.level&&(t+=$WH.sprintf(LANG.pr_inv_item,LANG.pr_inv_lowlevel.replace(": ",""))),(p.ench||p.gems||p.sock)&&(p.level&&(t+=LANG.dash),t+=LANG.pr_inv_missing,p.gems&&(t+=$WH.sprintf(1==p.gems?LANG.pr_inv_gem:LANG.pr_inv_gems,p.gems)),p.sock&&p.gems&&(t+=LANG.comma),p.sock&&(t+=$WH.sprintf(1==p.sock?LANG.pr_inv_socket:LANG.pr_inv_sockets,p.sock)),p.ench&&(p.gems||p.sock)&&(t+=LANG.comma),p.ench&&(t+=$WH.sprintf(1==p.ench?LANG.pr_inv_enchant:LANG.pr_inv_enchants,p.ench))),(p.level||p.ench||p.gems||p.sock)&&(t+="</span>"),t}}function _getItemRel(e){var t=_getSlotItem(e),s=_hasExtraSocket(e),i=[],a=[],n=[];if(g_items[t[0]]){t[1]&&i.push("rand="+t[1]),t[2]&&i.push("ench="+t[2]);for(var r=0,o=(0|g_items[t[0]].jsonequip.nsockets)+s;r<o;++r)a.push(t[4+r]>0?t[4+r]:0);if(a.length&&i.push("gems="+a.join(":")),s&&i.push("sock"),g_items[t[0]].jsonequip.itemset){for(var r=0,o=_data.length;r<o;++r){var l=_getSlotItem(r)[0];g_items[l]&&g_items[l].jsonequip.itemset&&n.push(l)}i.push("pcs="+n.join(":"))}_profile.level&&i.push("lvl="+_profile.level),_profile.classs&&i.push("c="+_profile.classs);var c=i.join("&");return c&&(c="&"+c),c}}function _getItemHilite(e){var t=_getSlotItem(e)[0];if(g_items[t]){var s=g_items[t].jsonequip;return s.reqlevel>_profile.level||s.reqclass&&!(s.reqclass&1<<_profile.classs-1)||s.subclass>0&&14!=s.subclass&&20!=s.subclass&&_proficiencies[_profile.classs][s.classs]&&!$WH.array_index(_proficiencies[_profile.classs][s.classs],s.subclass)?"q10":"q"+g_items[t].quality}}function _getItemErrors(e,t){var s=_getSlotItem(e);if(s[0]&&g_items[s[0]]&&_isSlotNeeded(e)){var i=0,a={},n=_getInventory(),r=g_items[s[0]].jsonequip,o=_hasExtraSocket(e),l=s[2];i=_profile.level>=70?9.5*(_profile.level-70)+105:_profile.level>=60?4.5*(_profile.level-60)+60:_profile.level;for(var c in jsonEquipCopy)a[c]=r[c];s[1]&&null!=g_items[s[0]].jsonequip.subitems&&null!=g_items[s[0]].jsonequip.subitems[s[1]]&&(a.name+=" "+g_items[s[0]].jsonequip.subitems[s[1]].name),a.profileslot=e,a.rel=_getItemRel(e),a.score=_getGearScore(e),a.use2h=17==r.slot&&!n[17][0],a.gems=[],a.matchSockets={},a.errors={},!(r.level<i&&5!=e&&6!=e&&20!=e)||r.scadist&&r.scaflags||(a.errors.level=1);for(var u=0,p=(0|r.nsockets)+o;u<p;++u){var d=s[u+4]>0?s[u+4]:0,m=o&&u==p-1?14:r["socket"+(u+1)];a.matchSockets[u]=d&&g_gems[d]&&_matchGemSocket(g_gems[d].colors,m),a.gems.push(d);for(var c in t)"t"!=c&&t[c]>0&&d&&g_gems[d]&&_matchGemSocket(g_gems[d].colors,c)&&(t[c]--,t.t--);d<=0&&(a.errors.gems=1+(0|a.errors.gems))}if(!_canBeSocketed(e)||o||2==_data[e].socket&&!_parent.isArmoryProfile()||(a.errors.sock=1),l||_canBeEnchanted(e)){if(a.enchant=0,l&&g_enchants[l]){var _=g_enchants[l],f=1<<r.slot-1;if("string"==typeof _.name)_.slots&f&&(a.enchant=_.source,a.enchantid=l);else for(var u=0,p=_.slots.length;u<p;++u)if(_.slots[u]&f){a.enchant=_.source[u],a.enchantid=l;break}if(a.enchant){var g=a.enchant<0?g_items:g_spells,h=Math.abs(a.enchant);null==g[h]&&(g[h]={icon:_.icon})}}a.enchant||(2!=_data[e].enchant||_parent.isArmoryProfile()?a.errors.ench=1:delete a.enchant)}return a}}function _initListview(e){var t,s,i;t=$WH.ce("div"),t.className="text",s=$WH.ce("h2"),s.id="gear-summary",_lnkPrint=$WH.ce("a"),_lnkPrint.className="profiler-tablinks-print",_lnkPrint.href="javascript:;",_lnkPrint.onclick=_printSummary.bind(0),$WH.ae(_lnkPrint,$WH.ct(LANG.pr_header_print)),$WH.ae(s,_lnkPrint),i=$WH.ce("a"),i.className="header-link",i.href="#gear-summary",$WH.ae(i,$WH.ct(LANG.pr_inv_title)),$WH.ae(s,i),$WH.ae(t,s),$WH.ae(_container,t),t=$WH.ce("div"),t.className="listview",$WH.ae(_container,t);var a=[{id:"score",name:LANG.score,compute:function(e,t){if(e.score){var s=e.score.item+e.score.ench+e.score.gems,i=$WH.ce("span");t.className="q"+pr_getGearScoreQuality(_profile.level,s-(0|e.score.bonus),null,_data[e.profileslot].id,e.use2h),s>0&&(i.className="tip",i.onmouseover=_parent.showGearScoreTooltip.bind(0,e.score),i.onmousemove=$WH.Tooltip.cursorUpdate,i.onmouseout=$WH.Tooltip.hide),$WH.ae(i,$WH.ct($WH.number_format(s))),$WH.ae(t,i)}},getVisibleText:function(e){if(e.score)return e.score.item+e.score.ench+e.score.gems},sortFunc:function(e,t,s){var i=e.score?e.score.item+e.score.ench+e.score.gems:0,a=t.score?t.score.item+t.score.ench+t.score.gems:0;return $WH.strcmp(i,a)}},{id:"gems",name:LANG.gems,compute:function(e,t){if((e.errors.gems||e.errors.sock)&&(t.style.backgroundColor="#8C0C0C"),e.gems.length){t.style.padding="0";var s,i=[];for(s=0;s<e.nsockets;++s)i.push(e["socket"+(s+1)]);s<e.gems.length&&i.push(14),Listview.funcBox.createSocketedIcons(i,t,e.gems,e.matchSockets);for(var a=t.firstChild,n=_talents.getTalentBuilds(),s=0,r=i.length;s<r;++s){var o=Icon.getLink(a.childNodes[s]);o.oncontextmenu=$WH.rf,o.onclick=$WH.Browser.opera||$WH.OS.mac?function(e){if(e=$WH.$E(e),e.shiftKey||e.ctrlKey)return!1}:null,o.onmouseup=_onMouseUpSlot.bind(0,e.profileslot,o),e.gems[s]>0||(o.onclick=$WH.rf,o.onmouseover=_showEmptyGemTooltip.bind(o,i[s]),o.onmouseout=$WH.Tooltip.hide),o.menu=[[,g_socket_names[i[s]]],[0,e.gems[s]>0?LANG.pr_menu_replace:LANG.pr_menu_add,_openGemPicker.bind(this,i[s],s+4,e.profileslot)]],e.gems[s]>0&&o.menu.push([0,LANG.pr_menu_remove,_unsocketItem.bind(this,4+s,e.profileslot,!1)]),o.menu.push([,LANG.pr_menu_links]);var l="?items=3&filter=maxrl="+_profile.level+";ub="+_profile.classs+(1==i[s]?";cr=81;crs=1;crv=0":32==i[s]?";cr=81;crs=6;crv=0":";cr=81:81:81;crs=2:3:4;crv=0:0:0;ma=1")+"$1"+(e.gems[s]?";gb=1;upg="+e.gems[s]:""),c=[0,LANG.pr_menu_upgrades,null,[]];if(c[3].push([0,n.name,$WH.sprintf(l,n.filter),null,{newWindow:!0}]),g_user.weightscales&&g_user.weightscales.length)for(var u=0,p=g_user.weightscales.length;u<p;++u){var d=g_user.weightscales[u];c[3].push([0,d.name,$WH.sprintf(l,pr_getScaleFilter(d)),null,{newWindow:!0}])}o.menu.push(c)}}},getVisibleText:function(e){if(e.gems.length){for(var t="",s=0,i=e.gems.length;s<i;++s){e.gems[s]>0&&(s>0&&(t+=" "),t+=g_gems[e.gems[s]].name)}return t}},getValue:function(e){return e.gems.length},sortFunc:function(e,t,s){var i=0,a=0;return $.each(e.gems,function(t){i+=e["socket"+(t+1)]}),$.each(t.gems,function(e){a+=t["socket"+(e+1)]}),$WH.strcmp(e.gems.length,t.gems.length)||-$WH.strcmp(i,a)}},{id:"enchant",name:LANG.enchant,compute:function(e,t){if(e.errors.ench&&(t.style.backgroundColor="#8C0C0C"),null!=e.enchant){t.style.padding="0",Listview.funcBox.createCenteredIcons([Math.abs(e.enchant)],t,null,e.enchant>0?1:null);var s=Icon.getLink(t.firstChild.childNodes[0]),i=_talents.getTalentBuilds();s.oncontextmenu=$WH.rf,s.onclick=$WH.Browser.opera||$WH.OS.mac?function(e){if(e=$WH.$E(e),e.shiftKey||e.ctrlKey)return!1}:null,s.onmouseup=_onMouseUpSlot.bind(0,e.profileslot,s),$WH.ns(s),e.enchant||(s.onclick=$WH.rf,s.onmouseover=_showEmptyItemTooltip.bind(s,e.profileslot),s.onmouseout=$WH.Tooltip.hide),s.menu=[[,g_item_slots[e.slot]],[0,e.enchant?LANG.pr_menu_replace:LANG.pr_menu_add,_openEnchantPicker.bind(this,e.profileslot)]],e.enchant&&s.menu.push([0,LANG.pr_menu_remove,_unenchantItem.bind(this,e.profileslot)]),s.menu.push([,LANG.pr_menu_links]);var a="?items=0.6&filter=sl="+e.slot+";maxrl="+_profile.level+";ub="+_profile.classs+"$1"+(e.enchant<0?";gb=1;upg="+Math.abs(e.enchant):""),n=[0,LANG.pr_menu_upgrades,null,[]];if(n[3].push([0,i.name,$WH.sprintf(a,i.filter),null,{newWindow:!0}]),g_user.weightscales&&g_user.weightscales.length)for(var r=0,o=g_user.weightscales.length;r<o;++r){var l=g_user.weightscales[r];n[3].push([0,l.name,$WH.sprintf(a,pr_getScaleFilter(l)),null,{newWindow:!0}])}s.menu.push(n)}},getVisibleText:function(e){if(null!=e.enchant)return g_enchants[e.enchantid].name},getValue:function(e){return null==e.enchant?0:1},sortFunc:function(e,t,s){return g_enchants[e.enchantid]&&g_enchants[t.enchantid]?$WH.strcmp(g_enchants[e.enchantid].gearscore,g_enchants[t.enchantid].gearscore):$WH.strcmp(e.enchant,t.enchant)}}];_listview=new Listview({template:"inventory",id:"inventory",parent:t,extraCols:a}),null!=e&&(_listview.tabs=_tabs,_listview.tabIndex=e),t=$WH.ce("div"),t.className="pad",$WH.ae(_container,t),_divTipRclk=t=$WH.ce("div"),t.className="text",t.style.display="none",$WH.ae(t,$WH.ct(_shiftClick?LANG.pr_tip_sclkopt2:LANG.pr_tip_rclkopt2)),$WH.ae(_container,t)}function _updateListview(){if(_inited){var e=[],t=_getMetaCondition(),s=0,i=0,a=0,n=0,r=0;_parent.updateGearScore();for(var o=0,l=_data.length;o<l;++o){var c=o,u=_getSlotItem(c);if(_isSlotNeeded(c,1)&&!u[0]&&5!=c&&6!=c&&20!=c&&(_profile.level>55||_profile.level>25&&(14!=c||15!=c||19!=c)||_profile.level>20&&(0!=c||1!=c)||2!=c||12!=c||13!=c)&&i++,u[0]&&g_items[u[0]]&&_isSlotNeeded(c)){var p=_getItemErrors(c,t);p.errors.level&&s++,p.errors.gems&&(a+=p.errors.gems),p.errors.sock&&r++,p.errors.ench&&n++,e.push(p)}}var d=_listview.getNoteTopDiv().firstChild,m="";if(s&&(m+=LANG.pr_inv_lowlevel+$WH.sprintf(1==s?LANG.pr_inv_item:LANG.pr_inv_items,s),(i||n||a||r||t.t>0)&&(m+=LANG.dash)),(i||n||a||r)&&(m+=LANG.pr_inv_missing,i&&(m+=$WH.sprintf(1==i?LANG.pr_inv_item:LANG.pr_inv_items,i)),a&&i&&(m+=LANG.comma),a&&(m+=$WH.sprintf(1==a?LANG.pr_inv_gem:LANG.pr_inv_gems,a)),r&&(i||a)&&(m+=LANG.comma),r&&(m+=$WH.sprintf(1==r?LANG.pr_inv_socket:LANG.pr_inv_sockets,r)),n&&(i||a||r)&&(m+=LANG.comma),n&&(m+=$WH.sprintf(1==n?LANG.pr_inv_enchant:LANG.pr_inv_enchants,n)),t.t>0&&(m+=LANG.dash)),t.t>0){m+=LANG.pr_inv_metareq;var o=0;for(var _ in t)"t"!=_&&t[_]>0&&(o++>0&&(m+=LANG.comma),m+=$WH.sprintf(1==t[_]?LANG.pr_inv_gem:LANG.pr_inv_gems,t[_]+" "+g_gem_colors[_]))}$WH.st(d,m.length?m:String.fromCharCode(160)),_listview.setData(e),_listview.updateFilters(!0),_divTipRclk.style.display=e.length?"":"none"}}function _printSummary(){var e=window.open("?profile=summary","","toolbar=no,menubar=yes,status=yes,scrollbars=yes,resizable=yes"),t="<html><head><title>"+document.title+'</title></head><body style="font-family: Arial, sans-serif; font-size: 13px">';e.document.open(),t+="<h2>"+_profile.name+" "+LANG.pr_inv_title+"</h2>";for(var s=0,i=_slots.length;s<i;++s){var a=s,n=_getSlotItem(a);if(n[0]&&g_items[n[0]]&&_isSlotNeeded(a)){var r=g_items[n[0]].jsonequip,o=g_items[n[0]].jsonequip.subitems,l=_hasExtraSocket(a);if(t+=g_item_slots[_slots[a].itemslots[0]]+": <b>"+r.name.substring(1),n[1]&&null!=o&&null!=o[n[1]]&&(t+=" "+o[n[1]].name),t+="</b>",t+="<ul>",r.source){t+="<li><b>"+LANG.source+"</b> - ";for(var c=0,u=r.source.length;c<u;++c){var p=r.sourcemore&&r.sourcemore[c]?r.sourcemore[c]:{},d=Listview.funcBox.getLowerSource(r.source[c],p,0|p.t);c>0&&(t+=", "),p.t?t+=p.n:t+=Listview.funcBox.getUpperSource(r.source[c],p),t+=" ("+g_sources[r.source[c]],null!=d&&(t+="; "+d.text,p.dd&&(p.dd<0?t+=" "+(p.dd<-1?LANG.pr_print_heroic:LANG.pr_print_normal):t+=" "+(1&p.dd?LANG.lvitem_raid10:LANG.lvitem_raid25)+" "+(p.dd>2?LANG.pr_print_heroic:LANG.pr_print_normal))),t+=")"}t+="</li>"}if(n[2]||_canBeEnchanted(a)){if(t+="<li><b>"+LANG.enchant+"</b> - ",n[2]&&g_enchants[n[2]]){var m=g_enchants[n[2]],_=1<<r.slot-1;if("string"==typeof m.name)m.slots&_&&(t+=m.name);else for(var c=0,u=m.slots.length;c<u;++c)if(m.slots[c]&_){t+=m.name[c];break}}else t+="<i>"+LANG.pr_print_none+"</i>";t+="</li>"}if(_canBeSocketed(a)&&(t+="<li><b>"+LANG.pr_menu_extrasock+"</b> - "+(l?LANG.pr_print_yes:"<i>"+LANG.pr_print_no+"</i>")+"</li>"),r.nsockets||l){t+="<li><b>"+LANG.gems+"</b> - ";for(var c=0,u=(0|r.nsockets)+l;c<u;++c)c>0&&(t+=", "),n[c+4]&&g_gems[n[c+4]]?t+=g_gems[n[c+4]].name:t+="<i>"+LANG.pr_print_none+"</i>",t+=" ("+g_socket_names[l&&c==u-1?14:r["socket"+(c+1)]]+")";t+="</li>"}t+="</ul>"}}t+="</body></html>",e.document.write(t),e.document.close()}function _prepareSearch(e,t){isNaN(t)&&(t=1e3),_timer>0&&(clearTimeout(_timer),_timer=0),e&&$WH.st(_searchMsg,$WH.sprintf(LANG.pr_searching,e)),_searchMsg.className="",_timer=setTimeout(_searchItems.bind(0,e,_currentSlot),t)}function _searchItems(search,slotId){var lv=g_listviews.items;if(_searchResults=[{none:1,__alwaysvisible:1}],lv.searchable=!1,lv.setData(_searchResults),lv.clearSearch(),lv.updateFilters(!0),_searchMsg.className="",!search&&!_currentScale)return void $WH.st(_searchMsg,LANG.pr_specifyitem);$WH.st(_searchMsg,$WH.sprintf(LANG.pr_searching,search)),new Ajax("?search="+$WH.urlencode(search)+"&json&slots="+_data[slotId].itemslots.join(":")+pr_getScaleFilter(_currentScale,1),{method:"POST",search:search,onSuccess:function(xhr,opt){var text=xhr.responseText;if("["!=text.charAt(0)||"]"!=text.charAt(text.length-1))return $WH.st(_searchMsg,$WH.sprintf(LANG.su_noresults,opt.search)),void(_searchMsg.className="q10");var a=eval(text);if(search==opt.search&&3==a.length&&a[1].length){for(var i=0,len=a[1].length;i<len;++i){var row={};row.id=a[1][i].id,row.name=row["name_"+Locale.getName()]=a[1][i].name.substring(1),row.quality=7-a[1][i].name.charAt(0),row.icon=a[1][i].icon,row.level=a[1][i].level,row.classs=a[1][i].classs,row.subclass=a[1][i].subclass,row.gearscore=a[1][i].gearscore,row.jsonequip=$WH.dO(a[1][i]),g_items.add(a[1][i].id,row),_searchResults.push(row)}$WH.ee(_searchMsg)}else $WH.st(_searchMsg,$WH.sprintf(LANG.pr_noresults,opt.search)),_searchMsg.className="q10";lv.setData(_searchResults),lv.clearSearch(),lv.updateFilters(!0),_sortPickerWindow(lv)}})}function _isValidItem(e){if(e.none)return!0;var t=_proficiencies[_profile.classs][e.classs];return null==_itemType||!t||e.subclass<1||14==e.subclass||(1==_itemType||2==e.classs||e.subclass>4)&&$WH.array_index(t,e.subclass)||2==_itemType&&e.subclass==t[t.length-1]}function _filterItems(e,t){switch(e){case 0:_itemType=t;break;default:return}return this&&"A"==this.nodeName&&g_setSelectedLink(this,"items"+e),_lvItems.updateFilters(!0),!1}function _createItemsNote(e){var t,s=$WH.ce("small"),i=$WH.ce("span");$WH.ae(s,$WH.ct(LANG.pr_note_type)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=_filterItems.bind(t,0,null),$WH.ae(t,$WH.ct(LANG.pr_note_all)),$WH.ae(s,t),$WH.ae(s,$WH.ct(LANG.comma)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=_filterItems.bind(t,0,1),$WH.ae(t,$WH.ct(LANG.pr_note_usable)),$WH.ae(s,t),$WH.ae(s,i),$WH.ae(i,$WH.ct(LANG.comma)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=_filterItems.bind(t,0,2),_itemType=2,g_setSelectedLink(t,"items0"),$WH.ae(i,t),i=$WH.ce("span"),i.style.padding="0 8px",i.style.color="white",$WH.ae(i,$WH.ct("|")),$WH.ae(s,i),$WH.ae(e,s),s=$WH.ce("small"),$WH.ae(s,$WH.ct(LANG.pr_note_name)),_spSearchName=$WH.ce("input"),_spSearchName.type="text",_spSearchName.value=_currentSearch,$WH.aE(_spSearchName,"keyup",_onKeyUpSearch.bind(0,333)),$WH.aE(_spSearchName,"keydown",_onKeyDownSearch),$WH.ae(s,_spSearchName),_searchMsg=$WH.ce("span"),_searchMsg.style.fontWeight="bold",$WH.ae(s,_searchMsg),$WH.ae(e,s)}function _isValidEnchant(e){if(e.none)return!0;var t=1<<g_items[_getSlotItem(_currentSlot)[0]].jsonequip.slot-1,s=1<<_profile.classs-1;return(e.classes<=0||e.classes&s)&&e.slots&t&&(null==_enchantSource||1==_enchantSource&&e.source<0||2==_enchantSource&&e.source>0)&&(null==_enchantStat||-1==_enchantStat&&!e.jsonequip.hasOwnProperty("sta")&&!e.jsonequip.hasOwnProperty("str")&&!e.jsonequip.hasOwnProperty("agi")&&!e.jsonequip.hasOwnProperty("int")&&!e.jsonequip.hasOwnProperty("spi")||e.jsonequip.hasOwnProperty(_enchantStat))}function _filterEnchants(e,t){switch(e){case 0:_enchantSource=t;break;case 1:_enchantStat=t;break;default:return}return this&&"A"==this.nodeName&&g_setSelectedLink(this,"enchants"+e),_lvEnchants.updateFilters(!0),!1}function _createEnchantsNote(e){var t,s=$WH.ce("small");$WH.ae(s,$WH.ct(LANG.pr_note_source)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=_filterEnchants.bind(t,0,null),$WH.ae(t,$WH.ct(LANG.pr_note_all)),g_setSelectedLink(t,"enchants0"),$WH.ae(s,t),$WH.ae(s,$WH.ct(LANG.comma)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=_filterEnchants.bind(t,0,1),$WH.ae(t,$WH.ct(LANG.pr_note_items)),$WH.ae(s,t),$WH.ae(s,$WH.ct(LANG.comma)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=_filterEnchants.bind(t,0,2),$WH.ae(t,$WH.ct(LANG.pr_note_profs)),$WH.ae(s,t),$WH.ae(e,s),s=$WH.ce("small");var i=$WH.ce("span");i.style.padding="0 8px",i.style.color="white",$WH.ae(i,$WH.ct("|")),$WH.ae(s,i),$WH.ae(s,$WH.ct(LANG.su_note_stats+": ")),t=$WH.ce("a"),t.href="javascript:;",t.onclick=_filterEnchants.bind(t,1,null),$WH.ae(t,$WH.ct(LANG.pr_note_all)),g_setSelectedLink(t,"enchants1"),$WH.ae(s,t),$WH.ae(s,$WH.ct(LANG.comma)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=_filterEnchants.bind(t,1,"sta"),$WH.ae(t,$WH.ct(LANG.traits.sta[0])),$WH.ae(s,t),$WH.ae(s,$WH.ct(LANG.comma)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=_filterEnchants.bind(t,1,"str"),$WH.ae(t,$WH.ct(LANG.traits.str[0])),$WH.ae(s,t),$WH.ae(s,$WH.ct(LANG.comma)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=_filterEnchants.bind(t,1,"agi"),$WH.ae(t,$WH.ct(LANG.traits.agi[0])),$WH.ae(s,t),$WH.ae(s,$WH.ct(LANG.comma)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=_filterEnchants.bind(t,1,"int"),$WH.ae(t,$WH.ct(LANG.traits.int[0])),$WH.ae(s,t),$WH.ae(s,$WH.ct(LANG.comma)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=_filterEnchants.bind(t,1,"spi"),$WH.ae(t,$WH.ct(LANG.traits.spi[0])),$WH.ae(s,t),$WH.ae(s,$WH.ct(LANG.comma)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=_filterEnchants.bind(t,1,-1),$WH.ae(t,$WH.ct(LANG.su_note_other)),_enchantStat=null,$WH.ae(s,t),$WH.ae(e,s)}function _hasSocketBonus(e){var t=_getSlotItem(e),s=0;if(!g_items[t[0]]||!g_items[t[0]].jsonequip.nsockets)return!1;for(var i=0;i<3;++i)t[i+4]&&g_gems[t[i+4]]&&_matchGemSocket(g_gems[t[i+4]].colors,g_items[t[0]].jsonequip["socket"+(i+1)])&&++s;return s==g_items[t[0]].jsonequip.nsockets}function _matchGemSocket(e,t){for(var s=1;s<=32;s*=2)if(t&s&&e&s)return!0;return!1}function _isValidGem(e){return!!e.none||(null==_gemSource||e.expansion==_gemSource)&&(1!=_currentColor&&1!=e.colors&&null==_gemColor||_matchGemSocket(e.colors,_currentColor))}function _filterGems(e,t){switch(e){case 0:_gemSource=t;break;case 1:_gemColor=t;break;default:return}return this&&"A"==this.nodeName&&g_setSelectedLink(this,"gems"+e),_lvGems.updateFilters(!0),!1}function _createGemsNote(e){var t,s=$WH.ce("small");$WH.ae(s,$WH.ct(LANG.pr_note_source)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=_filterGems.bind(t,0,null),$WH.ae(t,$WH.ct(LANG.pr_note_all)),$WH.ae(s,t),$WH.ae(s,$WH.ct(LANG.comma)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=_filterGems.bind(t,0,1),$WH.ae(t,$WH.ct(LANG.pr_note_bc)),$WH.ae(s,t),$WH.ae(s,$WH.ct(LANG.comma)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=_filterGems.bind(t,0,2),$WH.ae(t,$WH.ct(LANG.pr_note_wotlk)),_gemSource=2,g_setSelectedLink(t,"gems0"),$WH.ae(s,t),$WH.ae(e,s),s=$WH.ce("small");var i=$WH.ce("span");i.style.padding="0 8px",i.style.color="white",$WH.ae(i,$WH.ct("|")),$WH.ae(s,i),$WH.ae(s,$WH.ct(LANG.pr_note_color)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=_filterGems.bind(t,1,null),$WH.ae(t,$WH.ct(LANG.pr_note_all)),$WH.ae(s,t),$WH.ae(s,$WH.ct(LANG.comma)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=_filterGems.bind(t,1,1),$WH.ae(t,$WH.ct(LANG.pr_note_match)),_gemColor=1,g_setSelectedLink(t,"gems1"),$WH.ae(s,t),$WH.ae(e,s)}function _calcScores(e,t){for(var s=0,i=e.length;s<i;++s){var a=e[s];if(a.__tr=null,a.score=t?0:null,a.jsonequip&&t){var n=0,r=$WH.dO(a.jsonequip);_parent.unfixJson(r);for(var o in t)LANG.traits[o]&&(n+=t[o],isNaN(r[o])||(a.score+=r[o]*t[o]));a.score=(a.score/n).toFixed(2)}}return e}function _sortPickerWindow(e,t){_spSortWeighted&&($("option:selected",_spSortWeighted)[0]&&(_currentScale=$("option:selected",_spSortWeighted)[0].scale),e.setSort([1],!0,!1),e.setData(_calcScores(e.data,_currentScale)),_currentScale&&e.setSort([2],!0,!1),t&&"items"==e.id&&_onKeyUpSearch(0))}function _openItemPicker(e){_currentSlot=_getValidSlot(e),Lightbox.show("itempicker",{onShow:_onShowItemPicker})}function _openSubitemPicker(e){_currentSlot=_getValidSlot(e),Lightbox.show("subitempicker",{onShow:_onShowSubitemPicker})}function _openEnchantPicker(e){_currentSlot=_getValidSlot(e),Lightbox.show("enchantpicker",{onShow:_onShowEnchantPicker})}function _openGemPicker(e,t,s){_currentSlot=_getValidSlot(s),_currentSocket=t,_currentColor=e,Lightbox.show("gempicker",{onShow:_onShowGemPicker})}function _onShowItemPicker(e,t,s){Lightbox.setSize(800,564);var i;if(t){e.className="profiler-picker listview";var a=$WH.ce("div"),n=$WH.ce("a"),r=$WH.ce("div");a.className="listview",$WH.ae(e,a),n=$WH.ce("a"),n.className="screenshotviewer-close",n.href="javascript:;",n.onclick=Lightbox.hide,$WH.ae(n,$WH.ce("span")),$WH.ae(e,n),r.className="clear",$WH.ae(e,r),_lvItems=i=new Listview({template:"itempicker",id:"items",parent:a,data:[],clip:{w:780,h:478},createNote:_createItemsNote,customFilter:_isValidItem}),$WH.Browser.firefox?$WH.aE(i.getClipDiv(),"DOMMouseScroll",g_pickerWheel):i.getClipDiv().onmousewheel=g_pickerWheel}else i=g_listviews.items;var o=i.getNoteTopDiv(),l=$WH.gE(o,"small");if($WH.array_index([0,2,4,7,8,9,10,11,16,17,18,19],_currentSlot)){var c=$WH.gE(o,"span"),u=$WH.gE(o,"a");if(l[0].style.display="",_currentSlot>15)c[0].style.display="none",2==_itemType&&u[1].onclick();else{var p=_proficiencies[_profile.classs][4];c[0].style.display="",$WH.st(u[2],g_itemset_types[p[p.length-1]])}}else l[0].style.display="none";_updateWeightedSort(i),setTimeout(function(){_spSearchName.focus()},1)}function _onShowSubitemPicker(e,t,s){Lightbox.setSize(800,564);var i,a=_getSlotItem(_currentSlot)[0],n=[];for(var r in g_items[a].jsonequip.subitems){var o=g_items[a].jsonequip.subitems[r];o.id=r,o.item=a,n.push(o)}if(t){e.className="profiler-picker listview";var l=$WH.ce("div"),c=$WH.ce("a"),u=$WH.ce("div");l.className="listview",$WH.ae(e,l),c=$WH.ce("a"),c.className="screenshotviewer-close",c.href="javascript:;",c.onclick=Lightbox.hide,$WH.ae(c,$WH.ce("span")),$WH.ae(e,c),u.className="clear",$WH.ae(e,u),_lvSubitems=i=new Listview({template:"subitempicker",id:"subitems",parent:l,data:n}),$WH.Browser.firefox?$WH.aE(i.getClipDiv(),"DOMMouseScroll",g_pickerWheel):i.getClipDiv().onmousewheel=g_pickerWheel}else i=g_listviews.subitems,i.setData(n),i.clearSearch(),i.updateFilters(!0);_updateWeightedSort(i),
setTimeout(function(){i.focusSearch()},1)}function _onShowEnchantPicker(e,t,s){Lightbox.setSize(800,564);var i,a=[];a.push({none:1,__alwaysvisible:1});for(var n in g_enchants){var r=$WH.dO(g_enchants[n]);if(r.id=n,"string"==typeof r.name)a.push(r);else for(var o=0,l=g_enchants[n].name.length;o<l;++o){var c=$WH.dO(r);c.name=r.name[o],c.source=r.source[o],c.slots=r.slots[o],a.push(c)}}if(t){e.className="profiler-picker listview";var u=$WH.ce("div"),p=$WH.ce("a"),d=$WH.ce("div");u.className="listview",$WH.ae(e,u),p=$WH.ce("a"),p.className="screenshotviewer-close",p.href="javascript:;",p.onclick=Lightbox.hide,$WH.ae(p,$WH.ce("span")),$WH.ae(e,p),d.className="clear",$WH.ae(e,d),_lvEnchants=i=new Listview({template:"enchantpicker",id:"enchants",parent:u,data:a,createNote:_createEnchantsNote,customFilter:_isValidEnchant}),$WH.Browser.firefox?$WH.aE(i.getClipDiv(),"DOMMouseScroll",g_pickerWheel):i.getClipDiv().onmousewheel=g_pickerWheel}else i=g_listviews.enchants,i.setData(a),i.clearSearch(),i.updateFilters(!0);_updateWeightedSort(i),setTimeout(function(){i.focusSearch()},1)}function _onShowGemPicker(e,t,s){Lightbox.setSize(800,564);var i;if(t){e.className="profiler-picker listview";var a=[],n=$WH.ce("div"),r=$WH.ce("a"),o=$WH.ce("div");a.push({none:1,__alwaysvisible:1});for(var l in g_gems){var c=g_gems[l];c.id=l,a.push(c)}n.className="listview",$WH.ae(e,n),r=$WH.ce("a"),r.className="screenshotviewer-close",r.href="javascript:;",r.onclick=Lightbox.hide,$WH.ae(r,$WH.ce("span")),$WH.ae(e,r),o.className="clear",$WH.ae(e,o),_lvGems=i=new Listview({template:"gempicker",id:"gems",parent:n,data:a,createNote:_createGemsNote,customFilter:_isValidGem}),$WH.Browser.firefox?$WH.aE(i.getClipDiv(),"DOMMouseScroll",g_pickerWheel):i.getClipDiv().onmousewheel=g_pickerWheel}else i=g_listviews.gems,i.clearSearch(),i.updateFilters(!0);var u=i.getNoteTopDiv(),p=$WH.gE(u,"small");$WH.gE(u,"a");p[1].style.display=1==_currentColor||14==_currentColor?"none":"",_updateWeightedSort(i),setTimeout(function(){i.focusSearch()},1)}var _self=this,_parentVars,_profile,_statistics,_tabs,_timer,_inited,_data=[],_itemType,_enchantSource,_enchantStat,_gemSource,_gemColor,_mvInited,_shiftClick=$WH.Browser.opera,_cursorPos={x:0,y:0},_container,_divModel,_swfModel,_divInventory,_lnkPrint,_divTipRclk,_spSortWeighted,_listview,_lvItems,_spSearchName,_searchMsg,_lvSubitems,_lvEnchants,_lvGems,_currentSlot=-1,_currentSocket=-1,_currentColor=-1,_currentScale={},_currentSearch="",_searchResults,_slots=[{id:1,name:"head",itemslots:[1],enchant:1,enchantlevel:50},{id:2,name:"neck",itemslots:[2],nomodel:2},{id:3,name:"shoulder",itemslots:[3],enchant:1,enchantlevel:50},{id:15,name:"chest",itemslots:[16],enchant:1},{id:5,name:"chest",itemslots:[5,20],enchant:1,upgradeslots:[5]},{id:4,name:"shirt",itemslots:[4],noupgrade:1},{id:19,name:"tabard",itemslots:[19],noupgrade:1},{id:9,name:"wrists",itemslots:[9],enchant:1,socket:2,socketskill:164},{id:10,name:"hands",itemslots:[10],enchant:1,socket:2,socketskill:164},{id:6,name:"waist",itemslots:[6],enchant:2,socket:1,socketlevel:70,enchantskill:202},{id:7,name:"legs",itemslots:[7],enchant:1},{id:8,name:"feet",itemslots:[8],enchant:1},{id:11,name:"finger",itemslots:[11],enchant:2,nomodel:2,enchantskill:333},{id:12,name:"finger",itemslots:[11],enchant:2,nomodel:2,enchantskill:333},{id:13,name:"trinket",itemslots:[12],nomodel:2},{id:14,name:"trinket",itemslots:[12],nomodel:2},{id:16,name:"mainhand",itemslots:[21,13,17],enchant:1,weapon:1},{id:17,name:"offhand",itemslots:[22,13,23,14],enchant:3,weapon:2,noenchantclasses:[-5]},{id:18,name:"ranged",itemslots:[15,25],enchant:3,weapon:1,classes:[3,8,5,4,9,1],nomodel:1,noenchantclasses:[16,19]},{id:18,name:"relic",itemslots:[28],classes:[6,11,2,7],nomodel:2}];_proficiencies={1:{2:[0,1,2,3,4,5,6,7,8,10,13,15,16,18],4:[6,1,2,3,4]},2:{2:[0,1,4,5,6,7,8],4:[6,7,1,2,3,4]},3:{2:[0,1,2,3,6,7,8,10,13,15,16,18],4:[1,2,3]},4:{2:[2,3,4,7,13,15,16,18],4:[1,2]},5:{2:[4,10,15,19],4:[1]},6:{2:[0,1,4,5,6,7,8],4:[10,1,2,3,4]},7:{2:[0,1,4,5,10,13,15],4:[6,9,1,2,3]},8:{2:[7,10,15,19],4:[1]},9:{2:[7,10,15,19],4:[1]},11:{2:[4,5,6,10,13,15],4:[8,1,2]}},jsonEquipCopy={id:1,name:1,level:1,slot:1,source:1,sourcemore:1,nsockets:1,socket1:1,socket2:1,socket3:1},this.initialize=function(e,t){(_container=$WH.ge(e))&&(_parentVars=_parent.getVars(),_profile=_parentVars.profile,_statistics=_parentVars.statistics,_talents=_parentVars.talents,_tabs=_parentVars.tabs,_initModel(),_initCharacter(),_initListview(t))},this.setInventory=function(e){_setInventory(e)},this.getInventory=function(){return _getInventory()},this.updateInventory=function(){_updateInventory()},this.addItems=function(e){for(var t={},s=0,i=e.length;s<i;++s){var a=g_items[e[s]];if(a){var n=_getValidSlot(a.jsonequip.slotbak,0,1);if(-1==n)continue;!t[n]||12!=n&&14!=n&&16!=n||n++,t[n]=e[s],_equipItem(e[s],n)}}_updateModel(-1,1)},this.equipItem=function(e,t){var s=_getValidSlot(t,0,1);Lightbox.hide(),_equipItem(e,s)},this.equipSubitem=function(e,t){var t=_getValidSlot(t,1);Lightbox.hide(),_equipSubitem(e,t)},this.socketItem=function(e,t,s){var s=_getValidSlot(s,1),t=_getValidSocket(t,1);Lightbox.hide(),_socketItem(e,t,s)},this.enchantItem=function(e,t){var t=_getValidSlot(t,1);Lightbox.hide(),_enchantItem(e,t)},this.updateAllIcons=function(){_updateAllIcons()},this.updateAllHeirlooms=function(){_updateAllHeirlooms()},this.updateAllMenus=function(){_updateAllMenus()},this.updateMenu=function(e,t){_updateMenu(e,t)},this.onMouseUpSlot=function(e,t,s){_onMouseUpSlot(e,t,s)},this.updateListview=function(){_updateListview()},this.printSummary=function(){_printSummary()},this.showModel=function(e){_divModel.style.left=e?"":"-2323px"},this.updateModel=function(e,t){_updateModel(e,t)},this.matchGemSocket=function(e,t){return _matchGemSocket(e,t)},this.getGearScore=function(e){return _getGearScore(e)},this.getAverageLevel=function(){return _getAverageLevel()},this.hasItemClassQty=function(e,t,s){return _hasItemClassQty(e,t,s)}}function ProfilerCompletion(e){function t(e,t,s){j=[],T=t,C=s,V=e;var i=!1;window[fe.source]&&!$WH[fe.source]&&($WH[fe.source]=window[fe.source]);for(var a in window[fe.source]){var n=$WH.dO(window[fe.source][a]);n.id=parseInt(a),fe.filter&&!fe.filter(n)||(fe.compute&&!fe.compute(n,e[a])||!e[a]?n.completed=null:(n.completed=e[a]>946681200?new Date(1e3*e[a]):fe.showQuantity?e[a]:1,i=!0),n.who=x.name,n.faction=x.faction+1,n._included=k.bind(0,n,1),n.side&&!(n.side&x.faction+1)||n.reqclass&&!(n.reqclass&1<<x.classs-1)||n.reqrace&&!(n.reqrace&1<<x.race-1)||n.gender&&!(n.gender&1<<x.gender)||n.wflags&&31&n.wflags||!(!n.historical||n.historical&&n.completed)||fe.models&&!(n.npcId&&n.displayId&&n.displayName)||j.push(n))}if(!i&&fe.onDemand)for(var a in e){if("object"==typeof e[a]&&e[a].length){var n={};if(n.id=parseInt(a),fe.catgid&&(n[fe.catgid]=e[a][1]),fe.subcat&&(n[fe.subcat]=e[a][0]),fe.filter&&!fe.filter(n))continue}i=!0;break}J=!1,X=!1,i&&(I.setTabTooltip(M),I.setTabPound(M),I.unlock(M),I.getSelectedTab()==M&&_e.onShow())}function s(e){var t={all:{},complete:{},incomplete:{},bonus:{},excluded:{}},s=null==e?fe.overall:e,i=z,a=B,n=F;z=null,B=null!=e?e:null,F=null,O=!0,t.all[s]=0,t.complete[s]=0,t.incomplete[s]=0,t.bonus[s]=0,t.excluded[s]=0;for(var r=0,o=j.length;r<o;++r){var l=j[r],c=null==e?w(l):L(l);if(c==e)c="current";else if(c==s)continue;if(null==t.all[c]&&(t.all[c]=0),null==t.complete[c]&&(t.complete[c]=0),null==t.incomplete[c]&&(t.incomplete[c]=0),null==t.bonus[c]&&(t.bonus[c]=0),null==t.excluded[c]&&(t.excluded[c]=0),A(l))if(k(l)){if(!k(l,1)){t.bonus[c]++,t.bonus[s]++,t.excluded[c]++,t.excluded[s]++;continue}$WH.array_index(fe.nototal,c)?t.all[c]++:(t.all[c]++,t.all[s]++,l.completed?t.complete[s]++:t.incomplete[s]++),null!=l.completed?t.complete[c]++:t.incomplete[c]++}else t.excluded[c]++,t.excluded[s]++}if(fe.noempty)for(var c in t.complete)c!=s&&(t.complete[c]||$WH.array_index(fe.nototal,c)||(t.all[s]-=t.all[c]));z=i,B=a,F=n,O=!1,null!=e?E[e]=t:P=t}function i(){ee=_=$WH.ce("div"),_.className="text profiler-achievements-source",$WH.ae(Y,_)}function a(){if($WH.ee(ee),T&&C.getDate){var e=new Date(C),t=(g_serverTime-e)/1e3,s=$WH.ce("span"),i=$WH.ce("span");if($WH.ae(i,s),g_formatDate(s,t,e),ee.innerHTML="<small>"+$WH.sprintfa(LANG.pr_datasource,T,i.innerHTML)+"</small>",T.toLowerCase()==g_user.name.toLowerCase()){var a=$WH.ce("a");a.href="javascript:;",a.onclick=_e.purgeData,a.className="delete-icon",a.style.marginLeft="10px",g_addTooltip(a,LANG.pr_purgedata,"q2"),$WH.ae(a,$WH.ct(LANG.purge)),$WH.ae(ee.firstChild,a)}var a=$WH.ce("a");a.href="javascript:;",a.onclick=ContactTool.show.bind(ContactTool,{mode:4,profile:x}),a.className="icon-report",a.style.marginLeft="10px",g_addTooltip(a,LANG.report_tooltip,"q2"),$WH.ae(a,$WH.ct(LANG.report)),$WH.ae(ee.firstChild,a)}}function n(){var e,t;te=e=$WH.ce("div"),e.className="profiler-achievements-summary",fe.points&&(se=t=$WH.ce("div"),t.className="profiler-achievements-summary-points",$WH.ae(e,t)),ie=t=$WH.ce("div"),t.className="profiler-achievements-summary-inner",$WH.ae(e,t),$WH.ae(Y,e),$WH.ae(Y,Z),t=ae,t.className="text clear",t.innerHTML=LANG.pr_tip_quests,t.style.display="quests"==me&&K?"":"none",e=$WH.gE(t,"span")[0],e.onmouseover=function(){$WH.Tooltip.show(this,LANG.pr_tt_questtip,0,0,"q")},e.onmousemove=$WH.Tooltip.cursorUpdate,e.onmouseout=$WH.Tooltip.hide,e=$WH.ce("div"),e.className="pad",$WH.ae(t,e),$WH.ae(Y,t)}function r(){var e;if(fe.points&&($WH.ee(se),Listview.funcBox.appendMoney(se,0,null,0,0,x.achievementpoints),$WH.ae(se.firstChild,$WH.ct(" / "+$WH.number_format(g_achievement_points[0])))),$WH.ee(ie),$WH.ae(ie,o(fe.overall,0)),window[fe.order])for(var t=1,s=0,i=window[fe.order].length;s<i;++s)(P.all[window[fe.order][s]]||P.excluded[window[fe.order][s]])&&(!fe.noempty||P.complete[window[fe.order][s]]||P.excluded[window[fe.order][s]])&&($WH.ae(ie,o(window[fe.order][s],t)),++t);e=$WH.ce("div"),e.className="clear",$WH.ae(ie,e)}function o(e,t){var s=$WH.ce("a"),i=$WH.ce("var"),a=$WH.ce("em");return t>0&&(s.className=t%3!=0?"profiler-achievements-total":"profiler-achievements-total-right"),s.category=e,s.onclick=G.bind(s,0,e!=fe.overall?e:null),0==t?$WH.ae(a,$WH.ct(LANG.pr_ach_overall)):$WH.ae(a,$WH.ct(window[fe.catgs][e])),$WH.ae(i,a),$WH.ae(i,g_createAchievementBar(P.complete[e],$WH.array_index(fe.nototal,e)?-1:P.all[e],e==fe.overall,P.bonus[e])),$WH.ae(s,i),(e==B||0==t&&null==B)&&g_setSelectedLink(s,me+"0"),s}function l(){ne=$WH.ce("div"),ne.className="clear",$WH.ae(Y,ne),ce=new Tabs({parent:ne,onShow:u}),ce.add(LANG.pr_note_subcategories,{id:me}),ce.add(LANG.pr_note_all,{id:me}),ce.add(LANG.pr_note_complete,{id:me}),ce.add(LANG.pr_note_incomplete,{id:me}),ce.add(LANG.pr_note_excluded,{id:me}),ce.flush()}function c(){var e=null===B?fe.overall:B;ne.style.display=null===B&&fe.reqcatg?"none":"",ce.setTabName(1,LANG.pr_note_all+" ("+P.all[e]+")"),ce.setTabName(2,LANG.pr_note_complete+" ("+P.complete[e]+(P.bonus[e]?"+"+P.bonus[e]:"")+")"),ce.setTabName(3,LANG.pr_note_incomplete+" ("+P.incomplete[e]+")"),ce.setTabName(4,LANG.pr_note_excluded+" ("+P.excluded[e]+")")}function u(e,t){if(Q)if(R)re.style.display="none",oe.style.display="none",le.style.display="none";else switch(D=!1,e.index){case 0:re.style.display="",oe.style.display="none",le.style.display="none";break;case 1:G(1,null),re.style.display="none",oe.style.display="";break;case 2:G(1,!0),re.style.display="none",oe.style.display="",le.style.display="none";break;case 3:G(1,!1),re.style.display="none",oe.style.display="",le.style.display="none";break;case 4:D=!0,h(),re.style.display="none",oe.style.display="none",le.style.display=""}}function p(){re=$WH.ce("div"),re.className="listview",ue=new Listview({template:"completion",id:me+"-subcatgs",parent:re,onNoData:v,onClickRow:G}),$WH.ae(Y,re)}function d(e){G(2,null),null==E&&(E={});var t=!1,i=[];if(null!==B&&fe.subname){null==E[B]&&s(B);for(var a in E[B].all)a!=B&&(E[B].all[a]||E[B].excluded[a])&&("current"!==a&&(t=!0),i.push({id:a,name:"current"==a?fe.subname(B):fe.subname(a),current:"current"==a,total:E[B].all[a],complete:E[B].complete[a]}))}ue.setData(i),e||(ce.hide(0,t),ce.show(t?0:2,1))}function m(){oe=$WH.ce("div"),oe.className="listview",oe.style.display="none";var e=null,t=["side","location","rewards","reagents"],s=["category","standing","source"];switch(me){case"achievements":e=[-6];break;case"recipes":e=[-7];break;case"quests":t.shift()}if(fe.visibleCols)for(var i=0,a=fe.visibleCols.length;i<a;++i)s.push(fe.visibleCols[i]);if(fe.hiddenCols)for(var i=0,a=fe.hiddenCols.length;i<a;++i)t.push(fe.hiddenCols[i]);pe=new Listview({template:fe.template,id:me+"-includes",parent:oe,visibleCols:s,hiddenCols:t,extraCols:ge,sort:e,customFilter:A,onBeforeCreate:H,onNoData:v,onEmptyFilter:W}),$WH.ae(Y,oe)}function f(){fe.reqcatg&&null===B||(pe.setData($WH.array_filter(j,function(e){return k(e)})),pe.updateFilters(!0),X=!0)}function g(){le=$WH.ce("div"),le.className="listview",le.style.display="none";var e=null,t=["side","location","rewards","reagents"];switch(me){case"achievements":e=[-6];break;case"recipes":e=[-7];break;case"quests":t.shift()}de=new Listview({template:fe.template,id:me+"-excludes",parent:le,visibleCols:["category","standing","source"],hiddenCols:t,extraCols:ge,sort:e,customFilter:A,onBeforeCreate:H,include:1,onNoData:v,onEmptyFilter:W}),$WH.ae(Y,le)}function h(){fe.reqcatg&&null===B||(de.setData($WH.array_filter(j,function(e){return!k(e)||!k(e,1)})),de.updateFilters(),de.refreshRows())}function v(e){return(fe.reqcatg&&null==B||!this.filtered)&&(this.include||null===B&&null===F)?""!=this.quickSearchBox.value?void $WH.ae(e,$WH.ct(LANG.lvnodata2)):(this.bandTop.style.display=this.bandBot.style.display=this.mainContainer.style.display=null!==B||null!==F?"":"none",void $WH.ae(e,$WH.ct(this.include?LANG.lvnodata4:LANG.lvnodata3))):-1}function W(e){"category"==e.id&&this.removeIndicators()}function H(){g_user||(g_user={}),g_user.excludes||(g_user.excludes={}),g_user.includes||(g_user.includes={}),g_user.excludes[fe.typeid]||(g_user.excludes[fe.typeid]=[]),g_user.includes[fe.typeid]||(g_user.includes[fe.typeid]=[]),this.poundable=0,this.createCbControls=function(e,t){var s=function(e){var t=this.getCheckedRows();if(t.length){var s=[];$WH.array_walk(t,function(t){g_user.includes[fe.typeid]=$WH.array_filter(g_user.includes[fe.typeid],function(e){return e!=t.id}),g_user.excludes[fe.typeid]=$WH.array_filter(g_user.excludes[fe.typeid],function(e){return e!=t.id}),g_user[e+"s"][fe.typeid].push(t.id),t.__tr=null,s.push(t.id)}),s.length&&($.post("?account=exclude",{type:fe.typeid,id:s.join(","),mode:1}),N())}else alert($WH.sprintf(LANG.message_norowselected,e))},i=$WH.ce("input"),a=$WH.ce("input"),n=$WH.ce("input"),r=$WH.ce("input"),o=$WH.ce("input");i.type=a.type=n.type=r.type=o.type="button",i.value=LANG.button_selectall,a.value=LANG.button_deselect,n.value=LANG.button_exclude,r.value=LANG.button_include,o.value=LANG.button_quickexclude,i.onclick=Listview.cbSelect.bind(this,!0),a.onclick=Listview.cbSelect.bind(this,!1),n.onclick=s.bind(this,"exclude"),r.onclick=s.bind(this,"include"),o.onclick=q.show.bind(null,"quickexclude",{data:{empty:y},onSubmit:b}),n.onmouseover=function(e){$WH.Tooltip.showAtCursor(e,LANG.pr_tt_exclude)},r.onmouseover=function(e){$WH.Tooltip.showAtCursor(e,LANG.pr_tt_include)},n.onmousemove=r.onmousemove=$WH.Tooltip.cursorUpdate,n.onmouseout=r.onmouseout=$WH.Tooltip.hide,n.style.display=this.include?"none":"",r.style.display=this.include?"":"none",$WH.ae(e,i),$WH.ae(e,n),$WH.ae(e,r),$WH.ae(e,a),$WH.ae(e,$WH.ct("| ")),$WH.ae(e,o)},fe.models||(this.mode=1)}function y(e){if(null==e){var t=!0;for(var s in g_excludes[fe.typeid])t=t&&y(1<<s-1);return t}for(var s in g_excludes[fe.typeid])if(e&1<<s-1)for(var i=0,a=j.length;i<a;++i)if($WH.array_index(g_excludes[fe.typeid][s],j[i].id))return!1;return!0}function b(e){var t=g_user.settings?0|g_user.excludegroups:1;for(var s in e)if(!isNaN(s)){var i=e[s]=parseInt(e[s]);1==i&&t&s&&(t-=parseInt(s)),2!=i||t&s||(t+=parseInt(s))}g_user.excludegroups=t,$.post("?account=exclude",{groups:t}),N()}function N(){J&&X&&(E=null,s(),r(),c(),d(1),h(),f())}function k(e,t){if(!t&&e.completed)return!0;if(!(g_excludes[fe.typeid]||g_user.excludes&&g_user.excludes[fe.typeid]))return!0;if(g_user.includes&&g_user.includes[fe.typeid]&&$WH.array_index(g_user.includes[fe.typeid],e.id))return!0;if(g_user.excludes&&g_user.excludes[fe.typeid]&&$WH.array_index(g_user.excludes[fe.typeid],e.id))return!1;var s=g_user.settings?0|g_user.excludegroups:1;for(var i in g_excludes[fe.typeid])if($WH.array_index(g_excludes[fe.typeid][i],e.id)&&s&1<<i-1){if(i<6||i>10)return!1;if(6==i&&!(x.faction+1&1))return!1;if(7==i&&!(x.faction+1&2))return!1;if(8!=i||x.skills[356]){if(9==i&&!x.skills[202])return!1;if(10==i&&!x.skills[197])return!1}}return!0}function w(e){var t=e[fe.catgid];return"object"==typeof t&&t.length&&(t=t[0]),t}function L(e){var t=e[fe.subcat];return"object"==typeof t&&t.length&&(t=t[0]),$WH.array_index(fe.nosubcatg,w(e))?w(e):t}function A(e){if(e.id&&(null!==B||!fe.reqcatg||O))return(D||O||k(e,!z))&&(null===B&&(!$WH.array_index(fe.nototal,w(e))||O)||B==w(e))&&(!O||null===F||F==L(e))&&(D||null==z||z&&e.completed||!z&&null==e.completed)}function G(e,t){switch(e){case 0:;B=t,null!==B&&(fe.onDemand&&fe.partial&&!K[B]&&!R?($WH.g_ajaxIshRequest(g_host+"/?data="+fe.onDemand+"&locale="+Locale.getId()+"&catg="+B+"&callback=$WowheadProfiler.loadOnDemand"),Z.style.display="block",ae.style.display="none",R=this,B=null):X||(f(),h())),pe.resetFilters(),pe.clearSearch(),pe.quickSearchBox.onblur();break;case 1:z=t;for(var i=$WH.gE(pe.cbBarTop,"input"),a=0,n=i.length;a<n;++a)if(i[a].value==LANG.button_include){i[a].style.display=!1===z?"none":"";break}break;case 2:F="current"==t?B:t,pe.removeIndicators(),de.removeIndicators();break;default:return}return pe.updateFilters(!0),de.updateFilters(!0),this&&"A"==this.nodeName&&g_setSelectedLink(this,me+e),0==e&&(d(),c()),2==e&&(!F&&this&&"TR"==this.nodeName&&(this.className=""),c(),F&&(null==E[B]&&s(B),ce.show(E[B].complete[F]?2:3),fe.subname&&(pe.createIndicator($WH.sprintf(LANG["lvnote_"+me+"ind"],B,F,fe.subname(F)),Listview.headerFilter.bind(pe,pe.columns[pe.columns.length-2],"")),de.createIndicator($WH.sprintf(LANG["lvnote_"+me+"ind"],B,F,fe.subname(F)),Listview.headerFilter.bind(de,pe.columns[pe.columns.length-2],"")),setTimeout(Listview.headerFilter.bind(pe,pe.columns[pe.columns.length-2],fe.subname(F)),1),setTimeout(Listview.headerFilter.bind(de,de.columns[de.columns.length-2],fe.subname(F)),1)))),!1}var S,x,I,q,M,T,C,j,P,E,O,D,B,F,z,V,R,U,K,Q,J,X,Y,Z,ee,te,se,ie,ae,ne,re,oe,le,ce,ue,pe,de,me,_e=this,fe={},ge=[{id:"completed",name:LANG.completed,type:"text",width:"16%",value:"completed",compute:function(e,t){var s=$WH.ce("img");s.src=e.completed?g_staticDataUrl+"/images/icons/"+(e._included()?"tick":"star")+".png":g_staticDataUrl+"/images/icons/delete.gif",s.onmouseover=function(t){$WH.Tooltip.showAtCursor(t,LANG[e.completed?e._included()?"pr_note_complete":"pr_tt_excldone":"pr_note_incomplete"],0,0,"q")},s.onmousemove=$WH.Tooltip.cursorUpdate,s.onmouseout=$WH.Tooltip.hide,s.style.border="none",$WH.ae(t,s),e.completed&&e.completed.getTime?$WH.ae(t,$WH.ct(" "+g_formatDateSimple(e.completed))):fe.showQuantity&&e.completed&&$WH.ae(t,$WH.ct(" "+e.completed))},getVisibleText:function(e){var t=LANG[e.completed?"pr_note_complete":"pr_note_incomplete"];return e.completed&&e.completed.getTime&&(t+=" "+g_formatDateSimple(e.completed)),t},sortFunc:function(e,t,s){return $WH.strcmp(e.completed,t.completed)||$WH.strcmp(e._included(),t._included())}}];this.initialize=function(t,s,i){(Y=$WH.ge(t))&&(S=e.getVars(),x=S.profile,I=S.tabs,q=S.dialog,M=s,I.tabs[M]&&(me=I.tabs[M].id,$WH.cO(fe,i),Z=$WH.ce("img"),Z.src=g_staticDataUrl+"/images/ui/misc/progress-anim.gif",Z.style.clear="both",Z.style.display=fe.onDemand?"block":"none",Z.style.margin="0 auto",$WH.ae(Y,Z),ae=$WH.ce("div"),fe.onDemand?"string"!=typeof fe.onDemand&&(fe.onDemand=me):K=!0,fe.reqcatg||(fe.partial=!1)))},this.updateExclusions=function(){N()},this.isComplete=function(e){if(e)for(var t=0,s=j.length;t<s;++t){var i=j[t];if(i.id==e)return i.completed}return!1},this.setData=function(e,s,i){t(e,s,i)},this.filterData=function(e,t){if(U||(U={}),U[e]>0&&(clearTimeout(U[e]),U[e]=0),!j||R)return U[e]=setTimeout(_e.filterData.bind(_e,e,t),750);if(ie){var s=0;if(0===e)for(var i=$WH.gE(ie,"a"),a=0,n=i.length;a<n;++a)if(i[a].category==t){s=i[a];break}G.bind(s,e,t)()}},this.purgeData=function(){T.toLowerCase()==g_user.name.toLowerCase()&&confirm($WH.sprintf(LANG.confirm_purgedata,LANG["tab_"+me].toLowerCase()))&&new Ajax("?profile=purge&id="+x.source+"&data="+me,{method:"POST",onSuccess:function(e,t){location.href=g_getProfileUrl({id:x.id,region:x.region[0],realm:x.realm[0],name:x.name})}})},this.onLoad=function(e,s){if(e==fe.onDemand){R=null,Z.style.display="none",ae.style.display="quests"==me?"":"none",t(V,T,C),null!==s&&(K[s]=1,X=!1,_e.filterData(0,s))}},this.onShow=function(){if(I.tabs[M].locked)return window.open("?client");!fe.onDemand||R||K||($WH.g_ajaxIshRequest(g_host+"/?data="+fe.onDemand+(fe.dataArgs?fe.dataArgs(x):"")+"&locale="+Locale.getId()+"&callback=$WowheadProfiler.loadOnDemand"),Z.style.display="block",ae.style.display="none",R=this,K={}),j&&!R&&(Q||(i(),n(),l(),p(),m(),g(),Q=!0),J||(B=null,F=null,z=!window[fe.order]||null,s(),a(),r(),c(),d(),h(),f(),J=!0))}}var $WowheadProfiler;Listview.templates.inventory={searchable:1,filtrable:1,createNote:function(e){var t=$WH.ce("span");t.style.color="red",t.style.fontWeight="bold",$WH.st(t,String.fromCharCode(160)),$WH.ae(e,t)},columns:[{id:"name",name:LANG.name,type:"text",align:"left",span:2,value:"name",compute:function(e,t,s){var i=$WH.ce("td"),a=g_items.createIcon(e.id,0,null,"javascript:;"),n=Icon.getLink(a);n.oncontextmenu=$WH.rf,n.onclick=$WH.Browser.opera||$WH.OS.mac?function(e){if(e=$WH.$E(e),e.shiftKey||e.ctrlKey)return!1}:null,n.onmouseup=$WowheadProfiler.onMouseUpSlot.bind(0,e.profileslot,n),n.href="?item="+e.id,a.className+=" iconsmall-q"+(7-parseInt(e.name.charAt(0))),$WowheadProfiler.updateMenu(e.profileslot,n),i.style.width="1px",i.style.padding="0",i.style.borderRight="none",$WH.ae(i,a),$WH.ae(s,i),t.style.borderLeft="none",n=$WH.ce("a"),n.oncontextmenu=$WH.rf,n.onclick=$WH.Browser.opera||$WH.OS.mac?function(e){if(e=$WH.$E(e),e.shiftKey||e.ctrlKey)return!1}:null,n.onmouseup=$WowheadProfiler.onMouseUpSlot.bind(0,e.profileslot,n),n.className="q"+(7-parseInt(e.name.charAt(0))),n.style.fontFamily="Verdana, sans-serif",n.href="?item="+e.id,$WowheadProfiler.updateMenu(e.profileslot,n),e.rel&&(Icon.getLink(a).rel=e.rel,n.rel=e.rel),$WH.ae(n,$WH.ct(e.name.substring(1))),$WH.ae(t,n)},getVisibleText:function(e){return e.name.substring(1)}},{id:"level",name:LANG.level,value:"level",compute:function(e,t,s){return e.errors.level&&(t.style.color="red",t.style.fontWeight="bold"),e.level}},{id:"slot",name:LANG.slot,type:"text",compute:function(e,t){return $WH.nw(t),g_item_slots[e.slot]},getVisibleText:function(e){return g_item_slots[e.slot]},sortFunc:function(e,t,s){return $WH.strcmp(g_item_slots[e.slot],g_item_slots[t.slot])}},{id:"source",name:LANG.source,type:"text",compute:function(e,t){if(t.className="small",null!=e.source){if(1!=e.source.length){for(var s="",i=0,a=e.source.length;i<a;++i)i>0&&(s+=LANG.comma),s+=g_sources[e.source[i]];return s}$WH.nw(t);var n=e.sourcemore?e.sourcemore[0]:{};if(n.t){n.t;var r=$WH.ce("a");null!=n.q?r.className="q"+n.q:r.className="q1",5==n.t&&(r.className+=" icontinyl",r.style.backgroundImage="url("+g_staticDataUrl+"/images/wow/icons/tiny/quest_start.gif)"),r.href="?"+g_types[n.t]+"="+n.ti,$WH.ae(r,$WH.ct(n.n)),$WH.ae(t,r)}else if(n.z){5==e.source[0]&&$WH.ae(t,$WH.ct(LANG.pr_vendorsin));var r=$WH.ce("a");r.className="q1",r.href="?zone="+n.z,$WH.ae(r,$WH.ct(g_zones[n.z])),$WH.ae(t,r)}else $WH.ae(t,$WH.ct(Listview.funcBox.getUpperSource(e.source[0],n)));n.dd&&(n.dd<0?$WH.ae(t,$WH.ct($WH.sprintf(LANG.lvitem_dd,"",n.dd<-1?LANG.lvitem_heroic:LANG.lvitem_normal))):$WH.ae(t,$WH.ct($WH.sprintf(LANG.lvitem_dd,1&n.dd?LANG.lvitem_raid10:LANG.lvitem_raid25,n.dd>2?LANG.lvitem_heroic:LANG.lvitem_normal))))}},getVisibleText:function(e){if(null!=e.source){if(1==e.source.length){var t="",s=e.sourcemore?e.sourcemore[0]:{},i=0;return s.t?(i=s.t,t+=" "+s.n):t+=" "+Listview.funcBox.getUpperSource(e.source[0],s),ls=Listview.funcBox.getLowerSource(e.source[0],s,i),null!=ls&&(ls.pretext&&(t+=" "+ls.pretext),t+=" "+ls.text,ls.posttext&&(t+=" "+ls.posttext)),t}return Listview.funcBox.arrayText(e.source,g_sources)}},sortFunc:function(e,t,s){var i=Listview.funcBox.assocArrCmp(e.source,t.source,g_sources);if(0!=i)return i;var a=e.sourcemore&&1==e.source.length?e.sourcemore[0].n:null,n=t.sourcemore&&1==t.source.length?t.sourcemore[0].n:null;return $WH.strcmp(a,n)}}],getItemLink:function(e){return"?item="+e.id}},Listview.templates.completion={sort:[1],nItemsPerPage:-1,searchable:1,poundable:0,createNote:function(e){var t=$WH.ce("small");$WH.st(t,LANG.lvnote_clicksubcatg),$WH.ae(e,t)},columns:[{id:"name",name:LANG.name,type:"text",align:"left",value:"name",compute:function(e,t,s){var i=$WH.ce("img");if(i.style.margin="0 6px -3px 0",i.src=e.complete==e.total?g_staticDataUrl+"/images/icons/tick.png":g_staticDataUrl+"/images/icons/delete.gif",i.onmouseover=function(t){$WH.Tooltip.showAtCursor(t,LANG[e.complete==e.total?"pr_note_complete":"pr_note_incomplete"],0,0,"q")},i.onmousemove=$WH.Tooltip.cursorUpdate,i.onmouseout=$WH.Tooltip.hide,i.style.border="none",$WH.ae(t,i),e.current){var a=$WH.ce("b");$WH.st(a,e.name),$WH.ae(t,a)}else $WH.ae(t,$WH.ct(e.name))},sortFunc:function(e,t,s){return-$WH.strcmp(e.current,t.current)||$WH.strcmp(e.name,t.name)}},{id:"progress",name:LANG.progress,width:"250px",compute:function(e,t,s){t.style.padding=0,$WH.ae(t,g_createAchievementBar(e.complete,e.total)),s.onclick=this.onClickRow.bind(s,2,e.id)},sortFunc:function(e,t,s){var i=Math.floor(e.complete/e.total*1e3),a=Math.floor(t.complete/t.total*1e3);return i==a?e.total-t.total:i-a}}]},Listview.templates.gallery={sort:[1],mode:3,nItemsPerPage:-1,nItemsPerRow:8,searchable:1,poundable:2,columns:[{value:"displayName"}],compute:function(e,t,s){t.className="screenshot-cell",t.vAlign="top",Listview.funcBox.ssCreateCb(t,e);var i=$WH.ce("a");i.href="javascript:;",i.onclick=this.template.modelShow.bind(this.template,e.npcId,e.displayId,!1),i.style.position="relative";var a=$WH.ce("img");a.src=e.completed?g_staticDataUrl+"/images/icons/"+(e._included()?"tick":"star")+".png":g_staticDataUrl+"/images/icons/delete.gif",a.onmouseover=function(t){$WH.Tooltip.showAtCursor(t,LANG[e.completed?e._included()?"pr_note_complete":"pr_tt_excldone":"pr_note_incomplete"],0,0,"q")},a.onmousemove=$WH.Tooltip.cursorUpdate,a.onmouseout=$WH.Tooltip.hide,a.style.border="none",a.style.position="absolute",a.style.right="6px",a.style.bottom="9px",$WH.ae(i,a),a=$WH.ce("img"),a.src=g_staticDataUrl+"/modelviewer/thumbs/npc/"+e.displayId+".png",a.height=a.width=75,$WH.ae(i,a),$WH.ae(t,i),d=$WH.ce("div"),d.className="screenshot-cell-user",i=$WH.ce("a"),i.href="?spell="+e.id,$WH.ae(i,$WH.ct(e.displayName)),$WH.ae(d,i),$WH.ae(t,d);var n=e.item;if(n&&n.source){d=$WH.ce("div"),d.style.position="relative",d.style.height="1em";var r=$WH.ce("div");r.className="screenshot-caption";var o=$WH.ce("small");if(1==n.source.length){var l=n.sourcemore?n.sourcemore[0]:{};if(l.t){l.t;var i=$WH.ce("a");null!=l.q?i.className="q"+l.q:i.className="q1",5==l.t&&(i.className+=" icontinyl",i.style.backgroundImage="url("+g_staticDataUrl+"/images/wow/icons/tiny/quest_start.gif)"),i.href="?"+g_types[l.t]+"="+l.ti,$WH.ae(i,$WH.ct(l.n)),$WH.ae(o,i)}else if(l.z){5==n.source[0]&&$WH.ae(o,$WH.ct(LANG.pr_vendorsin));var i=$WH.ce("a");i.className="q1",i.href="?zone="+l.z,$WH.ae(i,$WH.ct(g_zones[l.z])),$WH.ae(o,i)}else $WH.ae(o,$WH.ct(Listview.funcBox.getUpperSource(n.source[0],l)));l.dd&&(l.dd<0?$WH.ae(o,$WH.ct($WH.sprintf(LANG.lvitem_dd,"",l.dd<-1?LANG.lvitem_heroic:LANG.lvitem_normal))):$WH.ae(o,$WH.ct($WH.sprintf(LANG.lvitem_dd,1&l.dd?LANG.lvitem_raid10:LANG.lvitem_raid25,l.dd>2?LANG.lvitem_heroic:LANG.lvitem_normal))))}else for(var s=0,c=n.source.length;s<c;++s)s>0&&$WH.ae(o,$WH.ct(LANG.comma)),$WH.ae(o,$WH.ct(g_sources[n.source[s]]));$WH.ae(o,$WH.ce("br")),$WH.ae(r,o),$WH.ae(d,r),$WH.ae(t,d)}$WH.aE(t,"click",this.template.modelShow.bind(this.template,e.npcId,e.displayId,!0))},getVisibleText:function(e){var t=e.displayName,s=e.item;if(s&&null!=s.source)if(1==s.source.length){var i=s.sourcemore?s.sourcemore[0]:{};i.t?(i.t,t+=" "+i.n):i.z&&(t+=" "+g_zones[i.z]),t+=" "+Listview.funcBox.getUpperSource(s.source[0],i),i.dd&&(t+=" "+(i.dd<-1||i.dd>2?LANG.pr_print_heroic:LANG.pr_print_normal))}else for(var a=0,n=s.source.length;a<n;++a)t+=" "+g_sources[s.source[a]];return t},modelShow:function(e,t,s,i){if(s){if(i=$WH.$E(i),i.shiftKey||i.ctrlKey)return;for(var a=i._target;a;){if("A"==a.nodeName)return;if("IMG"==a.nodeName)break;a=a.parentNode}}ModelViewer.show({type:1,typeId:e,displayId:t,noPound:1})}},Listview.templates.itempicker={sort:[1],nItemsPerPage:-1,hideBands:2,hideNav:3,hideHeader:1,searchable:1,searchDelay:100,poundable:0,filtrable:0,clip:{w:780,h:486},onBeforeCreate:function(){},onSearchSubmit:function(e){2==this.nRowsVisible&&e.id&&$WowheadProfiler.equipItem(e.id)},columns:[{id:"item",type:"text",align:"left",value:"name",span:2,compute:function(e,t,s){if(!e.none){var i=$WH.ce("td");i.style.width="1px",i.style.padding="0",i.style.borderRight="none";var a=Icon.create(e.icon,0,null,"?item="+e.id),n=Icon.getLink(a);$WH.ae(i,a),$WH.ae(s,i),t.style.borderLeft="none",n.onclick=$WH.rf;var r=$WH.ce("a");r.className="q"+e.quality,r.style.fontFamily="Verdana, sans-serif",r.href="?item="+e.id,$WH.ae(r,$WH.ct(e.name)),$WH.nw(t),$WH.ae(t,r),$(s).click(function(t){2==t.which&&t.target==r||(t.preventDefault(),$WowheadProfiler.equipItem.bind(this,e.id,e.slot)())})}},sortFunc:function(e,t,s){return e.none?-1:t.none?1:-$WH.strcmp(e.gearscore,t.gearscore)||-$WH.strcmp(e.level,t.level)||-$WH.strcmp(e.quality,t.quality)||$WH.strcmp(e.name,t.name)}},{id:"level",name:LANG.level,value:"level",sortFunc:function(e,t,s){return e.none?-1:t.none?1:-$WH.strcmp(e.score,t.score)||$WH.strcmp(e.name,t.name)}},{id:"type",name:LANG.type,type:"text",compute:function(e,t,s){if(!e.none){t.className="small q1",$WH.nw(t);var i=$WH.ce("a"),a=Listview.funcBox.getItemType(e.classs,e.subclass,e.subsubclass);i.href=a.url,$WH.ae(i,$WH.ct(a.text)),$WH.ae(t,i)}},getVisibleText:function(e){return Listview.funcBox.getItemType(e.classs,e.subclass,e.subsubclass).text}},{id:"score",align:"center",compute:function(e,t,s){if(e.none)return $WH.ee(s),$(s).click($WowheadProfiler.equipItem.bind(this,0,e.slot)),t.colSpan=5,t.style.fontWeight="bold",t.style.textAlign="center",LANG.dash+LANG.pr_noneitem+LANG.dash;if(null!=e.score){var i=parseFloat(e.score),a=$WH.ce("div");a.className="small q"+(i?i>0?2:10:0),$WH.st(a,i?(i>0?"+":"-")+e.score:0),$WH.ae(t,a)}}}]},Listview.templates.subitempicker={sort:[1],nItemsPerPage:-1,hideBands:2,hideNav:3,hideHeader:1,searchable:1,searchDelay:100,poundable:0,filtrable:0,clip:{w:780,h:486},onBeforeCreate:function(){},onSearchSubmit:function(e){2==this.nRowsVisible&&e.id&&$WowheadProfiler.equipSubitem(e.id)},columns:[{id:"subitem",type:"text",align:"left",value:"name",span:2,compute:function(e,t,s){if(!e.none){var i="?item="+e.item,a=g_items[e.item],n=$WH.ce("td");n.style.width="1px",n.style.padding="0",n.style.borderRight="none";var r=Icon.create(a.icon,0,null,i),o=Icon.getLink(r);$WH.ae(n,r),$WH.ae(s,n),t.style.borderLeft="none",o.onclick=$WH.rf,o.rel="rand="+e.id;var l=$WH.ce("a");-1!=e.quality&&(l.className="q"+a.quality),l.style.fontFamily="Verdana, sans-serif",l.href=i,l.rel="rand="+e.id,$WH.ae(l,$WH.ct(a["name_"+Locale.getName()]+" "+e.name)),$WH.nw(t),$WH.ae(t,l),$(s).click(function(t){2==t.which&&t.target==l||(t.preventDefault(),$WowheadProfiler.equipSubitem.bind(this,e.id)())})}}},{id:"enchantment",
type:"text",align:"left",value:"enchantment",compute:function(e,t,s){if(!e.none){var i=$WH.ce("div");i.className="small crop",t.title=e.enchantment,$WH.ae(i,$WH.ct(e.enchantment)),$WH.ae(t,i)}},sortFunc:function(e,t,s){return e.none?-1:t.none?1:-$WH.strcmp(e.score,t.score)||$WH.strcmp(e.name,t.name)}},{id:"score",align:"center",compute:function(e,t,s){if(!e.none&&null!=e.score){var i=parseFloat(e.score),a=$WH.ce("div");a.className="small q"+(i?i>0?2:10:0),$WH.st(a,i?(i>0?"+":"-")+e.score:0),$WH.ae(t,a)}}}]},Listview.templates.gempicker={sort:[1],nItemsPerPage:-1,hideBands:2,hideNav:3,hideHeader:1,searchable:1,searchDelay:100,poundable:0,filtrable:0,clip:{w:780,h:486},onBeforeCreate:function(){},onSearchSubmit:function(e){2==this.nRowsVisible&&e.id&&$WowheadProfiler.socketItem(e.id)},columns:[{id:"gem",type:"text",align:"left",value:"name",span:2,compute:function(e,t,s){if(!e.none){var i=$WH.ce("td");i.style.width="1px",i.style.padding="0",i.style.borderRight="none";var a=Icon.create(e.icon,0,null,"?item="+e.id),n=Icon.getLink(a);$WH.ae(i,a),$WH.ae(s,i),t.style.borderLeft="none",n.onclick=$WH.rf;var r=$WH.ce("a");r.className="q"+e.quality,r.style.fontFamily="Verdana, sans-serif",r.href="?item="+e.id,$WH.ae(r,$WH.ct(e.name)),$WH.nw(t),$WH.ae(t,r),$(s).click(function(t){2==t.which&&t.target==r||(t.preventDefault(),$WowheadProfiler.socketItem.bind(this,e.id,e.socket,e.slot)())})}},sortFunc:function(e,t,s){return e.none?-1:t.none?1:-$WH.strcmp(e.gearscore,t.gearscore)||-$WH.strcmp(e.quality,t.quality)||$WH.strcmp(e.colors,t.colors)||$WH.strcmp(e.icon,t.icon)||$WH.strcmp(e.name,t.name)}},{id:"enchantment",type:"text",align:"left",value:"enchantment",compute:function(e,t,s){if(!e.none){var i=$WH.ce("div");i.className="small crop",t.title=e.enchantment,$WH.ae(i,$WH.ct(e.enchantment)),$WH.ae(t,i)}},sortFunc:function(e,t,s){return e.none?-1:t.none?1:-$WH.strcmp(e.score,t.score)||$WH.strcmp(e.name,t.name)}},{id:"colors",compute:function(e,t,s){if(!e.none)return t.className="small gem"+e.colors,$WH.nw(t),g_gem_colors[e.colors]},getVisibleText:function(e){if(!e.none)return g_gem_colors[e.colors]}},{id:"score",align:"center",compute:function(e,t,s){if(e.none)return $WH.ee(s),$(s).click($WowheadProfiler.socketItem.bind(this,0,e.socket,e.slot)),t.colSpan=5,t.style.fontWeight="bold",t.style.textAlign="center",LANG.dash+LANG.pr_nonegem+LANG.dash;if(null!=e.score){var i=parseFloat(e.score),a=$WH.ce("div");a.className="small q"+(i?i>0?2:10:0),$WH.st(a,i?(i>0?"+":"-")+e.score:0),$WH.ae(t,a)}}}]},Listview.templates.enchantpicker={sort:[1],nItemsPerPage:-1,hideBands:2,hideNav:3,hideHeader:1,searchable:1,searchDelay:100,poundable:0,filtrable:0,clip:{w:780,h:486},onBeforeCreate:function(){},onSearchSubmit:function(e,t){2==this.nRowsVisible&&e.id&&$WowheadProfiler.enchantItem(e.id)},columns:[{id:"enchant",type:"text",align:"left",value:"name",span:2,compute:function(e,t,s){if(!e.none){var i=(e.source>0?"?spell=":"?item=")+Math.abs(e.source),a=$WH.ce("td");a.style.width="1px",a.style.padding="0",a.style.borderRight="none";var n=Icon.create(e.icon,0,null,i),r=Icon.getLink(n);$WH.ae(a,n),$WH.ae(s,a),t.style.borderLeft="none",r.onclick=$WH.rf;var o=$WH.ce("a");-1!=e.quality&&(o.className="q"+e.quality),o.style.fontFamily="Verdana, sans-serif",o.href=i,$WH.ae(o,$WH.ct(e.name)),$WH.nw(t),$WH.ae(t,o),$(s).click(function(t){2==t.which&&t.target==o||(t.preventDefault(),$WowheadProfiler.enchantItem.bind(this,e.id)())})}},sortFunc:function(e,t,s){return e.none?-1:t.none?1:-$WH.strcmp(e.gearscore,t.gearscore)||$WH.strcmp(e.name,t.name)}},{id:"enchantment",type:"text",align:"left",value:"enchantment",compute:function(e,t,s){if(!e.none){var i=$WH.ce("div");i.className="small crop",t.title=e.enchantment,$WH.ae(i,$WH.ct(e.enchantment)),$WH.ae(t,i)}},sortFunc:function(e,t,s){return e.none?-1:t.none?1:-$WH.strcmp(e.score,t.score)||$WH.strcmp(e.name,t.name)}},{id:"skill",type:"text",compute:function(e,t,s){if(!e.none)return t.className="small q0",$WH.nw(t),e.skill>0?g_spell_skills[e.skill]:LANG.types[3][0]},getVisibleText:function(e){if(!e.none)return e.skill>0?g_spell_skills[e.skill]:LANG.types[3][0]}},{id:"score",align:"center",compute:function(e,t,s){if(e.none)return $WH.ee(s),$(s).click($WowheadProfiler.enchantItem.bind(this,0)),t.colSpan=5,t.style.fontWeight="bold",t.style.textAlign="center",LANG.dash+LANG.pr_noneenchant+LANG.dash;if(null!=e.score){var i=parseFloat(e.score),a=$WH.ce("div");a.className="small q"+(i?i>0?2:10:0),$WH.st(a,i?(i>0?"+":"-")+e.score:0),$WH.ae(t,a)}}}]},Listview.templates.petpicker={sort:[1],nItemsPerPage:-1,hideBands:2,hideNav:3,hideHeader:1,searchable:1,searchDelay:100,poundable:0,filtrable:0,clip:{w:780,h:486},onBeforeCreate:function(){},onSearchSubmit:function(e,t){2==this.nRowsVisible&&e.id&&$WowheadProfiler.selectPet(e.id)},columns:[{id:"pet",type:"text",align:"left",value:"name",span:2,compute:function(e,t,s){if(!e.none){var i="?npc="+e.id,a=$WH.ce("td");a.style.width="1px",a.style.padding="0",a.style.borderRight="none";var n=Icon.create(e.icon,0,null,i),r=Icon.getLink(n);$WH.ae(a,n),$WH.ae(s,a),t.style.borderLeft="none",r.onclick=$WH.rf;var o=$WH.ce("a");o.style.fontFamily="Verdana, sans-serif",o.href=i,$WH.ae(o,$WH.ct(e.name)),$WH.nw(t),$WH.ae(t,o),$(s).click(function(t){2==t.which&&t.target==o||(t.preventDefault(),$WowheadProfiler.selectPet.bind(this,e.id)())})}},sortFunc:function(e,t,s){return e.none?-1:t.none?1:e.family!=t.family?$WH.strcmp(g_pet_families[e.family],g_pet_families[t.family]):e.skin!=t.skin?$WH.strcmp(e.skin,t.skin):$WH.strcmp(e.name,t.name)}},{id:"skin",type:"text",value:"skin",compute:function(e,t,s){if(!e.none){var i=$WH.ce("div");i.className="small crop",t.title=e.skin,$WH.ae(i,$WH.ct(e.skin)),$WH.ae(t,i)}}},{id:"level",type:"range",getMinValue:function(e){return e.minlevel},getMaxValue:function(e){return e.maxlevel},compute:function(e,t,s){return e.none?($WH.ee(s),$(s).click($WowheadProfiler.selectPet.bind(this,0)),t.colSpan=4,t.style.fontWeight="bold",t.style.textAlign="center",LANG.dash+LANG.pr_nonepet+LANG.dash):e.minlevel>0&&e.maxlevel>0?e.minlevel!=e.maxlevel?e.minlevel+LANG.hyphen+e.maxlevel:e.minlevel:-1}}]},Dialog.templates.profileredit={title:LANG.pr_dialog_chardetails,width:400,buttons:[["okay",LANG.ok],["cancel",LANG.cancel]],fields:[{id:"savewarning",type:"caption",compute:function(e,t,s,i){this.data.region&&this.data.region[0]&&this.data.battlegroup&&this.data.battlegroup[0]&&this.data.realm&&this.data.realm[0]&&!this.data.user&&(i.style.whiteSpace="normal",i.style.lineHeight="normal",i.style.paddingBottom="10px",$WH.st(i,LANG.dialog_losechanges))}},{id:"name",type:"text",label:LANG.pr_dialog_name,size:30,required:1,validate:function(e,t){return!e.match(/`~!@#$%^&*()_\-+={[}\]|:;"'<,>.?\/]/)||(alert(LANG.message_saveasinvalidname),!1)}},{id:"level",type:"select",label:LANG.pr_dialog_level,options:g_createRange(10,80),value:80,sort:-1,compute:function(e,t,s){e.onchange=this.updateIcon}},{id:"race",type:"select",label:LANG.pr_dialog_race,options:g_chr_races,sort:1,compute:function(e,t,s){e.onchange=this.updateIcon}},{id:"classs",type:"select",label:LANG.pr_dialog_class,options:g_chr_classes,sort:1,compute:function(e,t,s){e.onchange=this.updateIcon},validate:function(e,t){return 6!=e||t.level>=55||(alert(LANG.message_invalidlevel),!1)}},{id:"gender",type:"radio",label:LANG.pr_dialog_gender,options:{0:LANG.male,1:LANG.female},compute:function(e,t,s){e.onclick=this.updateIcon}},{id:"icon",type:"text",label:LANG.pr_dialog_icon,caption:LANG.pr_dialog_iconeg,size:30,required:1,compute:function(e,t,s,i){var a=$WH.ce("div");a.style.position="relative";var n=$WH.ce("div");n.style.position="absolute",n.style.left="151px",n.style.top="-71px";var r=this.btnPreview=$WH.ce("input");r.type="button",r.value=LANG.preview,r.onclick=function(){e.value=$WH.trim(e.value),$WH.ee(n),$WH.ae(n,Icon.create(e.value,2))};var o=this;e.onchange=function(){o.data.defaulticon=!1},$WH.ae(a,e),$WH.ae(a,r),$WH.ae(a,n),$WH.ae(i,a)}},{id:"description",type:"textarea",label:LANG.pr_dialog_description,width:"98%",size:[5,30]},{id:"published",type:"radio",label:LANG.pr_dialog_public,options:{0:LANG.privateprofile,1:LANG.publicprofile}}],onInit:function(e){this.updateIcon=this.template.updateIcon.bind(this,e)},onShow:function(){this.updateIcon()},updateIcon:function(e){if(this.data.defaulticon){var t=this.getSelectedValue("race"),s=this.getSelectedValue("classs"),i=this.getCheckedValue("gender"),a=this.getSelectedValue("level");this.setValue("icon",$WH.g_getProfileIcon(t,s,i,a))}this.btnPreview.onclick()}},Dialog.templates.quickexclude={title:LANG.dialog_manageexclusions,width:480,buttons:[["okay",LANG.ok],["cancel",LANG.cancel]],fields:[{id:"excludeexplain",type:"caption",compute:function(e,t,s,i,a){i.style.whiteSpace="normal",i.style.lineHeight="1.4em",i.innerHTML=LANG.dialog_exclude;var n=$WH.ce("div");n.className="pad",$WH.ae(i,n)}},{id:"miniheader",type:"caption",compute:function(e,t,s,i,a){$WH.ae(a,$WH.ce("td")),i.setAttribute("colSpan",null);var n=$WH.ce("label"),r=$WH.ce("b");$WH.st(r,LANG.button_exclude),$WH.ae(n,r),$WH.ae(i,n),n=$WH.ce("label"),r=$WH.ce("b"),$WH.st(r,LANG.button_include),$WH.ae(n,r),$WH.ae(i,n)}},{id:"noquickexcl",type:"caption",compute:function(e,t,s,i,a){i.style.whiteSpace="normal",i.style.lineHeight="1.4em",i.innerHTML=LANG.pr_tt_noqexcl;var n=$WH.ce("div");n.className="pad",$WH.ae(i,n)}},{id:1,label:LANG.dialog_notavail},{id:2,label:LANG.dialog_tcg},{id:4,label:LANG.dialog_collector},{id:8,label:LANG.dialog_promo},{id:16,label:LANG.dialog_nonus},{id:96,label:LANG.dialog_faction},{id:896,label:LANG.dialog_profession},{id:1024,label:LANG.dialog_noexalted},{id:"resetall",type:"caption",compute:function(e,t,s,i,a){i.style.textAlign="center";var n=$WH.ce("div");n.className="pad",$WH.ae(i,n);var r=$WH.ce("a");r.href="javascript:;",r.onclick=$WowheadProfiler.resetExclusions,$WH.st(r,LANG.dialog_resetexclusions),$WH.ae(i,r)}}],onInit:function(e,t){for(var s=[],i=[],a=0,n=this.template.fields.length;a<n;++a){var r=this.template.fields[a];isNaN(r.id)?(s=s.concat(i.sort(function(e,t){return $WH.strcmp(e.label,t.label)})),i=[],s.push(r)):($WH.cO(r,{type:"radio",noInputBr:1,options:{2:"",1:""},optorder:[2,1]}),i.push(r))}s=s.concat(i.sort(function(e,t){return $WH.strcmp(e.label,t.label)})),this.template.fields=s},onBeforeShow:function(e){$WH.gE(e,"table")[0].className="profiler-exclusion";for(var t=0,s=0,i=0,a=this.template.fields.length;i<a;++i){var n=this.template.fields[i];isNaN(n.id)?t=0:(this.data[n.id]=g_user.excludegroups&n.id?2:1,n.__tr.firstChild.style.textAlign="left",n.__tr.style.display=this.data.empty(n.id)?"none":"",this.data.empty(n.id)||(t++%2&&(n.__tr.style.backgroundColor="#202020"),s++))}this.template.fields[1].__tr.style.display=s?"":"none",this.template.fields[2].__tr.style.display=s?"none":""}};