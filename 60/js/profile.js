function pr_setRegionRealm(e,a,t){if(e){var r=e.elements.rg||e.elements[0],s=e.elements.sv||e.elements[1];if(r&&s){for(var n=0,l=r.options.length;n<l;++n)if(r.options[n].value==a){r.options[n].selected=!0;break}pr_onChangeRegion(e,a,t),s.onchange&&s.onchange()}}}function pr_onChangeRegion(e,a,t){if(e){var r=e.elements.rg||e.elements[0],s=e.elements.sv||e.elements[1];if(r&&s){var n=r.options[0];if(n.value="",n.style.color="#999999",$WH.ee(s),n=$WH.ce("option"),n.value="",n.style.color="#999999",$WH.ae(s,n),null==s.onchange&&(s.onchange=function(){this.className=this.selectedIndex?"":"search-character"}),null==a&&(a=r.options[r.selectedIndex].value),a){var l;r.className="",s.className="search-character",l=pr_getRealms(a);for(var i=0,o=l.length;i<o;++i){var c=l[i],p=g_realms[c];n=$WH.ce("option"),n.value=g_urlize(p.name,!0,!0),$WH.ae(n,$WH.ct(p.name)),null!=t&&p.name==t&&(s.className="",n.selected=!0),$WH.ae(s,n)}}else{r.className="search-character",s.className="search-character";var n=$WH.ce("option");n.disabled=!0,$WH.ae(n,$WH.ct(LANG.pr_selectregion)),$WH.ae(s,n)}}}}function pr_onChangeRace(){$('select[name="ra[]"] option:selected').length?$("select[name=si]").attr("disabled",!0).val(""):$("select[name=si]").attr("disabled",!1)}function pr_suggestRealms(e,a,t){if(t.empty(),a.val().length>=2){var r=pr_getRealms(e.val(),a.val());r.length?($.each(r,function(e,a){t.append("<span>"+g_realms[a].name+"</span>")}),a.removeClass("oops"),t.show()):(a.addClass("oops"),t.hide())}else a.removeClass("oops"),t.hide()}function pr_highlightRealm(e,a,t){var r=$("span",a),s=$(r.get(e-1));r.removeClass("active"),s.addClass("active"),t.val(s.text()).focus()}function pr_getRealms(e,a){return null!=pr_onChangeRegion.C[e]?realms=pr_onChangeRegion.C[e]:realms=pr_onChangeRegion.C[e]=g_sortJsonArray(g_realms,g_realms,function(e,a){return $WH.strcmp(g_realms[e].name,g_realms[a].name)},function(a){return a.region==e}),null!=a&&(realms=$WH.array_filter(realms,function(e){return g_realms[e].name.toLowerCase().match(a.toLowerCase())})),realms}function pr_updateStatus(e,a,t,r,s){}function pr_resyncRoster(e,a){var t=$WH.ge("roster-status");t.innerHTML=LANG.pr_queue_addqueue,t.style.display="",new Ajax("?"+a+"=resync&id="+e+"&profile",{method:"POST",onSuccess:function(r,s){var n=parseInt(r.responseText);isNaN(n)?alert(LANG.message_resyncerror+n):n<0&&-102!=n&&alert(LANG.message_resyncerror+"#"+n),pr_updateStatus("profile",t,e+"&"+a,!0)}})}function pr_initRosterListview(){this.applySort(),g_user.roles&(U_GROUP_ADMIN|U_GROUP_BUREAU)&&(this.mode=1,this.createCbControls=function(e,a){if(a||!(this.data.length<15)){var t=$WH.ce("input"),r=$WH.ce("input"),s=$WH.ce("input");t.type=r.type=s.type="button",t.value=LANG.button_selectall,r.value=LANG.button_deselect,s.value=LANG.button_resync,t.onclick=Listview.cbSelect.bind(this,!0),r.onclick=Listview.cbSelect.bind(this,!1),s.onclick=function(){var e=this.getCheckedRows();if(e.length){var a="";$WH.array_walk(e,function(e){a+=e.id+","}),a=$WH.rtrim(a,","),""!=a&&new Ajax("?profile=resync&id="+a),Listview.cbSelect.bind(this,!1)(),alert(LANG.message_characterresync)}else alert(LANG.message_nocharacterselected)}.bind(this),$WH.ae(e,t),$WH.ae(e,r),$WH.ae(e,s)}})}function pr_getGearScoreQuality(e,a,t,r,s){var n,l,i;if(!a)return 0;if(null==r)l=12.25390625,e<55&&(t&&(l-=81/256),l-=1.125,e<25&&(l-=25/16,e<20&&(l-=1.875)));else{switch(r){case 1:case 5:case 7:case 16:case 17:l=1;break;case 3:case 10:case 6:case 8:l=.75;break;case 9:case 2:case 15:case 11:case 12:case 13:case 14:l=9/16;break;case 18:l=81/256}s&&(l*=2)}if(n=e>70?9.5*(e-70)+105:e>60?4.5*(e-60)+60:e+5,a>=n*l*1.25)i=5;else for(i=4;a<n*l&&i>0;)n-=e>80?12*(5-i):.6*n,i--;return i}function pr_getSpecFromTalents(e,a){var t=0;null==a||0==a[0]&&0==a[1]&&0==a[2]?t=-1:a[0]-a[1]>5&&a[0]-a[2]>5?t=1:a[1]-a[0]>5&&a[1]-a[2]>5?t=2:a[2]-a[0]>5&&a[2]-a[1]>5&&(t=3);var r,s;if(t<=0)r=g_chr_specs[t],s=-1==t?"spell_shadow_sacrificialshield":"spell_nature_elementalabsorption";else if(r=g_chr_specs[e][t-1],wt_presets&&wt_presets[e]&&wt_presets[e].pve){var n=1;for(var l in wt_presets[e].pve)if(n++==t){s=wt_presets[e].pve[l].__icon;break}}return{id:t,name:r||"",icon:s||""}}function pr_getScaleFromSpec(e,a,t){var r=wt_presets[e].pve,s=[];for(var n in r)s.push(t?LANG.presets[n]:r[n]);return t?s[a]:$WH.dO(s[a])}function pr_getScaleFilter(e,a){var t=[];if(e)for(var r=0,s=fi_filters.items.length;r<s;++r){var n=fi_filters.items[r];LANG.traits[n.name]&&e[n.name]&&t.push([n.id,e[n.name]])}t.sort(function(e,a){return-$WH.strcmp(e[1],a[1])});for(var l=[],i=[],r=0,s=t.length;r<s;++r)l.push(t[r][0]),i.push(t[r][1]);return l.length&&i.length?(a?"&":";gm=3;")+"wt="+l.join(":")+(a?"&":";")+"wtv="+i.join(":"):""}function pr_showClassPresetMenu(e,a,t,r,s){var n=[[,LANG.menu_chooseclassspec]];if(a&&t&&(2!=t||r)){if(g_user.weightscales&&g_user.weightscales.length){var l=[0,LANG.ficustom,,[]];n.push(l);for(var i=0,o=g_user.weightscales.length;i<o;++i){var c=g_user.weightscales[i];l[3].push([c.id,c.name,"?items="+t+"&filter=cr=161;crs=1;crv=0"+pr_getScaleFilter(c)+(2==t?";gb=1":";gb=3")+";upg="+a+(2==t&&g_item_slots[r]?"#"+g_urlize(g_item_slots[r]):"")])}}for(var p in wt_presets){var l=[p,g_chr_classes[p],,[],{className:"c"+p,tinyIcon:"class_"+g_file_classes[p]}];n.push(l);var u=0;for(var m in wt_presets[p].pve)l[3].push([u,LANG.presets[m],"?items="+t+"&filter=ub="+p+";cr=161;crs=1;crv=0"+pr_getScaleFilter(wt_presets[p].pve[m])+(2==t?";gb=1":";gb=3")+";upg="+a+(2==t&&g_item_slots[r]?"#"+g_urlize(g_item_slots[r]):""),,{tinyIcon:wt_presets[p].pve[m].__icon}]),u++}var g=$WH.g_getCursorPos(s);Menu.sort(n),Menu.showAtXY(n,g.x,g.y)}}function pr_addEquipButton(e,a){$.each(g_user.characters,function(t,r){if(r.pinned){var s=RedButton.create(LANG.button_equip,!0,function(){location.href=g_getProfileUrl(r)+"&items="+a});return g_addTooltip(s,LANG.tooltip_equip,"q1"),void $("#"+e).append(s)}})}function pr_onBreadcrumbUpdate(){var e=PageTemplate.get("breadcrumb");if(e&&6==e.length){var a=Menu.getFullPath(mn_path,e),t=(a[a.length-1],PageTemplate.expandBreadcrumb()[0]),r=$WH.ce("form"),s=$WH.ce("input"),n=$WH.ce("a");t.className="profiler-charlookup",r.onsubmit=pr_DirectLookup.bind(0,r,!1),s.name="na",s.className="search-character",s.type="text",s.placeholder=LANG.tab_character+LANG.ellipsis,s.onfocus=function(){this.className=""},s.onblur=function(){""==$WH.trim(this.value)&&(this.className="search-character",this.value="")},n.className="profiler-charlookup-go",n.href="javascript:;",n.onclick=r.onsubmit.bind(r),$WH.ae(r,s),$WH.ae(r,n),$WH.ae(t,r)}}function pr_DirectLookup(e,a){var t,r=$('*[name="rg"]',e),s=$('*[name="sv"]',e),n=$('*[name="na"]',e);if(r.length>1&&(r=$('*[name="rg"]:checked',e)),a)return(r.val()||s.val()||n.val())&&(location.href="?profiles"+(r.val()?"="+r.val()+(s.val()?"."+g_urlize(s.val(),!1,!0):""):"")+(n.val()?"&filter=na="+n.val()+";ex=on":"")),!1;var l=PageTemplate.get("breadcrumb");if(t=l&&6==l.length)var i=Menu.getFullPath(mn_path,l),o=i[i.length-1];return n.val()?r.val()||t?s.val()||t?(r.val()&&s.val()&&(t=!1),location.href=(t?o[2].replace("profiles","profile"):"?profile="+r.val()+"."+g_urlize(s.val(),!1,!0))+"."+g_cleanCharacterName(n.val()),!1):(alert(LANG.message_missingrealm),s.focus().addClass("oops"),!1):(alert(LANG.message_missingregion),r.focus().addClass("oops"),!1):(alert(LANG.message_missingcharacter),n.focus().addClass("oops"),!1)}function pr_lookupOrSearch(e){if(!e){if($('input[name="sv"]').val()){var a=$('input[name="sv"]').val().toLowerCase(),t=!1;if($.each(g_realms,function(e,r){r.name.toLowerCase()==a&&(t=!0)}),!t)return alert(LANG.message_missingrealm),void $('input[name="sv"]').focus().addClass("oops")}e=$('input[name="na"]').val()&&$('input[name="sv"]').val()}pr_DirectLookup($(".profiler-home"),!e)}function pr_initProfilerHome(){$('input[name="na"]').keyup(function(e){$(this).removeClass("oops"),13==e.keyCode&&pr_lookupOrSearch(!1)}).focus(),$('input[type="radio"]').change(function(){$("label").removeClass("selected"),$('label[for="'+$(this).attr("id")+'"]').addClass("selected"),pr_suggestRealms($('input[name="rg"]:checked'),$('input[name="sv"]'),$(".profiler-autocomplete")),$('input[name="sv"]').focus()}),$('input[name="sv"]').keyup(function(e){switch(e.keyCode){case 13:$(".profiler-autocomplete").hide(),pr_lookupOrSearch(!1);break;case 27:$(".profiler-autocomplete").hide();break;case 38:selectedRealm--,selectedRealm<0&&(selectedRealm=$(".profiler-autocomplete span").length-1),pr_highlightRealm(selectedRealm,$(".profiler-autocomplete"),$('input[name="sv"]'));break;case 40:selectedRealm++,selectedRealm>=$(".profiler-autocomplete span").length&&(selectedRealm=0),pr_highlightRealm(selectedRealm,$(".profiler-autocomplete"),$('input[name="sv"]'));break;default:pr_suggestRealms($('input[name="rg"]:checked'),$('input[name="sv"]'),$(".profiler-autocomplete")),selectedRealm=0}}),$(".profiler-autocomplete").delegate("span","mouseover",function(){$(".profiler-autocomplete span").removeClass("active")}).delegate("span","click",function(){$('input[name="sv"]').val($(this).text()).focus(),$(".profiler-autocomplete").hide()}),$("#profiler-lookup, #profiler-search").click(function(e){pr_lookupOrSearch("profiler-lookup"==this.id)}),$("body").click(function(){$(".profiler-autocomplete").hide()})}pr_onChangeRegion.C={},$WH.isset("mn_profiles")&&(Menu.findItem(mn_path,[1,5,0])[MENU_IDX_SUB]=mn_profiles,Menu.findItem(mn_path,[1,5,2])[MENU_IDX_SUB]=mn_guilds,Menu.findItem(mn_path,[1,5,3])[MENU_IDX_SUB]=mn_arenateams,PageTemplate.getBreadcrumb().bind("update",pr_onBreadcrumbUpdate));