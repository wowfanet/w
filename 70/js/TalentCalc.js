function TalentCalc(){function e(){var e=_e[Ae];if(e.k>X)for(var t=Z-1;t>=0;--t)for(var a=e[t].t.length-1;a>=0;--a)for(var l=e[t].t[a].k,s=0;s<l;++s)if($(e[t].t[a]),e.k<=X)return}function t(e,t){M(-1,ze?0:Q),l(e,t)}function l(e,t){F==me&&$WH.Tooltip.showAtCursor(t,LANG[ze?"tc_rembon":"tc_addbon"],null,null,"q")}function s(e,t){T(prompt($WH.sprintf(LANG.prompt_ratinglevel,ke,ge),Ce)),n(e,t),y()}function n(e,t){$WH.Tooltip.showAtCursor(t,LANG.tooltip_changelevel,null,null,"q")}function r(e,t,a){var l,s,i=$WH.ce("div");switch(i.className="talentcalc-arrow",e){case 0:t=15,l=h(1,2),l.className="talentcalc-arrow-down",s=l.firstChild.childNodes[0].childNodes[0].style,s.width="15px",s.height="4px",s=l.firstChild.childNodes[1].childNodes[0].style,s.backgroundPosition="bottom",s.height=a-4+"px";break;case 1:l=h(2,2,!0),l.className="talentcalc-arrow-leftdown",s=l.firstChild.childNodes[0].childNodes[0].style,s.backgroundPosition="left",s.width=t-4+"px",s.height="11px",s=l.firstChild.childNodes[0].childNodes[1].style,s.backgroundPosition="right",s.width="4px",s=l.firstChild.childNodes[1].childNodes[0].style,s.backgroundPosition="bottom left",s.backgroundRepeat="no-repeat",s.height=a-11+"px";break;case 2:l=h(2,2,!0),l.className="talentcalc-arrow-rightdown",s=l.firstChild.childNodes[0].childNodes[0].style,s.backgroundPosition="left",s.width="4px",s=l.firstChild.childNodes[0].childNodes[1].style,s.backgroundPosition="right",s.width=t-4+"px",s.height="11px",s=l.firstChild.childNodes[1].childNodes[0].style,s.backgroundPosition="bottom right",s.backgroundRepeat="no-repeat",s.height=a-11+"px";break;case 3:a=15,l=h(2,1),l.className="talentcalc-arrow-right",s=l.firstChild.childNodes[0].childNodes[0].style,s.backgroundPosition="left",s.width="4px",s=l.firstChild.childNodes[0].childNodes[1].style,s.backgroundPosition="right",s.width=t-4+"px";break;case 4:a=15,l=h(2,1),l.className="talentcalc-arrow-left",s=l.firstChild.childNodes[0].childNodes[0].style,s.backgroundPosition="left",s.width=t-4+"px",s=l.firstChild.childNodes[0].childNodes[1].style,s.backgroundPosition="right",s.width="4px"}return i.style.width=t+"px",i.style.height=a+"px",$WH.ae(i,l),i}function c(){var e,t,a;be=$WH.ce("div"),be.className="talentcalc-lower",be.style.display="none";for(var l=0;l<Z;++l)e=Ge[l]=$WH.ce("div"),e.className="talentcalc-lower-tree"+(l+1),t=$WH.ce("p"),$WH.ae(t,$WH.ce("b")),$WH.ae(t,$WH.ce("span")),a=$WH.ce("a"),a.href="javascript:;",a.onclick=ye.reset.bind(null,l),g_addTooltip(a,LANG.tc_resettree),$WH.ae(t,a),$WH.ae(e,t),$WH.ae(be,e);$WH.ae(re,be)}function o(){We=$WH.ce("div"),We.className="talentcalc-main";var e=$WH.ce("div");e.className="clear",$WH.ae(We,e),$WH.ae(re,We)}function d(){if(F==me){$e=$WH.ce("div"),$e.className="talentcalc-model",$e.style.display="none",_swfModel=$WH.ce("div"),_swfModel.id="shg09yrhlnk",$WH.ae($e,_swfModel);var e=$WH.ce("div");e.className="clear",$WH.ae($e,e),$WH.ae(re,$e)}}function f(e){for(var t,a,l=[{}],s=0,i=g_pet_talents.length;s<i;++s){var n=g_pet_talents[s];if($WH.in_array(n.f,e)>=0){l[0].n=n.n,l[0].t=[],l[0].i=s,l[0].icon=n.icon;for(var r=0,c=n.t.length;r<c;++r)t=n.t[r],a=l[0].t[r]={},$WH.cO(a,t),t.f&&-1==$WH.in_array(t.f,e)&&(a.hidden=!0);break}}return l}function u(){var e,t,a;te=$WH.ce("div"),te.className="talentcalc-sidebar",e=$WH.ce("div"),e.className="talentcalc-sidebar-inner",t=$WH.ce("a"),t.className="talentcalc-button-help",t.href=F==me?"http://www.wow-petopia.com/talents/talents.html":"?help=talent-calculator",t.target="_blank",$WH.ae(t,$WH.ct(LANG.tc_help)),$WH.ae(e,t),ae=$WH.ce("div"),ae.className="talentcalc-sidebar-controls",ae.style.display="none",t=$WH.ce("a"),t.className="talentcalc-button-reset",t.href="javascript:;",t.onclick=ye.resetAll,$WH.ae(t,$WH.ct(LANG.tc_resetall)),$WH.ae(ae,t),t=le=$WH.ce("a"),t.className="talentcalc-button-lock",t.href="javascript:;",t.onclick=O,$WH.ae(t,$WH.ct(LANG.tc_lock)),$WH.ae(ae,t),t=$WH.ce("div"),t.className="clear",$WH.ae(ae,t),$WH.ae(e,ae),t=$WH.ce("div"),t.className="talentcalc-sidebar-controls2",a=$WH.ce("a"),a.className="talentcalc-button-import",a.href="javascript:;",a.onclick=R.profiler?ye.promptWhBuild:ye.promptBlizzBuild,$WH.ae(a,$WH.ct(LANG.tc_import)),$WH.ae(t,a),a=se=$WH.ce("a"),a.className="talentcalc-button-summary",a.style.display="none",a.href="javascript:;",a.onclick=ye.showSummary.bind(null,1),$WH.ae(a,$WH.ct(LANG.tc_summary)),$WH.ae(t,a),a=ne=$WH.ce("a"),a.className="talentcalc-button-restore",a.style.display="none",a.href="javascript:;",a.onclick=C,$WH.ae(a,$WH.ct(LANG.tc_restore)),$WH.ae(t,a),a=ie=$WH.ce("a"),a.className="talentcalc-button-export",a.style.display="none",a.href="javascript:;",a.target="_blank",$WH.ae(a,$WH.ct(LANG.tc_link)),$WH.ae(t,a),a=$WH.ce("div"),a.className="clear",$WH.ae(t,a),$WH.ae(e,t),t=$WH.ce("div"),$WH.ae(e,t),$WH.ae(te,e),t=$WH.ce("div"),t.className="talentcalc-sidebar-anchor",$WH.ae(t,te),$WH.ae(ee,t)}function h(e,t,a){for(var l,s,i=$WH.ce("table"),n=$WH.ce("tbody"),r=0;r<t;++r){l=$WH.ce("tr");for(var c=0;c<e;++c){if(a&&r>0){s=$WH.ce("th"),s.colSpan=2,$WH.ae(l,s);break}var o=$WH.ce("td");o.className="talentcalc-main-cell",$WH.ae(l,o)}$WH.ae(n,l)}return $WH.ae(i,n),i}function p(e){var t=_e[e];t.k=0,t.div=$WH.ce("div"),t.div.style.display="none",$WH.aef(We,t.div);for(var a=0;a<Z;++a){t[a].k=0;var l=$WH.ce("div"),s=$WH.ce("div");l.style.backgroundRepeat="no-repeat",l.style.cssFloat=l.style.styleFloat="left",a>0&&(l.style.borderLeft="1px solid #404040"),s.style.overflow="hidden",s.style.width=F==He?"204px":"244px",$WH.ae(s,h(4,V)),$WH.ae(l,s),$WH.ae(t.div,l);var i,n=$WH.gE(l,"td"),c="?"+Ne;F==me?(l.style.backgroundImage="url("+g_staticDataUrl+"/images/wow/hunterpettalents/bg_"+(t[0].i+1)+".jpg"+c+")",i=g_staticDataUrl+"/images/wow/hunterpettalents/icons_"+(t[0].i+1)+".jpg"+c):(l.style.backgroundImage="url("+g_staticDataUrl+"/images/wow/talents/backgrounds/"+g_file_classes[e]+"_"+(a+1)+".jpg"+c+")",i=g_staticDataUrl+"/images/wow/talents/icons/"+g_file_classes[e]+"_"+(a+1)+".jpg"+c);for(var o=t[a].t.length-1;o>=0;--o){var d=t[a].t[o],f=Icon.create(i,1,null,"javascript:;"),u=Icon.getLink(f),p=n[4*d.y+d.x+1-1];we[t[a].t[o].i]=d,u.rel="np",u.target="_blank",u.onmousedown=$WH.rf,u.onclick=$WH.rf,g_onClick(u,g.bind(u,d)),u.onmouseover=j.bind(null,u,d),u.onmouseout=$WH.Tooltip.hide;var b=$WH.ce("div"),W=$WH.ce("div");if($WH.ae(W,$WH.ct("0")),b.className="icon-border",W.className="icon-bubble",$WH.ae(f,b),$WH.ae(f,W),d.k=0,d.i=o,d.tree=a,d.classId=e,d.icon=f,d.link=u,d.border=b,d.bubble=W,d.hidden||$WH.ae(p,f),d.r){var $,v,H,m,k=t[a].t[d.r[0]],N=d.x-k.x,y=d.y-k.y,_=-1;if(null==k.links?k.links=[o]:k.links.push(o),y>0?_=0==N?0:N<0?1:2:0==y&&(N>0?_=3:N<0&&(_=4)),F==me?(H=60*(Math.abs(N)-1),m=60*(Math.abs(y)-1)):(H=50*(Math.abs(N)-1),m=50*(Math.abs(y)-1)),F==me)switch(_){case 0:m+=27,$=21,v=6-m}else switch(_){case 0:m+=17,$=16,v=6-m;break;case 1:H+=36,m+=42,$=16,v=6-m;break;case 2:H+=37,m+=42,$=-6,v=6-m;break;case 3:H+=15,$=-6,v=12;break;case 4:H+=15,$=37,v=12}var w=r(_,H,m);w.style.left=$+"px",w.style.top=v+"px";var A=$WH.ce("div");A.className="talentcalc-arrow-anchor",$WH.ae(A,w),d.hidden||p.insertBefore(A,p.firstChild),d.arrow=w}}}}function b(){var e,i;ce=$WH.ce("div"),ce.className="talentcalc-upper",ce.style.display="none",e=$WH.ce("span"),e.className="talentcalc-upper-class",oe=a=$WH.ce("a"),a.target="_blank",a.style.fontWeight="bold",$WH.ae(e,a),$WH.ae(e,$WH.ct(" ")),de=$WH.ce("b"),$WH.ae(e,de),$WH.ae(ce,e),e=$WH.ce("span"),e.className="talentcalc-upper-ptsleft",$WH.ae(e,$WH.ct(LANG.tc_ptsleft)),he=$WH.ce("b"),$WH.ae(e,he),$WH.ae(ce,e),F==me&&(i=pe=$WH.ce("a"),i.href="javascript:;",i.onclick=t.bind(null,i),i.onmouseover=l.bind(null,i),i.onmousemove=$WH.Tooltip.cursorUpdate,i.onmouseout=$WH.Tooltip.hide,$WH.ae(e,i)),e=$WH.ce("span"),e.className="talentcalc-upper-reqlevel",$WH.ae(e,$WH.ct(LANG.tc_reqlevel)),fe=$WH.ce("b"),$WH.ae(e,fe),i=ue=$WH.ce("a"),i.className="q1",i.href="javascript:;",i.onclick=s.bind(null,i),i.onmouseover=n.bind(null,i),i.onmousemove=$WH.Tooltip.cursorUpdate,i.onmouseout=$WH.Tooltip.hide,R.profiler||($WH.ae(e,$WH.ct(" (")),$WH.ae(e,i),$WH.ae(e,$WH.ct(")"))),$WH.ae(ce,e),e=$WH.ce("div"),e.className="clear",$WH.ae(ce,e),$WH.ae(re,ce)}function W(e){for(var t="",a=[],l=0;l<e.length;l+=2){for(var s=0;s<2;++s)a[s]=parseInt(e.substring(l+s,l+s+1)),isNaN(a[s])&&(a[s]=0);t+=Be.charAt(6*a[0]+a[1])}return t}function $(e,t,a){var l=_e[e.classId];if(e.k>0){if(e.links)for(i=0;i<e.links.length;++i)if(l[e.tree].t[e.links[i]].k)return;e.k--;for(var s=0,i=0;i<l[e.tree].t.length;++i){var n=l[e.tree].t[i];if(n.k&&e.y!=n.y&&s<n.y*J)return void e.k++;s+=n.k}if(l[e.tree].k--,i=l.k--,D(e.tree,t,null,e.classId),t){if(j(a,e),i>=X)for(var r=0;r<Z;++r)D(r,!0,null,e.classId);y()}}}function v(e){var t=v.L;if(null==t){t=v.L={};for(var a in H.L)t[H.L[a]]=a}return t[e]}function H(e){return H.L[e]}function m(){var e=_e[Ae];return F==me?Math.max(ze?60:0,e.k>0?4*(e.k-ze)+16:0):e.k?e.k+9:0}function k(e,t){var a=(e.d,Math.max(0,e.k-1)+(t?1:0));return e.d[a]}function g(e,t){Ie||(t?$(e,!0,this):N(e,!0,this))}function N(e,t,a){var l=_e[e.classId];if(l.k<X){if(e.enabled&&e.k<e.m&&(l.k++,l[e.tree].k++,e.k++,D(e.tree,t,e,e.classId),t)){if(j(a,e),l.k==X)for(var s=0;s<Z;++s)s!=e.tree&&D(s,t,null,e.classId);y()}}else F!=me||l.k!=X||t||(M(-1,Q,!0),N(e,t,a))}function y(){var e=_e[Ae];if(e){Me.mode=F,Me.classId=Ae,Me.locked=Ie,Me.requiredLevel=m(),Me.pointsLeft=X-e.k,Me.pointsSpent=F==me?e[0].k:[e[0].k,e[1].k,e[2].k],Me.bonusPoints=ze,$WH.st(de,"("+(F==me?e.k:Me.pointsSpent.join("/"))+")"),$WH.st(fe,Me.requiredLevel?Me.requiredLevel:"-"),$WH.st(ue,Ce),$WH.st(he,Me.pointsLeft),Ie?($WH.st(le,LANG.tc_unlock),le.className="talentcalc-button-unlock"):($WH.st(le,LANG.tc_lock),le.className="talentcalc-button-lock"),F==me&&(ze?($WH.st(pe,"[-]"),pe.className="q10"):($WH.st(pe,"[+]"),pe.className="q2")),ie&&(ie.href=(F==me?"?petcalc#":"?talent#")+ye.getWhBuild());for(var t=0;t<Z;++t){var a=Ge[t].firstChild.childNodes[1];$WH.st(a," ("+e[t].k+")")}ve&&ve(ye,Me,e)}}function _(){$WH.st(oe,Y[Ae]),F==me?(oe.href="?pet="+Ae,E(Ae),$e.style.display=""):(oe.href="?class="+Ae,oe.className="c"+Ae),0==xe&&(ae.style.display="",se.style.display="",ie&&(ie.style.display=""),ce.style.display="",be.style.display="");for(var t=_e[Ae],a=0;a<Z;++a){var l=Ge[a].firstChild.childNodes[0];F==He&&(l.style.backgroundImage="url("+g_staticDataUrl+"/images/wow/talents/trees/"+g_file_classes[Ae]+"_"+(a+1)+".gif)"),$WH.st(l,t[a].n)}e(),A(Ae),y(),++xe}function w(e,t){for(var a=_e[t],l=0,s=0,i=[],n=[],r=0;r<e.length;++r){var c=e.charAt(r);if(c!=qe){var o=Be.indexOf(c);if(o<0)continue;i[1]=o%6,i[0]=(o-i[1])/6;for(var d=0;d<2;++d){o=Math.min(i[d],a[l].t[s].m);for(var f=0;f<o;++f)N(a[l].t[s]);for(var u=0;u<n.length;++u)if(n[u][0].enabled&&n[u][1]>0){for(var f=0;f<n[u][1];++f)N(n[u][0]);n[u][1]=0}if(a[l].t[s].k<o&&n.push([a[l].t[s],o-a[l].t[s].k]),++s>=a[l].t.length)break}}if((s>=a[l].t.length||c==qe)&&(s=0,++l>Z-1))return}}function A(e){for(var t=0;t<Z;++t)D(t,!0,null,e)}function L(e,t){if(null==_e[e]){t.n=e,_e[e]=t;var a=_e[e];if(p(e),U&&U.classId==e){for(var l=0;l<Z;++l)D(l,!1,null,e);(U.wh||U.blizz)&&(Ie=!0,U.wh?w(U.wh,e):_parseBlizzBuild(U.blizz,e))}else Ie=!1;if(U=null,e==Ae){_(),a.div.style.display="";for(var l=0;l<Z;++l)D(l,!0,null,e)}}}function x(e){I(e),A(e)}function I(e){F==me&&M(-1,0,!0);for(var t=0;t<Z;++t)z(t,e,!1)}function z(e,t,a){var l,s=_e[t];for(l=0;l<s[e].t.length;++l)s[e].t[l].k=0;if(l=s.k<X,s.k-=s[e].k,s[e].k=0,a){if(l)D(e,!0,null,t);else for(e=0;e<Z;++e)D(e,!0,null,t);y()}}function C(){S&&(S.wh?P(S.wh):G(S.classId,S.blizz))}function G(e,t){null!=Y[e]&&t&&(Ie=!0,S||(S={classId:e,blizz:t},ne.style.display=""),_e[e]?(I(e),A(e),_parseBlizzBuild(t,e),A(e)):U={classId:e,blizz:t},B(e)||y())}function B(e){if(null!=Y[e]&&e!=Ae){if(Le=Ae,Ae=e,F==me&&null==_e[e])L(e,f(e));else if(_e[e]){_();var t=_e[e];t.div.style.display=""}else $WH.g_ajaxIshRequest("?data=talents&class="+e+"&locale="+Locale.getId()+"&"+Ne);return _e[Le]&&(_e[Le].div.style.display="none"),!0}}function T(e){if(e=parseInt(e),!(isNaN(e)||e<ke||e>ge)){Ce=e;var t;t=F==me?Math.max(0,Math.floor((e-16)/4)):Math.max(0,e-9),M(t,-1)}}function q(e){Ie!=e&&(Ie=e,A(Ae),y(1))}function M(t,a,l){var s=X;-1==t&&(t=K),-1==a&&(a=ze),K=t,ze=a,X=t+a,-1!=Ae&&(X<s&&e(),A(Ae),l||y())}function P(e){if(e){var t,a=e,l=!1;if(F==me){var s=Be.indexOf(e.charAt(0));if(s>=0&&s<=4){var i=Be.indexOf(e.charAt(1));i%2==1?(M(-1,Q,!0),--i):M(-1,0,!0),t=10*s+i/2,null!=g_pet_families[t]&&(e=e.substr(2),l=!0)}}else{var s=Be.indexOf(e.charAt(0));if(s>=0&&s<=27){var i=s%3,t=(s-i)/3;t=v(t),null!=t&&(e=e.substr(1),l=!0)}}return l?(e.length&&(Ie=!0,S||(S={wh:a},ne.style.display="")),_e[t]?(I(t),w(e,t),A(t)):U={classId:t,wh:e},B(t)||y(),t):void 0}}function j(e,t){var a=_e[t.classId],l="<table><tr><td><b>";t.z&&(l+='<span style="float: right" class="q0">'+t.z+"</span>"),l+=t.n+"</b><br />"+$WH.sprintf(LANG.tc_rank,t.k,t.m)+"<br />",t.r&&a[t.tree].t[t.r[0]].k<t.r[1]&&(l+='<span class="q10">',l+=$WH.sprintf(LANG[1==t.r[1]?"tc_prereq":"tc_prereqpl"],t.r[1],a[t.tree].t[t.r[0]].n),l+="</span><br />"),a[t.tree].k<t.y*J&&(l+='<span class="q10">'+$WH.sprintf(LANG.tc_tier,t.y*J,a[t.tree].n)+"</span><br />"),t.t&&t.t.length>=1&&(l+=t.t[0]),l+="</td></tr></table><table><tr><td>",t.t&&t.t.length>1&&(l+=t.t[1]+"<br />"),l+='<span class="q">'+k(t)+"</span><br />",Ie||t.enabled&&(t.k?t.k==t.m&&(l+='<span class="q10">'+LANG.tc_unlearn+"</span><br />"):l+='<span class="q2">'+LANG.tc_learn+"</span><br />",t.k&&t.k<t.m&&(l+="<br />"+LANG.tc_nextrank+'<br /><span class="q">'+k(t,1)+"</span><br />")),l+="</td></tr></table>",$WH.Tooltip.show(e,$WH.g_setTooltipLevel(l,m()))}function O(){return Ie=!Ie,A(Ae),y(),Ie}function D(e,t,a,l){var s,i=_e[l];if(a&&i.k!=X?(s=a.i,Math.floor(i[e].k/J)*J+5):(s=0,X-21),null!=a&&null!=a.links)for(var n=0,r=a.links.length;n<r;++n)s>a.links[n]&&(s=a.links[n]);for(var n=s;n<i[e].t.length;++n)if(a=i[e].t[n],(i.k!=X||a.k)&&i[e].k>=a.y*J?a.r?i[e].t[a.r[0]].k>=a.r[1]?a.enabled=1:a.enabled=0:a.enabled=1:a.enabled=0,t){if(!a.enabled||Ie&&!a.k){if(a.border.style.backgroundPosition="0 0",Icon.moveTexture(a.icon,1,n,1),a.link.className="",a.bubble.style.visibility="hidden",a.r){var c=a.arrow.firstChild;"2"==c.className.charAt(c.className.length-1)&&(c.className=c.className.substr(0,c.className.length-1))}}else if(a.k==a.m?(a.border.style.backgroundPosition="-42px 0",a.bubble.style.color="#E7BA00"):(a.border.style.backgroundPosition="-84px 0",a.bubble.style.color="#17FD17"),Icon.moveTexture(a.icon,1,n,0),a.link.className="bubbly",a.bubble.style.visibility="visible",a.r){var c=a.arrow.firstChild;"2"!=c.className.charAt(c.className.length-1)&&(c.className+="2")}a.bubble.firstChild.nodeValue=a.k,a.link.href="?spell="+a.s[Math.max(0,a.k-1)]}}function E(e,t){var a=g_staticDataUrl;if(F==me){var l=_e[e];if(l){if(g_pets[t]&&g_pets[t].family==e&&(l.npcId=t),!g_pets[l.npcId]||g_pets[l.npcId].family!=e){var s=[];for(var i in g_pets)g_pets[i].family==e&&s.push(g_pets[i].id);if(!s.length)return;l.npcId=s[Math.floor(Math.random()*s.length)]}var n={model:g_pets[l.npcId].displayId,modelType:8,contentPath:a+"/modelviewer/",blur:$WH.OS.mac?"0":"1"},r={quality:"high",allowscriptaccess:"always",allowfullscreen:!0,menu:!1,bgcolor:"#181818",wmode:"direct"},c={};swfobject.embedSWF(a+"/modelviewer/ZAMviewerfp11.swf",_swfModel.id,"100%","100%","10.0.0",a+"/modelviewer/expressInstall.swf",n,r,c)}}}var R,U,S,F,Z,V,J,K,Q,X,Y,ee,te,ae,le,se,ie,ne,re,ce,oe,de,fe,ue,he,pe,be,We,$e,ve,He=0,me=1,ke=10,ge=70,Ne=85,ye=this,_e={},we={},Ae=-1,Le=-1,xe=0,Ie=!1,ze=0,Ce=ge,Ge=[],Be="0zMcmVokRsaqbdrfwihuGINALpTjnyxtgevElBCDFHJKOPQSUWXYZ123456789",Te="aZbYcXdWeVfUgThSiRjQkPlOmNnMoLpKqJrIsHtGuFvEwDxCyBzA0123456789_=+-.",qe="Z",Me={};this.getTalentTrees=function(){return _e[Ae]},this.getBlizzBuild=function(){if(-1!=Ae){for(var e=_e[Ae],t="",a=0;a<Z;++a)for(var l=0;l<e[a].t.length;++l)t+=e[a].t[l].k;return t=$WH.rtrim(t,"0")}},this.getSpentFromBlizzBuild=function(e,t){for(var a=_e[t],l=[],s=0;s<Z;++s)l.push(0);if(a){var i=0,n=0;8==t&&62==e.length&&(e=e.substr(0,15)+e.substr(16));for(var s=0;s<e.length;++s){var r=Math.min(parseInt(e.charAt(s)),a[i].t[n].m);if(!isNaN(r)){for(var c=0;c<r;++c)++l[i];if(++n>a[i].t.length-1&&(n=0,++i>Z-1))break}}}return l},this.getTalents=function(){var e=[];if(-1!=Ae){var t=_e[Ae];if(t)for(var a=0;a<Z;++a)for(i=0;i<t[a].t.length;++i)t[a].t[i].k&&e.push(t[a].t[i])}return e},this.getTalentRanks=function(e){if(-1!=Ae)return we[e]?we[e].k:0},this.getWhBuild=function(){if(-1!=Ae){for(var e,t,a=_e[Ae],l="",s=0;s<Z;++s){for(e="",t=0;t<a[s].t.length;++t)e+=a[s].t[t].k;e=$WH.rtrim(e,"0"),l+=W(e),t=e.length,t%2==1&&++t,t<a[s].t.length&&(l+=qe)}var i;return i=F==me?Be.charAt(Math.floor(Ae/10))+Be.charAt(Ae%10*2+(ze?1:0)):Be.charAt(3*H(Ae)),i+=$WH.rtrim(l,qe)}},this.initialize=function(e,t){ee||(e=$WH.ge(e))&&(ee=e,ee.className="talentcalc",null==t&&(t={}),R=t,R.onChange&&(ve=R.onChange),R.mode==me?(F=me,Z=1,V=6,J=3,K=16,Q=4,Y=g_pet_families,ee.className+=" talentcalc-pet"):(F=He,Z=3,V=11,J=5,K=61,Q=0,Y=g_chr_classes,ee.className+=" talentcalc-default",$WowheadTalentCalculator=ye),X=K+ze,re=$WH.ce("div"),re.className="talentcalc-wrapper",$WH.ae(ee,re),u(),b(),o(),d(),c(),R.whBuild?P(R.whBuild):R.classId>0&&Y[R.classId]&&(R.blizzBuild?G(R.classId,R.blizzBuild):B(R.classId)))},this.promptBlizzBuild=function(){if(F!=me){var e,t=prompt(LANG.prompt_importblizz,"");if(t){if(t.match(/talent-calculator#([\w=+-.])c[0-9]{2}(![\w=+-.]*![\w=+-.]*![\w=+-.]*!?[\w=+-.]*)/))return e=Te.indexOf(RegExp.$1),void G(e,RegExp.$2);if(t.match(/\?cid=([0-9]+)&tal=([0-9]+)/))return e=parseInt(RegExp.$1),void G(e,RegExp.$2);var a=t.indexOf("?tal=");if(-1!=a){for(var l in g_file_classes)if(-1!=t.indexOf(g_file_classes[l])){e=parseInt(l);break}if(e)return void G(e,t.substring(a+5))}alert(LANG.alert_invalidurl)}}},this.promptWhBuild=function(){var e=prompt(LANG.prompt_importwh,"");if(e){var t=e.indexOf("=");if(-1!=t){P(e.substr(t).substr(1).split(":")[0]||"")}}},this.registerClass=function(e,t){L(e,t)},this.reset=function(e){-1!=Ae&&(e>Z-1||(Ie=!1,z(e,Ae,!0)))},this.resetAll=function(){_e[Ae]&&(Ie=!1,x(Ae),y())},this.resetBuild=function(){_e[Ae]&&(Ie=!1,I(Ae),A(Ae),y())},this.restore=function(){C()},this.setBlizzBuild=function(e,t){G(e,t)},this.setBonusPoints=function(){F==me&&M(-1,Q)},this.getBonusPoints=function(e){return ze},this.setClass=function(e){return B(e)},this.setLevelCap=function(e){T(e)},this.setLock=function(e){-1!=Ae&&q(e)},this.setWhBuild=function(e){return P(e)},this.setPetModel=function(e){E(Ae,e)},this.showSummary=function(e){if(-1!=Ae){var t,a,l,s=_e[Ae],i=window.open("?talent=summary","","toolbar=no,menubar=yes,status=yes,scrollbars=yes,resizable=yes"),n="<html><head><title>"+document.title+'</title></head><body style="font-family: Arial, sans-serif; font-size: 13px">';if(i.document.open(),e)for(n+="<h2>",n+=F==me?$WH.sprintf(LANG.tc_printh,m(),g_pet_families[s.n]):$WH.sprintf(LANG.tc_printh,m(),g_chr_classes[s.n])+" ("+s[0].k+"/"+s[1].k+"/"+s[2].k+")",n+="</h2>",n+="<p></p>",void 0!==$WowheadTalentCalculator&&(n+="<h3>"+LANG.tc_export+LANG.colon+"</h3>",n+="<blockquote style=\"font-family: 'Courier New';\">?cid="+Ae+"&tal="+$WowheadTalentCalculator.getBlizzBuild()+"</blockquote>",n+="<p></p>"),t=0;t<Z;++t){for(n+="<h3>"+s[t].n+" ("+s[t].k+" "+LANG[1==s[t].k?"tc_point":"tc_points"]+")</h3>",n+="<blockquote>",l=0,a=0;a<s[t].t.length;++a)s[t].t[a].k&&(l&&(n+="<br /><br />"),n+="<b>"+s[t].t[a].n+"</b>"+LANG.hyphen+$WH.sprintf(LANG.tc_rank,s[t].t[a].k,s[t].t[a].m)+"<br />",n+=k(s[t].t[a]),++l);0==l&&(n+=LANG.tc_none),n+="</blockquote>"}else{for(n+="<pre>",t=0;t<Z;++t){for(n+="<b>"+s[t].n+" ("+s[t].k+" "+LANG[1==s[t].k?"tc_point":"tc_points"]+")</b>\n\n",l=0,a=0;a<s[t].t.length;++a)s[t].t[a].k&&(n+="&nbsp;&nbsp;&nbsp;&nbsp;"+s[t].t[a].k+"/"+s[t].t[a].m+" "+s[t].t[a].n+"\n",++l);0==l&&(n+="&nbsp;&nbsp;&nbsp;&nbsp;"+LANG.tc_none+"\n"),n+="\n"}n+="</pre>"}n+="</body></html>",i.document.write(n),i.document.close()}},this.toggleLock=function(){-1!=Ae&&O()},H.L={6:9,11:0,3:1,8:2,2:3,5:4,4:5,7:6,9:7,1:8}}var $WowheadTalentCalculator;TalentCalc.MODE_DEFAULT=0,TalentCalc.MODE_PET=1;