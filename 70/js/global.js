function g_isUsernameValid(e){return null==e.match(/[^a-z0-9]/i)&&e.length>=4&&e.length<=16}function Ajax(e,t){if(e){var s;try{s=new XMLHttpRequest}catch(e){try{s=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{s=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){if(!window.createRequest)return void alert(LANG.message_ajaxnotsupported);s=window.createRequest()}}}this.request=s,$WH.cO(this,t),this.method=this.method||this.params&&"POST"||"GET",s.open(this.method,e,null==this.async||this.async),s.onreadystatechange=Ajax.onReadyStateChange.bind(this),"POST"==this.method.toUpperCase()&&s.setRequestHeader("Content-Type",(this.contentType||"application/x-www-form-urlencoded")+"; charset="+(this.encoding||"UTF-8")),s.send(this.params)}}function g_addCss(e){var t=$WH.ce("style");t.type="text/css",t.styleSheet?t.styleSheet.cssText=e:$WH.ae(t,$WH.ct(e));var s=$WH.gE(document,"head")[0];$WH.ae(s,t)}function g_setTextNodes(e,t){if(3==e.nodeType)e.nodeValue=t;else for(var s=0;s<e.childNodes.length;++s)g_setTextNodes(e.childNodes[s],t)}function g_setInnerHtml(e,t,s){if(e.nodeName.toLowerCase()==s)e.innerHTML=t;else for(var i=0;i<e.childNodes.length;++i)g_setInnerHtml(e.childNodes[i],t,s)}function g_getFirstTextContent(e){for(var t=0;t<e.childNodes.length;++t){if("#text"==e.childNodes[t].nodeName)return e.childNodes[t].nodeValue;var s=g_getFirstTextContent(e.childNodes[t]);if(s)return s}return!1}function g_getTextContent(e){for(var t="",s=0;s<e.childNodes.length;++s)e.childNodes[s].nodeValue?t+=e.childNodes[s].nodeValue:"BR"==e.childNodes[s].nodeName&&($WH.Browser.ie67?t+="\r":t+="\n"),t+=g_getTextContent(e.childNodes[s]);return t}function g_toggleDisplay(e){return e=$(e),e.toggle(),!!e.is(":visible")}function g_enableScroll(e){e?($WH.dE(document,"mousewheel",g_enableScroll.F),$WH.dE(window,"DOMMouseScroll",g_enableScroll.F)):($WH.aE(document,"mousewheel",g_enableScroll.F),$WH.aE(window,"DOMMouseScroll",g_enableScroll.F))}function g_setCaretPosition(e,t){if(e)if(e.createTextRange){var s=e.createTextRange();s.move("character",t),s.select()}else void 0!=e.selectionStart?(e.focus(),e.setSelectionRange(t,t)):e.focus()}function g_insertTag(e,t,s,i){var a=$WH.ge(e);if(a.focus(),null!=a.selectionStart){var n=a.selectionStart,o=a.selectionEnd,r=a.scrollLeft,l=a.scrollTop,c=a.value.substring(n,o);"function"==typeof i&&(c=i(c)),a.value=a.value.substr(0,n)+t+c+s+a.value.substr(o),a.selectionStart=a.selectionEnd=o+t.length,a.scrollLeft=r,a.scrollTop=l}else if(document.selection&&document.selection.createRange){var u=document.selection.createRange();if(u.parentElement()!=a)return;var c=u.text;"function"==typeof i&&(c=i(c)),u.text=t+c+s}a.onkeyup&&a.onkeyup()}function g_onAfterTyping(e,t,s){var i,a=function(){i&&(clearTimeout(i),i=null),i=setTimeout(t,s)};e.onkeyup=a}function g_onClick(e,t){function s(e){if(i){if(i!=e)return}else i=e;t(!0)}var i=0;e.onclick=function(e){return e=$WH.$E(e),2==e._button},e.oncontextmenu=function(){return s(1),!1},e.onmouseup=function(e){return e=$WH.$E(e),3==e._button||e.shiftKey||e.ctrlKey?s(2):1==e._button&&t(!1),!1}}function g_isLeftClick(e){return(e=$WH.$E(e))&&1==e._button}function g_preventEmptyFormSubmission(){if(!$.trim(this.elements[0].value))return!1}function g_getReputationPlusAchievementText(e,t,s,i){var a=$("<span>").addClass("wsach-pts");a.mouseover(function(e){$WH.Tooltip.showAtCursor(e,LANG.reputationtip,0,0,"q")}).mousemove(function(e){$WH.Tooltip.cursorUpdate(e)}).mouseout(function(){$WH.Tooltip.hide()}),a.css("color","white"),a.text($WH.number_format(i));var n=$("<span>");return n.append(" ("),n.append(a),n.append(")"),n}function g_addTooltip(e,t,s){s||-1!=t.indexOf("<table>")||(s="q"),$WH.Tooltip.simple(e,t,s)}function g_addStaticTooltip(e,t,s){s||-1!=t.indexOf("<table>")||(s="q"),e.onmouseover=function(i){$WH.Tooltip.show(e,t,0,0,s)},e.onmouseout=$WH.Tooltip.hide}function g_formatTimeElapsed(e){function t(e,t,s){return s&&""==LANG.timeunitsab[t]&&(s=0),s?e+" "+LANG.timeunitsab[t]:e+" "+(1==e?LANG.timeunitssg[t]:LANG.timeunitspl[t])}var s=[31557600,2629800,604800,86400,3600,60,1],i=[1,3,3,-1,5,-1,-1];e=Math.max(e,1);for(var a=3,n=s.length;a<n;++a)if(e>=s[a]){var o=a,r=Math.floor(e/s[o]);if(-1!=i[o]){var l=i[o];e%=s[o];var c=Math.floor(e/s[l]);if(c>0)return t(r,o,1)+" "+t(c,l,1)}return t(r,o,0)}return"(n/a)"}function g_GetStaffColorFromRoles(e){return e&U_GROUP_ADMIN?"comment-blue":e&U_GROUP_GREEN_TEXT?"comment-green":e&U_GROUP_VIP?"comment-gold":e&U_GROUP_PREMIUMISH?"comment-gold":""}function g_formatDate(e,t,s,i,a){var n=new Date,o=new Date;o.setTime(n.getTime()-1e3*t);var r,l=new Date(o.getYear(),o.getMonth(),o.getDate()),c=new Date(n.getYear(),n.getMonth(),n.getDate()),u=c.getTime()-l.getTime();if(u/=1e3,u/=86400,u=Math.round(u),t>=2592e3)r=LANG.date_on+g_formatDateSimple(s,i);else if(u>1){if(r=$WH.sprintf(LANG.ddaysago,u),e){var d=new Date;d.setTime(s.getTime()+(g_localTime-g_serverTime)),e.className+=" tip",e.title=d.toLocaleString()}}else if(t>=43200){if(r=n.getDay()==o.getDay()?LANG.today:LANG.yesterday,r=g_formatTimeSimple(o,r),e){var d=new Date;d.setTime(s.getTime()+(g_localTime-g_serverTime)),e.className+=" tip",e.title=d.toLocaleString()}}else{var r=$WH.sprintf(LANG.date_ago,g_formatTimeElapsed(t));if(e){var d=new Date;d.setTime(s.getTime()+(g_localTime-g_serverTime)),e.className+=" tip",e.title=d.toLocaleString()}}if(1==a&&(r=r.substr(0,1).toUpperCase()+r.substr(1)),!e)return r;$WH.ae(e,$WH.ct(r))}function g_formatDateSimple(e,t){function s(e){return e<10?"0"+e:e}var i="",a=e.getDate(),n=e.getMonth()+1,o=e.getFullYear();return i+=o<=1970?LANG.unknowndate_stc:$WH.sprintf(LANG.date_simple,s(a),s(n),o),null!=t&&(i=g_formatTimeSimple(e,i)),i}function g_formatTimeSimple(e,t,s){function i(e){return e<10?"0"+e:e}var a=e.getHours(),n=e.getMinutes();return null==t&&(t=""),t+=s?" ":LANG.date_at,t+=12==a?LANG.noon:0==a?LANG.midnight:a>12?a-12+":"+i(n)+" "+LANG.pm:a+":"+i(n)+" "+LANG.am}function g_createGlow(e,t){for(var s=$WH.ce("span"),i=-1;i<=1;++i)for(var a=-1;a<=1;++a){var n=$WH.ce("div");n.style.position="absolute",n.style.whiteSpace="nowrap",n.style.left=i+"px",n.style.top=a+"px",0==i&&0==a?n.style.zIndex=4:(n.style.color="black",n.style.zIndex=2),n.innerHTML=e,$WH.ae(s,n)}s.style.position="relative",s.className="glow"+(null!=t?" "+t:"");var o=$WH.ce("span");return o.style.visibility="hidden",$WH.ae(o,$WH.ct(e)),$WH.ae(s,o),s}function g_createProgressBar(e){null==e&&(e={}),void 0===e.text&&(e.text=" "),null==e.color&&(e.color="rep0"),(null==e.width||e.width>100)&&(e.width=100);var t,s;if(e.hoverText?(t=$WH.ce("a"),t.href="javascript:;"):t=$WH.ce("span"),t.className="progressbar",e.text||e.hoverText){if(s=$WH.ce("div"),s.className="progressbar-text",e.text){var i=$WH.ce("del");$WH.ae(i,$WH.ct(e.text)),$WH.ae(s,i)}if(e.hoverText){var a=$WH.ce("ins");$WH.ae(a,$WH.ct(e.hoverText)),$WH.ae(s,a)}$WH.ae(t,s)}if(s=$WH.ce("div"),s.className="progressbar-"+e.color,s.style.width=e.width+"%",e.height&&(s.style.height=e.height),$WH.ae(s,$WH.ct(String.fromCharCode(160))),$WH.ae(t,s),e.text){var s=$WH.ce("div");s.className="progressbar-text progressbar-hidden",$WH.ae(s,$WH.ct(e.text)),$WH.ae(t,s)}return t}function g_createReputationBar(e){var t=g_createReputationBar.P;e||(e=0),e+=42e3,e<0?e=0:e>84999&&(e=84999);for(var s,i=e,a=0,n=0,o=t.length;n<o&&!(t[n]>i);++n)n<o-1&&(i-=t[n],a=n+1);return s=t[a],g_createProgressBar({text:g_reputation_standings[a],hoverText:i+" / "+s,color:"rep"+a,width:parseInt(i/s*100)})}function g_createAchievementBar(e,t,s,i){return e||(e=0),g_createProgressBar({text:e+(i>0?"(+"+i+")":"")+(t>0?" / "+t:""),color:s?"rep7":"ach"+(t>0?0:1),width:t>0?parseInt(e/t*100):100})}function g_getMoneyHtml(e,t,s,i,a){var n=0,o="";if(t=1==t||"alliance"==t?1:2==t||"horde"==t?2:3,e>=1e4){n=1;var r=Math.floor(e/1e4);o+='<span class="moneygold">'+$WH.number_format(r)+"</span>",e%=1e4}if(e>=100){n?o+=" ":n=1;var r=Math.floor(e/100);o+='<span class="moneysilver">'+r+"</span>",e%=100}if(e>=1&&(n?o+=" ":n=1,o+='<span class="moneycopper">'+e+"</span>"),null!=s)for(var l=0;l<s.length;++l){n?o+=" ":n=1;var c=s[l][0],u=s[l][1],d=g_items[c]&&g_items[c].icon?g_items[c].icon:"inv_misc_questionmark";o+='<a href="?item='+c+'" class="moneyitem" style="background-image: url('+g_staticDataUrl+"/images/wow/icons/tiny/"+d.toLowerCase()+'.gif)">'+u+"</a>"}if(null!=i)for(var l=0;l<i.length;++l){n?o+=" ":n=1;var p=i[l][0],u=i[l][1],d=g_gatheredcurrencies[p]&&g_gatheredcurrencies[p].icon?g_gatheredcurrencies[p].icon:["inv_misc_questionmark","inv_misc_questionmark"];3==t&&d[0]==d[1]&&(t=1),o+=103==p?'<a href="?currency='+p+'" class="moneyarena tip" onmouseover="Listview.funcBox.moneyArenaOver(event)" onmousemove="$WH.Tooltip.cursorUpdate(event)" onmouseout="$WH.Tooltip.hide()">'+$WH.number_format(u)+"</a>":104==p?'<a href="?currency='+p+'" class="money'+(1==t?"alliance":"horde")+' tip" onmouseover="Listview.funcBox.moneyHonorOver(event)" onmousemove="$WH.Tooltip.cursorUpdate(event)" onmouseout="$WH.Tooltip.hide()">'+(3==t?'<span class="moneyalliance">':"")+$WH.number_format(u)+(3==t?"</span>":"")+"</a>":'<a href="?currency='+p+'" class="icontinyr tip q1" onmouseover="Listview.funcBox.moneyCurrencyOver('+p+", "+u+', event)" onmousemove="$WH.Tooltip.cursorUpdate(event)" onmouseout="$WH.Tooltip.hide()" style="background-image: url('+g_staticDataUrl+"/images/wow/icons/tiny/"+d[0].toLowerCase()+'.gif)">'+u+"</a>"}return a>0&&(n?o+=" ":n=1,o+='<span class="moneyachievement tip" onmouseover="Listview.funcBox.moneyAchievementOver(event)" onmousemove="$WH.Tooltip.cursorUpdate(event)" onmouseout="$WH.Tooltip.hide()">'+$WH.number_format(a)+"</span>"),o}function g_GetExpansionClassName(e){switch(e){case 0:return null;case 1:return"icon-bc-right";case 2:return"icon-wotlk-right"}return null}function g_pickerWheel(e){e=$WH.$E(e),e._wheelDelta<0?this.scrollTop+=27:this.scrollTop-=27}function g_setSelectedLink(e,t){g_setSelectedLink.groups||(g_setSelectedLink.groups={});var s=g_setSelectedLink.groups;s[t]&&(s[t].className=s[t].className.replace("selected","")),e.className+=" selected",s[t]=e}function g_setCheckedRow(e,t){g_setCheckedRow.groups||(g_setCheckedRow.groups={});var s=g_setCheckedRow.groups;s[t]&&(s[t].className=s[t].className.replace("checked","")),e.className+=" checked",s[t]=e}function g_addPages(e,t){function s(e,s){var i;return e==t.page?(i=$WH.ce("span"),i.className="selected"):(i=$WH.ce("a"),i.href=e>1?t.url+t.sep+e+t.pound:t.url+t.pound),$WH.ae(i,$WH.ct(null!=s?s:e)),i}if(t.pound||(t.pound=""),t.sep||(t.sep="."),!(t.allOrNothing&&t.nPages<=1)){var i,a=t.align&&"left"==t.align,n=$WH.ce("div"),o=$WH.ce("var");if(n.className="pages",a&&(n.className+=" pages-left"),t.nPages>1){i=$WH.ce("div"),i.className="pages-numbers";var r=Math.max(2,t.page-2),l=Math.min(t.nPages-1,t.page+2),c=[];if(t.page!=t.nPages&&c.push(s(t.page+1,LANG.lvpage_next+String.fromCharCode(8250))),c.push(s(t.nPages)),l<t.nPages-1){var u=$WH.ce("span");$WH.ae(u,$WH.ct("...")),c.push(u)}for(var d=l;d>=r;--d)c.push(s(d));if(r>2){var u=$WH.ce("span");$WH.ae(u,$WH.ct("...")),c.push(u)}c.push(s(1)),1!=t.page&&c.push(s(t.page-1,String.fromCharCode(8249)+LANG.lvpage_previous)),a&&c.reverse();for(var d=0,p=c.length;d<p;++d)$WH.ae(i,c[d]);i.firstChild.style.marginRight="0",i.lastChild.style.marginLeft="0"}var o=$WH.ce("var");if($WH.ae(o,$WH.ct($WH.sprintf(LANG[t.wording[1==t.nItems?0:1]],t.nItems))),t.nPages>1){var u=$WH.ce("span");$WH.ae(u,$WH.ct(String.fromCharCode(8211))),$WH.ae(o,u);var h=$WH.ce("a");h.className="gotopage",h.href="javascript:;",$WH.ns(h),$WH.Browser.ie&&$WH.ae(h,$WH.ct(" ")),h.onclick=function(){var e=prompt($WH.sprintf(LANG.prompt_gotopage,1,t.nPages),t.page);null!=e&&(e|=0)!=t.page&&e>=1&&e<=t.nPages&&(document.location.href=e>1?t.url+t.sep+e+t.pound:t.url+t.pound)},h.onmouseover=function(e){$WH.Tooltip.showAtCursor(e,LANG.tooltip_gotopage,0,0,"q2")},h.onmousemove=$WH.Tooltip.cursorUpdate,h.onmouseout=$WH.Tooltip.hide,$WH.ae(o,h)}a?($WH.ae(n,o),i&&$WH.ae(n,i)):(i&&$WH.ae(n,i),$WH.ae(n,o)),$WH.ae(e,n)}}function g_disclose(e,t){return t.className="disclosure-"+(g_toggleDisplay(e)?"on":"off"),!1}function g_setupChangeWarning(e,t,s){function i(){return s}if(!$WH.Browser.ie&&e){e.submit(function(){window.onbeforeunload=null});var a=[];for(var n in t){var o=t[n];o&&(a[n]=o.val(),o.keydown(function(){for(var e in t){var s=t[e];if(s){if(s.val()!=a[e])return void(window.onbeforeunload=i);window.onbeforeunload=null}}}))}}}function SetupReplies(e,t){SetupAddEditComment(e,t,!1),SetupShowMoreComments(e,t),e.find(".comment-reply-row").each(function(){SetupRepliesControls($(this),t)}),e.find(".comment-reply-row").hover(function(){$(this).find("span").attr("data-hover","true")},function(){$(this).find("span").attr("data-hover","false")})}function SetupAddEditComment(e,t,s){function i(){if(!y){y=!0;var i=$("<tr/>");s&&i.addClass("comment-reply-row").addClass("reply-edit-row"),i.html('<td style="width: 0"></td><td class="comment-form"><form><table><form><table><tr><td style="width: 600px"><textarea required="required" name="body" cols="68" rows="3"></textarea></td><td><input type="submit" value="'+(s?LANG.save:LANG.addreply)+'" /><img src="'+g_staticDataUrl+'/images/icons/ajax.gif" class="ajax-loader" /></td></tr><tr><td colspan="2"><span class="text-counter">Text counter placeholder</span></td></tr></table></form></td>'),h=i.find(".comment-form textarea"),m=i.find(".comment-form input[type=submit]"),f=i.find(".comment-form span.text-counter"),p=i.find(".comment-form form"),g=i.find(".comment-form .ajax-loader"),v=i.find(".comment-form"),p.submit(function(){return o(),!1}),d(),h.keyup(function(e){d()}),h.keydown(function(e){if(27==e.keyCode)return n(),!1}),h.keypress(function(e){if(13==e.keyCode)return o(),!1}),s?(e.after(i),e.hide(),p.find("textarea").text(t.replies[e.attr("data-idx")].body)):x.append(i),_=i,p.find("textarea").focus()}}function a(){y||i(),b=!0,s||(L.hide(),e.find(".comment-replies").show(),v.show(),v.find("textarea").focus())}function n(){if(b=!1,s)return _&&_.remove(),void e.show();L.show(),v.hide(),0==k&&e.find(".comment-replies").hide()}function o(){if(b&&!N)return h.val().length<H||h.val().length>W?(w||(w=!0,f.animate({opacity:"0.0"},150),f.animate({opacity:"1.0"},150,null,function(){w=!1})),!1):(r(),$.ajax({type:"POST",url:s?"?comment=edit-reply":"?comment=add-reply",data:{commentId:t.id,replyId:s?e.attr("data-replyid"):0,body:h.val()},success:function(e){c(e)},dataType:"json",error:function(e){u(e.responseText)}}),!0)}function r(){N=!0,g.show(),m.attr("disabled","disabled"),v.find(".message-box").remove()}function l(){N=!1,g.hide(),m.removeAttr("disabled")}function c(e){t.replies=e,Listview.templates.comment.updateReplies(t)}function u(e){l(),MessageBox(v,e)}function d(){var e="(error)",t="q0",s=h.val().replace(/(\s+)/g," ").replace(/^\s*/,"").replace(/\s*$/,"").length,i=W-s;0==s?e=$WH.sprintf(LANG.replylength1_format,H):s<H?e=$WH.sprintf(LANG.replylength2_format,H-s):(e=$WH.sprintf(1==i?LANG.replylength4_format:LANG.replylength3_format,i),i<120?t="q10":i<240?t="q5":i<360&&(t="q11")),f.html(e).attr("class",t)}var p=null,h=null,m=null,f=null,g=null,v=null,_=null,H=15,W=600,y=!1,b=!1,w=!1,N=!1,x=e.find(".comment-replies > table"),L=e.find(".add-reply"),k=t.replies.length;s?a():L.click(function(){a()})}function SetupShowMoreComments(e,t){function s(){a.hide(),n.append(CreateAjaxLoader()),$.ajax({type:"GET",url:"?comment=show-replies",data:{id:t.id},success:function(e){t.replies=e,Listview.templates.comment.updateReplies(t)},dataType:"json",error:function(){i()}})}function i(){a.show(),n.find(".ajax-loader").remove(),MessageBox(n,"There was an error fetching the comments. Try refreshing the page.")}var a=e.find(".show-more-replies"),n=e.find(".comment-replies");a.click(function(){s()})}function SetupRepliesControls(e,t){function s(e){var t=parseInt(d.text());t+=e,d.text(t),e>0?l.attr("data-hasvoted","true"):c.attr("data-hasvoted","true"),l.attr("data-canvote","false"),c.attr("data-canvote","false"),e>0&&u.remove(),v=!1}function i(){v=!1,u.remove()}function a(){e.remove(),MessageBox(g,LANG.message_commentdetached),_=!1}function n(){e.remove(),H=!1}function o(e){v=!1,_=!1,H=!1,e||(e=LANG.genericerror),MessageBox(p,e)}var r=e.attr("data-replyid"),l=e.find(".reply-upvote"),c=e.find(".reply-downvote"),u=e.find(".reply-report"),d=e.find(".reply-rating"),p=e.find(".reply-controls"),h=e.find(".reply-detach"),m=e.find(".reply-delete"),f=e.find(".reply-edit"),g=t.repliesCell,v=!1,_=!1,H=!1;f.click(function(){SetupAddEditComment(e,t,!0)}),u.click(function(){!v&&confirm(LANG.replyreportwarning_tip)&&(v=!0,$.ajax({type:"POST",url:"?comment=flag-reply",data:{id:r},success:function(){i()},error:function(e){o(e.responseText)}}))}),l.click(function(){"true"==l.attr("data-hasvoted")||"true"!=l.attr("data-canvote")||v||(v=!0,$.ajax({type:"POST",url:"?comment=upvote-reply",data:{id:r},success:function(){s(1)},error:function(e){o(e.responseText)}}))}),c.click(function(){"true"==c.attr("data-hasvoted")||"true"!=c.attr("data-canvote")||v||(v=!0,$.ajax({type:"POST",url:"?comment=downvote-reply",data:{id:r},success:function(){s(-1)},error:function(e){o(e.responseText)}}))}),h.click(function(){if(_)return void MessageBox(p,LANG.message_cantdetachcomment);confirm(LANG.confirm_detachcomment)&&(_=!0,$.ajax({type:"POST",url:"?comment=detach-reply",data:{id:r},success:function(){a()},error:function(e){o(e.responseText)}}))}),m.click(function(){H||confirm(LANG.deletereplyconfirmation_tip)&&(H=!0,$.ajax({type:"POST",url:"?comment=delete-reply",data:{id:r},success:function(){n()},error:function(e){o(e.responseText)}}))})}function co_addYourComment(){tabsContribute.focus(0),$WH.gE(document.forms.addcomment,"textarea")[0].focus()}function co_validateForm(e){var t=$WH.gE(e,"textarea")[0];return!!(1&g_user.permissions)||!!Listview.funcBox.coValidate(t)}function ss_submitAScreenshot(){tabsContribute.focus(1)}function ss_validateForm(e){return!!e.elements.screenshotfile.value.length||(alert(LANG.message_noscreenshot),!1)}function ss_appendSticky(){var e=$WH.ge("infobox-sticky-ss"),t=(g_pageInfo.type,g_pageInfo.typeId,$WH.in_array(lv_screenshots,1,function(e){return e.sticky}));if(-1!=t){var s=lv_screenshots[t],i=$WH.ce("a");i.href="#screenshots:id="+s.id,i.onclick=function(e){return ScreenshotViewer.show({screenshots:lv_screenshots,pos:t}),$WH.rf2(e)};var a=lv_videos&&lv_videos.length?[120,90]:[150,150],n=$WH.ce("img"),o=Math.min(a[0]/s.width,a[1]/s.height);n.src=g_staticUrl+"/uploads/screenshots/thumb/"+s.id+".jpg",n.width=Math.round(o*s.width),n.height=Math.round(o*s.height),n.className="border",$WH.ae(i,n),$WH.ae(e,i);var r=$WH.ge("infobox-screenshots"),i=$WH.ce("a");if(!r){var l=$("th",e.parentNode);r=l[l.length-(lv_videos&&lv_videos.length?2:1)]}$WH.ae(i,$WH.ct(r.textContent+" ("+lv_screenshots.length+")")),i.href="#screenshots",i.title=$WH.sprintf(LANG.infobox_showall,lv_screenshots.length),i.onclick=function(){return tabsRelated.focus(lv_videos&&lv_videos.length||g_user&&g_user.roles&(U_GROUP_ADMIN|U_GROUP_BUREAU|U_GROUP_VIDEO)?-2:-1),!1},$WH.ee(r),$WH.ae(r,i)}else{var i;i=g_user.id>0?'<a href="javascript:;" onclick="ss_submitAScreenshot(); return false">':'<a href="?account=signin">',e.innerHTML=$WH.sprintf(LANG.infobox_noneyet,i+LANG.infobox_submitone+"</a>")}}function vi_submitAVideo(){tabsContribute.focus(2)}function vi_validateForm(e){if(!e.elements.videourl.value.length)return alert(LANG.message_novideo),!1;var t=!1;for(var s in vi_sitevalidation)if(e.elements.videourl.value.match(vi_sitevalidation[s])){t=!0;break}return!!t||(alert(LANG.message_novideo),!1)}function vi_appendSticky(){var e=$WH.ge("infobox-sticky-vi"),t=(g_pageInfo.type,g_pageInfo.typeId,$WH.in_array(lv_videos,1,function(e){return e.sticky}));if(-1!=t){var s=lv_videos[t],i=$WH.ce("a");i.href="#videos:id="+s.id,i.onclick=function(e){return VideoViewer.show({videos:lv_videos,pos:t}),$WH.rf2(e)};var a=$WH.ce("img");a.src=$WH.sprintf(vi_thumbnails[s.videoType],s.videoId),a.className="border",$WH.ae(i,a),$WH.ae(e,i);var n=$WH.ge("infobox-videos"),i=$WH.ce("a");if(!n){var o=$("th",e.parentNode);n=o[o.length-(lv_videos&&lv_videos.length?2:1)]}$WH.ae(i,$WH.ct(n.textContent+" ("+lv_videos.length+")")),i.href="#videos",i.title=$WH.sprintf(LANG.infobox_showall,lv_videos.length),i.onclick=function(){return tabsRelated.focus(-1),!1},$WH.ee(n),$WH.ae(n,i)}else{var i;i=g_user.id>0?'<a href="javascript:;" onclick="vi_submitAVideo(); return false">':'<a href="?account=signin">',e.innerHTML=$WH.sprintf(LANG.infobox_noneyet,i+LANG.infobox_suggestone+"</a>")}}function su_addToSaved(e,t,s,i){if(e){suDialog||(suDialog=new Dialog);var a=function(t){var a=g_getWowheadCookie("compare_groups"),n="?compare";t.action>1?(a&&(e=a+";"+e),g_setWowheadCookie("compare_groups",e,!0),i&&g_setWowheadCookie("compare_level",i,!0)):n+="="+e+(i?"&l="+i:""),t.action<3&&(s?window.open(n):location.href=n)};suDialog.show("docompare",{data:{selecteditems:t,action:1},onSubmit:a})}}function Tabs(e){$WH.cO(this,e),this.parent&&(this.parent=$WH.ge(this.parent),this.selectedTab=-1,this.uls=[],this.tabs=[],this.nShows=0,null==this.poundable&&(this.poundable=1),this.poundedTab=null,null==this.onLoad&&(this.onLoad=Tabs.onLoad.bind(this)),null==this.onShow&&(this.onShow=Tabs.onShow.bind(this)),this.onHide&&(this.onHide=this.onHide.bind(this)),this.trackClick=Tabs.trackClick.bind(this))}function g_trackPageview(e){function t(){"function"==typeof ga&&ga("send","pageview",e)}$(document).ready(t)}function g_trackEvent(e,t,s,i){function a(){"function"==typeof ga&&ga("send","event",e,t,s,i)}$(document).ready(a)}function g_attachTracking(e,t,s,i,a){$(e).click(function(){g_trackEvent(t,s,i,a)})}function g_addAnalytics(){var e={"home-logo":{category:"Homepage Logo",actions:{"Click image":function(e){return!0}}},"home-featuredbox":{category:"Featured Box",actions:{"Follow link":function(e){return"home-featuredbox-links"!=e.parentNode.className},"Click image":function(e){return"home-featuredbox-links"==e.parentNode.className}}},"home-oneliner":{category:"Oneliner",actions:{"Follow link":function(e){return!0}}},"sidebar-container":{category:"Page sidebar",actions:{"Click image":function(e){return!0}}},"toptabs-promo":{category:"Page header",actions:{"Click image":function(e){return!0}}}};for(var t in e){var s=$WH.ge(t);s&&g_addAnalyticsToNode(s,e[t])}}function g_getNodeTextId(e){var t=null,s=g_getFirstTextContent(e);return s?t=g_urlize(s):e.title?t=g_urlize(e.title):e.id&&(t=g_urlize(e.id)),t}function g_addAnalyticsToNode(e,t,s){if(!t||!t.actions||!t.category)return void($WH.isset("g_dev")&&g_dev&&(console.log("Tried to add analytics event without appropriate parameters."),console.log(e),console.log(t)));for(var i=t.category,a=$WH.gE(e,"a"),n=0;n<a.length;++n){var e=a[n],o="Follow link";for(var r in t.actions)if(t.actions[r]&&t.actions[r](e)){o=r;break}g_attachTracking(e,i,o,(s?s+"-":"")+g_getNodeTextId(e))}}function Listview(e){if($WH.cO(this,e),this.id){var t=(this.tabs?"tab-":"lv-")+this.id;if(this.parent){var s=$WH.ce("div");s.id=t,$WH.ae($WH.ge(this.parent),s),this.container=s}else this.container=$WH.ge(t);if((null!=$WH.g_getGets().debug||g_user.debug)&&g_user.roles&U_GROUP_MODERATOR&&(this.debug=!0),this.template&&Listview.templates[this.template]){if(this.template=Listview.templates[this.template],g_listviews[this.id]=this,null==this.data&&(this.data=[]),null==this.poundable&&(null!=this.template.poundable?this.poundable=this.template.poundable:this.poundable=!0),null==this.searchable&&(null!=this.template.searchable?this.searchable=this.template.searchable:this.searchable=!1),null==this.filtrable&&(null!=this.template.filtrable?this.filtrable=this.template.filtrable:this.filtrable=!1),null==this.sortable&&(null!=this.template.sortable?this.sortable=this.template.sortable:this.sortable=!0),null==this.customPound&&(null!=this.template.customPound?this.customPound=this.template.customPound:this.customPound=!1),1==this.data.length&&(this.filtrable=!1,this.searchable=!1),this.searchable&&null==this.searchDelay&&(null!=this.template.searchDelay?this.searchDelay=this.template.searchDelay:this.searchDelay=333),null==this.clickable&&(null!=this.template.clickable?this.clickable=this.template.clickable:this.clickable=!0),null==this.hideBands&&(this.hideBands=this.template.hideBands),null==this.hideNav&&(this.hideNav=this.template.hideNav),null==this.hideHeader&&(this.hideHeader=this.template.hideHeader),null==this.hideCount&&(this.hideCount=this.template.hideCount),null==this.computeDataFunc&&null!=this.template.computeDataFunc&&(this.computeDataFunc=this.template.computeDataFunc),null==this.createCbControls&&null!=this.template.createCbControls&&(this.createCbControls=this.template.createCbControls),null!=this.template.onBeforeCreate&&(null==this.onBeforeCreate?this.onBeforeCreate=this.template.onBeforeCreate:this.onBeforeCreate=[this.template.onBeforeCreate,this.onBeforeCreate]),null==this.onAfterCreate&&null!=this.template.onAfterCreate&&(this.onAfterCreate=this.template.onAfterCreate),null==this.onNoData&&null!=this.template.onNoData&&(this.onNoData=this.template.onNoData),null==this.createNote&&null!=this.template.createNote&&(this.createNote=this.template.createNote),null==this.sortOptions&&null!=this.template.sortOptions&&(this.sortOptions=this.template.sortOptions),null==this.customFilter&&null!=this.template.customFilter&&(this.customFilter=this.template.customFilter),null==this.onSearchSubmit&&null!=this.template.onSearchSubmit&&(this.onSearchSubmit=this.template.onSearchSubmit),null==this.getItemLink&&null!=this.template.getItemLink&&(this.getItemLink=this.template.getItemLink),null==this.clip&&null!=this.template.clip&&(this.clip=this.template.clip),(this.clip||this.template.compute||"topics"==this.id||"recipes"==this.id)&&(this.debug=!1),null==this.mode&&(this.mode=this.template.mode),null!=this.template.noStyle&&(this.noStyle=this.template.noStyle),null==this.nItemsPerPage&&(null!=this.template.nItemsPerPage?this.nItemsPerPage=this.template.nItemsPerPage:this.nItemsPerPage=50),this.nItemsPerPage|=0,this.nItemsPerPage<=0&&(this.nItemsPerPage=0),this.nFilters=0,this.resetRowVisibility(),this.mode==Listview.MODE_TILED){if(null==this.nItemsPerRow){var i=this.template.nItemsPerRow;this.nItemsPerRow=null!=i?i:4}this.nItemsPerRow|=0,this.nItemsPerRow<=1&&(this.nItemsPerRow=1)}else if(this.mode==Listview.MODE_CALENDAR){this.dates=[],this.nItemsPerRow=7,this.nItemsPerPage=1,this.nDaysPerMonth=[],null!=this.template.startOnMonth?this.startOnMonth=this.template.startOnMonth:this.startOnMonth=new Date,this.startOnMonth.setDate(1),this.startOnMonth.setHours(0,0,0,0),null==this.nMonthsToDisplay&&(null!=this.template.nMonthsToDisplay?this.nMonthsToDisplay=this.template.nMonthsToDisplay:this.nMonthsToDisplay=1);for(var a=this.startOnMonth.getFullYear(),n=this.startOnMonth.getMonth(),o=0;o<this.nMonthsToDisplay;++o){var r=new Date(a,n+o,32);this.nDaysPerMonth[o]=32-r.getDate();for(var l=1;l<=this.nDaysPerMonth[o];++l)this.dates.push({date:new Date(a,n+o,l)})}null!=this.template.rowOffset&&(this.rowOffset=this.template.rowOffset)}else this.nItemsPerRow=1;this.columns=[];for(var l=0,c=this.template.columns.length;l<c;++l){var u=this.template.columns[l],d={};$WH.cO(d,u),this.columns.push(d)}if(null!=this.extraCols)for(var l=0,c=this.extraCols.length;l<c;++l){var p=null,h=this.extraCols[l];if(h.after||h.before){var m=$WH.in_array(this.columns,h.after?h.after:h.before,function(e){return e.id});-1!=m&&(p=h.after?m+1:m)}null==p&&(p=this.columns.length),"debug-id"==h.id?this.columns.splice(0,0,h):this.columns.splice(p,0,h)}this.visibility=[];var f=[],g=[];if(null!=this.visibleCols&&$WH.array_walk(this.visibleCols,function(e){f[e]=1}),null!=this.hiddenCols&&$WH.array_walk(this.hiddenCols,function(e){g[e]=1}),$.isArray(this.sortOptions))for(var l=0,c=this.sortOptions.length;l<c;++l){var v=this.sortOptions[l];(null!=f[v.id]||!v.hidden&&null==g[v.id])&&this.visibility.push(l)}else for(var l=0,c=this.columns.length;l<c;++l){var h=this.columns[l];(null!=f[h.id]||!h.hidden&&null==g[h.id])&&this.visibility.push(l)}if(null==this.sort&&this.template.sort&&(this.sort=this.template.sort.slice(0)),null!=this.sort){var _=this.sort;this.sort=[];for(var l=0,c=_.length;l<c;++l){var h=parseInt(_[l]);if(isNaN(h)){var H=0;"-"==_[l].charAt(0)&&(H=1,_[l]=_[l].substring(1));var m=$WH.in_array(this.columns,_[l],function(e){return e.id});-1!=m&&(H?this.sort.push(-(m+1)):this.sort.push(m+1))}else this.sort.push(h)}}else this.sort=[];if(this.debug||g_user.debug){this.columns.splice(0,0,{id:"debug-id",compute:function(e,t){e.id&&$WH.ae(t,$WH.ct(e.id))},getVisibleText:function(e){return e.id?e.id:""},getValue:function(e){return e.id?e.id:0},sortFunc:function(e,t,s){return null==e.id?-1:null==t.id?1:$WH.strcmp(e.id,t.id)},name:"ID",width:"5%",tooltip:"ID"}),this.visibility.splice(0,0,-1);for(var l=0,c=this.visibility.length;l<c;++l)this.visibility[l]=this.visibility[l]+1;for(var l=0,c=this.sort.length;l<c;++l)this.sort[l]<0?this.sort[l]=this.sort[l]-1:this.sort[l]=this.sort[l]+1}this.tabs?(this.tabIndex=this.tabs.add(this.getTabName(),{id:this.id,onLoad:this.initialize.bind(this)}),this.tabClick=Tabs.trackClick.bind(this.tabs,this.tabs.tabs[this.tabIndex])):this.initialize()}}}function MessageBox(e,t){e.find(".message-box").remove();var s=$("<div></div>");s.hide(),s.addClass("message-box"),s.html('<p class="message">'+t+'</p><p class="close">(Click on this box to close it)</p>'),setTimeout(function(){s.fadeOut()},5e3),s.click(function(e){$WH.sp(e),$(this).fadeOut()}),e.append(s[0]),s.fadeIn()}function g_cleanCharacterName(e){return e.match&&e.match(/^[A-Z]/)?e.charAt(0).toLowerCase()+e.substr(1):e}function g_getProfileUrl(e){return e.region?"?profile="+e.region+"."+e.realm+"."+g_cleanCharacterName(e.name)+(e.renameItr?"-"+e.renameItr:""):"?profile="+e.id}function g_getProfileRealmUrl(e){return"?profiles="+e.region+"."+e.realm}function Rectangle(e,t,s,i){this.l=e,this.t=t,this.r=e+s,this.b=t+i}function g_getViewport(){var e=$(window);return new Rectangle(e.scrollLeft(),e.scrollTop(),e.width(),e.height())}function Mapper(e,t){if($WH.cO(this,e),this.parent&&!this.parent.nodeName)this.parent=$WH.ge(this.parent);else if(!this.parent)return;var s;this.mouseX=this.mouseY=0,this.editable=this.editable||!1,this.overlay=this.overlay||!1,this.editable?(this.zoomable=this.toggle=!1,this.show=this.mouse=!0):(this.zoomable=null==this.zoomable||this.zoomable,this.toggle=null==this.toggle||this.toggle,this.show=null==this.show||this.show,this.mouse=null!=this.mouse&&this.mouse),this.buttons=null==this.buttons||this.buttons,this.zoneLink=null==this.zoneLink||this.zoneLink,-1!=location.href.indexOf("zone=")&&(this.zoneLink=!1),this.zoom=null==this.zoom?0:this.zoom,this.zone=null==this.zone?0:this.zone,this.level=null==this.level?Mapper.zoneDefaultLevel[this.zone]?Mapper.zoneDefaultLevel[this.zone]:0:this.level,this.pins=[],this.nCoords=0,this.tempWidth=null,this.tempHeight=null,this.parent.className="mapper",this.parent.appendChild(this.span=$WH.ce("span")),s=this.span.style,s.display="block",s.position="relative",$WH.ns(this.span),this.overlaySpan=s=$WH.ce("div"),s.style.display="block",s.style.width="100%",s.style.height="100%",this.span.appendChild(s),this.buttonDiv=s=$WH.ce("div"),s.style.position="absolute",s.style.top=s.style.right="3px",this.buttons&&this.parent.appendChild(s),this.editable?(this.span.onmouseup=this.addPin.bind(this),s=g_createGlow(LANG.mapper_tippin),s.style.fontSize="11px",s.style.position="absolute",s.style.bottom=s.style.right="0",$WH.ns(s),this.parent.appendChild(s)):(this.sToggle=s=RedButton.create(LANG.mapper_hidepins,!0,this.toggleShow.bind(this)),s.style.float="right",s.style.display="none",$WH.ns(s),this.buttonDiv.appendChild(s)),this.zoomable&&(this.span.onclick=this.toggleZoom.bind(this),this.span.id="sjdhfkljawelis"+(void 0!==this.unique?this.unique:""),this.sZoom=s=g_createGlow(LANG.mapper_tipzoom),s.style.fontSize="11px",s.style.position="absolute",
s.style.bottom=s.style.right="0",$WH.ns(s),this.span.appendChild(s)),this.sZoneLink=s=g_createGlow(""),s.style.display="none",s.style.position="absolute",s.style.top=s.style.left="0",this.parent.appendChild(s),this.mouse&&(this.parent.onmouseout=function(){this.timeout=setTimeout(function(){this.sMouse.style.display="none"}.bind(this),1)}.bind(this),this.parent.onmouseover=function(){clearTimeout(this.timeout),this.sMouse.style.display=""}.bind(this),this.span.onmousemove=this.span.onmousedown=this.getMousePos.bind(this),this.sMouse=s=g_createGlow("(0.0, 0.0)"),s.style.display="none",s.style.position="absolute",s.style.bottom=s.style.left="0",s.onmouseup=$WH.sp,$WH.ns(s),this.span.appendChild(s)),this.floorPins={},null!=e.coords?this.setCoords(e.coords):null!=e.link&&this.setLink(e.link),e.objectives&&this.setObjectives(e.objectives),e.zoneparent&&e.zones&&this.setZones(e.zoneparent,e.zones),this.updateMap(t)}function g_cookiesEnabled(){return document.cookie="enabledTest",-1!=document.cookie.indexOf("enabledTest")}function g_getWowheadCookie(e){return g_user.id>0?g_user.cookies[e]:$WH.gc(e)}function g_setWowheadCookie(e,t,s){var i="temp_"==e.substr(0,5);!s&&g_user.id>0&&!i?new Ajax("?cookie="+e+"&"+e+"="+$WH.urlencode(t),{method:"get",onSuccess:function(s){0==s.responseText&&(g_user.cookies[e]=t)}}):(s||0==g_user.id)&&$WH.sc(e,14,t,null,location.hostname)}function Line(e,t,s,i,a){var n=Math.min(e,s),o=Math.max(e,s),r=Math.min(t,i),l=Math.max(t,i),c=o-n,u=l-r,d=Math.sqrt(Math.pow(c,2)+Math.pow(u,2)),p=Math.atan2(u,c),h=Math.sin(p),m=Math.cos(p),f=$WH.ce("span");f.className="line",f.style.top=r.toFixed(2)+"px",f.style.left=n.toFixed(2)+"px",f.style.width=c.toFixed(2)+"px",f.style.height=u.toFixed(2)+"px";var g=$WH.ce("var");return g.style.width=d.toFixed(2)+"px",g.style.OTransform="rotate("+p+"rad)",g.style.MozTransform="rotate("+p+"rad)",g.style.webkitTransform="rotate("+p+"rad)",g.style.filter="progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11="+m+", M12="+-1*h+", M21="+h+", M22="+m+")",$WH.ae(f,g),e==n&&t==r||s==n&&i==r||(f.className+=" flipped"),null!=a&&(f.className+=" line-"+a),f}function GetN5(e){var t=Math.abs(e);return t<1e4?$WH.number_format(e):t<1e5?Math.round(e/100)/10+"k":t<1e6?Math.round(e/1e3)+"k":t<1e7?Math.round(e/1e3/10)/100+"m":t<1e8?Math.round(e/1e3/100)/10+"m":t<1e9?Math.round(e/1e3/1e3)+"m":t<1e10?Math.round(e/1e3/1e3/10)/100+"b":t<1e10?Math.round(e/1e3/1e3/100)/10+"b":Math.round(e/1e3/1e3/1e3)+"b"}function CreateAjaxLoader(){return $("<img>").attr("alt","").attr("src",g_staticDataUrl+"/images/icons/ajax.gif").addClass("ajax-loader")}function g_createRange(e,t){range={};for(var s=e;s<=t;++s)range[s]=s;return range}function g_sortIdArray(e,t,s){e.sort(s?function(e,i){return $WH.strcmp(t[e][s],t[i][s])}:function(e,s){return $WH.strcmp(t[e],t[s])})}function g_sortJsonArray(e,t,s,i){var a=[];for(var n in e)t[n]&&(null==i||i(t[n]))&&a.push(n);return null!=s?a.sort(s):g_sortIdArray(a,t),a}function g_urlize(e,t,s){t=!0;var i=$WH.ce("textarea");if(i.innerHTML=e.replace(/</g,"&lt;").replace(/>/g,"&gt;"),e=i.value,e=$WH.str_replace(e," / ","-"),e=$WH.str_replace(e,"'",""),s){e=$WH.str_replace(e,"(",""),e=$WH.str_replace(e,")","");var a={"ß":"ss","á":"a","ä":"a","à":"a","â":"a","è":"e","ê":"e","é":"e","ë":"e","í":"i","î":"i","ì":"i","ï":"i","ñ":"n","ò":"o","ó":"o","ö":"o","ô":"o","ú":"u","ü":"u","û":"u","ù":"u","œ":"oe","Á":"A","Ä":"A","À":"A","Â":"A","È":"E","Ê":"E","É":"E","Ë":"E","Í":"I","Î":"I","Ì":"I","Ï":"I","Ñ":"N","Ò":"O","Ó":"O","Ö":"O","Ô":"O","Ú":"U","Ü":"U","Û":"U","Ù":"U","Œ":"Oe"};for(var n in a)e=e.replace(new RegExp(n,"g"),a[n])}return e=$WH.trim(e),e=t?$WH.str_replace(e," ","-"):e.replace(/[^a-z0-9]/gi,"-"),e=$WH.str_replace(e,"--","-"),e=$WH.str_replace(e,"--","-"),e=$WH.rtrim(e,"-"),e=e.replace(/[A-Z]/g,function(e){return e.toLowerCase()})}function g_isDateValid(e){return/^(20[0-2]\d)-([01]\d)-([0-3]\d) ([0-2]\d):([0-5]\d):([0-5]\d)$/.exec(e)}function g_isIpAddress(e){return/[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+/.test(e)}function g_isEmailValid(e){return null!=e.match(/^([a-z0-9._-]+)(\+[a-z0-9._-]+)?(@[a-z0-9.-]+\.[a-z]{2,4})$/i)}function g_getCurrentDomain(){if(g_getCurrentDomain.CACHE)return g_getCurrentDomain.CACHE;var e=location.hostname;if(!g_isIpAddress(e)){var t=e.split(".");t.length>2&&t.splice(0,t.length-2),e=t.join(".")}return g_getCurrentDomain.CACHE=e,e}function g_isExternalUrl(e){return!!e&&((0==e.indexOf("http")||0==e.indexOf("//"))&&-1==e.indexOf(g_getCurrentDomain()))}function g_createOrRegex(e,t){e=e.replace(/(\(|\)|\|\+|\*|\?|\$|\^)/g,"\\$1");for(var s=e.split(" "),i="",a=0,n=s.length;a<n;++a)a>0&&(i+="|"),i+=s[a];return new RegExp((null!=t?"("+t+")?":"")+"("+i+")","gi")}function g_getHash(){return"#"+decodeURIComponent(location.href.split("#")[1]||"")}function g_modifyUrl(e,t,s){s||(s=$.noop);var i="";return e.match(/(#.+)$/)&&(i=RegExp.$1,e=e.replace(i,"")),$.each(t,function(t,i){var a,n,o,r=e.match(new RegExp("(&|\\?)?"+t+"=?([^&]+)?"));if(null!=r&&(a=r[0],n=r[1],o=decodeURIComponent(r[2])),null==i){if(!a)return;o=null}else"+="==i.substr(0,2)?o&&s.onAppendCollision?o=s.onAppendCollision(o,i.substr(2),s.menuUrl):!o&&s.onAppendEmpty?o=s.onAppendEmpty(i.substr(2),s.menuUrl):(o||(o=""),o+=$.trim(i.substr(2))):o=i;if(a){var l="";n&&(l+=n),null!=o&&(l+=t,o&&(l+="="+$WH.urlencode2(o))),e=e.replace(a,l)}else(o||null==i||"+="!=i.substr(0,2))&&(e+=(-1==e.indexOf("?")?"?":"&")+t,o&&(e+="="+$WH.urlencode2(o)))}),e=e.replace("?&","?"),e=e.replace(/&&/g,"&"),e=e.replace(/\/\?/g,"?"),(e=e.replace(/(&|\?)+$/,""))+i}function g_getPatchVersionIndex(e){for(var t,s=g_getPatchVersion,i=0,a=s.T.length-2;a>i;){if(t=Math.floor((a+i)/2),e>=s.T[t]&&e<s.T[t+1])return t;e>=s.T[t]?i=t+1:a=t-1}return t=Math.ceil((a+i)/2)}function g_getPatchVersion(e){var t=g_getPatchVersionIndex(e);return g_getPatchVersion.V[t]}function g_getIngameLink(e,t,s){return'/script DEFAULT_CHAT_FRAME:AddMessage("\\124c'+e+"\\124H"+t+"\\124h["+s+']\\124h\\124r");'}"abbr article aside audio canvas details figcaption figure footer header hgroup mark menu meter nav output progress section summary time video".replace(/\w+/g,function(e){document.createElement(e)});var U_GROUP_TESTER=1,U_GROUP_ADMIN=2,U_GROUP_EDITOR=4,U_GROUP_MOD=8,U_GROUP_BUREAU=16,U_GROUP_DEV=32,U_GROUP_VIP=64,U_GROUP_BLOGGER=128,U_GROUP_PREMIUM=256,U_GROUP_LOCALIZER=512,U_GROUP_SALESAGENT=1024,U_GROUP_SCREENSHOT=2048,U_GROUP_VIDEO=4096,U_GROUP_APIONLY=8192,U_GROUP_PENDING=16384,U_GROUP_STAFF=U_GROUP_ADMIN|U_GROUP_EDITOR|U_GROUP_MOD|U_GROUP_BUREAU|U_GROUP_DEV|U_GROUP_BLOGGER|U_GROUP_LOCALIZER|U_GROUP_SALESAGENT,U_GROUP_EMPLOYEE=U_GROUP_ADMIN|U_GROUP_BUREAU|U_GROUP_DEV,U_GROUP_GREEN_TEXT=U_GROUP_MOD|U_GROUP_BUREAU|U_GROUP_DEV,U_GROUP_PREMIUMISH=U_GROUP_PREMIUM|U_GROUP_EDITOR,U_GROUP_MODERATOR=U_GROUP_ADMIN|U_GROUP_MOD|U_GROUP_BUREAU,U_GROUP_COMMENTS_MODERATOR=U_GROUP_BUREAU|U_GROUP_MODERATOR|U_GROUP_LOCALIZER,U_GROUP_PREMIUM_PERMISSIONS=U_GROUP_PREMIUM|U_GROUP_STAFF|U_GROUP_VIP,g_users={},g_favorites=[],g_customColors={},User=new function(){this.hasPermissions=function(e){return!e||!!(g_user.roles&e)}};Ajax.onReadyStateChange=function(){4==this.request.readyState&&(0==this.request.status||this.request.status>=200&&this.request.status<300?null!=this.onSuccess&&this.onSuccess(this.request,this):null!=this.onFailure&&this.onFailure(this.request,this),null!=this.onComplete&&this.onComplete(this.request,this))};var DomContentLoaded=new function(){var e=[],t=[];this.now=function(){$WH.array_apply(e,function(e){e()})},this.delayed=function(){$WH.array_apply(t,function(e){e()}),DomContentLoaded=null},this.addEvent=function(t){e.push(t)},this.addDelayedEvent=function(e){t.push(e)}};g_enableScroll.F=function(e){return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1,e.cancelBubble=!0,!1};var PageTemplate=new function(){function e(){w=$('<div class="breadcrumb"></div>')}function t(){$WH.Browser.ie6&&$(document.documentElement).addClass("ie6 ie67 ie678"),$WH.Browser.ie7&&$(document.documentElement).addClass("ie7 ie67 ie678"),$WH.Browser.ie8&&$(document.documentElement).addClass("ie8 ie678")}function s(){var e=$("#toplinks-favorites > a");e.text(LANG.favorites),Favorites.hasFavorites()||e.parent().hide(),Favorites.refreshMenu()}function i(){var e=$("#toplinks-user");if(e.length){e.attr("href","?user="+g_user.name);var t=[],s=["user-page",LANG.userpage,"?user="+g_user.name,null,{checkedUrl:new RegExp("user="+g_user.name+"$","i")}];t.push(s);var i=["settings",LANG.settings,"?account",null,{icon:g_staticDataUrl+"/images/icons/cog.gif",checkedUrl:/account/i}];t.push(i);var o=["reputation",LANG.reputation,"?reputation"];t.push(o);var r=["guides","My Guides","?my-guides"];t.push(r),a(t),n(t);var l;g_user.premium||(l=["premium-upgrade",LANG.premiumupgrade,"?premium",null,{className:"q7",checkedUrl:/premium/i}],t.push(l)),t.push(["sign-out",LANG.signout,"?account=signout"]),Menu.add(e,t),e.addClass("hassubmenu")}}function a(e){if(g_user.characters&&g_user.characters.length){var t=["characters",LANG.tab_characters,"?user="+g_user.name+"#characters",null,{onBeforeShow:o}];e.push(t)}}function n(e){if(g_user.profiles&&g_user.profiles.length){var t=["profiles",LANG.tab_profiles,"?user="+g_user.name+"#profiles",null,{onBeforeShow:r}];e.push(t)}}function o(e){var t=[];g_user.characters.sort(function(e,t){return $WH.strcmp(e.realmname,t.realmname)||$WH.strcmp(e.region,t.region)||$WH.strcmp(e.name,t.name)});var s;$.each(g_user.characters,function(e,i){if(i.region&&i.realm&&i.name){var a=i.region+i.realm;if(a!=s){var n=[,i.realmname+" ("+i.region.toUpperCase()+")",g_getProfileRealmUrl(i)];t.push(n),s=a}var o=[i.id,i.name,g_getProfileUrl(i),null,{className:(i.pinned?"icon-star-right ":"")+"c"+i.classs,tinyIcon:$WH.g_getProfileIcon(i.race,i.classs,i.gender,i.level,0,"tiny")}];t.push(o)}}),e[MENU_IDX_SUB]=t}function r(e){var t=[];g_user.profiles.sort(function(e,t){return $WH.strcmp(e.name,t.name)}),$.each(g_user.profiles,function(e,s){var i=[s.id,s.name,g_getProfileUrl(s),null,{className:"c"+s.classs,tinyIcon:$WH.g_getProfileIcon(s.race,s.classs,s.gender,s.level,s.icon,"tiny")}];t.push(i)}),t.push([0,LANG.menu_newprofile,"?profile&new",null,{tinyIcon:"inv_misc_questionmark"}]),e[MENU_IDX_SUB]=t}function l(){$("#toplinks-feedback").attr("href","javascript:;").click(function(){ContactTool.show()})}function c(){var e,t=(location.pathname,location.search,location.hash,Locale.getId()),s=[];$.each(Locale.getAllByName(),function(i,a){var n=[a.id,a.description,g_langUrl[a.id],null,null];"undefined"!=typeof g_pageInfo&&g_pageInfo.type&&g_types[g_pageInfo.type]&&(n[4]={rel:g_types[g_pageInfo.type]+"="+g_pageInfo.typeId+" domain="+a.domain}),a.id==t&&(n.checked=!0,e=a),s.push(n)}),u($("#toplinks-language"),s,e),$(document).ready(function(){u($("#footer-links-language"),s,e)})}function u(e,t,s){e.attr("href","javascript:;"),e.addClass("hassubmenu"),Menu.add(e,t)}function d(){$("#header-expandsite").attr("href","javascript:;").click(W)}function p(){var e=$("#toptabs");e.length&&(N=$("<dl/>"),$.each(mn_path,function(e,t){var s=$("<dt><a><ins><big>"+t[MENU_IDX_NAME].charAt(0)+"</big>"+t[MENU_IDX_NAME].substr(1)+"</ins><span></span></a></dt>"),i=s.children("a");Menu.linkifyItem(t,i),s.appendTo(N)}),g(),N.appendTo(e))}function h(){var e=$("#topbar");if(e.length){var t=$("div.topbar-search",e);$("#livesearch-generic").attr("placeholder",LANG.searchdb);$("<a></a>").attr("href","javascript:;").click(y).appendTo(t),$("form",t).submit(g_preventEmptyFormSubmission),LiveSearch.attach($("input",t));var s=$WH.g_getWindowSize();s.w&&s.w<1024&&$("div.topbar-search input").css("width","180px"),v()}}function m(){_(),w.appendTo($("#main-precontents"))}function f(){if(null!=L.filter){var e=$WH.ge("main-precontents"),t=$WH.ce("div"),s=$WH.ce("a");t.className="path-right",s.href="javascript:;",s.id="fi_toggle",$WH.ns(s),s.onclick=fi_toggle,L.filter?(s.className="disclosure-on",$WH.ae(s,$WH.ct(LANG.fihide))):(s.className="disclosure-off",$WH.ae(s,$WH.ct(LANG.fishow))),$WH.ae(t,s),$WH.ae(e,t)}}function g(){if(N){var e=$("a",N);$.each(mn_path,function(t,s){var i=$(e.get(t));s[MENU_IDX_ID]==L.activeTab?(i.addClass("active"),Menu.remove(i)):(i.removeClass("active"),s[MENU_IDX_SUB]&&Menu.add(i,s[MENU_IDX_SUB]))})}}function v(){var e=$("#topbar div.topbar-buttons");if(e.length)switch(e.empty(),L.activeTab){case 0:Menu.addButtons(e,[Menu.findItem(mn_items,[2]),Menu.findItem(mn_items,[4]),Menu.findItem(mn_items,[1]),Menu.findItem(mn_items,[0]),Menu.findItem(mn_items,[7]),Menu.findItem(mn_items,[6]),Menu.findItem(mn_items,[11]),Menu.findItem(mn_items,[9]),Menu.findItem(mn_items,[3]),Menu.findItem(mn_items,[15]),Menu.findItem(mn_items,[10]),Menu.findItem(mn_items,[12]),Menu.findItem(mn_items,[13])]);break;case 1:Menu.addButtons(e,[Menu.findItem(mn_itemSets,[11]),Menu.findItem(mn_itemSets,[3]),Menu.findItem(mn_itemSets,[8]),Menu.findItem(mn_itemSets,[2]),Menu.findItem(mn_itemSets,[5]),Menu.findItem(mn_itemSets,[4]),Menu.findItem(mn_itemSets,[7]),Menu.findItem(mn_itemSets,[9]),Menu.findItem(mn_itemSets,[1])]);break;case 2:Menu.addButtons(e,[Menu.findItem(mn_spells,[7]),Menu.findItem(mn_spells,[-11]),Menu.findItem(mn_spells,[-4]),Menu.findItem(mn_spells,[-2]),Menu.findItem(mn_spells,[-6]),Menu.findItem(mn_spells,[-5]),Menu.findItem(mn_spells,[8]),Menu.findItem(mn_spells,[-3]),Menu.findItem(mn_spells,[11]),Menu.findItem(mn_spells,[9]),Menu.findItem(mn_spells,[-8]),Menu.findItem(mn_spells,[0])]);break;case 3:Menu.addButtons(e,[Menu.findItem(mn_skills,[171]),Menu.findItem(mn_skills,[164]),Menu.findItem(mn_skills,[333]),Menu.findItem(mn_skills,[202]),Menu.findItem(mn_skills,[182]),Menu.findItem(mn_skills,[755]),Menu.findItem(mn_skills,[165]),Menu.findItem(mn_skills,[186]),Menu.findItem(mn_skills,[393]),Menu.findItem(mn_skills,[197]),Menu.findItem(mn_skills,[185]),Menu.findItem(mn_skills,[129]),Menu.findItem(mn_skills,[356]),Menu.findItem(mn_skills,[762])]);break;case 4:Menu.addButtons(e,[Menu.findItem(mn_npcs,[1]),Menu.findItem(mn_npcs,[8]),Menu.findItem(mn_npcs,[3]),Menu.findItem(mn_npcs,[2]),Menu.findItem(mn_npcs,[4]),Menu.findItem(mn_npcs,[5]),Menu.findItem(mn_npcs,[7]),Menu.findItem(mn_npcs,[9]),Menu.findItem(mn_npcs,[6]),Menu.findItem(mn_npcs,[11]),Menu.findItem(mn_npcs,[12]),Menu.findItem(mn_npcs,[13]),Menu.findItem(mn_npcs,[10])]);break;case 5:Menu.addButtons(e,[Menu.findItem(mn_quests,[0]),Menu.findItem(mn_quests,[1]),Menu.findItem(mn_quests,[8]),Menu.findItem(mn_quests,[2]),Menu.findItem(mn_quests,[3]),Menu.findItem(mn_quests,[4]),Menu.findItem(mn_quests,[5]),Menu.findItem(mn_quests,[6]),Menu.findItem(mn_quests,[9]),Menu.findItem(mn_quests,[7]),Menu.findItem(mn_quests,[-2])]);break;case 7:Menu.addButtons(e,[Menu.findItem(mn_zones,[0]),Menu.findItem(mn_zones,[1]),Menu.findItem(mn_zones,[8]),Menu.findItem(mn_zones,[2]),Menu.findItem(mn_zones,[3]),Menu.findItem(mn_zones,[6]),Menu.findItem(mn_zones,[9])]);break;case 8:Menu.addButtons(e,[Menu.findItem(mn_objects,[-3]),Menu.findItem(mn_objects,[-4]),Menu.findItem(mn_objects,[-5]),Menu.findItem(mn_objects,[-2]),Menu.findItem(mn_objects,[-6]),Menu.findItem(mn_objects,[9]),Menu.findItem(mn_objects,[3]),Menu.findItem(mn_objects,[25])]);break;case 9:Menu.addButtons(e,[Menu.findItem(mn_factions,[1118]),Menu.findItem(mn_factions,[980]),Menu.findItem(mn_factions,[0])]);break;case 10:Menu.addButtons(e,[Menu.findItem(mn_holidays,[1]),Menu.findItem(mn_holidays,[2]),Menu.findItem(mn_holidays,[3])]);break;case 11:Menu.addButtons(e,[Menu.findItem(mn_char,[12]),Menu.findItem(mn_char,[100]),Menu.findItem(mn_char,[13]),Menu.findItem(mn_char,[10])]);break;case 12:Menu.addButtons(e,[Menu.findItem(mn_tools,[0]),Menu.findItem(mn_tools,[1])])}}function _(){if(!L.breadcrumb||!L.breadcrumb.length)return void w.hide();w.empty(),k.length&&($.each(k,function(){this.checked=!1,Menu.updateItem(this)}),k=[]);var e=Menu.getFullPath(mn_path,L.breadcrumb);if(e.length){var t=e.length-1;$.each(e,function(e,s){var i=Menu.getItemOpt(s);s.checked=!0,k.push(s),Menu.updateItem(s);var a=H(),n=a;if(s[MENU_IDX_URL]&&(n=$("<a/>",{href:Menu.getItemUrl(s)}).appendTo(a)),i.breadcrumb?n.text(i.breadcrumb):n.text(s[MENU_IDX_NAME]),Menu.add(n,s.parentMenu),a.appendTo(w),e==t&&s[MENU_IDX_SUB]){a.addClass("breadcrumb-arrow");var o=$('<span class="breadcrumb-ellipsis">...</span>');Menu.add(o,s[MENU_IDX_SUB]),o.appendTo(w)}}),w.trigger("update"),w.show()}}function H(){return w.children("span:last").addClass("breadcrumb-arrow"),$("<span/>").appendTo(w)}function W(){$("#sidebar, #header-expandsite").remove(),$("#layout").hasClass("nosidebar")||$("#wrapper").animate({"margin-right":"10px"},333,null,function(){$("#wrapper").css("margin-right","0px"),$("#layout").addClass("nosidebar")})}function y(){$(this).prev("form").submit().children("input").focus()}var b=this;b.init=function(){s(),i(),l(),c(),f(),d(),p(),h(),m(),x=!0},b.get=function(e){return L[e]},b.set=function(e){if(e){var t={};$.extend(t,L),$.extend(L,e),L.activeTab=parseInt(L.activeTab),x&&(L.activeTab!=t.activeTab&&(g(),v()),L.breadcrumb!=t.breadcrumb&&_())}},b.getBreadcrumb=function(){return w},b.updateBreadcrumb=function(){_()},b.expandBreadcrumb=function(){return H()};var w,N,x=!1,L={},k=[];!function(){e(),t()}()};g_createReputationBar.P=[36e3,3e3,3e3,3e3,6e3,12e3,21e3,999],DomContentLoaded.addEvent(function(){$WH.array_apply($WH.gE(document,"dfn"),function(x){var text=x.title;x.title="",x.className+=" tip",0==text.indexOf("LANG.")&&(text=eval(text)),g_addTooltip(x,text,"q")})});var g_screenshots={},ScreenshotViewer=new function(){function e(e){var t=h[m],s=Math.max(50,Math.min(618,$WH.g_getWindowSize().h-72-e));1!=I||t.id||t.resize?($=Math.min(772/t.width,618/t.height),v=Math.min(772/t.width,s/t.height)):$=v=1,$>1&&($=1),v>1&&(v=1),f=Math.round(v*t.width),g=Math.round(v*t.height);var i=Math.max(480,f);Lightbox.setSize(i+20,g+52+e),$WH.Browser.ie6&&(y.style.width=i+"px",h.length>1?w.style.height=N.style.height=g+"px":x.style.height=g+"px"),e&&(b.firstChild.width=f,b.firstChild.height=g)}function t(e){var t=h[e],s="#screenshots:";return s+=0==I?"id="+t.id:H+":"+(e+1)}function s(s){if(!(s&&v==$&&$WH.g_getWindowSize().h>W.offsetHeight)){W.style.visibility="hidden";var a=h[m],n=a.width>772||a.height>618;e(0);var o=a.url?a.url:g_staticUrl+"/uploads/screenshots/"+(n?"resized/":"normal/")+a.id+".jpg",r='<img src="'+o+'" width="'+f+'" height="'+g+'"';if($WH.Browser.ie6&&(r+=' galleryimg="no"'),r+=">",b.innerHTML=r,!s){g_trackEvent("Screenshots","Show",a.id+(a.caption&&a.caption.length?" ("+a.caption+")":"")),a.url?L.href=o:L.href=g_staticUrl+"/uploads/screenshots/normal/"+a.id+".jpg",a.user||"object"!=typeof g_pageInfo||(a.user=g_pageInfo.username);var l=a.date&&a.user,c=h.length>1;if(l){var u=new Date(a.date),d=(g_serverTime-u)/1e3,p=k.firstChild.childNodes[1];p.href="?user="+a.user,p.innerHTML=a.user;var _=k.firstChild.childNodes[3];$WH.ee(_),g_formatDate(_,d,u),k.firstChild.style.display=""}else k.firstChild.style.display="none";var _=k.childNodes[1];if($WH.ee(_),a.user){l&&$WH.ae(_,$WH.ct(" "+LANG.dash+" "));var p=$WH.ce("a");p.href="javascript:;",p.onclick=ContactTool.show.bind(ContactTool,{mode:3,screenshot:a}),p.className="icon-report",g_addTooltip(p,LANG.report_tooltip,"q2"),$WH.ae(p,$WH.ct(LANG.report)),$WH.ae(_,p)}if(_=k.childNodes[2],c){var H="";a.user&&(H=LANG.dash),H+=m+1+LANG.lvpage_of+h.length,_.innerHTML=H,_.style.display=""}else _.style.display="none";k.style.display=l||c?"":"none";var y=null!=a.caption&&a.caption.length,M=null!=a.subject&&a.subject.length&&a.type&&a.typeId;if(y||M){var r="";M&&(r+=LANG.types[a.type][0]+LANG.colon,r+='<a href="?'+g_types[a.type]+"="+a.typeId+'">',r+=a.subject,r+="</a>"),y&&(M&&(r+=LANG.dash),r+=a.noMarkup?a.caption:Markup.toHtml(a.caption,{mode:Markup.MODE_SIGNATURE})),A.innerHTML=r,A.style.display=""}else A.style.display="none";h.length>1?(w.href=t(i(-1)),N.href=t(i(1)),w.style.display=N.style.display="",x.style.display="none"):(w.style.display=N.style.display="none",x.style.display=""),location.replace(t(m))}Lightbox.reveal(),A.offsetHeight>18&&e(A.offsetHeight-18),W.style.visibility="visible"}}function i(e){var t=m;return t+=e,t<0?t=h.length-1:t>=h.length&&(t=0),t}function a(){return m=i(-1),u(),!1}function n(){return m=i(1),u(),!1}function o(e){switch(e=$WH.$E(e),e.keyCode){case 37:a();break;case 39:n()}}function r(){s(1)}function l(){d(),h.length>1&&$WH.dE(document,"keyup",o),_&&0==I?(-1!=_.indexOf(":id=")&&(_="#screenshots"),location.replace(_)):location.replace("#.")}function c(e,t,s){if("string"==typeof s.screenshots?(h=g_screenshots[s.screenshots],I=1,H=s.screenshots):(h=s.screenshots,I=0,H=null),W=e,m=0,s.pos&&s.pos>=0&&s.pos<h.length&&(m=s.pos),t){e.className="screenshotviewer",y=$WH.ce("div"),y.className="screenshotviewer-screen",w=$WH.ce("a"),N=$WH.ce("a"),w.className="screenshotviewer-prev",N.className="screenshotviewer-next",w.href="javascript:;",N.href="javascript:;";var i=$WH.ce("span");$WH.ae(i,$WH.ce("b")),$WH.ae(w,i);var i=$WH.ce("span");$WH.ae(i,$WH.ce("b")),$WH.ae(N,i),w.onclick=a,N.onclick=n,x=$WH.ce("a"),x.className="screenshotviewer-cover",x.href="javascript:;",x.onclick=Lightbox.hide;var i=$WH.ce("span");$WH.ae(i,$WH.ce("b")),$WH.ae(x,i),$WH.Browser.ie6&&($WH.ns(w),$WH.ns(N),w.onmouseover=N.onmouseover=x.onmouseover=function(){this.firstChild.style.display="block"},w.onmouseout=N.onmouseout=x.onmouseout=function(){this.firstChild.style.display=""}),$WH.ae(y,w),$WH.ae(y,N),$WH.ae(y,x),b=$WH.ce("div"),$WH.ae(y,b),$WH.ae(e,y);var r=$WH.ce("a");r.className="screenshotviewer-close",r.href="javascript:;",r.onclick=Lightbox.hide,$WH.ae(r,$WH.ce("span")),$WH.ae(e,r),L=$WH.ce("a"),L.className="screenshotviewer-original",L.href="javascript:;",L.target="_blank",$WH.ae(L,$WH.ce("span")),$WH.ae(e,L),k=$WH.ce("div"),k.className="screenshotviewer-from";var l=$WH.ce("span");$WH.ae(l,$WH.ct(LANG.lvscreenshot_from)),$WH.ae(l,$WH.ce("a")),$WH.ae(l,$WH.ct(" ")),$WH.ae(l,$WH.ce("span")),$WH.ae(k,l),$WH.ae(k,$WH.ce("span")),$WH.ae(k,$WH.ce("span")),$WH.ae(e,k),A=$WH.ce("div"),A.className="screenshotviewer-caption",$WH.ae(e,A);var c=$WH.ce("div");c.className="clear",$WH.ae(e,c)}_=location.hash,h.length>1&&$WH.aE(document,"keyup",o),u()}function u(){var t=h[m];if(t.width&&t.height)s();else{if(M)M.onload=null,M.onerror=null;else for(W.className="",G=[];W.firstChild;)G.push(W.firstChild),$WH.de(W.firstChild);var i=setTimeout(function(){t.width=126,t.height=22,e(0),t.width=null,t.height=null;var s=$WH.ce("div");s.style.margin="0 auto",s.style.width="126px";var i=$WH.ce("img");i.src=g_staticDataUrl+"/images/ui/misc/progress-anim.gif",i.width=126,i.height=22,$WH.ae(s,i),$WH.ae(W,s),Lightbox.reveal(),W.style.visiblity="visible"},150);M=new Image,M.onload=function(e,t){clearTimeout(t),e.width=this.width,e.height=this.height,M=null,p(),s()}.bind(M,t,i),M.onerror=function(e){clearTimeout(e),M=null,Lightbox.hide(),p()}.bind(M,i),M.src=t.url?t.url:g_staticUrl+"/uploads/screenshots/normal/"+t.id+".jpg"}}function d(){M&&(M.onload=null,M.onerror=null,M=null,p())}function p(){if(G){$WH.ee(W),W.className="screenshotviewer";for(var e=0;e<G.length;++e)$WH.ae(W,G[e]);G=null}}var h,m,f,g,v,$,_,H,W,y,b,w,N,x,L,k,A,M,G,I=0;this.checkPound=function(){if(location.hash&&0==location.hash.indexOf("#screenshots")&&!g_listviews.screenshots){var e=location.hash.split(":");if(3==e.length){var t=g_screenshots[e[1]],s=parseInt(e[2]);t&&s>=1&&s<=t.length&&ScreenshotViewer.show({screenshots:e[1],pos:s-1})}}},this.show=function(e){Lightbox.show("screenshotviewer",{onShow:c,onHide:l,onResize:r},e)},DomContentLoaded.addEvent(this.checkPound)},vi_thumbnails={1:"https://i3.ytimg.com/vi/$1/default.jpg"},vi_siteurls={1:"https://www.youtube.com/watch?v=$1"},vi_sitevalidation={1:/^https?:\/\/www\.youtube\.com\/watch\?v=([^& ]{11})/},g_videos=[],VideoViewer=new function(){function e(){var e=(d[p],Math.max(L.offsetHeight-18,0)),t=Math.max(50,Math.min(520,$WH.g_getWindowSize().h-72-e)),s=Math.min(1,t/520);h=Math.round(880*s),m=Math.round(520*s),y.style.height=b.style.height=w.style.height=m-95+"px",Lightbox.setSize(Math.max(480,h)+20,m+52+e)}function t(e){var t=d[e],s="#videos:";return s+=0==k?"id="+t.id:v+":"+(e+1)}function s(s){if(!(s&&1==f&&$WH.g_getWindowSize().h>_.offsetHeight)){_.style.visibility="hidden";var a=d[p];if(e(),!s){g_trackEvent("Videos","Show",a.id+(a.caption.length?" ("+a.caption+")":"")),1==a.videoType&&(W.innerHTML=Markup.toHtml("[youtube="+a.videoId+" width="+h+" height="+m+" autoplay=true]",{mode:Markup.MODE_ARTICLE})),N.href=$WH.sprintf(vi_siteurls[a.videoType],a.videoId),a.user||"object"!=typeof g_pageInfo||(a.user=g_pageInfo.username);var n=a.date&&a.user,r=d.length>1;if(n){var l=new Date(a.date),c=(g_serverTime-l)/1e3,u=x.firstChild.childNodes[1];u.href="?user="+a.user,u.innerHTML=a.user;var g=x.firstChild.childNodes[3];$WH.ee(g),g_formatDate(g,c,l),x.firstChild.style.display=""}else x.firstChild.style.display="none";var g=x.childNodes[1];if($WH.ee(g),a.user){n&&$WH.ae(g,$WH.ct(" "+LANG.dash+" "));var u=$WH.ce("a");u.href="javascript:;",u.onclick=ContactTool.show.bind(ContactTool,{mode:5,video:a}),u.className="icon-report",g_addTooltip(u,LANG.report_tooltip,"q2"),$WH.ae(u,$WH.ct(LANG.report)),$WH.ae(g,u)}if(g=x.childNodes[2],r){var v="";a.user&&(v=LANG.dash),v+=p+1+LANG.lvpage_of+d.length,g.innerHTML=v,g.style.display=""}else g.style.display="none";x.style.display=n||r?"":"none";var $=null!=a.caption&&a.caption.length,H=null!=a.subject&&a.subject.length&&a.type&&a.typeId;if($||H){var k="";H&&(k+=LANG.types[a.type][0]+LANG.colon,k+='<a href="?'+g_types[a.type]+"="+a.typeId+'">',k+=a.subject,k+="</a>"),$&&(H&&(k+=LANG.dash),k+=a.noMarkup?a.caption:Markup.toHtml(a.caption,{mode:Markup.MODE_SIGNATURE})),L.innerHTML=k,L.style.display=""}else L.style.display="none";d.length>1?(y.href=t(i(-1)),b.href=t(i(1)),y.style.display=b.style.display="",w.style.display="none"):(y.style.display=b.style.display="none",w.style.display=""),location.replace(t(p))}Lightbox.reveal(),_.style.visibility="visible",setTimeout(o,1)}}function i(e){var t=p;return t+=e,t<0?t=d.length-1:t>=d.length&&(t=0),t}function a(){return p=i(-1),s(),!1}function n(){return p=i(1),s(),!1}function o(){$&&(document.title=$)}function r(e){switch(e=$WH.$E(e),e.keyCode){case 37:a();break;case 39:n()}}function l(){s(1)}function c(){$WH.ee(W),d.length>1&&$WH.dE(document,"keyup",r),g&&0==k?(-1!=g.indexOf(":id=")&&(g="#videos"),location.replace(g)):location.replace("#."),o()}function u(e,t,i){if("string"==typeof i.videos?(d=g_videos[i.videos],k=1,v=i.videos):(d=i.videos,k=0,v=null),_=e,p=0,i.pos&&i.pos>=0&&i.pos<d.length&&(p=i.pos),t){e.className="screenshotviewer",H=$WH.ce("div"),H.className="screenshotviewer-screen",y=$WH.ce("a"),b=$WH.ce("a"),y.className="screenshotviewer-prev",b.className="screenshotviewer-next",y.href="javascript:;",b.href="javascript:;";var o=$WH.ce("span"),l=$WH.ce("b");$WH.ae(o,l),$WH.ae(y,o);var o=$WH.ce("span"),l=$WH.ce("b");$WH.ae(o,l),$WH.ae(b,o),y.onclick=a,b.onclick=n,w=$WH.ce("a"),w.className="screenshotviewer-cover",w.href="javascript:;",w.onclick=Lightbox.hide;var o=$WH.ce("span"),l=$WH.ce("b");$WH.ae(l,$WH.ct(LANG.close)),$WH.ae(o,l),$WH.ae(w,o),$WH.ae(H,y),$WH.ae(H,b),$WH.ae(H,w),W=$WH.ce("div"),$WH.ae(H,W),$WH.ae(e,H);var c=$WH.ce("a");c.className="screenshotviewer-close",c.href="javascript:;",c.onclick=Lightbox.hide,$WH.ae(c,$WH.ce("span")),$WH.ae(e,c),N=$WH.ce("a"),N.className="screenshotviewer-original",N.href="javascript:;",N.target="_blank",$WH.ae(N,$WH.ce("span")),$WH.ae(e,N),x=$WH.ce("div"),x.className="screenshotviewer-from";var u=$WH.ce("span");$WH.ae(u,$WH.ct(LANG.lvscreenshot_from)),$WH.ae(u,$WH.ce("a")),$WH.ae(u,$WH.ct(" ")),$WH.ae(u,$WH.ce("span")),$WH.ae(x,u),$WH.ae(x,$WH.ce("span")),$WH.ae(x,$WH.ce("span")),$WH.ae(e,x),L=$WH.ce("div"),L.className="screenshotviewer-caption",$WH.ae(e,L);var h=$WH.ce("div");h.className="clear",$WH.ae(e,h)}g=location.hash,d.length>1&&$WH.aE(document,"keyup",r),s()}var d,p,h,m,f,g,v,$,_,H,W,y,b,w,N,x,L,k=0;this.checkPound=function(){if($=$WH.gE(document,"title").innerHTML,location.hash&&0==location.hash.indexOf("#videos")&&!g_listviews.videos){var e=location.hash.split(":");if(3==e.length){var t=g_videos[e[1]],s=parseInt(e[2]);t&&s>=1&&s<=t.length&&VideoViewer.show({videos:e[1],pos:s-1})}}},this.show=function(e){return Lightbox.show("videoviewer",{onShow:u,onHide:c,onResize:l},e),!1},DomContentLoaded.addEvent(this.checkPound)},Dialog=function(){function e(e,i){!i&&g||t(e),u.onBeforeShow&&u.onBeforeShow(),f.onBeforeShow&&f.onBeforeShow(),Lightbox.setSize(u.width,u.height),e.className="dialog",s(),u.onShow&&u.onShow(),f.onShow&&f.onShow()}function t(e){$WH.ee(e),$WH.ee(v);var t=$WH.ce("div");if(t.className="text",$WH.ae(e,t),$WH.ae(t,v),u.title){var s=$WH.ce("h1");$WH.ae(s,$WH.ct(u.title)),$WH.ae(v,s)}var i=$WH.ce("table"),n=$WH.ce("tbody"),o=!1;$WH.ae(i,n),$WH.ae(v,i);for(var r=0,l=u.fields.length;r<l;++r){var c,d=u.fields[r];o||(tr=$WH.ce("tr"),th=$WH.ce("th"),td=$WH.ce("td")),d.__tr=tr,null==p[d.id]&&(p[d.id]=d.value?d.value:"");var m;if(d.options){if(m=[],d.optorder)$WH.cO(m,d.optorder);else for(var f in d.options)m.push(f);d.sort&&m.sort(function(e,t){return d.sort*$WH.strcmp(d.options[e],d.options[t])})}switch(d.type){case"caption":th.colSpan=2,th.style.textAlign="left",th.style.padding=0,d.compute?d.compute.bind(h,null,p[d.id],v,th,tr)():d.label&&$WH.ae(th,$WH.ct(d.label)),$WH.ae(tr,th),$WH.ae(n,tr);continue;case"textarea":var _=c=$WH.ce("textarea");_.name=d.id,d.disabled&&(_.disabled=!0),_.rows=d.size[0],_.cols=d.size[1],td.colSpan=2,d.label&&(th.colSpan=2,th.style.textAlign="left",th.style.padding=0,td.style.padding=0,$WH.ae(th,$WH.ct(d.label)),$WH.ae(tr,th),$WH.ae(n,tr),tr=$WH.ce("tr")),$WH.ae(td,_);break;case"select":var _=c=$WH.ce("select");_.name=d.id,d.size&&(_.size=d.size),d.disabled&&(_.disabled=!0),d.multiple&&(_.multiple=!0);for(var f=0,H=m.length;f<H;++f){var W=$WH.ce("option");W.value=m[f],$WH.ae(W,$WH.ct(d.options[m[f]])),$WH.ae(_,W)}$WH.ae(td,_);break;case"dynamic":td.colSpan=2,td.style.textAlign="left",td.style.padding=0,d.compute&&d.compute.bind(h,null,p[d.id],v,td,tr)(),$WH.ae(tr,td),$WH.ae(n,tr),c=td;break;case"checkbox":case"radio":;c=[];for(var f=0,H=m.length;f<H;++f){var _,y,b=$WH.ce("span"),w="sdfler46"+d.id+"-"+m[f];f>0&&!d.noInputBr&&$WH.ae(td,$WH.ce("br")),$WH.Browser.ie6&&"radio"==d.type?(y=$WH.ce("<label for='' + uniqueId + '' onselectstart='return false' />"),_=$WH.ce("<input type='' + field.type + '' name='' + field.id + '' />")):(y=$WH.ce("label"),y.setAttribute("for",w),y.onmousedown=$WH.rf,_=$WH.ce("input"),_.setAttribute("type",d.type),_.name=d.id),_.value=m[f],_.id=w,d.disabled&&(_.disabled=!0),d.submitOnDblClick&&(y.ondblclick=_.ondblclick=function(e){a()}),d.compute&&d.compute.bind(h,_,p[d.id],v,td,tr)(),$WH.ae(y,_),$WH.ae(y,$WH.ct(d.options[m[f]])),$WH.ae(td,y),c.push(_)}break;default:var _=c=$WH.ce("input");_.name=d.id,d.size&&(_.size=d.size),d.disabled&&(_.disabled=!0),d.submitOnEnter&&(_.onkeypress=function(e){e=$WH.$E(e),13==e.keyCode&&a()}),_.setAttribute("type",d.type),$WH.ae(td,_)}if(d.label&&("textarea"==d.type?(d.labelAlign&&(td.style.textAlign=d.labelAlign),td.colSpan=2):(d.labelAlign&&(th.style.textAlign=d.labelAlign),$WH.ae(th,$WH.ct(d.label)),$WH.ae(tr,th))),d.placeholder&&(_.placeholder=d.placeholder),"checkbox"!=d.type&&"radio"!=d.type&&(d.width&&(_.style.width=d.width),d.compute&&"caption"!=d.type&&"dynamic"!=d.type&&d.compute.bind(h,_,p[d.id],v,td,tr)()),d.caption){var b=$WH.ce("small");"textarea"!=d.type&&(b.style.paddingLeft="2px"),b.className="q0",$WH.ae(b,$WH.ct(d.caption)),$WH.ae(td,b)}$WH.ae(tr,td),$WH.ae(n,tr),o=d.mergeCell,$[d.id]=c}for(var r=u.buttons.length;r>0;--r){var N=u.buttons[r-1],x=$WH.ce("a");x.href="javascript:;",x.onclick=a.bind(x,N[0]),x.className="dialog-"+N[0],$WH.ae(x,$WH.ct(N[1])),$WH.ae(e,x)}var L=$WH.ce("div");L.className="clear",$WH.ae(e,L),g=!0}function s(){for(var e=0,t=u.fields.length;e<t;++e){var s=u.fields[e],i=$[s.id];switch(s.type){
case"caption":break;case"select":for(var a=0,n=i.options.length;a<n;a++)i.options[a].selected=i.options[a].value==p[s.id]||-1!=$WH.in_array(p[s.id],i.options[a].value);break;case"checkbox":case"radio":for(var a=0,n=i.length;a<n;a++)i[a].checked=i[a].value==p[s.id]||-1!=$WH.in_array(p[s.id],i[a].value);break;default:i.value=p[s.id]}s.update&&s.update.bind(h,null,p[s.id],v,i)()}}function i(){u.onHide&&u.onHide(),f.onHide&&f.onHide()}function a(e){if("cancel"==e)return Lightbox.hide();for(var t=0,s=u.fields.length;t<s;++t){var i,a=u.fields[t];switch(a.type){case"caption":continue;case"select":i=l(a.id);break;case"checkbox":case"radio":i=c(a.id);break;case"dynamic":if(a.getValue){i=a.getValue(a,p,v);break}default:i=o(a.id)}if(a.validate&&!a.validate(i,p,v))return;i&&"string"==typeof i&&(i=$WH.trim(i)),p[a.id]=i}n(e)}function n(e){var t;return m&&(t=m(p,e,v)),f.onSubmit&&(t=f.onSubmit(p,e,v)),(void 0===t||t)&&Lightbox.hide(),!1}function o(e){return $[e].value}function r(e,t){$[e].value=t}function l(e){for(var t=[],s=$[e],i=0,a=s.options.length;i<a;i++)s.options[i].selected&&t.push(parseInt(s.options[i].value)==s.options[i].value?parseInt(s.options[i].value):s.options[i].value);return 1==t.length&&(t=t[0]),t}function c(e){for(var t=[],s=$[e],i=0,a=s.length;i<a;i++)s[i].checked&&t.push(parseInt(s[i].value)==s[i].value?parseInt(s[i].value):s[i].value);return t}var u,d,p,h=this,m=null,f={},g=!1,v=$WH.ce("form"),$={};v.onsubmit=function(){return a(),!1},this.show=function(t,s){t&&(d=t,u=Dialog.templates[d],h.template=u,u.onInit&&!g&&u.onInit.bind(h,v,s)(),s.onBeforeShow&&(f.onBeforeShow=s.onBeforeShow.bind(h,v)),u.onBeforeShow&&(u.onBeforeShow=u.onBeforeShow.bind(h,v)),s.onShow&&(f.onShow=s.onShow.bind(h,v)),u.onShow&&(u.onShow=u.onShow.bind(h,v)),s.onHide&&(f.onHide=s.onHide.bind(h,v)),u.onHide&&(u.onHide=u.onHide.bind(h,v)),s.onSubmit&&(f.onSubmit=s.onSubmit),u.onSubmit&&(m=u.onSubmit.bind(h,v)),s.data&&(g=!1,p={},$WH.cO(p,s.data)),h.data=p,Lightbox.show("dialog-"+d,{onShow:e,onHide:i}))},this.getValue=function(e){return o(e)},this.setValue=function(e,t){r(e,t)},this.getSelectedValue=function(e){return l(e)},this.getCheckedValue=function(e){return c(e)}};Dialog.templates={};var Slider=new function(){function e(e){return e=$WH.$E(e),h=this,p=$WH.g_getCursorPos(e),$WH.aE(document,"mousemove",t),$WH.aE(document,"mouseup",s),!1}function t(e){if(e=$WH.$E(e),p&&h){var t=$WH.g_getCursorPos(e),s=t[h._dir]-p[h._dir],i=r(h,h._pos+s),a=c(h);a&&h.input&&(h.input.value=a.value),i||(p=t),h.onMove&&h.onMove(e,h,a)}}function s(e){return e=$WH.$E(e),h.onMove&&h.onMove(e,h,c(h)),h=null,p=null,$WH.dE(document,"mousemove",t),$WH.dE(document,"mouseup",s),!1}function a(e,i){i=$WH.$E(i),h=e,p=$WH.g_getCursorPos(i);var a=$WH.ac(h.parentNode),n=Math.floor(d(h)/2);r(h,p[h._dir]-a[h._dir]-n);var o=c(h);return o&&h.input&&(h.input.value=o.value),h.onMove&&h.onMove(i,h,o),$WH.aE(document,"mousemove",t),$WH.aE(document,"mouseup",s),!1}function n(e,t){m&&clearTimeout(m),"change"==t.type||"keypress"==t.type&&13==t.which?o(e,t):m=setTimeout(o.bind(0,e,t),1e3)}function o(e,t){var s=e.input.value,i=c(e);isNaN(s)&&(s=i.value),s>e._max&&(s=e._max),s<e._min&&(s=e._min),Slider.setValue(e,s),e.onMove&&e.onMove(t,e,c(e))}function r(e,t){var s=!1;return t<0?(t=0,s=!0):t>l(e)&&(t=l(e),s=!0),e.style["y"==e._dir?"top":"left"]=t+"px",e._pos=t,s}function l(e){return u(e)-d(e)+2}function c(e){var t=e._pos/l(e),s=Math.round(t*(e._max-e._min)+e._min),i=[t,s];return i.percent=t,i.value=s,i}function u(e){return e._tsz>0?e._tsz:"y"==e._dir?e.parentNode.offsetHeight:e.parentNode.offsetWidth}function d(e){return e._hsz>0?e._hsz:"y"==e._dir?e.offsetHeight:e.offsetWidth}var p,h,m;this.setPercent=function(e,t){r(e,parseInt(t*l(e)))},this.setValue=function(e,t){t<e._min?t=e._min:t>e._max&&(t=e._max),e.input&&(e.input.value=t),this.setPercent(e,(t-e._min)/(e._max-e._min))},this.setSize=function(e,t){var s=c(e),i=l(e);e.parentNode.style["y"==e._dir?"height":"width"]=t+"px",i!=l(e)&&this.setValue(e,s.value)},this.init=function(t,s){var o=$WH.ce("a");o.href="javascript:;",o.onmousedown=e,o.className="handle";var r=$WH.ce("a");if(r.href="javascript:;",r.onmousedown=a.bind(0,o),r.className="track",$WH.ae(t,$WH.ce("span")),$WH.ae(t,r),$WH.ae(t,o),o._dir="x",o._min=1,o._max=100,o._pos=0,o._tsz=0,o._hsz=0,null!=s&&("y"==s.direction&&(o._dir="y"),s.minValue&&(o._min=s.minValue),s.maxValue&&(o._max=s.maxValue),s.onMove&&(o.onMove=s.onMove),s.trackSize&&(o._tsz=s.trackSize),s.handleSize&&(o._hsz=s.handleSize),!1!==s.showLabels)){var l=$WH.ce("div");l.innerHTML=o._min,l.className="label min",$WH.ae(t,l),l=$WH.ce("div"),l.innerHTML=o._max,l.className="label max",$WH.ae(t,l),o.input=$WH.ce("input"),$(o.input).attr({value:o._max,type:"text"}).bind("click",function(){this.select()}).keypress(function(e){var t=[],s=e.which;for(i=48;i<58;i++)t.push(i);$WH.in_array(t,s)>=0||13==s||e.preventDefault()}).bind("keyup keydown change",n.bind(0,o)),o.input.className="input",$WH.ae(t,o.input)}return t.className="slider-"+o._dir+(null==s||!1!==s.showLabels?" has-labels":""),o}},suDialog;Dialog.templates.docompare={title:LANG.dialog_compare,width:400,buttons:[["okay",LANG.ok],["cancel",LANG.cancel]],fields:[{id:"selecteditems",type:"caption",compute:function(e,t,s,i){i.innerHTML=$WH.sprintf(1==t?LANG.dialog_selecteditem:LANG.dialog_selecteditems,t)}},{id:"action",type:"radio",label:"",value:3,submitOnDblClick:1,options:{1:LANG.dialog_nosaveandview,2:LANG.dialog_saveandview,3:LANG.dialog_saveforlater}}]};var Favorites=new function(){function e(){var s="object"==typeof g_pageInfo&&"number"==typeof g_pageInfo.type&&"number"==typeof g_pageInfo.typeId?document.querySelector("#main-contents h1"):null;if(!s)return void("complete"!==document.readyState&&setTimeout(e,9));c=g_pageInfo.type,u=g_pageInfo.typeId,t(s)}function t(e){d=$("<span/>",{class:"fav-star",mouseout:$WH.Tooltip.hide}).appendTo(e),g_user.id?(d.addClass("fav-star"+(i(c,u)?"-1":"-0")).click(function(e,t,i){a(e,t,i),s(e,t),$WH.Tooltip.hide()}.bind(null,c,u,e.textContent.trim().replace(/(.+)<.*/,"$1"))),d.mouseover(function(e){var t=this.className.match(/\bfav-star-0\b/)?LANG.addtofavorites:LANG.removefromfavorites;$WH.Tooltip.show(this,t,!1,!1,"q2")})):d.addClass("fa-star-0").click(function(){location.href="?account=signin",$WH.Tooltip.hide()}).mouseover(function(e){$WH.Tooltip.show(this,LANG.favorites_login+"<div class='q2' style='margin-top:10px'>"+LANG.clicktologin+"</span>")})}function s(e,t){if(d){var s="fav-star-0",a="fav-star-1";i(e,t)||(s="fav-star-1",a="fav-star-0"),d.removeClass(s).addClass(a)}}function i(e,t){var s=r(e);if(-1==s)return!1;for(var i,a=0;i=g_favorites[s].entities[a];a++)if(i[0]==t)return!0;return!1}function a(e,t,s){i(e,t)?o(e,t):n(e,t,s)}function n(e,t,s){var i=r(e,!0);if(-1!=i){for(var a,n=0;a=g_favorites[i].entities[n];n++)if(a[0]==t)return void alert(LANG.favorites_duplicate.replace("%s",LANG.types[e][1]));l("add",e,t),g_favorites[i].entities.push([t,s]),Favorites.refreshMenu()}}function o(e,t){var s=r(e);if(-1!=s)for(var i,a=0;i=g_favorites[s].entities[a];a++)if(i[0]==t)return l("remove",e,t),g_favorites[s].entities.splice(a,1),g_favorites[s].entities.length||g_favorites.splice(s,1),void Favorites.refreshMenu()}function r(e,t){if(!LANG.types[e])return-1;for(var s,i=0;s=g_favorites[i];i++)if(s.id==e)return i;if(!t)return-1;for(g_favorites.push({id:e,entities:[]}),g_favorites.sort(function(e,t){return $WH.stringCompare(LANG.types[e.id],LANG.types[t.id])}),i=0;s=g_favorites[i];i++)if(s.id==e)return i;return-1}function l(e,t,s){var i={id:s};i[e]=t,$.post("?account=favorites",i)}var c=null,u=null,d=null;this.pageInit=function(e,s,i){if("string"==typeof e){if(!document.querySelector)return;e=document.querySelector(e)}e&&"number"==typeof s&&"number"==typeof i&&(c=s,u=i,t(e))},this.hasFavorites=function(){return!!g_favorites.length},this.getMenu=function(){for(var e,t=[],s=0,i=0,a=0;e=g_favorites[a];a++)if(e.entities.length){s++;for(var n,o=[],r=0;n=e.entities[r];r++)o.push([n[0],n[1],"?"+g_types[e.id]+"="+n[0]]),i++;Menu.sort(o),t.push([e.id,LANG.types[e.id][2],,o])}if(Menu.sort(t),1==s&&i<=45||2==s&&s+i<=30||s>2&&s+i<=15){for(var l=[],a=0;o=t[a];a++){l.push([,o[MENU_IDX_NAME]]);for(var c,r=0;c=o[MENU_IDX_SUB][r];r++){var u=[c[MENU_IDX_ID],c[MENU_IDX_NAME],c[MENU_IDX_URL]];c[MENU_IDX_OPT]&&(u[MENU_IDX_OPT]=c[MENU_IDX_OPT]),l.push(u)}}t=l}return t},this.refreshMenu=function(){var e=$("#toplinks-favorites");if(e.length){var t=Favorites.getMenu();if(!t.length)return void e.hide();Menu.add(e,t),e.show()}},document.querySelector&&$WH.localStorage.isSupported()&&e()};Tabs.prototype={add:function(e,t){var s,i=this.tabs.length;return s={caption:e,index:i,owner:this},$WH.cO(s,t),this.tabs.push(s),i},hide:function(e,t){if(this.tabs[e]){var s=this.selectedTab;if(0==e&&-1==s&&(this.poundedTab=this.selectedTab=s=0),e!=this.poundedTab&&(this.selectedTab=-1),this.tabs[e].hidden=!t,this.flush(),!t&&e==s){this.selectedTab=s;for(var i=0,a=this.tabs.length;i<a;++i)if(i!=e&&!this.tabs[i].hidden)return this.show(i,1)}}},unlock:function(e,t){if(this.tabs[e]){this.tabs[e].locked=t,s=$WH.gE(this.uls[0],"a"),$(".icon-lock",s[e]).remove(),t&&$("div, b",s[e]).prepend('<span class="icon-lock" />');var s=location.hash.substr(1).split(":")[0];this.tabs[e].id==s&&this.show(e,1)}},focus:function(e){e<0&&(e=this.tabs.length+e),this.forceScroll=1,$WH.gE(this.uls[0],"a")[e].onclick({},!0),this.forceScroll=null},show:function(e,t){var s;if(isNaN(e)||e<0?e=0:e>=this.tabs.length&&(e=this.tabs.length-1),!(null==t&&e==this.selectedTab||this.tabs[e].hidden)){if(this.tabs[e].locked)return this.onShow(this.tabs[e],this.tabs[this.selectedTab]);if(-1!=this.selectedTab){if(s=this.tabs[this.selectedTab],this.onHide&&!this.onHide(s))return;if(s.onHide&&!s.onHide())return}++this.nShows,s=$WH.gE(this.uls[0],"a"),-1!=this.selectedTab&&(s[this.selectedTab].className=""),s[e].className="selected",s=this.tabs[e],s.onLoad&&(s.onLoad(),s.onLoad=null),this.onShow(this.tabs[e],this.tabs[this.selectedTab]),s.onShow&&s.onShow(this.tabs[this.selectedTab]),this.selectedTab=e}},flush:function(e){var t,i,a,n,o,r=$WH.ce("div");r.className="tabs-container",this.uls[0]=$WH.ce("ul"),this.uls[0].className="tabs",o=$WH.ce("div"),o.className="tabs-levels",$WH.ae(r,this.uls[0]);for(var l=0;l<this.tabs.length;++l){var c=this.tabs[l];i=$WH.ce("li"),a=$WH.ce("a"),n=$WH.ce("b"),c.hidden&&(i.style.display="none"),this.poundable?a.href="#"+c.id:a.href="javascript:;",$WH.ns(a),a.onclick=Tabs.onClick.bind(c,a),o=$WH.ce("div"),c.locked?(s=$WH.ce("span"),s.className="icon-lock",$WH.ae(o,s)):c.icon&&(s=$WH.ce("span"),s.className="icontiny",s.style.backgroundImage="url("+g_staticDataUrl+"/images/wow/icons/tiny/"+c.icon.toLowerCase()+".gif)",$WH.ae(o,s)),c.tooltip&&(a.onmouseover=function(e,t){$WH.Tooltip.showAtCursor(t,e,0,0,"q")}.bind(a,c.tooltip),a.onmousemove=$WH.Tooltip.cursorUpdate,a.onmouseout=$WH.Tooltip.hide),c.class&&(o.className=c.class),$WH.ae(o,$WH.ct(c.caption)),$WH.ae(a,o),c.locked?(s=$WH.ce("span"),s.className="icon-lock",$WH.ae(n,s)):c.icon&&(s=$WH.ce("span"),s.className="icontiny",s.style.backgroundImage="url("+g_staticDataUrl+"/images/wow/icons/tiny/"+c.icon.toLowerCase()+".gif)",$WH.ae(n,s)),$WH.ae(n,$WH.ct(c.caption)),$WH.ae(a,n),$WH.ae(i,a),$WH.ae(this.uls[0],i)}$WH.ee(this.parent),$WH.ae(this.parent,r),this.onLoad&&null!=(t=this.onLoad())&&(this.poundedTab=e=t),this.show(e)},setTabName:function(e,t){this.tabs[e].caption=t,g_setTextNodes($WH.gE(this.uls[0],"a")[e],t)},setTabPound:function(e,t){if(this.poundable){$WH.gE(this.uls[0],"a")[e].href="#"+this.tabs[e].id+(t?":"+t:"")}},setTabTooltip:function(e,t){this.tabs[e].tooltip=t;var s=$WH.gE(this.uls[0],"a");null==t?s[e].onmouseover=s[e].onmousemove=s[e].onmouseout=null:(s[e].onmouseover=function(e){$WH.Tooltip.showAtCursor(e,t,0,0,"q2")},s[e].onmousemove=$WH.Tooltip.cursorUpdate,s[e].onmouseout=$WH.Tooltip.hide)},getSelectedTab:function(){return this.selectedTab}},Tabs.onClick=function(e,t,s){if(null!=s||this.index!=this.owner.selectedTab){var i=$WH.rf2(t);if(null!=i){if(this.owner.show(this.index,s),this.owner.poundable&&!this.locked){var a=e.href.indexOf("#");-1!=a&&location.replace(e.href.substr(a))}return i}}},Tabs.onLoad=function(){if(this.poundable&&location.hash.length){var e=location.hash.substr(1).split(":")[0];return e?$WH.in_array(this.tabs,e,function(e){if(!e.locked)return e.id}):void 0}},Tabs.onShow=function(e,t){var s;if(!e.hidden&&!e.locked&&(t&&($WH.ge("tab-"+t.id).style.display="none"),(null!=this.poundedTab||t)&&this.trackClick(e),s=$WH.ge("tab-"+e.id),s.style.display="",(1==this.nShows&&null!=this.poundedTab&&this.poundedTab>=0||this.forceScroll)&&!this.noScroll)){var i,a;this.__st?(i=this.__st,a=15):(i=s,a=this.parent.offsetHeight+15),setTimeout($WH.g_scrollTo.bind(null,i,a),10)}},Tabs.trackClick=function(e){this.trackable&&!e.tracked&&(g_trackEvent("Tabs","Show",this.trackable+": "+e.id),e.tracked=1)},$(document).ready(g_addAnalytics);var g_listviews={};Listview.MODE_DEFAULT=0,Listview.MODE_CHECKBOX=1,Listview.MODE_DIV=2,Listview.MODE_TILED=3,Listview.MODE_CALENDAR=4,Listview.MODE_FLEXGRID=5,Listview.prototype={initialize:function(){if(this.data.length&&null!=this.computeDataFunc)for(var e=0,t=this.data.length;e<t;++e)this.computeDataFunc(this.data[e]);this.tabs?(this.pounded=this.tabs.poundedTab==this.tabIndex,this.pounded&&this.readPound()):this.readPound(),this.applySort();var s;if(null!=this.onBeforeCreate)if("function"==typeof this.onBeforeCreate)s=this.onBeforeCreate();else for(var e=0;e<this.onBeforeCreate.length;++e)this.onBeforeCreate[e].bind(this)();if(this.noData=$WH.ce("div"),this.noData.className="listview-nodata text",this.mode==Listview.MODE_DIV)this.mainContainer=this.mainDiv=$WH.ce("div"),this.noStyle||(this.mainContainer.className="listview-mode-div");else if(this.mode==Listview.MODE_FLEXGRID){this.mainContainer=this.mainDiv=$WH.ce("div",{className:"listview-mode-flexgrid"}),this.mainContainer.setAttribute("data-cell-min-width",this.template.cellMinWidth),this.clickable&&(this.mainContainer.className+=" clickable");for(var i=$(".layout"),a=parseInt(i.css("max-width"))-(parseInt(i.css("padding-left"))||0)-(parseInt(i.css("padding-right"))||0),n=Math.floor(a/this.template.cellMinWidth),o='.listview-mode-flexgrid[data-cell-min-width="'+this.template.cellMinWidth+'"] > div {min-width:'+this.template.cellMinWidth+"px;width:"+100/n+"%}";n--;)n&&(o+="\n@media screen and (max-width: "+((n+1)*this.template.cellMinWidth-1+40)+"px) {",o+='\n    .listview-mode-flexgrid[data-cell-min-width="'+this.template.cellMinWidth+'"] > div {width:'+100/n+"%}",o+="\n}");$("<style/>").text(o).appendTo(document.head)}else{if(this.mainContainer=this.table=$WH.ce("table"),this.thead=$WH.ce("thead"),this.tbody=$WH.ce("tbody"),this.clickable&&(this.tbody.className="clickable"),this.mode==Listview.MODE_TILED||this.mode==Listview.MODE_CALENDAR){this.noStyle||(this.table.className="listview-mode-"+(this.mode==Listview.MODE_TILED?"tiled":"calendar"));for(var r,l=100/this.nItemsPerRow+"%",c=$WH.ce("colgroup"),e=0;e<this.nItemsPerRow;++e)r=$WH.ce("col"),r.style.width=l,$WH.ae(c,r);$WH.ae(this.mainContainer,c),this.sortOptions&&setTimeout(function(){this.updateSortArrow()}.bind(this),0)}else this.noStyle||(this.table.className="listview-mode-default"),this.createHeader(),this.updateSortArrow();$WH.ae(this.table,this.thead),$WH.ae(this.table,this.tbody)}this.createBands(),null!=this.customFilter&&this.updateFilters(),this.updateNav(),this.refreshRows(),this.updateBrowseSession(),null!=this.onAfterCreate&&this.onAfterCreate(s)},createHeader:function(){var e=$WH.ce("tr");if(this.mode==Listview.MODE_CHECKBOX){var t=$WH.ce("th"),s=$WH.ce("div"),i=$WH.ce("a");t.style.width="33px",i.href="javascript:;",i.className="listview-cb",$WH.ns(i),$WH.ae(i,$WH.ct(String.fromCharCode(160))),$WH.ae(s,i),$WH.ae(t,s),$WH.ae(e,t)}for(var a=0,n=this.visibility.length;a<n;++a){var o=this.visibility[a],r=this.columns[o],t=$WH.ce("th");s=$WH.ce("div"),i=$WH.ce("a"),outerSpan=$WH.ce("span"),innerSpan=$WH.ce("span"),r.__th=t,this.filtrable&&(null==r.filtrable||r.filtrable)?(i.onmouseup=Listview.headerClick.bind(this,r,o),i.onclick=i.oncontextmenu=$WH.rf):this.sortable&&(i.href="javascript:;",i.onclick=this.sortBy.bind(this,o+1)),i.onclick?(i.onmouseover=Listview.headerOver.bind(this,i,r),i.onmouseout=$WH.Tooltip.hide,$WH.ns(i)):i.className="static",null!=r.width&&(t.style.width=r.width),null!=r.align&&(t.style.textAlign=r.align),null!=r.span&&(t.colSpan=r.span),$WH.ae(innerSpan,$WH.ct(r.name)),$WH.ae(outerSpan,innerSpan),$WH.ae(i,outerSpan),$WH.ae(s,i),$WH.ae(t,s),$WH.ae(e,t)}this.hideHeader&&(this.thead.style.display="none"),$WH.ae(this.thead,e)},createSortOptions:function(e){if($.isArray(this.sortOptions)){var t=$WH.ce("div");t.className="listview-sort-options",t.innerHTML=LANG.lvnote_sort;var s=$WH.ce("span");s.className="listview-sort-options-choices";var i=null;$.isArray(this.sort)&&(i=this.sort[0]);for(var a,n=[],o=0;o<this.sortOptions.length;o++)this.sortOptions[o].hidden||(a=$WH.ce("a"),a.href="javascript:;",a.innerHTML=this.sortOptions[o].name,a.onclick=this.sortGallery.bind(this,a,o+1),i===o+1&&(a.className="active"),n.push(a));for(o=0;o<n.length;o++)$WH.ae(s,n[o]);$WH.ae(t,s),$WH.aef(e,t)}},sortGallery:function(e,t){var s=$(e);s.siblings("a").removeClass("active"),s.addClass("active"),this.sortBy(t)},createBands:function(){var e=$WH.ce("div"),t=$WH.ce("div"),s=$WH.ce("div"),i=$WH.ce("div");if(this.bandTop=e,this.bandBot=t,this.noteTop=s,this.noteBot=i,e.className="listview-band-top",t.className="listview-band-bottom",this.navTop=this.createNav(!0),this.navBot=this.createNav(!1),s.className=i.className="listview-note",this.note){s.innerHTML=this.note;var a=$WH.g_getGets();this.note.indexOf("fi_toggle()")>-1&&!a.filter&&fi_toggle()}else this.createNote&&this.createNote(s,i);if(this.createSortOptions(s),this.debug){$WH.ae(s,$WH.ct(" ("));var n=$WH.ce("a");n.onclick=this.getList.bind(this),$WH.ae(n,$WH.ct("CSV")),$WH.ae(s,n),$WH.ae(s,$WH.ct(")"))}if(this._errors){var o=$WH.ce("small"),r=$WH.ce("b");r.className="q10 icon-report",s.innerHTML&&(r.style.marginLeft="10px"),g_addTooltip(o,LANG.lvnote_witherrors,"q"),$WH.st(r,LANG.error),$WH.ae(o,r),$WH.ae(s,o)}if(s.firstChild||this.createCbControls||this.mode==Listview.MODE_CHECKBOX||$WH.ae(s,$WH.ct(String.fromCharCode(160))),this.createCbControls||this.mode==Listview.MODE_CHECKBOX||$WH.ae(i,$WH.ct(String.fromCharCode(160))),$WH.ae(e,this.navTop),this.searchable){var l=this.updateFilters.bind(this,!0),c=this._truncated?LANG.lvsearchdisplayedresults:LANG.lvsearchresults,o=$WH.ce("span"),u=$WH.ce("em"),d=$WH.ce("a"),p=$WH.ce("input");o.className="listview-quicksearch",this.tabClick&&$(o).click(this.tabClick),$WH.ae(o,u),d.href="javascript:;",d.onclick=function(){var e=this.nextSibling;e.value="",e.placeholder=c,l()},d.style.display="none",$WH.ae(d,$WH.ce("span")),$WH.ae(o,d),$WH.ns(d),p.setAttribute("type","text"),p.placeholder=c,p.style.width=this._truncated?"19em":"15em",g_onAfterTyping(p,l,this.searchDelay),p.onmouseover=function(){""!=$WH.trim(this.value)&&(this.className="")},p.onfocus=function(){this.className=""},p.onblur=function(){""==$WH.trim(this.value)&&(this.value="")},p.onkeypress=this.submitSearch.bind(this),$WH.ae(o,p),this.quickSearchBox=p,this.quickSearchGlass=u,this.quickSearchClear=d,$WH.ae(e,o)}if($WH.ae(e,s),$WH.ae(t,this.navBot),$WH.ae(t,i),(this.createCbControls||this.mode==Listview.MODE_CHECKBOX)&&(this.note&&(s.style.paddingBottom="5px"),this.cbBarTop=this.createCbBar(!0),this.cbBarBot=this.createCbBar(!1),$WH.ae(e,this.cbBarTop),$WH.ae(t,this.cbBarBot),this.noteTop.firstChild||this.cbBarTop.firstChild||(this.noteTop.innerHTML="&nbsp;"),this.noteBot.firstChild||this.cbBarBot.firstChild||(this.noteBot.innerHTML="&nbsp;"),this.noteTop.firstChild&&this.cbBarTop.firstChild&&(this.noteTop.style.paddingBottom="6px"),this.noteBot.firstChild&&this.cbBarBot.firstChild&&(this.noteBot.style.paddingBottom="6px")),1&this.hideBands&&(e.style.display="none"),2&this.hideBands&&(t.style.display="none"),$WH.ae(this.container,this.bandTop),this.clip){var h=$WH.ce("div");h.className="listview-clip",h.style.width=this.clip.w+"px",h.style.height=this.clip.h+"px",this.clipDiv=h,$WH.ae(h,this.mainContainer),$WH.ae(h,this.noData),$WH.ae(this.container,h)}else $WH.ae(this.container,this.mainContainer),$WH.ae(this.container,this.noData);$WH.ae(this.container,this.bandBot)},createNav:function(e){var t=$WH.ce("div"),s=$WH.ce("a"),i=$WH.ce("a"),a=$WH.ce("a"),n=$WH.ce("a"),o=$WH.ce("span"),r=$WH.ce("b"),l=$WH.ce("b"),c=$WH.ce("b");return t.className="listview-nav",s.href=i.href=a.href=n.href="javascript:;",$WH.ae(s,$WH.ct(String.fromCharCode(171)+LANG.lvpage_first)),$WH.ae(i,$WH.ct(String.fromCharCode(8249)+LANG.lvpage_previous)),$WH.ae(a,$WH.ct(LANG.lvpage_next+String.fromCharCode(8250))),$WH.ae(n,$WH.ct(LANG.lvpage_last+String.fromCharCode(187))),$WH.ns(s),$WH.ns(i),$WH.ns(a),$WH.ns(n),s.onclick=this.firstPage.bind(this),i.onclick=this.previousPage.bind(this),a.onclick=this.nextPage.bind(this),n.onclick=this.lastPage.bind(this),this.mode==Listview.MODE_CALENDAR?($WH.ae(r,$WH.ct("a")),$WH.ae(o,r)):($WH.ae(r,$WH.ct("a")),$WH.ae(l,$WH.ct("a")),$WH.ae(c,$WH.ct("a")),$WH.ae(o,r),$WH.ae(o,$WH.ct(LANG.hyphen)),$WH.ae(o,l),$WH.ae(o,$WH.ct(LANG.lvpage_of)),$WH.ae(o,c)),$WH.ae(t,s),$WH.ae(t,i),$WH.ae(t,o),$WH.ae(t,a),$WH.ae(t,n),e?1&this.hideNav&&(t.style.display="none"):2&this.hideNav&&(t.style.display="none"),this.tabClick&&$("a",t).click(this.tabClick),t},createCbBar:function(e){var t=$WH.ce("div");return this.createCbControls&&this.createCbControls(t,e),t.firstChild&&(t.className="listview-withselected"+(e?"":"2")),t},refreshRows:function(){var e=null;switch(this.mode){case Listview.MODE_DIV:e=this.mainContainer;break;case Listview.MODE_FLEXGRID:e=this.mainDiv;break;default:e=this.tbody}if(e){if($WH.ee(e),0==this.nRowsVisible)return this.filtered||(this.bandTop.style.display=this.bandBot.style.display="none",this.mainContainer.style.display="none"),this.noData.style.display="",void this.showNoData();var t,s;if(1&this.hideBands||(this.bandTop.style.display=""),2&this.hideBands||(this.bandBot.style.display=""),this.nDaysPerMonth&&this.nDaysPerMonth.length){t=0;for(var i=0;i<this.rowOffset;++i)t+=this.nDaysPerMonth[i];s=t+this.nDaysPerMonth[i]}else if(this.nItemsPerPage>0){if(t=this.rowOffset,s=Math.min(t+this.nRowsVisible,t+this.nItemsPerPage),this.filtered&&this.rowOffset>0){for(var i=0,a=0;i<this.data.length&&a<this.rowOffset;++i){var n=this.data[i];n.__hidden||n.__deleted?++t:++a}s+=t-this.rowOffset}}else t=0,s=this.nRowsVisible;var o=s-t;if(this.mode==Listview.MODE_DIV)for(var r=0;r<o;++r){var i=t+r,n=this.data[i];if(!n)break;n.__hidden||n.__deleted?++o:$WH.ae(this.mainDiv,this.getDiv(i))}else if(this.mode==Listview.MODE_FLEXGRID)for(var r=0;r<o;++r){var i=t+r,n=this.data[i];if(!n)break;n.__hidden||n.__deleted?++o:$WH.ae(this.mainDiv,this.getDiv(i))}else if(this.mode==Listview.MODE_TILED){for(var l=0,c=$WH.ce("tr"),r=0;r<o;++r){var i=t+r,n=this.data[i];if(!n)break;n.__hidden||n.__deleted?++o:($WH.ae(c,this.getCell(i)),++l==this.nItemsPerRow&&($WH.ae(this.tbody,c),r+1<o&&(c=$WH.ce("tr")),l=0))}if(0!=l){for(;l<4;++l){var u=$WH.ce("td");u.className="empty-cell",$WH.ae(c,u)}$WH.ae(this.tbody,c)}}else if(this.mode==Listview.MODE_CALENDAR){for(var c=$WH.ce("tr"),i=0;i<7;++i){var d=$WH.ce("th");$WH.st(d,LANG.date_days[i]),$WH.ae(c,d)}$WH.ae(this.tbody,c),c=$WH.ce("tr");for(var l=0;l<this.dates[t].date.getDay();++l){var u=$WH.ce("td");u.className="empty-cell",$WH.ae(c,u)}for(var r=t;r<s;++r)$WH.ae(c,this.getEvent(r)),7==++l&&($WH.ae(this.tbody,c),c=$WH.ce("tr"),l=0);if(0!=l){for(;l<7;++l){var u=$WH.ce("td");u.className="empty-cell",$WH.ae(c,u)}$WH.ae(this.tbody,c)}}else for(var r=0;r<o;++r){var i=t+r,n=this.data[i];if(!n)break;n.__hidden||n.__deleted?++o:$WH.ae(this.tbody,this.getRow(i))}this.mainContainer.style.display="",this.noData.style.display="none"}},showNoData:function(){var e=this.noData;$WH.ee(e);var t=-1;this.onNoData&&(t=this.onNoData.bind(this,e)()),-1==t&&$WH.ae(this.noData,$WH.ct(this.filtered?LANG.lvnodata2:LANG.lvnodata))},getDiv:function(e){var t=this.data[e];return null!=t.__div&&this.minPatchVersion==t.__minPatch||this.createDiv(t,e),t.__div},createDiv:function(e,t){var s=$WH.ce("div");e.__div=s,this.minPatchVersion&&(e.__minPatch=this.minPatchVersion),this.template.compute.bind(this,e,s,t)()},getCell:function(e){var t=this.data[e];return null==t.__td&&this.createCell(t,e),t.__td},createCell:function(e,t){var s=$WH.ce("td");e.__td=s,this.template.compute.bind(this,e,s,t)()},getEvent:function(e){var t=this.dates[e];return null==t.__td&&this.createEvent(t,e),t.__td},createEvent:function(e,t){e.events=$WH.array_filter(this.data,function(t){if(t.__hidden||t.__deleted)return!1;var s=Listview.funcBox.getEventNextDates(t.startDate,t.endDate,t.rec||0,e.date);return!(!s[0]||!s[1])&&(s[0].setHours(0,0,0,0),s[1].setHours(0,0,0,0),s[0]<=e.date&&s[1]>=e.date)});var s=$WH.ce("td");e.__td=s,e.date.getFullYear()==g_serverTime.getFullYear()&&e.date.getMonth()==g_serverTime.getMonth()&&e.date.getDate()==g_serverTime.getDate()&&(s.className="calendar-today");var i=$WH.ce("div");i.className="calendar-date",$WH.st(i,e.date.getDate()),$WH.ae(s,i),i=$WH.ce("div"),i.className="calendar-event",$WH.ae(s,i),this.template.compute.bind(this,e,i,t)(),this.getItemLink&&(s.onclick=this.itemClick.bind(this,e))},getRow:function(e){var t=this.data[e];return null==t.__tr&&this.createRow(t),t.__tr},setRow:function(e){this.data[e.pos]&&(this.data[e.pos]=e,this.data[e.pos].__tr=e.__tr,this.createRow(this.data[e.pos]),this.refreshRows())},createRow:function(e){var t=$WH.ce("tr");if(e.__tr=t,this.mode==Listview.MODE_CHECKBOX){var s=$WH.ce("td");if(!e.__nochk){s.className="listview-cb",s.onclick=Listview.cbCellClick;var i=$WH.ce("input");$WH.ns(i),i.type="checkbox",i.onclick=Listview.cbClick,e.__chk&&(i.checked=!0),e.__cb=i,$WH.ae(s,i)}$WH.ae(t,s)}for(var a=0,n=this.visibility.length;a<n;++a){var o,r=this.visibility[a],l=this.columns[r],s=$WH.ce("td");null!=l.align&&(s.style.textAlign=l.align),o=l.compute?l.compute.bind(this,e,s,t,r)():null!=e[l.value]?e[l.value]:-1,-1!=o&&null!=o&&s.insertBefore($WH.ct(o),s.firstChild),$WH.ae(t,s)}this.mode==Listview.MODE_CHECKBOX&&e.__chk&&(t.className="checked"),1==e.frommerge&&(t.className+=" mergerow"),this.getItemLink&&(t.onclick=this.itemClick.bind(this,e))},itemClick:function(e,t){t=$WH.$E(t);for(var s=t._target;s;){if("A"==s.nodeName)return;s=s.parentNode}location.href=this.getItemLink(e)},submitSearch:function(e){if(e=$WH.$E(e),this.onSearchSubmit&&13==e.keyCode)for(var t=0,s=this.data.length;t<s;++t)this.data[t].__hidden||this.onSearchSubmit.bind(this,this.data[t])()},validatePage:function(){var e=this.nItemsPerPage,t=this.rowOffset,s=this.nRowsVisible;t<0?this.rowOffset=0:this.mode==Listview.MODE_CALENDAR?this.rowOffset=Math.min(t,this.nDaysPerMonth.length-1):this.rowOffset=this.getRowOffset(t+e>s?s-1:t)},getRowOffset:function(e){var t=this.nItemsPerPage;return t>0&&e>0?Math.floor(e/t)*t:0},resetRowVisibility:function(){for(var e=0,t=this.data.length;e<t;++e)this.data[e].__hidden=!1;this.filtered=!1,this.rowOffset=0,this.nRowsVisible=this.data.length},getColText:function(e,t){var s="";return this.template.getVisibleText&&(s=$WH.trim(this.template.getVisibleText(e)+" ")),t.getVisibleText?s+t.getVisibleText(e):t.getValue?s+t.getValue(e):t.value?s+e[t.value]:t.compute?s+t.compute(e,$WH.ce("td"),$WH.ce("tr")):""},resetFilters:function(){for(var e=0,t=this.visibility.length;e<t;++e){var s=this.visibility[e],i=this.columns[s];i.__filter&&(i.__th.firstChild.firstChild.className="",i.__filter=null,--this.nFilters)}},updateFilters:function(e){$WH.Tooltip.hide(),this.resetRowVisibility();var t,s,i;if(this.searchable?(this.quickSearchBox.parentNode.style.display="",t=$WH.trim(this.quickSearchBox.value),t?(this.quickSearchGlass.style.display="none",this.quickSearchClear.style.display="",t=t.toLowerCase().replace(/\s+/g," "),s=t.split(" "),i=s.length):(this.quickSearchGlass.style.display="",this.quickSearchClear.style.display="none")):this.quickSearchBox&&(this.quickSearchBox.parentNode.style.display="none"),!t&&0==this.nFilters&&null==this.customFilter)return void(e&&(this.updateNav(),this.refreshRows(),this.updateBrowseSession()));for(var a={1:function(e,t){return e>t},2:function(e,t){return e==t},3:function(e,t){return e<t},4:function(e,t){return e>=t},5:function(e,t){return e<=t},6:function(e,t,s){return t<=e&&e<=s}},n={1:function(e,t,s){return t>s},2:function(e,t,s){return e<=s&&s<=t},3:function(e,t,s){return e<s},4:function(e,t,s){return t>=s},5:function(e,t,s){return e<=s},6:function(e,t,s,i){return s<=t&&e<=i}},o=0,r=0,l=this.data.length;r<l;++r){var c=this.data[r],u=0,d=0,p=[];if(c.__hidden=!0,!this.customFilter||this.customFilter(c,r)){for(var h=0,m=this.visibility.length;h<m;++h){var f=this.visibility[h],g=this.columns[f];if(g.__filter){var v=g.__filter,$=!1;if(null!=g.type&&"range"==g.type){var _=g.getMinValue(c),H=g.getMaxValue(c);$=n[v.type](_,H,v.value,v.value2)}else if(null==g.type||"num"==g.type||v.type>0){var W=null;g.getValue?W=g.getValue(c):g.value&&(W=parseFloat(c[g.value])),W||(W=0),$=a[v.type](W,v.value,v.value2)}else{var y=this.getColText(c,g);if(y)if(y=y.toString().toLowerCase(),v.invert)$=null!=y.match(v.regex);else{for(var b=0,w=0,N=v.words.length;w<N&&-1!=y.indexOf(v.words[w]);++w)++b;$=b==v.words.length}}if(v.invert&&($=!$),!$)break;++u}if(t){var y=this.getColText(c,g);if(y){y=y.toString().toLowerCase();for(var w=0,N=s.length;w<N;++w)p[w]||-1!=y.indexOf(s[w])&&(p[w]=1,++d)}}}!c.__alwaysvisible&&(0!=this.nFilters&&u!=this.nFilters||t&&d!=i)||(c.__hidden=!1,++o)}}this.filtered=o<this.data.length,this.nRowsVisible=o,e&&(this.updateNav(),this.refreshRows(),this.updateBrowseSession())},changePage:function(){this.validatePage(),this.refreshRows(),this.updateNav(),this.updatePound(),this.updateBrowseSession();var e=$WH.g_getScroll(),t=$WH.ac(this.container);e.y>t[1]&&scrollTo(e.x,t[1])},firstPage:function(){return this.rowOffset=0,this.changePage(),!1},previousPage:function(){return this.rowOffset-=this.nItemsPerPage,this.changePage(),!1},nextPage:function(){return this.rowOffset+=this.nItemsPerPage,this.changePage(),!1},lastPage:function(){return this.rowOffset=99999999,this.changePage(),!1},addSort:function(e,t){var s=$WH.in_array(e,Math.abs(t),function(e){return Math.abs(e)});-1!=s&&(t=e[s],e.splice(s,1)),e.splice(0,0,t)},sortBy:function(e){var t=this.sortOptions||this.columns;if(!(e<=0||e>t.length)){if(Math.abs(this.sort[0])==e)this.sort[0]=-this.sort[0];else{var s=-1;"text"==t[e-1].type&&(s=1),this.addSort(this.sort,s*e)}this.applySort(),this.refreshRows(),this.updateSortArrow(),this.updatePound()}},applySort:function(){0!=this.sort.length&&(Listview.sort=this.sort,Listview.columns=this.columns,Listview.sortOptions=this.sortOptions,this.indexCreated?this.data.sort(Listview.sortIndexedRows.bind(this)):this.data.sort(Listview.sortRows.bind(this)),this.updateSortIndex(),this.updateBrowseSession())},setSort:function(e,t,s){this.sort.toString()!=e.toString()&&(this.sort=e,this.applySort(),t&&this.refreshRows(),s&&this.updatePound())},readPound:function(){if(!this.poundable||!location.hash.length)return!1;var e=location.hash.substr(1);if(this.tabs){var t=e.lastIndexOf(":");if(-1==t)return!1;e=e.substr(t+1)}var s=parseInt(e);if(!isNaN(s)){if(this.rowOffset=s,this.validatePage(),2!=this.poundable){var i=[],a=e.match(/(\+|\-)[0-9]+/g);if(null!=a){for(var n=this.sortOptions||this.columns,o=a.length-1;o>=0;--o){var r=0|parseInt(a[o]),e=Math.abs(r);if(e<=0||e>n.length)break;this.addSort(i,r)}this.setSort(i,!1,!1)}}this.tabs&&this.tabs.setTabPound(this.tabIndex,this.getTabPound())}},updateBrowseSession:function(){
if(window.JSON&&$WH.localStorage.isSupported()&&("undefined"!=typeof fi_filters||/\?search/.test(location.search))&&!(this.data.length<3)&&"function"==typeof this.getItemLink){var e=location.pathname+location.search,t=new Date(g_serverTime.getTime()-2592e5).getTime(),s=$WH.localStorage.get("lvBrowse");if(s){s=window.JSON.parse(s);for(var i=0;i<s.length;i++)(s[i].path==e||s[i].when<t)&&s.splice(i--,1);s.length>=5&&s.splice(4,s.length-5-1)}else s=[];for(var a,n=[],o=/^\?[-a-z]+=\d+/i,i=0;i<this.data.length;i++)(a=o.exec(this.getItemLink(this.data[i])))&&n.push(a[0]);n.length<3||(s.unshift({path:e,hash:location.hash,when:g_serverTime.getTime(),urls:n}),$WH.localStorage.set("lvBrowse",window.JSON.stringify(s)))}},updateSortArrow:function(){if(this.sort.length&&this.thead&&this.mode!=Listview.MODE_CALENDAR){var e=$WH.in_array(this.visibility,Math.abs(this.sort[0])-1);if(-1!=e){if(this.mode==Listview.MODE_TILED){if(!this.sortOptions)return;var t=$(".listview-sort-options a",this.noteTop).get(e);return this.lsa&&this.lsa!=t&&(this.lsa.className=""),t.className=this.sort[0]<0?"active sortdesc":"active sortasc",void(this.lsa=t)}this.mode==Listview.MODE_CHECKBOX&&e<this.thead.firstChild.childNodes.length-1&&(e+=1);var s=this.thead.firstChild.childNodes[e].firstChild.firstChild.firstChild;this.lsa&&this.lsa!=s&&(this.lsa.className=""),s.className=this.sort[0]<0?"sortdesc":"sortasc",this.lsa=s}}},updateSortIndex:function(){for(var e=this.data,t=0,s=e.length;t<s;++t)e[t].__si=t;this.indexCreated=!0},updateTabName:function(){this.tabs&&null!=this.tabIndex&&this.tabs.setTabName(this.tabIndex,this.getTabName())},updatePound:function(e){if(this.poundable){var t="",s="";if(e){if(location.hash.length&&this.tabs){var i=location.hash.lastIndexOf(":");-1==i||isNaN(parseInt(location.hash.substr(i+1)))||(t=location.hash.substr(i+1))}}else t=this.getTabPound();this.customPound?s=this.customPound:this.tabs&&(s=this.id),t&&this.tabs&&this.tabs.setTabPound(this.tabIndex,t),location.replace("#"+s+(s&&t?":":"")+t)}},updateNav:function(){var e=[this.navTop,this.navBot],t=this.nItemsPerPage,s=this.rowOffset,i=this.nRowsVisible,a=0,n=0,o=0,r=0,l=new Date;if(i>0?(1&this.hideNav||(e[0].style.display=""),2&this.hideNav||(e[1].style.display="")):e[0].style.display=e[1].style.display="none",this.mode==Listview.MODE_CALENDAR){for(var c=0;c<this.nDaysPerMonth.length;++c)c==s&&(c>0&&(n=1),c>1&&(a=1),c<this.nDaysPerMonth.length-1&&(o=1),c<this.nDaysPerMonth.length-2&&(r=1));l.setTime(this.startOnMonth.valueOf()),l.setMonth(l.getMonth()+s)}else t&&(s>0&&(n=1,s>=t+t&&(a=1)),s+t<i&&(o=1,s+t+t<i&&(r=1)));for(var c=0;c<2;++c){var u=e[c].childNodes;u[0].style.display=a?"":"none",u[1].style.display=n?"":"none",u[3].style.display=o?"":"none",u[4].style.display=r?"":"none",u=u[2].childNodes,this.mode==Listview.MODE_CALENDAR?u[0].firstChild.nodeValue=LANG.date_months[l.getMonth()]+" "+l.getFullYear():(u[0].firstChild.nodeValue=s+1,u[2].firstChild.nodeValue=t?Math.min(s+t,i):i,u[4].firstChild.nodeValue=i)}},getTabName:function(){for(var e=this.name,t=this.data.length,s=0,i=this.data.length;s<i;++s)(this.data[s].__hidden||this.data[s].__deleted)&&--t;return t>0&&!this.hideCount&&(e+=$WH.sprintf(LANG.qty,t)),e},getTabPound:function(){var e="";return e+=this.rowOffset,2!=this.poundable&&this.sort.length&&(e+=("+"+this.sort.join("+")).replace(/\+\-/g,"-")),e},getCheckedRows:function(){for(var e=[],t=0,s=this.data.length;t<s;++t){var i=this.data[t];(i.__cb&&i.__cb.checked||!i.__cb&&i.__chk)&&e.push(i)}return e},resetCheckedRows:function(){for(var e=0,t=this.data.length;e<t;++e){var s=this.data[e];s.__cb?s.__cb.checked=!1:s.__chk&&(s.__chk=null),s.__tr&&(s.__tr.className=s.__tr.className.replace("checked",""))}},deleteRows:function(e){if(e&&e.length){for(var t=0,s=e.length;t<s;++t){var i=e[t];i.__hidden||i.__hidden||(this.nRowsVisible-=1),i.__deleted=!0}this.updateTabName(),this.rowOffset>=this.nRowsVisible?this.previousPage():(this.refreshRows(),this.updateNav(),this.updateBrowseSession())}},setData:function(e){this.data=e,this.indexCreated=!1,this.resetCheckedRows(),this.resetRowVisibility(),this.tabs?(this.pounded=this.tabs.poundedTab==this.tabIndex,this.pounded&&this.readPound()):this.readPound(),this.applySort(),this.updateSortArrow(),null!=this.customFilter&&this.updateFilters(),this.updateNav(),this.refreshRows(),this.updateBrowseSession()},getClipDiv:function(){return this.clipDiv},getNoteTopDiv:function(){return this.noteTop},focusSearch:function(){this.quickSearchBox.focus()},clearSearch:function(){this.quickSearchBox.value=""},getList:function(){if(this.debug){for(var e="",t=0;t<this.data.length;t++)this.data[t].__hidden||(e+=this.data[t].id+", ");listviewIdList.show(e)}},createIndicator:function(e,t,s){this.noteIndicators||(this.noteIndicators=$WH.ce("div"),this.noteIndicators.className="listview-indicators",$(this.noteIndicators).insertBefore($(this.noteTop)));var i=this.tabClick;$(this.noteIndicators).append($('<span class="indicator"></span>').html(e).append(t?$('<a class="indicator-x" style="outline: none">[x]</a>').attr("href","function"==typeof t?"javascript:;":t).click(function(){i&&i(),"function"==typeof t&&t()}):"").css("cursor","function"==typeof s?"pointer":null).click(function(){i&&i(),"function"==typeof s&&s()})),$(this.noteTop).css("padding-top","7px")},removeIndicators:function(){this.noteIndicators&&($(this.noteIndicators).remove(),this.noteIndicators=null),$(this.noteTop).css("padding-top","")}},Listview.sortRows=function(e,t){for(var s=Listview.sort,i=Listview.columns,a=0,n=s.length;a<n;++a){var o,r=i[Math.abs(s[a])-1];if(r||(r=this.template),0!=(o=r.sortFunc?r.sortFunc(e,t,s[a]):$WH.strcmp(e[r.value],t[r.value])))return o*s[a]}return 0},Listview.sortIndexedRows=function(e,t){var s,i=Listview.sort,a=Listview.sortOptions||Listview.columns;for(var n in i)if(_=a[Math.abs(i[n])-1],_||(_=this.template),0!=(s=_.sortFunc?_.sortFunc(e,t,i[0]):$WH.strcmp(e[_.value],t[_.value])))return s*i[n];return e.__si-t.__si},Listview.cbSelect=function(e){for(var t=0,s=this.data.length;t<s;++t){var i=this.data[t],a=e;if(!i.__hidden){if(!i.__nochk&&i.__cb){var n=i.__cb,o=n.parentNode.parentNode;null==a&&(a=!n.checked),n.checked!=a&&(n.checked=a,o.className=n.checked?o.className+" checked":o.className.replace("checked",""))}else null==a&&(a=!0);i.__chk=a}}},Listview.cbClick=function(e){setTimeout(Listview.cbUpdate.bind(0,0,this,this.parentNode.parentNode),1),$WH.sp(e)},Listview.cbCellClick=function(e){setTimeout(Listview.cbUpdate.bind(0,1,this.firstChild,this.parentNode),1),$WH.sp(e)},Listview.cbUpdate=function(e,t,s){e&&(t.checked=!t.checked),s.className=t.checked?s.className+" checked":s.className.replace("checked","")},Listview.headerClick=function(e,t,s){return s=$WH.$E(s),this.tabClick&&this.tabClick(),3==s._button||s.shiftKey||s.ctrlKey?($WH.Tooltip.hide(),setTimeout(Listview.headerFilter.bind(this,e,null),1)):this.sortBy(t+1),!1},Listview.headerFilter=function(e,t){var s="";if(e.__filter&&(e.__filter.invert&&(s+="!"),s+=e.__filter.text),null==t)var t=prompt($WH.sprintf(LANG.prompt_colfilter1+("text"==e.type?LANG.prompt_colfilter2:LANG.prompt_colfilter3),e.name),s);if(null!=t){var i={text:"",type:-1};if(!(t=$WH.trim(t.replace(/\s+/g," ")))&&this.onEmptyFilter)this.onEmptyFilter(e);else if(t){"!"!=t.charAt(0)&&"-"!=t.charAt(0)||(i.invert=1,t=t.substr(1)),"text"==e.type&&(i.type=0,i.text=t,i.invert?i.regex=g_createOrRegex(t):i.words=t.toLowerCase().split(" "));var a,n;if(t.match(/(>|=|<|>=|<=)\s*([0-9\.]+)/)){if(a=parseFloat(RegExp.$2),!isNaN(a)){switch(RegExp.$1){case">":i.type=1;break;case"=":i.type=2;break;case"<":i.type=3;break;case">=":i.type=4;break;case"<=":i.type=5}i.value=a,i.text=RegExp.$1+" "+a}}else if(t.match(/([0-9\.]+)\s*\-\s*([0-9\.]+)/)){if(a=parseFloat(RegExp.$1),n=parseFloat(RegExp.$2),!isNaN(a)&&!isNaN(n)){if(a>n){var o=a;a=n,n=o}a==n?(i.type=2,i.value=a,i.text="= "+a):(i.type=6,i.value=a,i.value2=n,i.text=a+" - "+n)}}else{var r=t.toLowerCase().split(" ");e.allText||1!=r.length||isNaN(a=parseFloat(r[0]))?"text"==e.type&&(i.type=0,i.text=t,i.invert?i.regex=g_createOrRegex(t):i.words=r):(i.type=2,i.value=a,i.text="= "+a)}if(-1==i.type)return void alert(LANG.message_invalidfilter)}if(!e.__filter||i.text!=e.__filter.text||i.invert!=e.__filter.invert){var l=e.__th.firstChild.firstChild;t&&i.text?(e.__filter||(l.className="q5",++this.nFilters),e.__filter=i):(e.__filter&&(l.className="",--this.nFilters),e.__filter=null),this.updateFilters(1)}}},Listview.headerOver=function(e,t,s){var i="";i+='<b class="q1">'+(t.tooltip?t.tooltip:t.name)+"</b>",t.__filter&&(i+="<br />"+$WH.sprintf(t.__filter.invert?LANG.tooltip_colfilter2:LANG.tooltip_colfilter1,t.__filter.text)),i+='<br /><span class="q2">'+LANG.tooltip_lvheader1+"</span>",this.filtrable&&(null==t.filtrable||t.filtrable)&&(i+='<br /><span class="q2">'+($WH.Browser.opera?LANG.tooltip_lvheader3:LANG.tooltip_lvheader2)+"</span>"),$WH.Tooltip.show(e,i,0,0,"q")},Listview.extraCols={id:{id:"id",name:"ID",width:"5%",value:"id",compute:function(e,t){e.id&&$WH.ae(t,$WH.ct(e.id))}},date:{id:"obj-date",name:LANG.added,compute:function(e,t){if(e.date){if(!(e.date<=86400)){var s=new Date(1e3*e.date);return g_formatDate(t,(g_serverTime-s)/1e3,s,null,!0)}$WH.ae(t,$WH.ct("???"))}},sortFunc:function(e,t,s){return e.date==t.date?0:e.date<t.date?-1:1}},cost:{id:"cost",name:LANG.cost,getValue:function(e){if(e.cost)return(e.cost[2]&&e.cost[2][0]?e.cost[2][0][1]:0)||(e.cost[1]&&e.cost[1][0]?e.cost[1][0][1]:0)||e.cost[0]},compute:function(e,t){if(e.cost){var s=e.cost[0],i=null,a=e.cost[2],n=e.cost[1];null!=e.side?i=e.side:null!=e.react&&(1==e.react[0]&&-1==e.react[1]?i=1:-1==e.react[0]&&1==e.react[1]&&(i=2)),Listview.funcBox.appendMoney(t,s,i,a,n)}},sortFunc:function(e,t,s){if(null==e.cost)return-1;if(null==t.cost)return 1;var i=0,a=0,n=0,o=0;return null!=e.cost[2]&&$WH.array_walk(e.cost[2],function(e,t,s,a){i+=Math.pow(10,a)+e[1]}),null!=t.cost[2]&&$WH.array_walk(t.cost[2],function(e,t,s,i){a+=Math.pow(10,i)+e[1]}),null!=e.cost[1]&&$WH.array_walk(e.cost[1],function(e,t,s,i){n+=Math.pow(10,i)+e[1]}),null!=t.cost[1]&&$WH.array_walk(t.cost[1],function(e,t,s,i){o+=Math.pow(10,i)+e[1]}),$WH.strcmp(i,a)||$WH.strcmp(n,o)||$WH.strcmp(e.cost[0],t.cost[0])}},count:{id:"count",name:LANG.count,value:"count",compute:function(e,t){if(this._totalCount>0||e.outof>0){if(e.outof){var s=$WH.ce("div");s.className="small q0",$WH.ae(s,$WH.ct($WH.sprintf(LANG.lvdrop_outof,e.outof))),$WH.ae(t,s)}return e.count}},getVisibleText:function(e){var t=e.count;return e.outof&&(t+=" "+e.outof),t},sortFunc:function(e,t,s){return null==e.count?-1:null==t.count?1:$WH.strcmp(e.count,t.count)}},percent:{id:"percent",name:"%",value:"percent",compute:function(row,td){if(row.count<=0)return"??";if(row.pctstack){var text="",data=eval("("+row.pctstack+")");for(var amt in data){var pct=data[amt]*row.percent/100;pct=pct>=1.95?parseFloat(pct.toFixed(0)):pct>=.195?parseFloat(pct.toFixed(1)):parseFloat(pct.toFixed(2)),text+=$WH.sprintf(LANG.stackof_format,amt,pct)+"<br />"}td.className+=" tip",g_addTooltip(td,text)}var value=parseFloat(row.percent.toFixed(row.percent>=1.95?1:2));if(!row.pctstack)return value;var sp=$WH.ce("span");sp.className+=" tip",$WH.ae(sp,$WH.ct(value)),$WH.ae(td,sp)},getVisibleText:function(e){return e.count<=0?"??":e.percent>=1.95?e.percent.toFixed(1):parseFloat(e.percent.toFixed(2))},sortFunc:function(e,t,s){if(null==e.count)return-1;if(null==t.count)return 1;if(e.percent>=1.95)var i=e.percent.toFixed(0);else i=e.percent>=.195?parseFloat(e.percent.toFixed(1)):parseFloat(e.percent.toFixed(2));if(t.percent>=1.95)var a=t.percent.toFixed(0);else a=t.percent>=.195?parseFloat(t.percent.toFixed(1)):parseFloat(t.percent.toFixed(2));return $WH.strcmp(i,a)}},stock:{id:"stock",name:LANG.stock,width:"10%",value:"stock",compute:function(e,t){return e.stock>0?e.stock:(t.style.fontFamily="Verdana, sans-serif",String.fromCharCode(8734))},getVisibleText:function(e){return e.stock>0?e.stock:String.fromCharCode(8734)+" infinity"}},currency:{id:"currency",name:LANG.currency,getValue:function(e){if(e.currency)return e.currency[0]?e.currency[0][1]:0},compute:function(e,t){if(e.currency){var s=null;null!=e.side?s=e.side:null!=e.react&&(1==e.react[0]&&-1==e.react[1]?s=1:-1==e.react[0]&&1==e.react[1]&&(s=2)),Listview.funcBox.appendMoney(t,null,s,null,e.currency)}},sortFunc:function(e,t,s){if(null==e.currency)return-1;if(null==t.currency)return 1;var i=0,a=0;return $WH.array_walk(e.currency,function(e,t,s,a){i+=Math.pow(10,a)+e[1]}),$WH.array_walk(t.currency,function(e,t,s,i){a+=Math.pow(10,i)+e[1]}),$WH.strcmp(i,a)}},mode:{id:"mode",name:"Mode",after:"name",type:"text",compute:function(e,t){if(e.modes&&e.modes.mode)return 120==(120&e.modes.mode)||3==(3&e.modes.mode)?LANG.pr_note_all:Listview.extraCols.mode.getVisibleText(e)},getVisibleText:function(e){var t,s=!!(26&e.modes.mode),i=!!(97&e.modes.mode),a=!!(40&e.modes.mode),n=!!(80&e.modes.mode);a&&!n?t=10:n&&!a&&(t=25);var o;return s&&!i?o="normal":i&&!s&&(o="heroic"),o?t?$WH.sprintf(LANG["tab_"+o+"X"],t):LANG["tab_"+o]:t?$WH.sprintf(LANG.lvzone_xman,t):LANG.pr_note_all},sortFunc:function(e,t,s){if(e.modes&&t.modes)return-$WH.strcmp(e.modes.mode,t.modes.mode)}},requires:{id:"requires",name:LANG.requires,type:"text",compute:function(e,t){if(e.achievement&&g_achievements[e.achievement]){$WH.nw(t),t.className="small",t.style.lineHeight="18px";var s=$WH.ce("a");s.href="?achievement="+e.achievement,s.className="icontiny tinyspecial",s.style.backgroundImage="url("+g_staticDataUrl+"/images/wow/icons/tiny/"+g_achievements[e.achievement].icon.toLowerCase()+".gif)",s.style.whiteSpace="nowrap",$WH.st(s,g_achievements[e.achievement]["name_"+Locale.getName()]),$WH.ae(t,s)}},getVisibleText:function(e){if(e.achievement&&g_achievements[e.achievement])return g_achievements[e.achievement].name},sortFunc:function(e,t,s){return $WH.strcmp(this.getVisibleText(e),this.getVisibleText(t))}},reqskill:{id:"reqskill",name:LANG.skill,width:"10%",value:"reqskill",before:"yield"},yield:{id:"yield",name:LANG.yields,type:"text",align:"left",span:2,value:"name",compute:function(e,t,s){if(e.yield&&g_items[e.yield]){var i=$WH.ce("td");i.style.width="1px",i.style.padding="0",i.style.borderRight="none",$WH.ae(i,g_items.createIcon(e.yield,1)),$WH.ae(s,i),t.style.borderLeft="none";var a=$WH.ce("div"),n=$WH.ce("a");n.style.fontFamily="Verdana, sans-serif",n.href="?item="+e.yield,n.className="q"+g_items[e.yield].quality,$WH.ae(n,$WH.ct(g_items[e.yield]["name_"+Locale.getName()])),$WH.ae(a,n),$WH.ae(t,a)}},getVisibleText:function(e){if(e.yield&&g_items[e.yield])return g_items[e.yield]["name_"+Locale.getName()]},sortFunc:function(e,t,s){return e.yield&&g_items[e.yield]&&t.yield&&g_items[t.yield]?-$WH.strcmp(g_items[e.yield].quality,g_items[t.yield].quality)||$WH.strcmp(g_items[e.yield]["name_"+Locale.getName()],g_items[t.yield]["name_"+Locale.getName()]):e.yield&&g_items[e.yield]?1:t.yield&&g_items[t.yield]?-1:0}},condition:{id:"condition",name:LANG.requires,type:"text",width:"25%",compute:function(e,t){if(e.condition){t.className="small",t.style.lineHeight="18px";var s=ConditionList.createCell(e.condition);Markup.printHtml(s,t)}},getVisibleText:function(e){var t;return e.condition?(t=ConditionList.createCell(e.condition),Markup.removeTags(t)):""},sortFunc:function(e,t,s){var i=this.getVisibleText(e),a=this.getVisibleText(t);return""!=i&&""==a?-1:""!=a&&""==i?1:$WH.strcmp(i,a)}}},Listview.funcBox={createSimpleCol:function(e,t,s,i){return{id:e,name:void 0!==LANG[t]?LANG[t]:t,width:s,value:i}},initLootTable:function(e){var t;t=null!=this._totalCount?this._totalCount:e.outof,0==t?-1!=e.count?e.percent=e.count:e.percent=0:e.percent=e.count/t*100,Listview.funcBox.initModeFilter.bind(this,e)()},initModeFilter:function(e){if(null==this._lootModes&&(this._lootModes={99:0}),null==this._distinctModes&&(this._distinctModes={99:0}),e.modes&&4!=e.modes.mode||12==e.classs||!e.commondrop){if(e.modes){for(var t=-2;t<=5;++t)null==this._lootModes[t]&&(this._lootModes[t]=0),e.modes.mode&1<<parseInt(t)+2&&this._lootModes[t]++;null==this._distinctModes[e.modes.mode]&&(this._distinctModes[e.modes.mode]=0),this._distinctModes[e.modes.mode]++}}else this._lootModes[99]++,this._distinctModes[99]++},addModeIndicator:function(){var e=0;for(var t in this._distinctModes)this._distinctModes[t]&&e++;if(!(e<2)){var s,i=location.hash.match(/:mode=([^:]+)/),a=[0,-1,-2,1,3,2,4,5,99],n={"-2":LANG.tab_heroic,"-1":LANG.tab_normal,0:LANG.tab_noteworthy,1:$WH.sprintf(LANG.tab_normalX,10),2:$WH.sprintf(LANG.tab_normalX,25),3:$WH.sprintf(LANG.tab_heroicX,10),4:$WH.sprintf(LANG.tab_heroicX,25),5:LANG.tab_raidfinder,99:""},o=function(e,t,s){g_setSelectedLink(this,"lootmode"),r.customPound=r.id+(null!=t?":mode="+g_urlize(n[t].replace(" ","")):""),r.customFilter=function(t){return Listview.funcBox.filterMode(t,r._totalCount,e)},r.updateFilters(1),r.applySort(),r.refreshRows(),s&&r.updatePound(1)},r=this,l=[];s=$("<a><span>"+LANG.pr_note_all+"</span></a>"),s[0].f=o.bind(s[0],null,null,1),s.click(s[0].f);var c=o.bind(s[0],null,null,0);c(),l.push($('<span class="indicator-mode"></span>').append(s).append($("<b>"+LANG.pr_note_all+"</b>")));for(var u=0,d=a.length;u<d;++u){var t=a[u];this._lootModes[t]&&(s=$("<a><span>"+n[t]+"</span> ("+this._lootModes[t]+")</a>"),s[0].f=o.bind(s[0],1<<t+2,t,1),s.click(s[0].f),0==t&&(c=o.bind(s[0],1<<t+2,t,0)),(t<-1||t>2)&&5!=t&&s.addClass("icon-heroic"),l.push($('<span class="indicator-mode"></span>').append(s).append($("<b"+(t<-1||t>2?' class="icon-heroic"':"")+">"+n[t]+" ("+this._lootModes[t]+")</b>"))),i&&i[1]==g_urlize(n[t].replace(" ",""))&&s[0].f())}for(var p=!1,t=0,d=l.length;t<d;++t)s=$("a",l[t]),$("span",s).html()||3!=l.length?this.createIndicator(l[t],null,s[0].f):p=!0;p&&c(),$(this.noteTop).append($('<div class="clear"></div>'))}},filterMode:function(e,t,s){if(null!=t&&null!=e.count){null==e._count&&(e._count=e.count);var i=e._count;null!=s&&e.modes[s]&&(i=e.modes[s].count,t=e.modes[s].outof),e.__tr=null,e.count=i,e.outof=t,e.percent=t?i/t*100:i}return null==s||(e.modes&&4!=e.modes.mode||12==e.classs||!e.commondrop?e.modes&&e.modes.mode&s:32==s)},initSubclassFilter:function(e){var t=e.classs||0;null==this._itemClasses&&(this._itemClasses={}),null==this._itemClasses[t]&&(this._itemClasses[t]=0),this._itemClasses[t]++},addSubclassIndicator:function(){var e=location.hash.match(/:type=([^:]+)/),t=[];for(var s in g_item_classes)t.push({i:s,n:g_item_classes[s]});t.sort(function(e,t){return $WH.strcmp(e.n,t.n)});var i,a=function(e,t){g_setSelectedLink(this,"itemclass"),n.customPound=n.id+(null!=e?":type="+e:""),n.customFilter=function(t){return null==e||e==t.classs},n.updateFilters(1),n.applySort(),n.refreshRows(),t&&n.updatePound(1)},n=this,o=[];i=$("<a><span>"+LANG.pr_note_all+"</span></a>"),i[0].f=a.bind(i[0],null,1),i.click(i[0].f),a.bind(i[0],null,0)(),o.push($('<span class="indicator-mode"></span>').append(i).append($("<b>"+LANG.pr_note_all+"</b>")));for(var r=0,l=t.length;r<l;++r){var s=t[r].i;this._itemClasses[s]&&(i=$("<a><span>"+g_item_classes[s]+"</span> ("+this._itemClasses[s]+")</a>"),i[0].f=a.bind(i[0],s,1),i.click(i[0].f),o.push($('<span class="indicator-mode"></span>').append(i).append($("<b>"+g_item_classes[s]+" ("+this._itemClasses[s]+")</b>"))),e&&e[1]==g_urlize(s)&&i[0].f())}if(o.length>2){for(var s=0,l=o.length;s<l;++s)this.createIndicator(o[s],null,$("a",o[s])[0].f);$(this.noteTop).css("padding-bottom","12px"),$(this.noteIndicators).append($('<div class="clear"></div>')).insertAfter($(this.navTop))}},initSpellFilter:function(e){null==this._spellTypes&&(this._spellTypes={}),null==this._spellTypes[e.cat]&&(this._spellTypes[e.cat]=0),this._spellTypes[e.cat]++},addSpellIndicator:function(){var e,t=location.hash.match(/:type=([^:]+)/),s=function(e,t){g_setSelectedLink(this,"spellType"),i.customPound=i.id+(null!=e?":type="+e:""),i.customFilter=function(t){return null==e||t.cat==e},i.updateFilters(1),i.applySort(),i.refreshRows(),t&&i.updatePound(1)},i=this,a=[];e=$("<a><span>"+LANG.pr_note_all+"</span></a>"),e[0].f=s.bind(e[0],null,1),e.click(e[0].f),s.bind(e[0],null,0)(),a.push($('<span class="indicator-mode"></span>').append(e).append($("<b>"+LANG.pr_note_all+"</b>")));for(var n in g_spell_categories)this._spellTypes[n]&&(e=$("<a><span>"+g_spell_categories[n]+"</span> ("+this._spellTypes[n]+")</a>"),e[0].f=s.bind(e[0],n,1),e.click(e[0].f),a.push($('<span class="indicator-mode"></span>').append(e).append($("<b>"+g_spell_categories[n]+" ("+this._spellTypes[n]+")</b>"))),t&&t[1]==n&&e[0].f());if(a.length>2){for(var n=0,o=a.length;n<o;++n)this.createIndicator(a[n],null,$("a",a[n])[0].f);$(this.noteTop).css("padding-bottom","12px"),$(this.noteIndicators).append($('<div class="clear"></div>')).insertAfter($(this.navTop))}},initStatisticFilter:function(e){null==this._achievTypes&&(this._achievTypes={}),null==this._achievTypes[e.type]&&(this._achievTypes[e.type]=0),this._achievTypes[e.type]++},addStatisticIndicator:function(){var e=location.hash.match(/:type=([^:]+)/),t=[];for(var s in g_achievement_types)t.push({i:s,n:g_achievement_types[s]});t.sort(function(e,t){return $WH.strcmp(e.n,t.n)});var i,a=function(e,t){g_setSelectedLink(this,"achievType"),n.customPound=n.id+(null!=e?":type="+e:""),n.customFilter=function(t){return null==e||e==t.type},n.updateFilters(1),n.applySort(),n.refreshRows(),t&&n.updatePound(1)},n=this,o=[];i=$("<a><span>"+LANG.pr_note_all+"</span></a>"),i[0].f=a.bind(i[0],null,1),i.click(i[0].f),a.bind(i[0],null,0)(),o.push($('<span class="indicator-mode"></span>').append(i).append($("<b>"+LANG.pr_note_all+"</b>")));for(var r=0,l=t.length;r<l;++r){var s=t[r].i;this._achievTypes[s]&&(i=$("<a><span>"+g_achievement_types[s]+"</span> ("+this._achievTypes[s]+")</a>"),i[0].f=a.bind(i[0],s,1),i.click(i[0].f),o.push($('<span class="indicator-mode"></span>').append(i).append($("<b>"+g_achievement_types[s]+" ("+this._achievTypes[s]+")</b>"))),e&&e[1]==s&&i[0].f())}if(o.length>2){for(var s=0,l=o.length;s<l;++s)this.createIndicator(o[s],null,$("a",o[s])[0].f);$(this.noteTop).append($('<div class="clear"></div>'))}},initQuestFilter:function(e){null==this._questTypes&&(this._questTypes={});for(var t=1;t<=4;++t)null==this._questTypes[t]&&(this._questTypes[t]=0),e._type&&e._type&1<<t-1&&this._questTypes[t]++},addQuestIndicator:function(){var e,t=location.hash.match(/:type=([^:]+)/),s=function(e,t){g_setSelectedLink(this,"questType"),i.customPound=i.id+(null!=e?":type="+e:""),i.customFilter=function(t){return null==e||t._type&1<<e-1},i.updateFilters(1),i.applySort(),i.refreshRows(),t&&i.updatePound(1)},i=this,a=[];e=$("<a><span>"+LANG.pr_note_all+"</span></a>"),e[0].f=s.bind(e[0],null,1),e.click(e[0].f),s.bind(e[0],null,0)(),a.push($('<span class="indicator-mode"></span>').append(e).append($("<b>"+LANG.pr_note_all+"</b>")));for(var n=1;n<=4;++n)this._questTypes[n]&&(e=$("<a><span>"+g_quest_indicators[n]+"</span> ("+this._questTypes[n]+")</a>"),e[0].f=s.bind(e[0],n,1),e.click(e[0].f),a.push($('<span class="indicator-mode"></span>').append(e).append($("<b>"+g_quest_indicators[n]+" ("+this._questTypes[n]+")</b>"))),t&&t[1]==n&&e[0].f());if(a.length>2){for(var n=0,o=a.length;n<o;++n)this.createIndicator(a[n],null,$("a",a[n])[0].f);$(this.noteTop).css("padding-bottom","12px"),$(this.noteIndicators).append($('<div class="clear"></div>')).insertAfter($(this.navTop))}},assocArrCmp:function(e,t,s){if(null==e)return-1;if(null==t)return 1;for(var i=Math.max(e.length,t.length),a=0;a<i;++a){if(null==e[a])return-1;if(null==t[a])return 1;var n=$WH.strcmp(s[e[a]],s[t[a]]);if(0!=n)return n}return 0},assocBinFlags:function(e,t){var s=[];for(var i in t)!isNaN(i)&&e&1<<i-1&&s.push(i);return s.sort(function(e,s){return $WH.strcmp(t[e],t[s])}),s},location:function(e,t){if(null==e.location)return-1;for(var s=0,i=e.location.length;s<i;++s){s>0&&$WH.ae(t,$WH.ct(LANG.comma));var a=e.location[s];if(-1==a)$WH.ae(t,$WH.ct(LANG.ellipsis));else{var n=$WH.ce("a");n.className="q1",n.href="?zone="+a,$WH.ae(n,$WH.ct(g_zones[a])),$WH.ae(t,n)}}},arrayText:function(e,t){if(null!=e){if(!$WH.is_array(e))return t[e];for(var s="",i=0,a=e.length;i<a;++i)i>0&&(s+=" "),t[e[i]]&&(s+=t[e[i]]);return s}},createCenteredIcons:function(e,t,s,i){if(null!=e){var a=$WH.ce("div"),n=$WH.ce("div");if($WH.ae(document.body,a),s&&(1!=e.length||2!=i)){var o=$WH.ce("div");o.style.position="relative",o.style.width="1px";var r=$WH.ce("div");r.className="q0",r.style.position="absolute",r.style.right="2px",r.style.lineHeight="26px",r.style.fontSize="11px",r.style.whiteSpace="nowrap",$WH.ae(r,$WH.ct(s)),$WH.ae(o,r),$WH.ae(a,o),a.style.paddingLeft=r.offsetWidth+"px"}var l=g_items;1==i&&(l=g_spells);for(var c=0,u=e.length;c<u;++c){var d;if(null==e[c])d=$WH.ce("div"),d.style.width=d.style.height="26px";else{var p,h;"object"==typeof e[c]?(p=e[c][0],h=e[c][1]):p=e[c],d=p?l.createIcon(p,0,h):Icon.create("inventoryslot_empty",0,null,"javascript:;")}if(1==e.length&&2==i){if(p&&g_items[p]){$WH.ee(a);var m=g_items[p],f=$WH.ce("a"),g=$WH.ce("span");if(g.style.paddingTop="4px",f.href="?item="+p,f.className="q"+m.quality+" icontiny tinyspecial",f.style.backgroundImage="url("+g_staticDataUrl+"/images/wow/icons/tiny/"+m.icon.toLowerCase()+".gif)",f.style.whiteSpace="nowrap",$WH.st(f,m["name_"+Locale.getName()]),$WH.ae(g,f),h>1&&$WH.ae(g,$WH.ct(" ("+h+")")),s){var o=$WH.ce("span");o.className="q0",o.style.fontSize="11px",o.style.whiteSpace="nowrap",$WH.ae(o,$WH.ct(s)),$WH.ae(a,o),$(r).length>0&&(g.style.paddingLeft=$(r).width()+"px")}$WH.ae(a,g)}}else d.style.cssFloat=d.style.styleFloat="left",$WH.ae(a,d),a.style.margin="0 auto",a.style.textAlign="left",a.style.width=26*e.length+"px"}return n.className="clear",$WH.ae(t,a),$WH.ae(t,n),!0}},createSocketedIcons:function(e,t,s,i,a){for(var n=0,o=$WH.ce("div"),r=$WH.ce("div"),l=0,c=e.length;l<c;++l){var u,d=s[l];u=g_items&&g_items[d]?g_items.createIcon(d,0):$WH.isset("g_gems")&&g_gems&&g_gems[d]?Icon.create(g_gems[d].icon,0,null,"?item="+d):Icon.create(null,0,null,"javascript:;"),u.className+=" iconsmall-socket-"+g_file_gems[e[l]]+(s&&d?"":"-empty"),u.style.cssFloat=u.style.styleFloat="left",i&&i[l]&&(u.insertBefore($WH.ce("var"),u.childNodes[1]),++n),$WH.ae(o,u)}o.style.margin="0 auto",o.style.textAlign="left",o.style.width=26*e.length+"px",r.className="clear",$WH.ae(t,o),$WH.ae(t,r),a&&n==e.length&&(o=$WH.ce("div"),o.style.paddingTop="4px",$WH.ae(o,$WH.ct(a)),$WH.ae(t,o))},getItemType:function(e,t,s){return null!=s&&null!=g_item_subsubclasses[e]&&null!=g_item_subsubclasses[e][t]?{url:"?items="+e+"."+t+"."+s,text:g_item_subsubclasses[e][t][s]}:null!=t&&null!=g_item_subclasses[e]?{url:"?items="+e+"."+t,text:g_item_subclasses[e][t]}:{url:"?items="+e,text:g_item_classes[e]}},getQuestCategory:function(e){return g_quest_sorts[e]},getQuestReputation:function(e,t){if(t.reprewards)for(var s=0,i=t.reprewards.length;s<i;++s)if(t.reprewards[s][0]==e)return t.reprewards[s][1]},getFactionCategory:function(e,t){return e?g_faction_categories[e]:g_faction_categories[t]},getEventNextDates:function(e,t,s,i){if("string"!=typeof e||"string"!=typeof t)return[null,null];if(e=new Date(e.replace(/-/g,"/")),t=new Date(t.replace(/-/g,"/")),isNaN(e.getTime())||isNaN(t.getTime()))return[null,null];null==i&&(i=g_serverTime);var a=0;if(-1==s){for(var n=new Date(i.getFullYear(),i.getMonth(),1,e.getHours(),e.getMinutes(),e.getSeconds()),o=0;o<2;++o){n.setDate(1),n.setMonth(n.getMonth()+o);var r=n.getDay(),l=1;2009==n.getYear()&&(l=0),r>l&&n.setDate(n.getDate()+(7-r));var c=new Date(n);if(c.setDate(c.getDate()+(7-l)),i.getTime()<c.getTime())break}a=n.getTime()-e.getTime()}else s>0&&(s*=1e3,a=Math.ceil((i.getTime()-t.getTime())/s)*s);return e.setTime(e.getTime()+a),t.setTime(t.getTime()+a),[e,t]},createTextRange:function(e,t){return e|=0,t|=0,e>1||t>1?e!=t&&t>0?e+"-"+t:e+"":null},coGetColor:function(e,t,s){if(e.user&&g_customColors[e.user])return" comment-"+g_customColors[e.user];switch(t){case-1:var i=null;if(null!=(i=s?e.divBody[0].className.match(/comment-([a-z]+)/):e.divPost.childNodes[1].className.match(/comment-([a-z]+)/)))return" comment-"+i[1];break;case 3:if(e.roles&U_GROUP_PREMIUMISH)return" comment-gold";case 4:if(e.roles&U_GROUP_ADMIN)return" comment-blue";if(e.roles&U_GROUP_GREEN_TEXT)return" comment-green";if(e.roles&U_GROUP_VIP)return" comment-gold";if(e.roles&U_GROUP_PREMIUMISH)return" comment-gold"}return e.roles&U_GROUP_ADMIN?" comment-blue":e.commentv2&&e.sticky||e.roles&U_GROUP_GREEN_TEXT||e.rating>=10?" comment-green":e.rating<-2?" comment-bt":e.roles&U_GROUP_PREMIUMISH?" comment-gold":""},coFlagUpOfDate:function(e){var t=e.commentCell.find(".comment-notification");(e.user==g_user.name||0!=(g_user.roles&(U_GROUP_ADMIN|U_GROUP_MOD)))&&confirm("Mark comment "+e.id+" as up to date?")&&(e.container.removeClass("comment-outofdate"),$.post("?comment=out-of-date",{id:e.id,remove:1},function(s){"ok"==s?(e.outofdate=!1,Listview.templates.comment.updateCommentCell(e),MessageBox(t,LANG.lvcomment_uptodateresponse)):MessageBox(t,"Error: "+s)}))},coFlagOutOfDate:function(e){var t=e.commentCell.find(".comment-notification");if(e.user==g_user.name||0!=(g_user.roles&(U_GROUP_ADMIN|U_GROUP_BUREAU)))return void(confirm("Mark comment "+e.id+" as out of date?")&&(e.container.addClass("comment-outofdate"),$.post("?comment=out-of-date",{id:e.id},function(s){"ok"==s?(e.outofdate=!0,Listview.templates.comment.updateCommentCell(e),MessageBox(t,LANG.lvcomment_outofdateresponse)):MessageBox(t,"Error: "+s)})));for(var s=null;;){if(null==(s=prompt(LANG.lvcomment_outofdate_tip))||0==s)return;if(s.toString().length>0)break;alert(LANG.youmustprovideareason_stc)}$.post("?comment=out-of-date",{id:e.id,reason:s},function(s){"ok"==s?(e.outofdate=!0,Listview.templates.comment.updateCommentCell(e),MessageBox(t,LANG.lvcomment_outofdateresponsequeued)):MessageBox(t,"Error: "+s)})},coDelete:function(e){var t=e.user==g_user.name||0!=(g_user.roles&(U_GROUP_ADMIN|U_GROUP_MOD|U_GROUP_BUREAU)),s=e.commentCell.find(".comment-notification");if(t){if(!confirm(LANG.confirm_deletecomment))return;return $.post("?comment=delete",{id:e.id}),e.commentv2?(e.container.addClass("comment-deleted"),MessageBox(s,LANG.commentdeleted_tip),e.deletedInfo=[g_serverTime,g_user.name],Listview.templates.comment.updateCommentCell(e),e.deleted=!0,e.voteCell.hide(),e.repliesCell.hide(),e.commentBody.hide(),e.repliesControl.hide(),Listview.templates.comment.updateRepliesControl(e),Listview.templates.comment.updateCommentControls(e,e.commentControls),void(e.rating>=-4&&!e.headerCell.data("events")&&(e.headerCell.css("cursor","pointer"),e.headerCell.bind("click",function(t){"A"!=$WH.$E(t)._target.nodeName&&(e.voteCell.toggle(),e.repliesCell.toggle(),e.commentBody.toggle(),e.repliesControl.toggle())})))):void this.deleteRows([e])}},coUndelete:function(e){var t=e.user==g_user.name||0!=(g_user.roles&(U_GROUP_ADMIN|U_GROUP_MOD)),s=e.commentCell.find(".comment-notification");confirm(LANG.votetoundelete_tip)&&($.post("?comment=undelete",{id:e.id}),t?(MessageBox(s,"This comment has been restored."),e.commentv2&&(e.container.removeClass("comment-deleted"),e.deletedInfo=null,e.deleted=!1,Listview.templates.comment.updateCommentCell(e),e.voteCell.show(),e.repliesCell.show(),e.commentBody.show(),e.repliesControl.show(),Listview.templates.comment.updateRepliesControl(e),e.rating>=-4&&(e.headerCell.css("cursor","auto"),e.headerCell.unbind("click")))):MessageBox(s,LANG.votedtodelete_tip))},coEdit:function(e,t,s){if(!e.commentCell.find(".comment-edit")[0]){s&&(e.divBody.hide(),e.divResponse.hide());var i=$("<div/>");i.addClass("comment-edit"),e.divEdit=i[0],-1==t&&null!=g_users[e.user]&&(e.roles=g_users[e.user].roles);var a=Listview.funcBox.coEditAppend(i,e,t,s),n=$("<div/>");n.addClass("comment-edit-buttons");var o=$("<button/>",{text:LANG.compose_save});o.click(Listview.funcBox.coEditButton.bind(o[0],e,!0,t,s)),n.append(o),n.append($WH.ct(" ")),o=$("<button/>",{text:LANG.compose_cancel}),o.click(Listview.funcBox.coEditButton.bind(o[0],e,!1,t,s)),n.append(o),
i.append(n),i.insertAfter(e.divBody),a.focus()}},coEditAppend:function(e,t,s,i,a){var n=Listview.funcBox.coGetCharLimit(s);if(1==s||3==s||4==s?(t.user=g_user.name,t.roles=g_user.roles,t.rating=1):2==s&&(t.roles=g_user.roles,t.rating=1),a&&(t.roles&=~U_GROUP_PENDING),-1==s||0==s){var o=$("<div/>",{text:LANG.compose_mode});o.addClass("comment-edit-modes");var r=$("<a/>",{href:"javascript:;",text:LANG.compose_edit});r.click(Listview.funcBox.coModeLink.bind(r[0],1,s,t)),r.addClass("selected"),o.append(r),o.append($WH.ct("|"));var l=$("<a/>",{href:"javascript:;",text:LANG.compose_preview});l.click(Listview.funcBox.coModeLink.bind(l[0],2,s,t)),o.append(l),e.append(o)}var c=$("<div/>",{css:{display:"none"}});c.addClass("text comment-body"+Listview.funcBox.coGetColor(t,s,i));var u=$("<div/>");u.addClass("comment-edit-body");var d=$('<div style="float: left" />');d.addClass("toolbar");var p=$('<div style="float: left" />');p.addClass("menu-buttons");var h=$("<textarea/>",{val:t.body,rows:10,css:{clear:"left"}});switch(h.addClass("comment-editbox"),s){case 1:h.attr("name","commentbody");break;case 2:h.attr({name:"desc",originalValue:t.body});break;case 3:h.attr("name","body");break;case 4:h.attr({name:"sig",originalValue:t.body,rows:3}),h.css("height","auto")}if(-1!=s&&0!=s){var m=$("<h3/>"),f=$("<a/>"),g=$("<div/>"),v=$("<div/>"),_=screen.availWidth<=480,H=Listview.funcBox.coLivePreview.bind(h[0],t,s,g[0]);f.addClass("disclosure-"+(_?"off":"on")),f.text(LANG.compose_livepreview),m.append(f),f.attr("href","javascript:;"),f.click(function(){H(1);var e=g_toggleDisplay(g);f.toggleClass("disclosure-on",e),f.toggleClass("disclosure-off",!e)}),m.addClass("first"),v.addClass("pad"),c.append(m),c.append(g),c.append(v),g_onAfterTyping(h[0],H,50),h.focus(function(){H(),c.css("display",_?"none":""),4!=s&&h.css("height","22em")})}else 4!=s&&h.focus(function(){h.css("height","22em")});var W=[{id:"b",title:LANG.markup_b,pre:"[b]",post:"[/b]"},{id:"i",title:LANG.markup_i,pre:"[i]",post:"[/i]"},{id:"u",title:LANG.markup_u,pre:"[u]",post:"[/u]"},{id:"s",title:LANG.markup_s,pre:"[s]",post:"[/s]"},{id:"small",title:LANG.markup_small,pre:"[small]",post:"[/small]"},{id:"url",title:LANG.markup_url,nopending:!0,onclick:function(){var e=prompt(LANG.prompt_linkurl,"http://");e&&g_insertTag(h[0],"[url="+e+"]","[/url]")}},{id:"quote",title:LANG.markup_quote,pre:"[quote]",post:"[/quote]"},{id:"code",title:LANG.markup_code,pre:"[code]",post:"[/code]"},{id:"ul",title:LANG.markup_ul,pre:"[ul]\n[li]",post:"[/li]\n[/ul]",rep:function(e){return e.replace(/\n/g,"[/li]\n[li]")}},{id:"ol",title:LANG.markup_ol,pre:"[ol]\n[li]",post:"[/li]\n[/ol]",rep:function(e){return e.replace(/\n/g,"[/li]\n[li]")}},{id:"li",title:LANG.markup_li,pre:"[li]",post:"[/li]"}];if(i){for(var y=0,b=W.length;y<b;++y){var w=W[y];if(!(g_user.rolls&U_GROUP_PENDING&&w.nopending)){var N="tb-"+w.id,x=$("<button/>",{click:function(e,t){t.preventDefault(),(null!=e.onclick?e.onclick:g_insertTag.bind(0,h[0],e.pre,e.post,e.rep))()}.bind(null,w),class:N,title:w.title});x[0].setAttribute("type","button"),x.append("<ins/>"),d.append(x)}}d.addClass("formatting button sm")}else for(var y=0,b=W.length;y<b;++y){var w=W[y];if(4==s&&"quote"==w.id)break;if(!(g_user.roles&U_GROUP_PENDING&&w.nopending)){var x=$("<button/>",{click:function(e,t){t.preventDefault(),(null!=e.onclick?e.onclick:g_insertTag.bind(0,h[0],e.pre,e.post,e.rep))()}.bind(null,w)});x[0].setAttribute("type","button");var L=$("<img/>");x.attr("title",w.title),L.attr("src",g_staticDataUrl+"/images/deprecated/pixel.gif"),L.addClass("toolbar-"+w.id),x.append(L),d.append(x)}}var k=function(e,t){var s=prompt($WH.sprintf(LANG.markup_prompt,e),"");null!=s&&g_insertTag(h[0],"["+t+"="+(parseInt(s)||0)+"]","")},A=[[0,LANG.markup_links,,[[9,LANG.types[10][0]+"...",k.bind(null,LANG.types[10][1],"achievement")],[11,LANG.types[13][0]+"...",k.bind(null,LANG.types[13][1],"class")],[7,LANG.types[8][0]+"...",k.bind(null,LANG.types[8][1],"faction")],[0,LANG.types[3][0]+"...",k.bind(null,LANG.types[3][1],"item")],[1,LANG.types[4][0]+"...",k.bind(null,LANG.types[4][1],"itemset")],[2,LANG.types[1][0]+"...",k.bind(null,LANG.types[1][1],"npc")],[3,LANG.types[2][0]+"...",k.bind(null,LANG.types[2][1],"object")],[8,LANG.types[9][0]+"...",k.bind(null,LANG.types[9][1],"pet")],[4,LANG.types[5][0]+"...",k.bind(null,LANG.types[5][1],"quest")],[12,LANG.types[14][0]+"...",k.bind(null,LANG.types[14][1],"race")],[13,LANG.types[15][0]+"...",k.bind(null,LANG.types[15][1],"skill")],[5,LANG.types[6][0]+"...",k.bind(null,LANG.types[6][1],"spell")],[6,LANG.types[7][0]+"...",k.bind(null,LANG.types[7][1],"zone")]]]];u.append(d),u.append(p),u.append($('<div style="clear: left" />')),u.append(h),u.append($("<br/>")),Menu.addButtons(p[0],A),4==s?u.append($WH.ct($WH.sprintf(LANG.compose_limit2,n,3))):u.append($WH.ct($WH.sprintf(LANG.compose_limit,n)));var M=$('<span class="comment-remaining"> '+$WH.sprintf(LANG.compose_remaining,n-t.body.length)+"</span>");if(u.append(M),h.keyup(Listview.funcBox.coUpdateCharLimit.bind(0,h,M,n)),h.keydown(Listview.funcBox.coUpdateCharLimit.bind(0,h,M,n)),(-1==s||0==s)&&g_user.roles&U_GROUP_MODERATOR){var G=$("<div/>",{class:"pad"}),I=$("<div/>",{text:(g_user.roles&U_GROUP_ADMIN?"Admin":"Moderator")+" response"}),C=$("<textarea/>",{val:t.response,rows:3,css:{height:"6em"}});u.append(G),u.append(I),u.append(C)}return e.append(u),e.append($("<br/>")),e.append(c),$("<div/>").append('<div class="pad"/>').append($('<h3 class="first"/>').append($('<a class="disclosure-off"/>').text(LANG.compose_formattinghelp).click(function(){g_disclose(this.parentNode.nextSibling,this)}))).append($('<div style="display: none"/>').append(Markup.toHtml("[markupdoc help=user]"))).insertAfter(e.parent()),h},coLivePreview:function(e,t,s,i){if(1==i||"none"!=s.style.display){var a=this,n=Listview.funcBox.coGetCharLimit(t),o=a.value.length>n?a.value.substring(0,n):a.value;if(4==t){var r;-1!=(r=o.indexOf("\n"))&&-1!=(r=o.indexOf("\n",r+1))&&-1!=(r=o.indexOf("\n",r+1))&&(o=o.substring(0,r))}var l=Markup.rolesToClass(e.roles),c=Markup.toHtml(o,{allow:l,mode:Markup.MODE_COMMENT,roles:e.roles});s.innerHTML=c||'<span class="q6">...</span>'}},coEditButton:function(e,t,s,i){if(t){var a=$WH.gE(e.divEdit,"textarea"),n=a[0];if(!Listview.funcBox.coValidate(n,s))return;if(n.value!=e.body||a[1]&&a[1].value!=e.response){var o=0;null!=e.lastEdit&&(o=e.lastEdit[1]),++o,e.lastEdit=[g_serverTime,o,g_user.name],e.commentv2||Listview.funcBox.coUpdateLastEdit(e);var r=Listview.funcBox.coGetCharLimit(s),l=Markup.rolesToClass(e.roles),c=Markup.toHtml(n.value.length>r?n.value.substring(0,r):n.value,{allow:l,mode:Markup.MODE_COMMENT,roles:e.roles}),u=a[1]&&a[1].value.length>0?Markup.toHtml("[div][/div][wowheadresponse="+g_user.name+" roles="+g_user.roles+"]"+a[1].value+"[/wowheadresponse]",{allow:Markup.CLASS_STAFF,mode:Markup.MODE_COMMENT,roles:g_user.roles}):"";e.commentv2?(e.body=n.value,g_user.roles&U_GROUP_MODERATOR&&a[1]&&(e.response=a[1].value,e.responseuser=g_user.name,e.responseroles=g_user.roles),Listview.templates.comment.updateCommentCell(e)):(i?(e.divBody.html(c),e.divResponse.html(u)):(e.divBody.innerHTML=c,e.divResponse.innerHTML=u),e.body=n.value,g_user.roles&U_GROUP_MODERATOR&&a[1]&&(e.response=a[1].value));var d="body="+$WH.urlencode(e.body);void 0!==e.response&&(d+="&response="+$WH.urlencode(e.response)),-1==s?new Ajax("?forums=editpost&id="+e.id,{method:"POST",params:d}):new Ajax("?comment=edit&id="+e.id,{method:"POST",params:d})}}e.commentv2?Listview.templates.comment.updateCommentCell(e):i?(e.divBody.show(),e.divResponse.show()):(e.divBody.style.display="",e.divResponse.style.display="",e.divLinks.firstChild.style.display=""),e.commentv2||($WH.de(e.divEdit),e.divEdit=null)},coGetCharLimit:function(e){if(2==e)return 7500;if(4==e)return 250;if(g_user.roles&U_GROUP_STAFF)return 16e6;var t=1;switch(g_user.premium&&(t=3),e){case 0:case 1:return 7500*t;case-1:case 3:return 15e3*t}},coUpdateCharLimit:function(e,t,s){var i=$(e).val();i.length>s?$(e).val(i.substring(0,s)):($(t).html(" "+$WH.sprintf(LANG.compose_remaining,s-i.length)).removeClass("q10"),i.length==s&&$(t).addClass("q10"))},coModeLink:function(e,t,s){var i=Listview.funcBox.coGetCharLimit(t),a=Markup.MODE_COMMENT;$WH.array_walk($WH.gE(this.parentNode,"a"),function(e){e.className=""}),this.className="selected";var n=$WH.gE(this.parentNode.parentNode,"textarea"),o=n[0],r=o.parentNode,l=$(".comment-body",r.parentNode)[0];switch(4==t&&(a=Markup.MODE_SIGNATURE),e){case 1:r.style.display="",l.style.display="none",r.firstChild.focus();break;case 2:r.style.display="none";var c=o.value.length>i?o.value.substring(0,i):o.value;if(4==t){var u;-1!=(u=c.indexOf("\n"))&&-1!=(u=c.indexOf("\n",u+1))&&-1!=(u=c.indexOf("\n",u+1))&&(c=c.substring(0,u))}var d=Markup.rolesToClass(s.roles),p=Markup.toHtml(c,{allow:d,mode:a,roles:s.roles});n[1]&&n[1].value.length>0&&(p+=Markup.toHtml("[div][/div][wowheadresponse="+g_user.name+" roles="+g_user.roles+"]"+n[1].value+"[/wowheadresponse]",{allow:Markup.CLASS_STAFF,mode:a,roles:g_user.roles})),l.innerHTML=p,l.style.display=""}},coValidate:function(e,t){if(1==(t|=0)||-1==t){if($WH.trim(e.value).length<10)return alert(LANG.message_forumposttooshort),!1}else if($WH.trim(e.value).length<10)return alert(LANG.message_commenttooshort),!1;var s=Listview.funcBox.coGetCharLimit(t);return!(e.value.length>=s&&!confirm($WH.sprintf(1==t?LANG.confirm_forumposttoolong:LANG.confirm_commenttoolong,s,e.value.substring(s-30,s))))},coSortNewestFirst:function(e){$WH.sc("comments_sort",1e3,"1","/",location.hostname),$(e).parent().find("a.selected").removeClass("selected"),e.className="selected",this.mainDiv.className+=" listview-aci",this.setSort([-5,4,6,-1,-2],!0,!1)},coSortOldestFirst:function(e){$WH.sc("comments_sort",1e3,"2","/",location.hostname),$(e).parent().find("a.selected").removeClass("selected"),e.className="selected",this.mainDiv.className+=" listview-aci",this.setSort([-5,4,6,1,2],!0,!1)},coSortHighestRatedFirst:function(e){$WH.sc("comments_sort",1e3,"3","/",location.hostname),$(e).parent().find("a.selected").removeClass("selected"),e.className="selected",this.mainDiv.className=this.mainDiv.className.replace("listview-aci",""),this.setSort([-5,4,6,-3,2],!0,!1)},coFilterByPatchVersion:function(e){this.minPatchVersion=e.value,this.refreshRows()},coUpdateLastEdit:function(e){var t=e.divLastEdit;if(t)if(null!=e.lastEdit){var s=e.lastEdit;t.childNodes[1].firstChild.nodeValue=s[2],t.childNodes[1].href="?user="+s[2];var i=new Date(s[0]),a=(g_serverTime-i)/1e3;t.childNodes[3].firstChild&&$WH.de(t.childNodes[3].firstChild),g_formatDate(t.childNodes[3],a,i);var n="";null!=e.rating&&(n+=$WH.sprintf(LANG.lvcomment_patch,g_getPatchVersion(i))),s[1]>1&&(n+=LANG.dash+$WH.sprintf(LANG.lvcomment_nedits,s[1])),t.childNodes[4].nodeValue=n,t.style.display=""}else t.style.display="none"},coFormatFileSize:function(e){for(var t=-1;e>=1024&&t<7;)e/=1024,++t;return t<0?e+" byte"+(e>1?"s":""):e.toFixed(1)+" "+"KMGTPEZY"[t]+"B"},dateEventOver:function(e,t,s){var i=Listview.funcBox.getEventNextDates(t.startDate,t.endDate,t.rec||0,e),a="";if(i[0]&&i[1]){var n,o,r=new Date(t.startDate.replace(/-/g,"/")),l=new Date(t.endDate.replace(/-/g,"/"));r.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),l.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),e.getFullYear()==i[0].getFullYear()&&e.getMonth()==i[0].getMonth()&&e.getDate()==i[0].getDate()&&(n=!0),e.getFullYear()==i[1].getFullYear()&&e.getMonth()==i[1].getMonth()&&e.getDate()==i[1].getDate()&&(o=!0),a=n&&o?g_formatTimeSimple(r,LANG.lvscreenshot_from,1)+" "+g_formatTimeSimple(l,LANG.date_to,1):n?g_formatTimeSimple(r,LANG.tab_starts):o?g_formatTimeSimple(l,LANG.tab_ends):LANG.allday}$WH.Tooltip.showAtCursor(s,'<span class="q1">'+t.name+"</span><br />"+a,0,0,"q")},ssCellOver:function(){this.className="screenshot-caption-over"},ssCellOut:function(){this.className="screenshot-caption"},ssCellClick:function(e,t){if(t=$WH.$E(t),!t.shiftKey&&!t.ctrlKey){for(var s=t._target;s;){if("A"==s.nodeName)return;if("IMG"==s.nodeName)break;s=s.parentNode}ScreenshotViewer.show({screenshots:this.data,pos:e})}},ssCreateCb:function(e,t){if(!t.__nochk){var s=$WH.ce("div");s.className="listview-cb",s.onclick=Listview.cbCellClick;var i=$WH.ce("input");i.type="checkbox",i.onclick=Listview.cbClick,$WH.ns(i),t.__chk&&(i.checked=!0),t.__cb=i,$WH.ae(s,i),$WH.ae(e,s)}},viCellClick:function(e,t){if(t=$WH.$E(t),!t.shiftKey&&!t.ctrlKey){for(var s=t._target;s;){if("A"==s.nodeName)return;if("IMG"==s.nodeName)break;s=s.parentNode}VideoViewer.show({videos:this.data,pos:e})}},moneyHonorOver:function(e){$WH.Tooltip.showAtCursor(e,"<b>"+LANG.tooltip_honorpoints+"</b>",0,0,"q1")},moneyArenaOver:function(e){$WH.Tooltip.showAtCursor(e,"<b>"+LANG.tooltip_arenapoints+"</b>",0,0,"q1")},moneyAchievementOver:function(e){$WH.Tooltip.showAtCursor(e,"<b>"+LANG.tooltip_achievementpoints+"</b>",0,0,"q1")},moneyCurrencyOver:function(e,t,s){var i=g_gatheredcurrencies[e]["name_"+Locale.getName()];$WH.Tooltip.showAtCursor(s,i,0,0,"q1")},appendMoney:function(e,t,s,i,a,n){var o,r,l=0;if(s=1==s||"alliance"==s?1:2==s||"horde"==s?2:3,t>=1e4&&(l=1,o=$WH.ce("span"),o.className="moneygold",$WH.ae(o,$WH.ct($WH.number_format(Math.floor(t/1e4)))),$WH.ae(e,o),t%=1e4),t>=100&&(l?$WH.ae(e,$WH.ct(" ")):l=1,o=$WH.ce("span"),o.className="moneysilver",$WH.ae(o,$WH.ct(Math.floor(t/100))),$WH.ae(e,o),t%=100),t>=1&&(l?$WH.ae(e,$WH.ct(" ")):l=1,o=$WH.ce("span"),o.className="moneycopper",$WH.ae(o,$WH.ct(t)),$WH.ae(e,o)),null!=i)for(var c=0;c<i.length;++c){l?$WH.ae(e,$WH.ct(" ")):l=1;var u=i[c][0],d=i[c][1],p=g_items.getIcon(u);o=$WH.ce("a"),o.href="?item="+u,o.className="moneyitem",o.style.backgroundImage="url("+g_staticDataUrl+"/images/wow/icons/tiny/"+p.toLowerCase()+".gif)",$WH.ae(o,$WH.ct(d)),$WH.ae(e,o)}if(null!=a)for(var c=0;c<a.length;++c){l?$WH.ae(e,$WH.ct(" ")):l=1;var h=a[c][0],d=a[c][1],p=["inv_misc_questionmark","inv_misc_questionmark"];g_gatheredcurrencies[h]&&(p=g_gatheredcurrencies[h].icon),o=$WH.ce("a"),o.href="?currency="+h,o.onmousemove=$WH.Tooltip.cursorUpdate,o.onmouseout=$WH.Tooltip.hide,103==h?(o.className="moneyarena tip",o.onmouseover=Listview.funcBox.moneyArenaOver,$WH.ae(o,$WH.ct($WH.number_format(d)))):104==h?(3==s&&p[0]==p[1]&&(s=1),o.className="money"+(1==s?"alliance":"horde")+" tip",o.onmouseover=Listview.funcBox.moneyHonorOver,3==s?(r=$WH.ce("span"),r.className="moneyalliance",$WH.ae(r,$WH.ct($WH.number_format(d))),$WH.ae(o,r)):$WH.ae(o,$WH.ct($WH.number_format(d)))):(o.className="icontinyr tip q1",o.style.backgroundImage="url("+g_staticDataUrl+"/images/wow/icons/tiny/"+p[0].toLowerCase()+".gif)",o.onmouseover=Listview.funcBox.moneyCurrencyOver.bind(o,h,d),$WH.ae(o,$WH.ct($WH.number_format(d)))),$WH.ae(e,o)}"number"==typeof n&&(l?$WH.ae(e,$WH.ct(" ")):l=1,o=$WH.ce("span"),o.className="moneyachievement tip",o.onmouseover=Listview.funcBox.moneyAchievementOver,o.onmousemove=$WH.Tooltip.cursorUpdate,o.onmouseout=$WH.Tooltip.hide,$WH.ae(o,$WH.ct($WH.number_format(n))),$WH.ae(e,o))},getUpperSource:function(e,t){switch(e){case 2:if(t.bd)return LANG.source_bossdrop;if(t.z)return LANG.source_zonedrop;break;case 4:return LANG.source_quests;case 5:return LANG.source_vendors}return g_sources[e]},getLowerSource:function(e,t,s){switch(e){case 3:if(t.p&&g_sources_pvp[t.p])return{text:g_sources_pvp[t.p]}}switch(s){case 0:case 1:case 2:if(t.z){var i={url:"?zone="+t.z,text:g_zones[t.z]};return t.t&&5==e&&(i.pretext=LANG.lvitem_vendorin),t.dd&&99!=t.dd&&(t.dd<0?i.posttext=$WH.sprintf(LANG.lvitem_dd,"",t.dd<-1?LANG.lvitem_heroic:LANG.lvitem_normal):i.posttext=$WH.sprintf(LANG.lvitem_dd,1&t.dd?LANG.lvitem_raid10:LANG.lvitem_raid25,t.dd>2?LANG.lvitem_heroic:LANG.lvitem_normal)),i}break;case 5:return{url:"?quests="+t.c2+"."+t.c,text:Listview.funcBox.getQuestCategory(t.c)};case 6:return t.c&&t.s?{url:"?spells="+t.c+"."+t.s,text:g_spell_skills[t.s]}:{url:"?spells=0",text:"??"}}},getExpansionText:function(e){var t="";return 1==e.expansion?t+=" bc":2==e.expansion&&(t+=" wotlk wrath"),t}},Listview.templates={faction:{sort:[1],nItemsPerPage:-1,searchable:1,filtrable:1,columns:[{id:"name",name:LANG.name,type:"text",align:"left",value:"name",compute:function(e,t){var s=$WH.ce("a");if(s.style.fontFamily="Verdana, sans-serif",s.href=this.getItemLink(e),$WH.ae(s,$WH.ct(e.name)),e.expansion){var i=$WH.ce("span");i.className=g_GetExpansionClassName(e.expansion),$WH.ae(i,s),$WH.ae(t,i)}else $WH.ae(t,s)},getVisibleText:function(e){return e.name+Listview.funcBox.getExpansionText(e)}},{id:"side",name:LANG.side,type:"text",compute:function(e,t){if(e.side&&3!=e.side){var s=$WH.ce("span");s.className=1==e.side?"icon-alliance":"icon-horde",g_addTooltip(s,g_sides[e.side]),$WH.ae(t,s)}},getVisibleText:function(e){if(e.side)return g_sides[e.side]},sortFunc:function(e,t,s){return $WH.strcmp(g_sides[e.side],g_sides[t.side])}},{id:"standing",name:LANG.reputation,value:"standing",compute:function(e,t){t.style.padding=0,$WH.ae(t,g_createReputationBar(e.standing))},hidden:1},{id:"category",name:LANG.category,type:"text",width:"16%",compute:function(e,t){if(null!=e.category2){t.className="small q1";var s=$WH.ce("a"),i="?factions="+e.category2;e.category&&(i+="."+e.category),s.href=i,$WH.ae(s,$WH.ct(Listview.funcBox.getFactionCategory(e.category,e.category2))),$WH.ae(t,s)}},getVisibleText:function(e){return Listview.funcBox.getFactionCategory(e.category,e.category2)},sortFunc:function(e,t,s){var i=Listview.funcBox.getFactionCategory;return $WH.strcmp(i(e.category,e.category2),i(t.category,t.category2))}}],getItemLink:function(e){return"?faction="+e.id}},item:{sort:[-2],searchable:1,filtrable:1,columns:[{id:"name",name:LANG.name,type:"text",align:"left",span:2,value:"name",compute:function(e,t,s){e.upgraded&&(s.className="upgraded");var i=$WH.ce("td");i.style.width="1px",i.style.padding="0",i.style.borderRight="none";var a=null,n=null;null!=e.stack&&(a=Listview.funcBox.createTextRange(e.stack[0],e.stack[1])),null!=e.avail&&(n=e.avail),e.id&&$WH.ae(i,g_items.createIcon(e.id,null==this.iconSize?1:this.iconSize,a,n)),$WH.ae(s,i),t.style.borderLeft="none";var o=$WH.ce("a");o.className="q"+(7-parseInt(e.name.charAt(0))),o.style.fontFamily="Verdana, sans-serif",o.href=this.getItemLink(e),e.rel&&(Icon.getLink(i.firstChild).rel=e.rel,o.rel=e.rel),$WH.ae(o,$WH.ct(e.name.substring(1)));var r=$WH.ce("div");if($WH.ae(r,o),e.reqclass){var l=$WH.ce("div");l.className="small2";for(var c=Listview.funcBox.assocBinFlags(e.reqclass,g_chr_classes),i=0,u=c.length;i<u;++i)if(6!=c[i]){i>0&&$WH.ae(l,$WH.ct(", "));var o=$WH.ce("a");o.href="?class="+c[i],o.className="c"+c[i],$WH.st(o,g_chr_classes[c[i]]),$WH.ae(l,o)}$WH.ae(r,l)}if("number"==typeof fi_nExtraCols&&fi_nExtraCols>=5&&null!=e.source&&1==e.source.length){if(e.reqclass)$WH.ae(l,$WH.ct(LANG.dash));else{var l=$WH.ce("div");l.className="small2"}var d=e.sourcemore?e.sourcemore[0]:{},p=0;if(d.t){p=d.t;var o=$WH.ce("a");null!=d.q?o.className="q"+d.q:o.className="q1",o.href="?"+g_types[d.t]+"="+d.ti,d.n.length<=30?$WH.ae(o,$WH.ct(d.n)):(o.title=d.n,$WH.ae(o,$WH.ct($WH.trim(d.n.substr(0,27))+"..."))),$WH.ae(l,o)}else $WH.ae(l,$WH.ct(Listview.funcBox.getUpperSource(e.source[0],d)));var h=Listview.funcBox.getLowerSource(e.source[0],d,p);if(null!=h){if($WH.ae(l,$WH.ct(LANG.hyphen)),h.pretext&&$WH.ae(l,$WH.ct(h.pretext)),h.url){var o=$WH.ce("a");o.className="q1",o.href=h.url,$WH.ae(o,$WH.ct(h.text)),$WH.ae(l,o)}else $WH.ae(l,$WH.ct(h.text));h.posttext&&$WH.ae(l,$WH.ct(h.posttext))}$WH.ae(r,l)}if(e.heroic||e.reqrace){r.style.position="relative";var l=$WH.ce("div");if(l.className="small",l.style.fontStyle="italic",l.style.position="absolute",l.style.right=l.style.bottom="3px",e.heroic){var m=$WH.ce("span");m.className="q2",$WH.ae(m,$WH.ct(LANG.lvitem_heroicitem)),$WH.ae(l,m)}if(e.reqrace&&1101!=(1791&e.reqrace)&&690!=(1791&e.reqrace)){e.heroic&&($WH.ae(l,$WH.ce("br")),l.style.bottom="-6px");for(var f=Listview.funcBox.assocBinFlags(e.reqrace,g_chr_races),i=0,u=f.length;i<u;++i){i>0&&$WH.ae(l,$WH.ct(", "));var o=$WH.ce("a");o.href="?race="+f[i],$WH.st(o,g_chr_races[f[i]]),$WH.ae(l,o)}l.className+=" q1"}$WH.ae(r,l)}$WH.ae(t,r)},getVisibleText:function(e){var t=e.name.substring(1);if(e.heroic&&(t+=" "+LANG.lvitem_heroicitem),e.reqrace&&(t+=" "+Listview.funcBox.arrayText(Listview.funcBox.assocBinFlags(e.reqrace,g_chr_races),g_chr_races)),e.reqclass&&(t+=" "+Listview.funcBox.arrayText(Listview.funcBox.assocBinFlags(e.reqclass,g_chr_classes),g_chr_classes)),"number"==typeof fi_nExtraCols&&fi_nExtraCols>=5&&null!=e.source&&1==e.source.length){var s=e.sourcemore?e.sourcemore[0]:{},i=0;s.t?(i=s.t,t+=" "+s.n):t+=" "+Listview.funcBox.getUpperSource(e.source[0],s);var a=Listview.funcBox.getLowerSource(e.source[0],s,i);null!=a&&(a.pretext&&(t+=" "+a.pretext),t+=" "+a.text,a.posttext&&(t+=" "+a.posttext))}return t}},{id:"level",name:LANG.level,value:"level",type:"range",getMinValue:function(e){return e.minlevel?e.minlevel:e.level},getMaxValue:function(e){return e.maxlevel?e.maxlevel:e.level},compute:function(e,t){return e.minlevel&&e.maxlevel?e.minlevel!=e.maxlevel?e.minlevel+LANG.hyphen+e.maxlevel:e.minlevel:e.level},sortFunc:function(e,t,s){return s>0?$WH.strcmp(e.minlevel,t.minlevel)||$WH.strcmp(e.maxlevel,t.maxlevel)||$WH.strcmp(e.level,t.level):$WH.strcmp(e.maxlevel,t.maxlevel)||$WH.strcmp(e.minlevel,t.minlevel)||$WH.strcmp(e.level,t.level)}},{id:"reqlevel",name:LANG.req,tooltip:LANG.tooltip_reqlevel,value:"reqlevel",compute:function(e,t){if(e.reqlevel>1)return e.reqlevel}},{id:"side",name:LANG.side,type:"text",compute:function(e,t){if(e.side&&3!=e.side){var s=$WH.ce("span");s.className=1==e.side?"icon-alliance":"icon-horde",g_addTooltip(s,g_sides[e.side]),$WH.ae(t,s)}},getVisibleText:function(e){if(e.side)return g_sides[e.side]},sortFunc:function(e,t,s){return $WH.strcmp(g_sides[e.side],g_sides[t.side])}},{id:"dps",name:LANG.dps,value:"dps",compute:function(e,t){return(e.dps||0).toFixed(1)},hidden:!0},{id:"speed",name:LANG.speed,value:"speed",compute:function(e,t){return(e.speed||0).toFixed(2)},hidden:!0},{id:"armor",name:LANG.armor,value:"armor",compute:function(e,t){if(e.armor>0)return e.armor},hidden:!0},{id:"slot",name:LANG.slot,type:"text",compute:function(e,t){return $WH.nw(t),g_item_slots[e.slot]},getVisibleText:function(e){return g_item_slots[e.slot]},sortFunc:function(e,t,s){return $WH.strcmp(g_item_slots[e.slot],g_item_slots[t.slot])}},{id:"slots",name:LANG.slots,value:"nslots",hidden:!0},{id:"skill",name:LANG.skill,value:"skill",hidden:!0},{id:"glyph",name:LANG.glyphtype,type:"text",value:"glyph",compute:function(e,t){if(e.glyph)return g_item_glyphs[e.glyph]},getVisibleText:function(e){return g_item_glyphs[e.glyph]},sortFunc:function(e,t,s){return $WH.strcmp(g_item_glyphs[e.glyph],g_item_glyphs[t.glyph])},hidden:!0},{id:"source",name:LANG.source,type:"text",compute:function(e,t){if(0==this.iconSize&&(t.className="small"),null!=e.source){if(1!=e.source.length){for(var s="",i=0,a=e.source.length;i<a;++i)i>0&&(s+=LANG.comma),s+=g_sources[e.source[i]];return s}$WH.nw(t);var n=e.sourcemore?e.sourcemore[0]:{},o=0;if(n.t){o=n.t;var r=$WH.ce("a");null!=n.q?r.className="q"+n.q:r.className="q1",r.href="?"+g_types[n.t]+"="+n.ti,r.style.whiteSpace="nowrap",n.icon&&(r.className+=" icontiny tinyspecial",r.style.backgroundImage='url("'+g_staticDataUrl+"/images/wow/icons/tiny/"+n.icon.toLowerCase()+'.gif")'),$WH.ae(r,$WH.ct(n.n)),$WH.ae(t,r)}else $WH.ae(t,$WH.ct(Listview.funcBox.getUpperSource(e.source[0],n)));var l=Listview.funcBox.getLowerSource(e.source[0],n,o);if(0!=this.iconSize&&null!=l){var c=$WH.ce("div");if(c.className="small2",l.pretext&&$WH.ae(c,$WH.ct(l.pretext)),l.url){var r=$WH.ce("a");r.className="q1",r.href=l.url,$WH.ae(r,$WH.ct(l.text)),$WH.ae(c,r)}else $WH.ae(c,$WH.ct(l.text));l.posttext&&$WH.ae(c,$WH.ct(l.posttext)),$WH.ae(t,c)}}},getVisibleText:function(e){if(null!=e.source){if(1==e.source.length){var t="",s=e.sourcemore?e.sourcemore[0]:{},i=0;s.t?(i=s.t,t+=" "+s.n):t+=" "+Listview.funcBox.getUpperSource(e.source[0],s);var a=Listview.funcBox.getLowerSource(e.source[0],s,i);return null!=a&&(a.pretext&&(t+=" "+a.pretext),t+=" "+a.text,a.posttext&&(t+=" "+a.posttext)),t}return Listview.funcBox.arrayText(e.source,g_sources)}},sortFunc:function(e,t){var s=Listview.funcBox.assocArrCmp(e.source,t.source,g_sources);if(0!=s)return s;var i=e.sourcemore&&1==e.source.length?e.sourcemore[0].n:null,a=t.sourcemore&&1==t.source.length?t.sourcemore[0].n:null;return $WH.strcmp(i,a)}},{id:"type",name:LANG.type,type:"text",compute:function(e,t){if(null!=e.classs){t.className="small q1",$WH.nw(t);var s=$WH.ce("a"),i=Listview.funcBox.getItemType(e.classs,e.subclass,e.subsubclass);s.href=i.url,$WH.ae(s,$WH.ct(i.text)),$WH.ae(t,s)}},getVisibleText:function(e){return Listview.funcBox.getItemType(e.classs,e.subclass,e.subsubclass).text},sortFunc:function(e,t,s){var i=Listview.funcBox.getItemType;return $WH.strcmp(i(e.classs,e.subclass,e.subsubclass).text,i(t.classs,t.subclass,t.subsubclass).text)}}],getItemLink:function(e){return"@"==e.name.charAt(0)?"javascript:;":"?item="+e.id},onBeforeCreate:function(){for(var e=!1,t=0,s=this.data.length;t<s;++t){var i=this.data[t];i.slot>0&&18!=i.slot||3==i.classs&&7!=i.subclass||$WH.in_array(ModelViewer.validSlots,i.slotbak)>=0&&i.displayid>0||i.modelviewer?++e:i.__nochk=1}e>0&&(this.mode=Listview.MODE_CHECKBOX,this._nComparable=e)},createCbControls:function(e,t){if((t||!(this._nComparable<15))&&this.mode==Listview.MODE_CHECKBOX){var s=$WH.ce("input"),i=$WH.ce("input"),a=!!g_user.characters&&$WH.array_filter(g_user.characters,function(e){return e.pinned});s.type=i.type="button",s.value=LANG.button_equip,i.value=LANG.button_deselect,i.onclick=Listview.cbSelect.bind(this,!1),0!=this._nComparable&&void 0!==this._nComparable||(s.disabled="disabled",i.disabled="disabled",a=!1),a&&a.length&&(s.onclick=this.template.equipItems.bind(this,a[0]),$WH.ae(e,s)),$WH.ae(e,i)}},compareItems:function(){var e=this.getCheckedRows();if(e.length){var t="";$WH.array_walk(e,function(e){0!=e.slot&&18!=e.slot&&(t+=e.id+";")}),su_addToSaved($WH.rtrim(t,";"),e.length)}},viewIn3d:function(){var e=this.getCheckedRows();if(e.length){var t=!1,s=!1,i=!1,a={},n=null;$WH.array_walk(e,function(e){if($WH.in_array(ModelViewer.validSlots,e.slotbak)>=0&&e.displayid>0){var o=ModelViewer.slotMap[e.slotbak];a[o]&&(s=!0),a[o]=e.displayid,t=!0}else e.modelviewer?n=e.modelviewer:i=!0});var o=null;if(n)(t||i)&&(o=LANG.dialog_cantdisplay),ModelViewer.show({type:n.type,displayId:n.displayid,slot:n.slot,message:o});else{(s||i)&&(o=LANG.dialog_cantdisplay);var r=[];for(var l in a)r.push(parseInt(l)),r.push(a[l]);r.length>0?ModelViewer.show({type:4,equipList:r,message:o}):alert(LANG.message_nothingtoviewin3d)}}},equipItems:function(e){var t=this.getCheckedRows();if(t.length){var s="";$WH.array_walk(t,function(e){0!=e.slot&&18!=e.slot&&(s+=e.id+":")}),location.href=g_getProfileUrl(e)+"&items="+$WH.rtrim(s,":")}}},itemset:{sort:[1],nItemsPerPage:75,searchable:1,filtrable:1,columns:[{id:"name",name:LANG.name,type:"text",align:"left",value:"name",compute:function(e,t){var s=$WH.ce("a");s.className="q"+(7-parseInt(e.name.charAt(0))),s.style.fontFamily="Verdana, sans-serif",s.href=this.getItemLink(e),$WH.ae(s,$WH.ct(e.name.substring(1)));var i=$WH.ce("div");if(i.style.position="relative",$WH.ae(i,s),e.heroic){var a=$WH.ce("div");a.className="small q2",a.style.fontStyle="italic",a.style.position="absolute",a.style.right="3px",a.style.bottom="3px",$WH.ae(a,$WH.ct(LANG.lvitem_heroicitem)),$WH.ae(i,a)}if($WH.ae(t,i),e.note){var a=$WH.ce("div");a.className="small",$WH.ae(a,$WH.ct(g_itemset_notes[e.note])),$WH.ae(t,a)}},getVisibleText:function(e){var t=e.name.substring(1);return e.note&&(t+=" "+g_itemset_notes[e.note]),t}},{id:"level",name:LANG.level,type:"range",getMinValue:function(e){return e.minlevel},getMaxValue:function(e){return e.maxlevel},compute:function(e,t){return e.minlevel>0&&e.maxlevel>0?e.minlevel!=e.maxlevel?e.minlevel+LANG.hyphen+e.maxlevel:e.minlevel:-1},sortFunc:function(e,t,s){return s>0?$WH.strcmp(e.minlevel,t.minlevel)||$WH.strcmp(e.maxlevel,t.maxlevel):$WH.strcmp(e.maxlevel,t.maxlevel)||$WH.strcmp(e.minlevel,t.minlevel)}},{id:"pieces",name:LANG.pieces,getValue:function(e){return e.pieces.length},compute:function(e,t){t.style.padding="0",Listview.funcBox.createCenteredIcons(e.pieces,t)},sortFunc:function(e,t){var s=null!=e.pieces?e.pieces.length:0,i=null!=t.pieces?t.pieces.length:0;return $WH.strcmp(s,i)}},{id:"type",name:LANG.type,type:"text",compute:function(e,t){return g_itemset_types[e.type]},sortFunc:function(e,t,s){return $WH.strcmp(g_itemset_types[e.type],g_itemset_types[t.type])}},{id:"classes",name:LANG.classes,type:"text",width:"20%",getVisibleText:function(e){var t="";if(e.reqclass)for(var s=Listview.funcBox.assocBinFlags(e.reqclass,g_chr_classes),i=0,a=s.length;i<a;++i)6!=s[i]&&(i>0&&(t+=LANG.comma),t+=g_chr_classes[s[i]]);return t},compute:function(e,t){if(e.reqclass){var s=Listview.funcBox.assocBinFlags(e.reqclass,g_chr_classes),i=$WH.ce("div");i.style.width=26*s.length+"px",i.style.margin="0 auto";for(var a=0,n=s.length;a<n;++a){var o=Icon.create("class_"+g_file_classes[s[a]],0,null,"?class="+s[a]);o.style.cssFloat=o.style.styleFloat="left",g_addTooltip(o,g_chr_classes[s[a]],"c"+s[a]),$WH.ae(i,o)}$WH.ae(t,i)}},sortFunc:function(e,t,s){return Listview.funcBox.assocArrCmp(Listview.funcBox.assocBinFlags(e.reqclass,g_chr_classes),Listview.funcBox.assocBinFlags(t.reqclass,g_chr_classes),g_chr_classes)}}],getItemLink:function(e){return"?itemset="+e.id}},npc:{sort:[1],nItemsPerPage:100,searchable:1,filtrable:1,columns:[{id:"name",name:LANG.name,type:"text",align:"left",value:"name",compute:function(e,t){var s=$WH.ce("div");e.boss&&(s.className="icon-boss-padded");var i=$WH.ce("a");if(i.style.fontFamily="Verdana, sans-serif",i.href=this.getItemLink(e),$WH.ae(i,$WH.ct(e.name)),null!=e.hasQuests&&(i.className+=" icontiny tinyspecial",i.style.backgroundImage="url("+g_staticDataUrl+"/images/wow/icons/tiny/quest_start.gif)"),g_user.roles&U_GROUP_PREMIUM_PERMISSIONS&&(i.rel="map"),$WH.ae(s,i),null!=e.tag){var a=$WH.ce("div");a.className="small",$WH.ae(a,$WH.ct("<"+e.tag+">")),$WH.ae(s,a)}if(null!=e.method){t.style.position="relative";var a=$WH.ce("div");a.className="small",a.style.fontStyle="italic",a.style.position="absolute",a.style.right="3px",a.style.bottom="3px",a.style.textAlign="right",$WH.ae(a,$WH.ct(e.method?LANG.added:LANG.lvquest_removed)),$WH.ae(s,a)}$WH.ae(t,s)},getVisibleText:function(e){var t=e.name;return e.tag&&(t+=" <"+e.tag+">"),e.boss&&(t+=" boss skull"),t},sortFunc:function(e,t,s){return $WH.strcmp(t.boss,e.boss)||$WH.strcmp(e.name,t.name)||$WH.strcmp(e.hasQuests,t.hasQuests)}},{id:"level",name:LANG.level,type:"range",width:"10%",getMinValue:function(e){return e.minlevel},getMaxValue:function(e){return e.maxlevel},compute:function(e,t){if(e.classification){var s=$WH.ce("div");s.className="small",$WH.ae(s,$WH.ct(g_npc_classifications[e.classification])),$WH.ae(t,s)}return 3==e.classification||9999==e.maxlevel?"??":e.minlevel>0&&e.maxlevel>0?e.minlevel!=e.maxlevel?e.minlevel+LANG.hyphen+e.maxlevel:e.minlevel:-1},getVisibleText:function(e){var t="";return e.classification&&(t+=" "+g_npc_classifications[e.classification]),e.minlevel>0&&e.maxlevel>0&&(t+=" ",9999==e.maxlevel?t+="??":e.minlevel!=e.maxlevel?t+=e.minlevel+LANG.hyphen+e.maxlevel:t+=e.minlevel),t},sortFunc:function(e,t,s){return s>0?$WH.strcmp(e.minlevel,t.minlevel)||$WH.strcmp(e.maxlevel,t.maxlevel)||$WH.strcmp(e.classification,t.classification):$WH.strcmp(e.maxlevel,t.maxlevel)||$WH.strcmp(e.minlevel,t.minlevel)||$WH.strcmp(e.classification,t.classification)}},{id:"location",name:LANG.location,type:"text",compute:function(e,t){return Listview.funcBox.location(e,t)},getVisibleText:function(e){return Listview.funcBox.arrayText(e.location,g_zones)},sortFunc:function(e,t,s){return Listview.funcBox.assocArrCmp(e.location,t.location,g_zones)}},{id:"react",name:LANG.react,type:"text",
width:"10%",value:"react",filtrable:0,compute:function(e,t){if(null==e.react)return-1;for(var s=[LANG.lvnpc_alliance,LANG.lvnpc_horde],i=0,a=0;a<2;++a)if(null!=e.react[a]){i++>0&&$WH.ae(t,$WH.ct(" "));var n=$WH.ce("span");n.className=e.react[a]<0?"q10":e.react[a]>0?"q2":"q",$WH.ae(n,$WH.ct(s[a])),$WH.ae(t,n)}}},{id:"skin",name:LANG.skin,type:"text",value:"skin",compute:function(e,t){if(e.skin){var s=$WH.ce("a");s.className="q1",s.href="?npcs&filter=cr=35;crs=0;crv="+e.skin,$WH.ae(s,$WH.ct(e.skin)),$WH.ae(t,s)}},hidden:1},{id:"petfamily",name:LANG.petfamily,type:"text",width:"12%",compute:function(e,t){t.className="q1";var s=$WH.ce("a");s.href="?pet="+e.family,$WH.ae(s,$WH.ct(g_pet_families[e.family])),$WH.ae(t,s)},getVisibleText:function(e){return g_pet_families[e.family]},sortFunc:function(e,t,s){return $WH.strcmp(g_pet_families[e.family],g_pet_families[t.family])},hidden:1},{id:"type",name:LANG.type,type:"text",width:"12%",compute:function(e,t){t.className="small q1";var s=$WH.ce("a");s.href="?npcs="+e.type,$WH.ae(s,$WH.ct(g_npc_types[e.type])),$WH.ae(t,s)},getVisibleText:function(e){return g_npc_types[e.type]},sortFunc:function(e,t,s){return $WH.strcmp(g_npc_types[e.type],g_npc_types[t.type])}}],getItemLink:function(e){return"?npc="+e.id}},object:{sort:[1],nItemsPerPage:100,searchable:1,filtrable:1,columns:[{id:"name",name:LANG.name,type:"text",align:"left",value:"name",compute:function(e,t){var s=$WH.ce("div"),i=$WH.ce("a");if(e.name||(e.name="Unnamed Object #"+e.id,i.className+="q0"),i.style.fontFamily="Verdana, sans-serif",i.href=this.getItemLink(e),$WH.ae(i,$WH.ct(e.name)),null!=e.hasQuests&&(i.className+=" icontiny tinyspecial",i.style.backgroundImage="url("+g_staticDataUrl+"/images/wow/icons/tiny/quest_start.gif)"),g_user.roles&U_GROUP_PREMIUM_PERMISSIONS&&(i.rel="map"),$WH.ae(s,i),null!=e.method){t.style.position="relative";var a=$WH.ce("div");a.className="small",a.style.fontStyle="italic",a.style.position="absolute",a.style.right="3px",a.style.bottom="3px",a.style.textAlign="right",$WH.ae(a,$WH.ct(e.method?LANG.added:LANG.lvquest_removed)),$WH.ae(s,a)}$WH.ae(t,s)}},{id:"location",name:LANG.location,type:"text",compute:function(e,t){return Listview.funcBox.location(e,t)},getVisibleText:function(e){return Listview.funcBox.arrayText(e.location,g_zones)},sortFunc:function(e,t,s){return Listview.funcBox.assocArrCmp(e.location,t.location,g_zones)}},{id:"skill",name:LANG.skill,width:"10%",value:"skill",hidden:!0},{id:"type",name:LANG.type,type:"text",width:"12%",compute:function(e,t){t.className="small q1";var s=$WH.ce("a");s.href="?objects="+e.type,$WH.ae(s,$WH.ct(g_object_types[e.type])),$WH.ae(t,s)},getVisibleText:function(e){return g_object_types[e.type]},sortFunc:function(e,t,s){return $WH.strcmp(g_object_types[e.type],g_object_types[t.type])}}],getItemLink:function(e){return"?object="+e.id}},quest:{sort:[1,2],nItemsPerPage:100,searchable:1,filtrable:1,columns:[{id:"name",name:LANG.name,type:"text",align:"left",value:"name",compute:function(e,t){var s=$WH.ce("div"),i=$WH.ce("a");if(i.style.fontFamily="Verdana, sans-serif",i.href=this.getItemLink(e),$WH.ae(i,$WH.ct(e.name)),$WH.ae(s,i),e.reqclass){var a=$WH.ce("div");a.className+=" small2";for(var n=Listview.funcBox.assocBinFlags(e.reqclass,g_chr_classes),o=0,r=n.length;o<r;++o){o>0&&$WH.ae(a,$WH.ct(LANG.comma));var i=$WH.ce("a");i.href="?class="+n[o],i.className+="c"+n[o],$WH.st(i,g_chr_classes[n[o]]),$WH.ae(a,i)}$WH.ae(s,a)}if(1&e.wflags||32&e.wflags||e.reqrace&&-1!=e.reqrace){s.style.position="relative";var a=$WH.ce("div");if(a.className="small",a.style.fontStyle="italic",a.style.position="absolute",a.style.right="3px",a.style.bottom="3px",a.style.textAlign="right",32&e.wflags){1&e.wflags&&($WH.ae(a,$WH.ce("br")),s.style.height="33px");var l=$WH.ce("span"),c=LANG.lvquest_autoaccept;64&e.wflags&&(l.style.color="red",c+=" "+LANG.lvquest_hostile),$WH.ae(l,$WH.ct(c)),$WH.ae(a,l)}if(e.reqrace&&-1!=e.reqrace){var u=Listview.funcBox.assocBinFlags(e.reqrace,g_chr_races);u.length&&(1&e.wflags||32&e.wflags)&&($WH.ae(a,$WH.ce("br")),s.style.height="33px");for(var o=0,r=u.length;o<r;++o){o>0&&$WH.ae(a,$WH.ct(LANG.comma));var d=$WH.ce("a");d.href="?race="+u[o],d.className+="q1",$WH.st(d,g_chr_races[u[o]]),$WH.ae(a,d)}}$WH.ae(s,a)}$WH.ae(t,s)}},{id:"level",name:LANG.level,value:"level",compute:function(e,t){if(e.type||e.daily||e.weekly){var s=$WH.ce("div");s.className="small",$WH.nw(s),e.daily?e.type?$WH.ae(s,$WH.ct($WH.sprintf(LANG.lvquest_daily,g_quest_types[e.type]))):$WH.ae(s,$WH.ct(LANG.daily)):e.weekly?e.type?$WH.ae(s,$WH.ct($WH.sprintf(LANG.lvquest_weekly,g_quest_types[e.type]))):$WH.ae(s,$WH.ct(LANG.weekly)):e.type&&$WH.ae(s,$WH.ct(g_quest_types[e.type])),$WH.ae(t,s)}return e.level},getVisibleText:function(e){var t="";return e.type&&(t+=" "+g_quest_types[e.type]),e.daily?t+=" "+LANG.daily:e.weekly&&(t+=" "+LANG.weekly),e.level&&(t+=" "+e.level),t},sortFunc:function(e,t,s){return $WH.strcmp(e.level,t.level)||$WH.strcmp(e.type,t.type)}},{id:"reqlevel",name:LANG.req,tooltip:LANG.tooltip_reqlevel,value:"reqlevel"},{id:"side",name:LANG.side,type:"text",compute:function(e,t){if(e.side&&3!=e.side){var s=$WH.ce("span");s.className=1==e.side?"icon-alliance":"icon-horde",g_addTooltip(s,g_sides[e.side]),$WH.ae(t,s)}else e.side||$WH.ae(t,$WH.ct("??"))},getVisibleText:function(e){if(e.side)return g_sides[e.side]},sortFunc:function(e,t,s){return $WH.strcmp(g_sides[e.side],g_sides[t.side])}},{id:"rewards",name:LANG.rewards,compute:function(e,t){if(null!=e.itemchoices||null!=e.itemrewards){var s,i;e.itemchoices&&e.itemchoices.length>1&&(s=LANG.lvquest_pickone,e.itemrewards&&e.itemrewards.length>0&&(i=LANG.lvquest_alsoget)),Listview.funcBox.createCenteredIcons(e.itemchoices,t,s,2),Listview.funcBox.createCenteredIcons(e.itemrewards,t,i,2)}if(e.titlereward&&g_titles[e.titlereward]){var a=g_titles[e.titlereward]["name_"+Locale.getName()];a=a.replace("%s",'<span class="q0">&lt;'+LANG.name+"&gt;</span>");var n=$WH.ce("a");n.className="q1",n.href="?title="+e.titlereward,n.innerHTML=a,$WH.ae(t,n),$WH.ae(t,$WH.ce("br"))}},getVisibleText:function(e){var t="";return e.itemchoices&&e.itemchoices.length&&(t+=" "+LANG.lvquest_pickone,e.itemrewards&&e.itemrewards.length&&(t+=" "+LANG.lvquest_alsoget)),e.titlereward&&g_titles[e.titlereward]&&(t+=" "+g_titles[e.titlereward]["name_"+Locale.getName()]),t},sortFunc:function(e,t,s){var i=(null!=e.itemchoices?e.itemchoices.length:0)+(null!=e.itemrewards?e.itemrewards.length:0),a=(null!=t.itemchoices?t.itemchoices.length:0)+(null!=t.itemrewards?t.itemrewards.length:0),n=e.titlereward&&g_titles[e.titlereward]?g_titles[e.titlereward]["name_"+Locale.getName()]:"",o=t.titlereward&&g_titles[t.titlereward]?g_titles[t.titlereward]["name_"+Locale.getName()]:"";return $WH.strcmp(i,a)||$WH.strcmp(n,o)}},{id:"experience",name:LANG.exp,value:"xp"},{id:"money",name:LANG.money,compute:function(e,t){(e.money>0||null!=e.currencyrewards)&&(e.money>0&&(Listview.funcBox.appendMoney(t,e.money),null!=e.currencyrewards&&$WH.ae(t,$WH.ct(" + "))),null!=e.currencyrewards&&Listview.funcBox.appendMoney(t,null,e.side,null,e.currencyrewards))},getVisibleText:function(e){for(var t="",s=0;e.currencyrewards&&s<e.currencyrewards.length;++s)g_gatheredcurrencies[e.currencyrewards[s][0]]&&(t+=" "+g_gatheredcurrencies[e.currencyrewards[s][0]]["name_"+Locale.getName()]);return t},sortFunc:function(e,t,s){var a=0,n=0;if(e.currencyrewards&&e.currencyrewards.length)for(i in e.currencyrewards){var o=e.currencyrewards[i];a+=o[1]}if(t.currencyrewards&&t.currencyrewards.length)for(e in t.currencyrewards){var o=t.currencyrewards[i];n+=o[1]}return $WH.strcmp(a,n)||$WH.strcmp(e.money,t.money)}},{id:"reputation",name:LANG.reputation,width:"14%",value:"id",hidden:!0},{id:"category",name:LANG.category,type:"text",compute:function(e,t){if(0!=e.category){t.className="small q1";var s=$WH.ce("a");s.href="?quests="+e.category2+"."+e.category,$WH.ae(s,$WH.ct(Listview.funcBox.getQuestCategory(e.category))),$WH.ae(t,s)}},getVisibleText:function(e){return Listview.funcBox.getQuestCategory(e.category)},sortFunc:function(e,t,s){var i=Listview.funcBox.getQuestCategory;return $WH.strcmp(i(e.category),i(t.category))}}],getItemLink:function(e){return"?quest="+e.id}},reputationhistory:{sort:["when"],searchable:0,filterable:0,columns:[{id:"action",name:LANG.reputationaction,type:"text",align:"left",value:"title",compute:function(e,t){if(e.param&&e.param>0){var s=$("<a>").attr("href","?go-to-comment&id="+e.param).text(l_reputation_names[e.action]);11!=e.action&&12!=e.action&&13!=e.action||s.attr("href","?website-achievement="+e.param+"#user:"+g_user.name),$(t).append(s)}else $(t).append(l_reputation_names[e.action])},getVisibleText:function(e){return l_reputation_names[e.action]}},{id:"amount",name:LANG.amount,type:"text",width:"250px",compute:function(e,t){var s=$("<span>").text(e.amount);e.amount>0?s.addClass("q2").prepend("+"):e.amount<0&&s.addClass("q10"),$(t).append(s)},getVisibleText:function(e){return e.amount},sortFunc:function(e,t){return e.when==t.when?0:e.when<t.when?1:-1}},{id:"when",name:LANG.date,type:"text",width:"250px",compute:function(e,t){var s=new Date(e.when),i=(g_serverTime-s)/1e3;a=$WH.ce("span"),g_formatDate(a,i,s),$WH.ae(t,a)},sortFunc:function(e,t){return e.when==t.when?0:e.when<t.when?1:-1}}]},icongallery:{sort:[1],mode:Listview.MODE_FLEXGRID,clickable:!1,nItemsPerPage:150,cellMinWidth:85,poundable:1,sortOptions:[{id:"name",name:LANG.name,sortFunc:function(e,t){return $WH.stringCompare(e.name,t.name)}}],columns:[],value:"name",compute:function(e,t,s){var i=$WH.ce("div");i.className="icon-cell",$(i).mouseenter(function(){setTimeout(function(){this.className+=" animate"}.bind(this),1)}).mouseleave(function(){this.className=this.className.replace(/ *animate\b/,"")}),$WH.ae(i,Icon.create(e.icon,2,null,this.getItemLink(e)));var a=$WH.ce("div",{className:"icon-cell-overlay"});$(a).mouseleave(function(){$(".fa-check",this).removeClass("fa-check").addClass("fa-clipboard")}),$WH.ae(a,Icon.create(e.icon,2,null,this.getItemLink(e)));var n=$WH.ce("div",{className:"icon-cell-overlay-name"}),o=function(){this.focus(),this.select()};$WH.ae(n,$WH.ce("input",{type:"text",value:e.name,onclick:o,onfocus:o})),$WH.ae(n,$WH.ce("input",{type:"button",className:"button-copy",onclick:function(){var e=$(this),t=e.siblings('input[type="text"]');t.focus().select();var s=!1;try{document.execCommand("copy")||(s=!0)}catch(e){s=!0}t.blur(),s?(e.css({"pointer-events":"none","background-image":"url("+g_staticDataUrl+"/images/icons/report.png)"}).blur(),setTimeout(function(){$(".icon-cell-overlay-name .button-copy").fadeOut(1e3)},600)):e.css("background-image","url("+g_staticDataUrl+"/images/icons/tick.png)")}})),$WH.ae(a,n);for(var r,l=$WH.ce("div",{className:"icon-cell-overlay-counts"}),c=[3,6,10,17,9,13],u=0,d=0;r=c[d];d++){var p=g_types[r]+"count";if(e[p]){u+=e[p];var h=g_types[r],m=1==e[p]?LANG.types[r][1]:LANG.types[r][3];$WH.ae(l,$WH.ce("div",null,$WH.ce("a",{href:this.getItemLink(e)+"#used-by-"+h,innerHTML:$WH.sprintf(LANG.entitycount,e[p],m)})))}}u||$WH.ae(l,$WH.ce("div",{innerHTML:LANG.unused})),$WH.ae(a,l);var f=$WH.ce("div",{className:"icon-cell-overlay-placer"},a);$WH.ae(i,f),$WH.ae(t,i)},sortFunc:function(e,t){return $WH.stringCompare(e.name,t.name)},getItemLink:function(e){return"?icon="+e.id}},topusers:{sort:["reputation"],searchable:1,filtrable:0,columns:[{id:"username",name:LANG.username,type:"text",align:"left",compute:function(e,t){var s=$("<a>"),i=g_GetStaffColorFromRoles(e.groups);""!=i?s.addClass(i):s.css("color","white"),s.text(e.username),s.addClass("listview-cleartext"),s.attr("href","?user="+e.username),$(t).append(s)},getVisibleText:function(e){return e.username},sortFunc:function(e,t){return $WH.stringCompare(e.username,t.username)},getItemLink:function(e){return"?user="+e.username}},{id:"reputation",name:LANG.reputation,type:"text",compute:function(e,t){$(t).append($WH.number_format(e.reputation))},sortFunc:function(e,t){return t.reputation==e.reputation?0:e.reputation<t.reputation?1:-1}},{id:"achievements",name:LANG.achievements,type:"text",compute:function(e,t){var s=$("<span>").addClass("wsach-pts").css("font-size","inherit"),i="";e.gold&&(i+="<i>"+e.gold+"</i>&middot;"),e.silver&&(i+="<b>"+e.silver+"</b>&middot;"),i+="<u>"+e.copper+"</u>",s.html(i),$(t).append(s)},sortFunc:function(e,t){var s=1e3*e.gold*1e3+1e3*e.silver+e.copper,i=1e3*t.gold*1e3+1e3*t.silver+t.copper;return s==i?0:s<i?1:-1}},{id:"comments",name:LANG.comments,type:"text",compute:function(e,t){$(t).append($WH.number_format(e.comments))},sortFunc:function(e,t){return e.comments==t.comments?0:e.comments<t.comments?1:-1}},{id:"posts",name:LANG.posts,type:"text",compute:function(e,t){$(t).append($WH.number_format(e.posts))},sortFunc:function(e,t){return e.posts==t.posts?0:e.posts<t.posts?1:-1}},{id:"screenshots",name:LANG.screenshots,type:"text",compute:function(e,t){$(t).append($WH.number_format(e.screenshots))},sortFunc:function(e,t){return e.screenshots==t.screenshots?0:e.screenshots<t.screenshots?1:-1}},{id:"reports",name:LANG.reports,type:"text",compute:function(e,t){$(t).append($WH.number_format(e.reports))},sortFunc:function(e,t){return e.reports==t.reports?0:e.reports<t.reports?1:-1}},{id:"votes",name:LANG.votes,type:"text",compute:function(e,t){$(t).append($WH.number_format(e.votes))},sortFunc:function(e,t){return e.votes==t.votes?0:e.votes<t.votes?1:-1}},{id:"uploads",name:LANG.uploads,type:"text",compute:function(e,t){$(t).append($WH.number_format(e.uploads))},sortFunc:function(e,t){return e.uploads==t.uploads?0:e.uploads<t.uploads?1:-1}},{id:"created",name:LANG.created,type:"text",hidden:1,compute:function(e,t){var s=new Date(e.creation),i=(g_serverTime-s)/1e3;sp=$WH.ce("span"),g_formatDate(sp,i,s),$WH.ae(t,sp)},sortFunc:function(e,t){return e.creation==t.creation?0:e.creation<t.creation?1:-1}}],getItemLink:function(e){return"?user="+e.username}},skill:{sort:[1],searchable:1,filtrable:1,columns:[{id:"name",name:LANG.name,type:"text",align:"left",value:"name",span:2,compute:function(e,t,s){var i=$WH.ce("td");i.style.width="1px",i.style.padding="0",i.style.borderRight="none",$WH.ae(i,Icon.create(e.icon,0,null,this.getItemLink(e))),$WH.ae(s,i),t.style.borderLeft="none";var a=$WH.ce("div"),n=$WH.ce("a");if(n.style.fontFamily="Verdana, sans-serif",n.href=this.getItemLink(e),$WH.ae(n,$WH.ct(e.name)),e.expansion){var o=$WH.ce("span");o.className=g_GetExpansionClassName(e.expansion),$WH.ae(o,n),$WH.ae(a,o)}else $WH.ae(a,n);$WH.ae(t,a)},getVisibleText:function(e){return e.name+Listview.funcBox.getExpansionText(e)}},{id:"category",name:LANG.category,type:"text",width:"16%",compute:function(e,t){if(0!=e.category){t.className="small q1";var s=$WH.ce("a");s.href="?skills="+e.category,$WH.ae(s,$WH.ct(g_skill_categories[e.category])),$WH.ae(t,s)}},getVisibleText:function(e){return g_skill_categories[e.category]},sortFunc:function(e,t,s){return $WH.strcmp(g_skill_categories[e.category],g_skill_categories[t.category])}}],getItemLink:function(e){return"?skill="+e.id}},spell:{sort:["name","skill","level"],searchable:1,filtrable:1,columns:[{id:"name",name:LANG.name,type:"text",align:"left",span:2,value:"name",compute:function(e,t,s){var i,a=$WH.ce("td");a.style.width="44px",a.style.padding="0",a.style.borderRight="none",i=null!=e.creates?g_items.createIcon(e.creates[0],1,Listview.funcBox.createTextRange(e.creates[1],e.creates[2])):g_spells.createIcon(e.id,1),i.style.cssFloat=i.style.styleFloat="left",$WH.ae(a,i),$WH.ae(s,a),t.style.borderLeft="none";var n=$WH.ce("div"),o=$WH.ce("a"),r=e.name.charAt(0);if("@"!=r&&(o.className="q"+(7-parseInt(r))),o.style.fontFamily="Verdana, sans-serif",o.href=this.getItemLink(e),$WH.ae(o,$WH.ct(e.name.substring(1))),$WH.ae(n,o),e.rank){var l=$WH.ce("div");l.className="small2",$WH.ae(l,$WH.ct(e.rank)),$WH.ae(n,l)}if(this.showRecipeClass&&e.reqclass){var l=$WH.ce("div");l.className="small2";for(var c=Listview.funcBox.assocBinFlags(e.reqclass,g_chr_classes),a=0,u=c.length;a<u;++a)if(6!=c[a]){a>0&&$WH.ae(l,$WH.ct(", "));var o=$WH.ce("a");o.href="?class="+c[a],o.className="c"+c[a],$WH.st(o,g_chr_classes[c[a]]),$WH.ae(l,o)}$WH.ae(n,l)}if(e.reqrace){n.style.position="relative";var l=$WH.ce("div");if(l.className="small",l.style.fontStyle="italic",l.style.position="absolute",l.style.right=l.style.bottom="3px",1101==(1791&e.reqrace))$WH.ae(l,$WH.ct(g_sides[1]));else if(690==(1791&e.reqrace))$WH.ae(l,$WH.ct(g_sides[2]));else{var d=Listview.funcBox.assocBinFlags(e.reqrace,g_chr_races);l.className+=" q1";for(var a=0,u=d.length;a<u;++a){a>0&&$WH.ae(l,$WH.ct(LANG.comma));var o=$WH.ce("a");o.href="?race="+d[a],$WH.st(o,g_chr_races[d[a]]),$WH.ae(l,o)}}$WH.ae(n,l)}$WH.ae(t,n)},getVisibleText:function(e){var t=e.name;if(e.rank&&(t+=" "+e.rank),e.reqclass)for(var s=Listview.funcBox.assocBinFlags(e.reqclass,g_chr_classes),i=0,a=s.length;i<a;++i)6!=s[i]&&(i>0&&(t+=LANG.comma),t+=g_chr_classes[s[i]]);return e.reqrace&&(t+=" "+Listview.funcBox.arrayText(Listview.funcBox.assocBinFlags(e.reqrace,g_chr_races),g_chr_races)),t}},{id:"tier",name:LANG.tier,width:"10%",value:"level",compute:function(e,t){if(e.level>0){var s=this._petTalents?20:10,i=this._petTalents?12:5;return Math.floor((e.level-s)/i)+1}return 1},hidden:!0},{id:"level",name:LANG.level,width:"10%",value:"level",compute:function(e,t){if(e.level>0)return e.level},hidden:!0},{id:"trainingcost",name:LANG.cost,width:"10%",hidden:!0,getValue:function(e){if(e.trainingcost)return e.trainingcost},compute:function(e,t){e.trainingcost&&Listview.funcBox.appendMoney(t,e.trainingcost)},sortFunc:function(e,t,s){return null==e.trainingcost?-1:null==t.trainingcost?1:e.trainingcost<t.trainingcost?-1:e.trainingcost>t.trainingcost?1:0}},{id:"classes",name:LANG.classes,type:"text",hidden:!0,width:"20%",getVisibleText:function(e){var t="";if(e.reqclass)for(var s=Listview.funcBox.assocBinFlags(e.reqclass,g_chr_classes),i=0,a=s.length;i<a;++i)6!=s[i]&&(i>0&&(t+=LANG.comma),t+=g_chr_classes[s[i]]);return t},compute:function(e,t){if(e.reqclass){var s=Listview.funcBox.assocBinFlags(e.reqclass,g_chr_classes),i=$WH.ce("div");i.style.width=26*s.length+"px",i.style.margin="0 auto";for(var a=0,n=s.length;a<n;++a)if(6!=s[a]){var o=Icon.create("class_"+g_file_classes[s[a]],0,null,"?class="+s[a]);o.style.cssFloat=o.style.styleFloat="left",g_addTooltip(o,g_chr_classes[s[a]],"c"+s[a]),$WH.ae(i,o)}$WH.ae(t,i)}},sortFunc:function(e,t,s){return Listview.funcBox.assocArrCmp(Listview.funcBox.assocBinFlags(e.reqclass,g_chr_classes),Listview.funcBox.assocBinFlags(t.reqclass,g_chr_classes),g_chr_classes)}},{id:"singleclass",name:LANG.classs,type:"text",hidden:!0,width:"15%",compute:function(e,t){if(e.reqclass){var s=Listview.funcBox.assocBinFlags(e.reqclass,g_chr_classes),i=s[0],a=$WH.ce("a");a.style.backgroundImage='url("'+g_staticDataUrl+"/images/wow/icons/tiny/class_"+g_file_classes[i]+'.gif")',a.className="icontiny tinyspecial c"+i,a.href="?class="+i,$WH.ae(a,$WH.ct(g_chr_classes[i])),$WH.ae(t,a)}},sortFunc:function(e,t,s){return Listview.funcBox.assocArrCmp(Listview.funcBox.assocBinFlags(e.reqclass,g_chr_classes),Listview.funcBox.assocBinFlags(t.reqclass,g_chr_classes),g_chr_classes)}},{id:"glyphtype",name:LANG.glyphtype,type:"text",hidden:!0,width:"10%",compute:function(e,t){if(e.glyphtype)return g_item_glyphs[e.glyphtype]}},{id:"schools",name:LANG.school,type:"text",width:"10%",hidden:!0,compute:function(e,t){for(var s="",i=e.schools?e.schools:e.school,a=0;a<32;++a)i&1<<a&&(""!=s&&(s+=", "),s+=g_spell_resistances[a]);return s},sortFunc:function(e,t,s){return $WH.strcmp(this.compute(e),this.compute(t))}},{id:"type",name:LANG.type,type:"text",width:"14%",hidden:!0,compute:function(e,t){var s=$WH.ce("div");if(s.className="small",-1!=$WH.in_array([7,-2,-7,-12,-11,-13],e.cat)){var i=$WH.ce("a");if(i.className="q0",i.href="?spells="+e.cat,$WH.ae(i,$WH.ct(g_spell_categories[e.cat])),$WH.ae(s,i),$WH.ae(s,$WH.ce("br")),e.talentspec)for(var a=0,n=e.talentspec.length;a<n;++a){a>0&&$WH.ae(s,$WH.ct(LANG.comma));var o=$WH.ce("a");o.className="q1",o.href="?spells="+e.cat+"."+(1+Math.log(e.reqclass)/Math.LN2)+"."+e.talentspec[a],$WH.ae(o,$WH.ct(g_chr_specs[e.talentspec[a]])),$WH.ae(s,o)}else if(g_spell_types[e.cat])if(-11!=e.cat||1!=e.type&&2!=e.type)$WH.ae(s,$WH.ct(g_spell_types[e.cat][e.type]));else{var o=$WH.ce("a");o.className="q1",o.href="?spells="+e.cat+"."+(2==e.type?"8":"6"),$WH.ae(o,$WH.ct(g_spell_types[e.cat][e.type])),$WH.ae(s,o)}else if(e.reqclass){var o=$WH.ce("a");o.className="q1",o.href="?spells="+e.cat+"."+(1+Math.log(e.reqclass)/Math.LN2)+(g_item_glyphs[e.glyphtype]?"&filter=gl="+e.glyphtype:""),$WH.ae(o,$WH.ct((g_item_glyphs[e.glyphtype]?g_item_glyphs[e.glyphtype]+" ":"")+g_chr_classes[1+Math.log(e.reqclass)/Math.LN2])),$WH.ae(s,o)}}else if(g_spell_categories[e.cat]){var i=$WH.ce("a");i.className="q1",i.href="?spells="+e.cat,$WH.ae(i,$WH.ct(g_spell_categories[e.cat])),$WH.ae(s,i)}$WH.ae(t,s)},getVisibleText:function(e){var t=g_spell_categories[e.cat];return-1!=$WH.in_array([7,-2,-12,-11,-13],e.cat)&&(e.talentspec?t+=" "+Listview.funcBox.arrayText(e.talentspec,g_chr_specs):g_spell_types[e.cat]?t+=" "+g_spell_types[e.cat][e.type]:(g_item_glyphs[e.glyphtype]&&(t+=" "+g_item_glyphs[e.glyphtype]),t+=" "+g_chr_classes[1+Math.log(e.reqclass)/Math.LN2])),t},sortFunc:function(e,t,s){var i=g_spell_types[e.cat]?g_spell_types[e.cat][e.type]:e.type,a=g_spell_types[t.cat]?g_spell_types[t.cat][t.type]:e.type;return $WH.strcmp(e.cat,t.cat)||$WH.strcmp(i,a)}},{id:"reagents",name:LANG.reagents,width:"9%",hidden:!0,getValue:function(e){return e.reagents?e.reagents.length:0},compute:function(e,t){if(null!=e.reagents){t.style.padding="0";var s=$WH.ce("div"),i=e.reagents;s.style.width=44*i.length+"px",s.style.margin="0 auto";for(var a=0,n=i.length;a<n;++a){var o=i[a][0],r=i[a][1],l=g_items.createIcon(o,1,r);l.style.cssFloat=l.style.styleFloat="left",$WH.ae(s,l)}$WH.ae(t,s)}},sortFunc:function(e,t){var s=null!=e.reagents?e.reagents.length:0,i=null!=t.reagents?t.reagents.length:0;return s>0&&s==i?$WH.strcmp(e.reagents.toString(),t.reagents.toString()):$WH.strcmp(s,i)}},{id:"tp",name:LANG.tp,tooltip:LANG.tooltip_trainingpoints,width:"7%",hidden:!0,value:"tp",compute:function(e,t){if(e.tp>0)return e.tp}},{id:"source",name:LANG.source,type:"text",width:"12%",hidden:!0,compute:function(e,t){if(null!=e.source){for(var s="",i=0,a=e.source.length;i<a;++i)i>0&&(s+=LANG.comma),s+=g_sources[e.source[i]];return s}},sortFunc:function(e,t,s){return Listview.funcBox.assocArrCmp(e.source,t.source,g_sources)}},{id:"skill",name:LANG.skill,type:"text",width:"16%",getValue:function(e){return e.learnedat},compute:function(e,t,s,i){if(null!=e.skill){this.skillsColumn=i;var a=$WH.ce("div");if(a.className="small",-7==e.cat&&null!=e.pettype){e.skill=[];for(var n={0:410,1:409,2:411},o=0,r=e.pettype.length;o<r;++o)e.skill.push(n[e.pettype[o]])}for(var o=0,r=e.skill.length;o<r;++o)if(o>0&&$WH.ae(a,$WH.ct(LANG.comma)),-1==e.skill[o])$WH.ae(a,$WH.ct(LANG.ellipsis));else if(-1!=$WH.in_array([7,-2,-3,-5,-6,-7,11,9],e.cat)){var l=$WH.ce("a");l.className="q1",-1!=$WH.in_array([-5,-6],e.cat)?l.href="?spells="+e.cat:l.href="?spells="+e.cat+"."+(!e.reqclass||7!=e.cat&&-2!=e.cat?"":1+Math.log(e.reqclass)/Math.LN2+".")+e.skill[o];var c=$WH.g_getGets(),u=c.spells?c.spells.split("."):[!1,!1];if(e.reqclass&&(7==e.cat||-2==e.cat)&&o<1&&1+Math.log(e.reqclass)/Math.LN2!=u[1]){var d=$WH.ce("a");d.className="q0",d.href="?spells="+e.cat+"."+(1+Math.log(e.reqclass)/Math.LN2),$WH.ae(d,$WH.ct(g_chr_classes[1+Math.log(e.reqclass)/Math.LN2])),$WH.ae(a,d),$WH.ae(a,$WH.ce("br"))}$WH.ae(l,$WH.ct(-7==e.cat&&null!=e.pettype?g_pet_types[e.pettype[o]]:g_spell_skills[e.skill[o]])),$WH.ae(a,l)}else $WH.ae(a,$WH.ct(g_spell_skills[e.skill[o]]));if(e.learnedat>0){$WH.ae(a,$WH.ct(" ("));var p=$WH.ce("span");9999==e.learnedat?(p.className="q0",$WH.ae(p,$WH.ct("??"))):e.learnedat>0&&($WH.ae(p,$WH.ct(e.learnedat)),p.style.fontWeight="bold"),$WH.ae(a,p),$WH.ae(a,$WH.ct(")"))}if($WH.ae(t,a),null!=e.colors){this.template.columns[i].type=null;for(var h=e.colors,m=0,o=0;o<h.length;++o)if(h[o]>0){++m;break}if(m>0){m=0,a=$WH.ce("div"),a.className="small",a.style.fontWeight="bold";for(var o=0;o<h.length;++o)if(h[o]>0){m++>0&&$WH.ae(a,$WH.ct(" "));var f=$WH.ce("span");f.className="r"+(o+1),$WH.ae(f,$WH.ct(h[o])),$WH.ae(a,f)}$WH.ae(t,a)}}}},getVisibleText:function(e){var t=Listview.funcBox.arrayText(e.skill,g_spell_skills);return e.learnedat>0&&(t+=" "+(9999==e.learnedat?"??":e.learnedat)),t},sortFunc:function(e,t){for(var s=[e.learnedat,t.learnedat],i=0;i<2;++i){var a=0==i?e:t;if(9999==s[i]&&null!=a.colors){for(var n=0;0==a.colors[n]&&n<a.colors.length;)n++;n<a.colors.length&&(s[i]=a.colors[n])}}var o=$WH.strcmp(s[0],s[1]);if(0!=o)return o;if(null!=e.colors&&null!=t.colors)for(var n=0;n<4;++n)if(0!=(o=$WH.strcmp(e.colors[n],t.colors[n])))return o;return null!=e.pettype&null!=t.pettype?Listview.funcBox.assocArrCmp(e.pettype,t.pettype,g_pet_types):Listview.funcBox.assocArrCmp(e.skill,t.skill,g_spell_skills)}},{id:"stackRules",name:"Behaviour",type:"text",width:"20%",hidden:!0,compute:function(e,t){if(e.stackRule){var s="",i="";switch(e.stackRule){case 3:i="(strongest effect is applied)";case 0:s="coexist";break;case 2:case 4:i=2==e.stackRule?"(from same caster)":"(strongest effect is applied)";case 1:s="exclusive"}t.className="small",t.style.lineHeight="18px";var a=$WH.ce("span");if(a.className=e.stackRule&&3!=e.stackRule?"q10":"q2",$WH.ae(a,$WH.ct(s)),$WH.ae(t,a),i){var n=$WH.ce("span");n.style.whiteSpace="nowrap",n.className="q0",$WH.ae(t,$WH.ce("br")),$WH.st(n,i),$WH.ae(t,n)}}},getVisibleText:function(e){if(e.stackRule){var t="";switch(e.stackRule){case 3:t+="(strongest effect is applied)";case 0:t+=" coexist";break;case 2:t+="(from same caster)";case 1:t+=" exclusive"}return t}},sortFunc:function(e,t,s){return $WH.strcmp(e.stackRule,t.stackRule)}},{id:"linkedTrigger",name:"Triggers",type:"text",width:"50%",hidden:!0,compute:function(e,t){if(e.linked){var s=e.linked[0],i="";switch(e.linked[2]){case 0:i=s>0?"When Spell is casted":"When Aura is removed";break;case 1:i="When Spell hits the target(s)";break;case 2:i="When Aura is applied and removed"}t.className="small",t.style.lineHeight="18px";var a=$WH.ce("a");if(a.style.whiteSpace="nowrap",a.href="?spell="+Math.abs(s),g_pageInfo.typeId==Math.abs(s))a.className="q1",$WH.st(a,"This");else{var n=g_spells[Math.abs(s)];a.className="icontiny tinyspecial",a.style.backgroundImage="url("+g_staticDataUrl+"/images/wow/icons/tiny/"+n.icon+".gif)",$WH.st(a,n["name_"+Locale.getName()])}$WH.ae(t,a);var o=$WH.ce("span");o.className="q0",$WH.st(o,i),$WH.ae(t,$WH.ce("br")),$WH.ae(t,o)}},getVisibleText:function(e){if(e.linked){var t=e.linked[0],s="";switch(g_pageInfo.typeId==Math.abs(t)?s+="This":s+=g_spells[Math.abs(t)]["name_"+Locale.getName()],e.linked[2]){case 0:s+=t>0?" When Spell is casted":" When Aura is removed";break;case 1:s+=" When Spell hits the target(s)";break;case 2:s+=" When Aura is applied and removed"}return s}},sortFunc:function(e,t,s){var i=e.linked[0],a=t.linked[0];return i>0&&a<0?-1:i<0&&a>0?1:g_pageInfo.typeId==Math.abs(i)?1:g_pageInfo.typeId==Math.abs(a)?-1:i!=a?$WH.strcmp(g_spells[Math.abs(i)]["name_"+Locale.getName()],g_spells[Math.abs(a)]["name_"+Locale.getName()]):0}},{id:"linkedEffect",name:"Effects",type:"text",width:"50%",hidden:!0,compute:function(e,t){if(e.linked){var s=e.linked[1],i="";switch(e.linked[2]){case 0:case 1:i=s>0?"Spell is triggered":"Spells Auras are removed";break;case 2:i=s>0?"Spells Auras are applied or removed":"Immunity against Spell is applied or cleared "}t.className="small",t.style.lineHeight="18px";var a=$WH.ce("a");if(a.style.whiteSpace="nowrap",a.href="?spell="+Math.abs(s),g_pageInfo.typeId==Math.abs(s))a.className="q1",$WH.st(a,"This");else{var n=g_spells[Math.abs(s)];a.className="icontiny tinyspecial",a.style.backgroundImage="url("+g_staticDataUrl+"/images/wow/icons/tiny/"+n.icon+".gif)",$WH.st(a,n["name_"+Locale.getName()])}$WH.ae(t,a);var o=$WH.ce("span");o.className="q0",$WH.st(o,i),$WH.ae(t,$WH.ce("br")),$WH.ae(t,o)}},getVisibleText:function(e){if(e.linked){var t=e.linked[1],s="";switch(g_pageInfo.typeId==Math.abs(t)?s+="This":s+=g_spells[Math.abs(t)]["name_"+Locale.getName()],e.linked[2]){case 0:case 1:s+=t>0?" Spell is triggered":" Spells Auras are removed";break;case 2:s+=t>0?" Spells Auras are applied or removed":" Immunity against Spell is applied or cleared "}return s}},sortFunc:function(e,t,s){var i=e.linked[1],a=t.linked[1];return i>0&&a<0?-1:i<0&&a>0?1:g_pageInfo.typeId==Math.abs(i)?1:g_pageInfo.typeId==Math.abs(a)?-1:i!=a?$WH.strcmp(g_spells[Math.abs(i)]["name_"+Locale.getName()],g_spells[Math.abs(a)]["name_"+Locale.getName()]):0}}],getItemLink:function(e){return"?spell="+e.id}},zone:{sort:[1],nItemsPerPage:-1,searchable:1,filtrable:1,columns:[{id:"name",name:LANG.name,type:"text",align:"left",value:"name",compute:function(e,t){var s=$WH.ce("div"),a=$WH.ce("a");if(a.style.fontFamily="Verdana, sans-serif",a.href=this.getItemLink(e),$WH.ae(a,$WH.ct(e.name)),e.expansion){var n=$WH.ce("span");n.className=g_GetExpansionClassName(e.expansion),$WH.ae(n,a),$WH.ae(s,n)}else $WH.ae(s,a);if($WH.ae(t,s),e.subzones){if(1==e.subzones.length&&e.subzones[0]==e.id)return;var o=parseInt(e.subzones.length/3);o!=e.subzones.length/3&&o++,s.style.position="relative",s.style.minHeight=12*o+19+"px";var r=$WH.ce("div");r.className="small",r.style.fontStyle="italic",r.style.position="absolute",r.style.right="2px",r.style.bottom="2px",r.style.textAlign="right";for(i in e.subzones)if(g_gatheredzones[e.subzones[i]]){i>0&&$WH.ae(r,$WH.ct(LANG.comma));var a=$WH.ce("a");a.className=e.subzones[i]==e.id?"q1":"q0",a.style.whiteSpace="nowrap",a.href="?zone="+e.subzones[i],$WH.st(a,g_gatheredzones[e.subzones[i]]["name_"+Locale.getName()]),$WH.ae(r,a)}$WH.ae(s,r)}},getVisibleText:function(e){var t=e.name+Listview.funcBox.getExpansionText(e);return 5!=e.instance&&8!=e.instance||(t+=" heroic"),t}},{id:"level",name:LANG.level,type:"range",width:"10%",getMinValue:function(e){return e.minlevel},getMaxValue:function(e){return e.maxlevel},compute:function(e,t){if(e.minlevel>0&&e.maxlevel>0)return e.minlevel!=e.maxlevel?e.minlevel+LANG.hyphen+e.maxlevel:e.minlevel},sortFunc:function(e,t,s){return s>0?$WH.strcmp(e.minlevel,t.minlevel)||$WH.strcmp(e.maxlevel,t.maxlevel):$WH.strcmp(e.maxlevel,t.maxlevel)||$WH.strcmp(e.minlevel,t.minlevel)}},{id:"players",name:LANG.players,type:"text",hidden:!0,compute:function(e,t){if(e.instance>0){var s=$WH.ce("span");-2==e.nplayers&&(e.nplayers="10/25");var i="";e.nplayers&&(4==e.instance?i+=$WH.sprintf(LANG.lvzone_xvx,e.nplayers,e.nplayers):i+=$WH.sprintf(LANG.lvzone_xman,e.nplayers)),$WH.ae(s,$WH.ct(i)),$WH.ae(t,s)}},getVisibleText:function(e){if(e.instance>0){-2==e.nplayers&&(e.nplayers="10/25");var t="";return e.nplayers&&(2!=e.instance&&5!=e.instance||e.nplayers>5)&&(4==e.instance?t+=$WH.sprintf(LANG.lvzone_xvx,e.nplayers,e.nplayers):t+=$WH.sprintf(LANG.lvzone_xman,e.nplayers)),t}},sortFunc:function(e,t,s){return $WH.strcmp(e.nplayers,t.nplayers)}},{id:"territory",name:LANG.territory,type:"text",width:"13%",compute:function(e,t){var s=$WH.ce("span");switch(e.territory){case 0:s.className="icon-alliance";break;case 1:s.className="icon-horde";break;case 4:s.className="icon-ffa"}$WH.ae(s,$WH.ct(g_zone_territories[e.territory])),$WH.ae(t,s)},getVisibleText:function(e){return g_zone_territories[e.territory]},sortFunc:function(e,t,s){return $WH.strcmp(g_zone_territories[e.territory],g_zone_territories[t.territory])}},{id:"instancetype",name:LANG.instancetype,type:"text",compute:function(e,t){if(e.instance>0){var s=$WH.ce("span");(e.instance>=1&&e.instance<=5||7==e.instance||8==e.instance)&&(s.className="icon-instance"+e.instance);var i=g_zone_instancetypes[e.instance];if(e.heroicLevel){var a=$WH.ce("span");a.className="icon-heroic",g_addTooltip(a,LANG.tooltip_heroicmodeavailable+LANG.qty.replace("$1",e.heroicLevel)),$WH.ae(t,a)}$WH.ae(s,$WH.ct(i)),$WH.ae(t,s)}},
getVisibleText:function(e){if(e.instance>0){var t=g_zone_instancetypes[e.instance];return e.nplayers&&(2!=e.instance&&5!=e.instance||e.nplayers>5)&&(4==e.instance?t+=" "+$WH.sprintf(LANG.lvzone_xvx,e.nplayers,e.nplayers):t+=" "+$WH.sprintf(LANG.lvzone_xman,e.nplayers)),5!=e.instance&&8!=e.instance||(t+=" heroic"),t}},sortFunc:function(e,t,s){return $WH.strcmp(g_zone_instancetypes[e.instance],g_zone_instancetypes[t.instance])||$WH.strcmp(e.instance,t.instance)||$WH.strcmp(e.nplayers,t.nplayers)}},{id:"category",name:LANG.category,type:"text",width:"15%",compute:function(e,t){t.className="small q1";var s=$WH.ce("a");s.href="?zones="+e.category,$WH.ae(s,$WH.ct(g_zone_categories[e.category])),$WH.ae(t,s)},getVisibleText:function(e){return g_zone_categories[e.category]},sortFunc:function(e,t,s){return $WH.strcmp(g_zone_categories[e.category],g_zone_categories[t.category])}}],getItemLink:function(e){return"?zone="+e.id}},holiday:{sort:[2,1],nItemsPerPage:-1,searchable:1,filtrable:1,columns:[{id:"name",name:LANG.name,type:"text",align:"left",value:"name",span:2,compute:function(e,t,s){var i=$WH.ce("td");i.style.width="1px",i.style.padding="0",i.style.borderRight="none",$WH.ae(i,g_holidays.createIcon(e.id,0)),$WH.ae(s,i),t.style.borderLeft="none";var a=$WH.ce("a");a.style.fontFamily="Verdana, sans-serif",a.href=this.getItemLink(e),$WH.ae(a,$WH.ct(e.name)),$WH.ae(t,a)},getVisibleText:function(e){return e.name}},{id:"date",name:LANG.date,type:"text",width:"16%",allText:!0,compute:function(e,t,s){if(e.startDate&&e.endDate){var i=Listview.funcBox.getEventNextDates(e.startDate,e.endDate,e.rec||0);if(i[0]&&i[1]){var a=g_formatDateSimple(i[0]),n=g_formatDateSimple(i[1]),o=$WH.ce("span");a!=n?$WH.st(o,a+LANG.hyphen+n):$WH.st(o,a),$WH.ae(t,o),i[0]<=g_serverTime&&i[1]>=g_serverTime&&(s.className="checked",o.className="q2 tip",g_addTooltip(o,LANG.tooltip_activeholiday,"q"))}}},getVisibleText:function(e){if(e.startDate&&e.endDate){var t=Listview.funcBox.getEventNextDates(e.startDate,e.endDate,e.rec||0);if(t[0]&&t[1]){var s=g_formatDateSimple(t[0]),i=g_formatDateSimple(t[1]);return s!=i?s+LANG.hyphen+i:s}}return""},sortFunc:function(e,t,s){if(e.startDate&&t.startDate){var i=Listview.funcBox.getEventNextDates(e.startDate,e.endDate,e.rec||0),a=Listview.funcBox.getEventNextDates(t.startDate,t.endDate,t.rec||0);if(i[0]&&a[0])return i[0]-a[0]}else{if(e.startDate)return-1;if(t.startDate)return 1}return 0}},{id:"category",name:LANG.category,type:"text",width:"16%",compute:function(e,t){t.className="small q1";var s=$WH.ce("a"),i="?events="+e.category;s.href=i,$WH.ae(s,$WH.ct(g_holiday_categories[e.category])),$WH.ae(t,s)},getVisibleText:function(e){return g_holiday_categories[e.category]},sortFunc:function(e,t,s){return $WH.strcmp(g_holiday_categories[e.category],g_holiday_categories[t.category])}}],getItemLink:function(e){return"?event="+e.id}},holidaycal:{sort:[1],mode:4,startOnMonth:new Date(g_serverTime.getFullYear(),0,1),nMonthsToDisplay:12,rowOffset:g_serverTime.getMonth(),poundable:2,columns:[],compute:function(e,t,s){if(e.events&&e.events.length)for(var s=0;s<e.events.length;++s){var i=g_holidays.createIcon(e.events[s].id,1);i.onmouseover=Listview.funcBox.dateEventOver.bind(i,e.date,e.events[s]),i.onmousemove=$WH.Tooltip.cursorUpdate,i.onmouseout=$WH.Tooltip.hide,i.style.cssFloat=i.style.styleFloat="left",$WH.ae(t,i)}},sortFunc:function(e,t){if(e.startDate&&t.startDate)for(var s=Listview.funcBox.getEventNextDates(e.startDate,e.endDate,e.rec||0),i=Listview.funcBox.getEventNextDates(t.startDate,t.endDate,t.rec||0),a=0;a<2;++a){var n=s[a],o=i[a];if(n.getFullYear()==o.getFullYear()&&n.getMonth()==o.getMonth()&&n.getDate()==o.getDate())return n-o}return $WH.strcmp(e.name,t.name)}},comment:{sort:[-5,4,6,-3,2],mode:2,nItemsPerPage:40,poundable:2,columns:[{value:"number"},{value:"id"},{value:"rating"},{value:"deleted"},{value:"sticky"},{value:"outofdate"}],compute:function(e,t,s){var i=$("<div></div>"),a=e.__minPatch&&g_getPatchVersion.T[e.__minPatch]>new Date(e.date);e.locale="english-comments"==this.id?"www":"",i.append('<table><tr><td class="vote-column"><p class="upvote">+</p><div class="rating-container"></div><p class="downvote">-</p><p class="comment-sticky" title="'+LANG.stickycomment_tip+'">STICKY</p></td><td class="main-body"><div class="comment-header"><table><tr><td class="comment-author"></td><td class="comment-controls"></td><td class="comment-notification"></td></tr></table></div><div class="text comment-body"></div><div class="comment-replies"></div><p class="comment-replies-control" style="display: none"></p></td></tr></table>'),e.colorClass="comment"+s%2,i.addClass("comment").addClass(e.colorClass),e.rating<-4&&i.addClass("comment-lowrated"),e.deleted&&i.addClass("comment-deleted"),e.outofdate&&i.addClass("comment-outofdate"),e.container=i,e.voteCell=i.find(".vote-column"),e.commentCell=i.find(".main-body"),e.repliesCell=i.find(".comment-replies"),e.repliesControl=i.find(".comment-replies-control"),e.headerCell=i.find(".comment-header"),e.commentBody=i.find(".comment-body"),e.commentAuthor=i.find(".comment-author"),e.commentControls=i.find(".comment-controls"),this.template.updateVoteCell(e,!0),this.template.updateCommentCell(e),this.template.updateStickyStatus(e),this.template.updateReplies(e),(e.deleted||e.rating<-4)&&(e.headerCell.css("cursor","pointer"),e.headerCell.bind("click",function(t){"A"!=$WH.$E(t)._target.nodeName&&(e.voteCell.toggle(),e.repliesCell.toggle(),e.commentBody.toggle())})),$(t).addClass("comment-wrapper").html(i),a?$(t).hide():$(t).show()},updateReplies:function(e){if(this.updateRepliesCell(e),this.updateRepliesControl(e),SetupReplies(e.container,e),!e.alreadyLoadedBefore){e.alreadyLoadedBefore=!0;var t=location.hash.match("#comments:id=([0-9]+):reply=([0-9]+)");if(t){var s=t[1],i=t[2];e.id==s&&this.highlightReply(e,i)}}},highlightReply:function(e,t,s){var i=null;for(var a in e.replies)if(e.replies[a].id==t){i=e.replies[a];break}if(!i){if(s)return;return void $.ajax({type:"GET",url:"?comment=show-replies",data:{id:e.id},success:function(s){e.replies=s,Listview.templates.comment.updateReplies(e),Listview.templates.comment.highlightReply(e,t,!0)},dataType:"json"})}var n=e.repliesCell.find(".comment-reply-row[data-replyid="+t+"]"),o="#292929";e.deleted?o="#402424":e.outofdate?o="#322C1C":"comment0"==e.colorClass&&(o="#242424"),n.css("background-color","#581111"),setTimeout(function(){n.animate({backgroundColor:o},1500)},1500)},updateStickyStatus:function(e){e.sticky?e.voteCell.find(".comment-sticky").show():e.voteCell.find(".comment-sticky").hide()},updateRepliesCell:function(e){var t=e.repliesCell,s=$("<table></table>");if(t.html(""),!e.replies.length)return void t.append(s).hide();for(var i=0;i<e.replies.length;++i){var a=e.replies[i],n=$('<tr class="comment-reply-row"><td class="reply-controls"><p class="reply-upvote">upvote</p><p class="reply-rating"></p><p class="reply-downvote">downvote</p></td><td class="reply-text"></td></tr>'),o=$('<p class="comment-reply-author"></p>'),r=$("<a></a>"),l=new Date(a.creationdate),c=(g_serverTime-l)/1e3,u=n.find(".reply-upvote"),d=n.find(".reply-downvote"),p=g_user.name==a.username||0!=(g_user.roles&U_GROUP_COMMENTS_MODERATOR),h=p;n.attr("data-replyid",a.id),n.attr("data-idx",i),n.find(".reply-text").addClass(g_GetStaffColorFromRoles(a.roles));var m=$("<a></a>");m.text(g_formatDate(null,c,l)),m.attr("href","#comments:id="+e.id+":reply="+a.id),m.attr("id","comments:id="+e.id+":reply="+a.id),m.addClass("when"),r.attr("href","?user="+a.username),r.text(a.username),o.append(r),o.append(" ").append(m).append(" ").append($WH.sprintf(LANG.lvcomment_patch,g_getPatchVersion(l)));var f=Markup.toHtml(a.body,{allow:Markup.CLASS_USER,mode:Markup.MODE_REPLY,roles:0,locale:e.locale});f=f.replace(/[^\s<>]{81,}/,function(e){if("href"==e.substring(0,4)||"src"==e.substring(0,3))return e;var t="";for(j=0;j<e.length;j+=80)t+=e.substring(j,80+j)+" ";return t}),g_user.canUpvote&&g_user.name!=a.username&&!a.reportedByUser&&(f+=' <span class="reply-report" title="'+LANG.reportthisreply_stc+'">report</span>'),h&&(f+=' <span class="reply-edit" title="'+LANG.editthisreply_stc+'">edit</span>'),g_user.roles&U_GROUP_COMMENTS_MODERATOR&&(f+=' <span class="reply-detach" title="'+LANG.lvcomment_detach+'">detach</span>'),p&&(f+=' <span class="reply-delete" title="'+LANG.deletethisreply_stc+'">delete</span>'),n.find(".reply-text").html(o).append(f),n.find(".reply-rating").text(a.rating),a.votedByUser&&u.attr("data-hasvoted","true"),!g_user.canUpvote||g_user.name==a.username||a.votedByUser||a.downvotedByUser||u.attr("data-canvote","true"),a.downvotedByUser&&d.attr("data-hasvoted","true"),!g_user.canDownvote||g_user.name==a.username||a.votedByUser||a.downvotedByUser||d.attr("data-canvote","true"),s.append(n)}t.html(s),(e.deleted||e.rating<-4)&&e.repliesCell.hide()},updateRepliesControl:function(e){var t=e.repliesControl;t.html("").hide().unbind().attr("class","comment-replies-control");var s=Math.max(e.nreplies-e.replies.length,0);e.deleted||e.outofdate||e.rating<-4||!g_user.canPostReplies&&!s||(g_user.canPostReplies?s?t.text($WH.sprintf(1==s?LANG.addshow1morereply_stc:LANG.addshowmorereplies_format,s)).addClass("show-more-replies"):t.text(LANG.addreply_stc).addClass("add-reply"):t.text($WH.sprintf(1==s?LANG.show1morereply_stc:LANG.showmorereplies_format,s)).addClass("show-more-replies"),t.show())},updateCommentCell:function(e){e.commentCell.find(".comment-edit").remove(),this.updateCommentBody(e,e.commentBody),this.updateCommentAuthor(e,e.commentAuthor),this.updateCommentControls(e,e.commentControls)},updateCommentAuthor:function(e,t){var s=g_users[e.user],i=new Date(e.date),a=(g_serverTime-i)/1e3;t.html(""),t.append(LANG.lvcomment_by),t.append($WH.sprintf('<a href="?user=$1">$2</a>',e.user,e.user)),t.append(g_getReputationPlusAchievementText(s.gold,s.silver,s.copper,s.reputation)),t.append($WH.sprintf(' <a class="q0" id="comments:id=$1" href="#comments:id=$2">$3</a>',e.id,e.id,g_formatDate(null,a,i))),t.append(" "),t.append($WH.sprintf(LANG.lvcomment_patch,g_getPatchVersion(i)))},updateCommentControls:function(e,t){var s=[],i=0!=(g_user.roles&U_GROUP_COMMENTS_MODERATOR)||e.user.toLowerCase()==g_user.name.toLowerCase()&&!g_user.commentban,a=0!=(g_user.roles&U_GROUP_COMMENTS_MODERATOR)||e.user.toLowerCase()==g_user.name.toLowerCase()&&!g_user.commentban,n=0!=(g_user.roles&U_GROUP_COMMENTS_MODERATOR);i&&(e.outofdate||e.deleted||s.push({name:LANG.lvcomment_edit,func:Listview.funcBox.coEdit.bind(this,e,0,!1)})),a&&!e.deleted&&s.push({name:LANG.lvcomment_delete,func:Listview.funcBox.coDelete.bind(this,e)}),n&&e.deleted&&s.push({name:LANG.lvcomment_undelete,func:Listview.funcBox.coUndelete.bind(this,e)}),n&&e.outofdate&&s.push({name:LANG.lvcomment_uptodate,func:Listview.funcBox.coFlagUpOfDate.bind(this,e)}),0==g_user.id||e.outofdate||e.deleted||s.push({name:LANG.lvcomment_outofdate,func:Listview.funcBox.coFlagOutOfDate.bind(this,e)}),!n||e.sticky||e.outofdate||e.deleted||s.push({name:"Sticky",func:this.sticky.bind(this,e)}),n&&e.sticky&&!e.outofdate&&!e.deleted&&s.push({name:"Unsticky",func:this.sticky.bind(this,e)}),e.outofdate||e.deleted||s.push({extraClass:"icon-report",tooltip:LANG.report_tooltip,name:LANG.lvcomment_report,func:ContactTool.show.bind(ContactTool,{mode:1,comment:e})}),t.html("");for(var o in s){var r=s[o],l=$("<a></a>"),c=$("<span></span>");0!=o&&c.append(" | "),l.click(r.func),l.text(r.name),r.extraClass&&l.addClass(r.extraClass),r.tooltip&&l.mouseover(function(e){$WH.Tooltip.showAtCursor(e,r.tooltip,0,0,"q2")}).mousemove(function(e){$WH.Tooltip.cursorUpdate(e)}).mouseout(function(){$WH.Tooltip.hide()}),c.append(l),t.append(c)}},updateCommentBody:function(e,t){var s=Markup.rolesToClass(e.roles);if(t.removeClass("comment-green"),t.addClass(Listview.funcBox.coGetColor(e)),t.html(Markup.toHtml(e.body,{allow:s,mode:Markup.MODE_COMMENT,roles:e.roles,locale:e.locale})),e.response){var i=$("<div></div>");i.addClass("text comment-body"),i.html(Markup.toHtml("[div][/div][wowheadresponse="+e.responseuser+" roles="+e.responseroles+"]"+e.response+"[/wowheadresponse]",{allow:Markup.CLASS_STAFF,roles:e.responseroles,uid:"resp-"+e.id})),t.append(i)}e.lastEdit&&this.addEditedByOrDeletedByText(t,LANG.lvcomment_lastedit,e.lastEdit[2],e.lastEdit[0],e.lastEdit[1]),e.deletedInfo&&this.addEditedByOrDeletedByText(t,LANG.lvcomment_deletedby,e.deletedInfo[1],e.deletedInfo[0],null),e.divBody=t[0],(e.deleted||e.rating<-4)&&t.hide()},addEditedByOrDeletedByText:function(e,t,s,i,a){var n=new Date(i),o=(g_serverTime-n)/1e3;a=a>1?LANG.dash+$WH.sprintf(LANG.lvcomment_nedits,a):"";var r=$("<div></div>");r.addClass("comment-lastedit"),r.html($WH.sprintf("$1 <a></a> $2 $3$4",t,g_formatDate(null,o,n),$WH.sprintf(LANG.lvcomment_patch,g_getPatchVersion(n)),a)),r.find("a").text(s).attr("href","?user="+s),e.append(r)},updateVoteCell:function(e,t){var s=e.voteCell.find(".upvote"),i=e.voteCell.find(".downvote"),a=e.voteCell.find(".rating-container"),n=$('<p class="rating"></p>'),o=this;a.html(n),e.userRating>0?s.attr("data-hasvoted","true").attr("title",LANG.upvoted_tip):s.attr("data-hasvoted","false").attr("title",LANG.upvote_tip),e.userRating<0?i.attr("data-hasvoted","true").attr("title",LANG.downvoted_tip):i.attr("data-hasvoted","false").attr("title",LANG.downvote_tip),g_addTooltip(s[0],LANG.tooltip_uprate,"q2"),g_addTooltip(i[0],LANG.tooltip_downrate,"q10"),n.unbind(),s.unbind(),i.unbind(),n.text(e.rating),n.click(function(){o.showVoteBreakdown(e,a)}),s.click(function(){o.vote(e,1)}),i.click(function(){o.vote(e,-1)}),(e.deleted||e.rating<-4)&&t&&e.voteCell.hide()},vote:function(e,t){if(t){if(!g_user.id)return void this.voteError(e,LANG.votelogin_tip);if(e.deleted)return void this.voteError(e,LANG.votedeleted_tip);if(g_user.name==e.user)return void this.voteError(e,LANG.voteself_tip);if(!g_user.canUpvote&&t>0)return void this.voteError(e,$WH.sprintf(LANG.upvotenorep_tip,g_user.upvoteRep));if(!g_user.canDownvote&&t<0)return void this.voteError(e,$WH.sprintf(LANG.downvotenorep_tip,g_user.downvoteRep));if(t>0)t=g_user.superCommentVotes?2:1;else{if(!(t<0))return;t=g_user.superCommentVotes?-2:-1}var s=e.rating,i=e.userRating,a=this;e.userRating>0&&t>0||e.userRating<0&&t<0?(e.rating-=e.userRating,e.userRating=0):(e.rating-=e.userRating,e.rating+=t,e.userRating=t),this.updateVoteCell(e),$.get("?comment=vote",{id:e.id,rating:t},function(t){t.error&&(e.rating=s,e.userRating=i,a.updateVoteCell(e)),t.message&&a.voteError(e,t.message)},"json")}},voteError:function(e,t){MessageBox(e.voteCell,t)},showVoteBreakdown:function(e,t){t.find("p").html('<img src="'+g_staticDataUrl+'/images/icons/ajax.gif" />'),$.get("?comment=rating&id="+e.id,null,function(e){e.success?t.html($WH.sprintf('<p class="rating-up">$1</p><div class="rating-separator"></div><p class="rating-down">$2</p>',e.up?"+"+e.up:0,-e.down)):MessageBox(t,"An error has occurred while fetching vote counts. Try refreshing the page.")},"json")},sticky:function(e){var t=e.commentCell.find(".comment-notification");e.sticky=!e.sticky,this.updateStickyStatus(e),this.updateCommentCell(e),e.sticky?MessageBox(t,"This comment is now sticky."):MessageBox(t,"This comment is no longer sticky."),$.post("?comment=sticky",{id:e.id,sticky:e.sticky?1:0})},createNote:function(e){var t=$WH.ce("small");if(!g_user.commentban){var s=$WH.ce("a");g_user.id>0?(s.href="javascript:;",s.onclick=co_addYourComment):s.href="?account=signin",$WH.ae(s,$WH.ct(LANG.lvcomment_add)),$WH.ae(t,s);var i=$WH.ce("span");i.style.padding="0 5px",i.style.color="white",$WH.ae(i,$WH.ct("|")),$WH.ae(t,i)}$WH.ae(t,$WH.ct(LANG.sort+LANG.colon));var a=$WH.ce("a");a.href="javascript:;",$WH.ae(a,$WH.ct(LANG.newestfirst_stc)),a.onclick=Listview.funcBox.coSortNewestFirst.bind(this,a),$WH.ae(t,a),$WH.ae(t,$WH.ct(LANG.comma));var n=$WH.ce("a");n.href="javascript:;",$WH.ae(n,$WH.ct(LANG.oldestfirst_stc)),n.onclick=Listview.funcBox.coSortOldestFirst.bind(this,n),$WH.ae(t,n),$WH.ae(t,$WH.ct(LANG.comma));var o=$WH.ce("a");switch(o.href="javascript:;",$WH.ae(o,$WH.ct(LANG.highestrated_stc)),o.onclick=Listview.funcBox.coSortHighestRatedFirst.bind(this,o),$WH.ae(t,o),$WH.gc().comments_sort){case"1":a.onclick();break;case"2":n.onclick();break;default:case"3":o.onclick()}var i=$WH.ce("span");i.style.padding="0 5px",i.style.color="white",$WH.ae(i,$WH.ct("|")),$WH.ae(t,i);var r=$WH.ce("select"),l=$WH.ce("option");l.value=0,l.selected="selected",$WH.ae(r,l);for(var c={},u=0;u<this.data.length;++u){c[g_getPatchVersionIndex(new Date(this.data[u].date).getTime())]=!0}var d=[];for(var p in c)d.push(p);d.sort(function(e,t){return t-e});for(var p=0;p<d.length;++p){var l=$WH.ce("option");l.value=d[p],$WH.ae(l,$WH.ct(g_getPatchVersion.V[d[p]])),$WH.ae(r,l)}r.onchange=Listview.funcBox.coFilterByPatchVersion.bind(this,r),$WH.ae(t,$WH.ct(LANG.lvcomment_patchfilter)),$WH.ae(t,r),$WH.ae(e,t),this.tabClick&&$("a, select",t).click(this.tabClick)},onNoData:function(e){var t="<b>"+LANG.lvnodata_co1+'</b><div class="pad2"></div>';if(g_user.id>0){var s=LANG.lvnodata_co2;s=s.replace("<a>",'<a href="javascript:;" onclick="co_addYourComment()" onmousedown="return false">'),t+=s}else{var s=LANG.lvnodata_co3;s=s.replace("<a>",'<a href="?account=signin">'),s=s.replace("<a>",'<a href="?account=signup">'),t+=s}e.style.padding="1.5em 0",e.innerHTML=t},onBeforeCreate:function(){if(location.hash&&null!=location.hash.match(/:id=([0-9]+)/)){switch($WH.gc().comments_sort){case"1":this.setSort([-5,4,-1,-2],!1,!1);break;case"2":this.setSort([-5,4,1,2],!1,!1);break;default:case"3":this.setSort([-5,4,-3,2],!1,!1)}var e=$WH.in_array(this.data,parseInt(RegExp.$1),function(e){return e.id});return this.rowOffset=this.getRowOffset(e),this.data[e]}},onAfterCreate:function(e){if(null!=e){var t=e.__div;this.tabs.__st=t}}},commentpreview:{sort:[4],nItemsPerPage:75,columns:[{id:"subject",name:LANG.subject,align:"left",value:"subject",compute:function(e,t){var s=$WH.ce("a");if(s.style.fontFamily="Verdana, sans-serif",s.href=this.getItemLink(e),$WH.ae(s,$WH.ct(e.subject)),$WH.ae(t,s),LANG.types[e.type]){var i=$WH.ce("div");i.className="small",$WH.ae(i,$WH.ct(LANG.types[e.type][0])),$WH.ae(t,i)}}},{id:"preview",name:LANG.preview,align:"left",width:"50%",value:"preview",compute:function(e,t,s){var i=$WH.ce("div");if(i.className="crop",e.rating>=10&&(i.className+=" comment-green"),$WH.ae(i,$WH.ct(Markup.removeTags(e.preview,{mode:Markup.MODE_ARTICLE}))),$WH.ae(t,i),null!==e.rating||e.deleted){i=$WH.ce("div"),i.className="small3",e.rating&&$WH.ae(i,$WH.ct(LANG.lvcomment_rating+(e.rating>0?"+":"")+e.rating));var a=$WH.ce("span"),n="";a.className="q10",e.deleted&&(n=LANG.lvcomment_deleted),$WH.ae(a,$WH.ct(n)),$WH.ae(i,a),s.__status=a,$WH.ae(t,i)}}},{id:"author",name:LANG.author,value:"user",compute:function(e,t){t.className="q1";var s=$WH.ce("a");s.href="?user="+e.user,$WH.ae(s,$WH.ct(e.user)),$WH.ae(t,s)}},{id:"posted",name:LANG.posted,width:"16%",value:"elapsed",compute:function(e,t){var s=new Date(e.date),i=(g_serverTime-s)/1e3,a=$WH.ce("span");g_formatDate(a,i,s,0,1),$WH.ae(t,a)}}],getItemLink:function(e){return"?"+g_types[e.type]+"="+e.typeId+(null!=e.id?"#comments:id="+e.id:"")}},replypreview:{sort:[4],nItemsPerPage:75,columns:[{id:"subject",name:LANG.subject,align:"left",value:"subject",compute:function(e,t){var s=$WH.ce("a");if(s.style.fontFamily="Verdana, sans-serif",s.href=this.getItemLink(e),$WH.ae(s,$WH.ct(e.subject)),$WH.ae(t,s),LANG.types[e.type]){var i=$WH.ce("div");i.className="small",$WH.ae(i,$WH.ct(LANG.types[e.type][0])),$WH.ae(t,i)}}},{id:"preview",name:LANG.preview,align:"left",width:"50%",value:"preview",compute:function(e,t,s){var i=$WH.ce("div");if(i.className="crop",e.rating>=10&&(i.className+=" comment-green"),$WH.ae(i,$WH.ct(Markup.removeTags(e.preview,{mode:Markup.MODE_ARTICLE}))),$WH.ae(t,i),e.rating){i=$WH.ce("div"),i.className="small3",$WH.ae(i,$WH.ct(LANG.lvcomment_rating+(e.rating>0?"+":"")+e.rating));var a=$WH.ce("span");a.className="q10",$WH.ae(a,$WH.ct("")),$WH.ae(i,a),s.__status=a,$WH.ae(t,i)}}},{id:"author",name:LANG.author,value:"user",compute:function(e,t){t.className="q1";var s=$WH.ce("a");s.href="?user="+e.user,$WH.ae(s,$WH.ct(e.user)),$WH.ae(t,s)}},{id:"posted",name:LANG.posted,width:"16%",value:"elapsed",compute:function(e,t){var s=new Date(e.date),i=(g_serverTime-s)/1e3,a=$WH.ce("span");g_formatDate(a,i,s,0,1),$WH.ae(t,a)}}],getItemLink:function(e){return e.url?"?"+e.url:g_types[e.type]?$WH.sprintf("?$1=$2#comments:id=$3:reply=$4",g_types[e.type],e.typeId,e.commentid,e.id):"?go-to-reply&id="+e.id}},screenshot:{sort:[],mode:3,nItemsPerPage:40,nItemsPerRow:4,poundable:2,columns:[],compute:function(e,t,s){var i=new Date(e.date),a=(g_serverTime-i)/1e3;t.className="screenshot-cell",t.vAlign="bottom";var n=$WH.ce("a");n.href="#screenshots:id="+e.id,n.onclick=$WH.rf2;var o=$WH.ce("img");Math.min(150/e.width,150/e.height);o.src=g_staticUrl+"/uploads/screenshots/thumb/"+e.id+".jpg",$WH.ae(n,o),$WH.ae(t,n);var r=$WH.ce("div");r.className="screenshot-cell-user";var l=null!=e.user&&e.user.length;l&&(n=$WH.ce("a"),n.href="?user="+e.user,$WH.ae(n,$WH.ct(e.user)),$WH.ae(r,$WH.ct(LANG.lvscreenshot_from)),$WH.ae(r,n),$WH.ae(r,$WH.ct(" ")));var c=$WH.ce("span");l?g_formatDate(c,a,i):g_formatDate(c,a,i,0,1),$WH.ae(r,c),$WH.ae(r,$WH.ct(" "+LANG.dash+" "));var n=$WH.ce("a");n.href="javascript:;",n.onclick=ContactTool.show.bind(ContactTool,{mode:3,screenshot:e}),n.className="icon-report",g_addTooltip(n,LANG.report_tooltip,"q2"),$WH.ae(n,$WH.ct(LANG.report)),$WH.ae(r,n),$WH.ae(t,r),r=$WH.ce("div"),r.style.position="relative",r.style.height="1em";var u=null!=e.caption&&e.caption.length,d=null!=e.subject&&e.subject.length;if(u||d){var p=$WH.ce("div");if(p.className="screenshot-caption",d){var h=$WH.ce("small");$WH.ae(h,$WH.ct(LANG.types[e.type][0]+LANG.colon));var m=$WH.ce("a");$WH.ae(m,$WH.ct(e.subject)),m.href="?"+g_types[e.type]+"="+e.typeId,$WH.ae(h,m),$WH.ae(p,h),u&&e.caption.length&&$WH.ae(h,$WH.ct(" (...)")),$WH.ae(h,$WH.ce("br"))}if(u){$WH.aE(t,"mouseover",Listview.funcBox.ssCellOver.bind(p)),$WH.aE(t,"mouseout",Listview.funcBox.ssCellOut.bind(p));var f=$WH.ce("span");f.innerHTML=Markup.toHtml(e.caption,{mode:Markup.MODE_SIGNATURE}),$WH.ae(p,f)}$WH.ae(r,p)}$WH.aE(t,"click",Listview.funcBox.ssCellClick.bind(this,s)),$WH.ae(t,r)},createNote:function(e){if("object"==typeof g_pageInfo&&g_pageInfo.type>0){var t=$WH.ce("small"),s=$WH.ce("a");g_user.id>0?(s.href="javascript:;",s.onclick=ss_submitAScreenshot):s.href="?account=signin",$WH.ae(s,$WH.ct(LANG.lvscreenshot_submit)),$WH.ae(t,s),$WH.ae(e,t)}},onNoData:function(e){if(!("object"==typeof g_pageInfo&&g_pageInfo.type>0))return-1;var t="<b>"+LANG.lvnodata_ss1+'</b><div class="pad2"></div>';if(g_user.id>0){var s=LANG.lvnodata_ss2;s=s.replace("<a>",'<a href="javascript:;" onclick="ss_submitAScreenshot()" onmousedown="return false">'),t+=s}else{var s=LANG.lvnodata_ss3;s=s.replace("<a>",'<a href="?account=signin">'),s=s.replace("<a>",'<a href="?account=signup">'),t+=s}e.style.padding="1.5em 0",e.innerHTML=t},onBeforeCreate:function(){if(location.hash&&null!=location.hash.match(/:id=([0-9]+)/)){var e=$WH.in_array(this.data,parseInt(RegExp.$1),function(e){return e.id});return this.rowOffset=this.getRowOffset(e),e}},onAfterCreate:function(e){null!=e&&setTimeout(function(){ScreenshotViewer.show({screenshots:this.data,pos:e})}.bind(this),1)}},sound:{searchable:1,filtrable:1,columns:[{id:"name",name:LANG.name,type:"text",align:"left",value:"name",compute:function(e,t){var s=$WH.ce("a");s.className="listview-cleartext",s.href="?sound="+e.id,$WH.st(s,e.name),$WH.ae(t,s)}},{id:"type",name:LANG.type,type:"text",compute:function(e,t){var s="";if(!this.hasOwnProperty("soundtypecache")){var i={};for(var a in mn_sounds)mn_sounds[a][0]<1e3&&(i[mn_sounds[a][0]]=mn_sounds[a][1]);this.soundtypecache=i}this.soundtypecache.hasOwnProperty(e.type)&&(s=this.soundtypecache[e.type]),$WH.st(t,s)},sortFunc:function(e,t){if(!this.hasOwnProperty("soundtypecache")){var s={};for(var i in mn_sounds)mn_sounds[i][0]<1e3&&(s[mn_sounds[i][0]]=mn_sounds[i][1]);this.soundtypecache=s}var a=this.soundtypecache.hasOwnProperty(e.type)?this.soundtypecache[e.type]:"",n=this.soundtypecache.hasOwnProperty(t.type)?this.soundtypecache[t.type]:"";return $WH.strcmp(a,n)||$WH.strcmp(e.name,t.name)}},{id:"activity",name:LANG.activity,hidden:!0,type:"text",compute:function(e,t){return e.hasOwnProperty("activity")?LANG.sound_activities.hasOwnProperty(e.activity)?LANG.sound_activities[e.activity]:e.activity:""},sortFunc:function(e,t){return $WH.strcmp(this.compute(e),this.compute(t))}},{id:"sound",name:LANG.types[19][2],span:2,compute:function(e,t,s){var i=$WH.ce("td");i.className="nowrap",$WH.ae(s,i),i.style.borderRight="none",t.className="nowrap",t.style.borderLeft="none";var a=$WH.ce("div");$WH.ae(i,a),(new AudioControls).init(e.files,a,{listview:this,trackdisplay:t})}}],getItemLink:function(e){return"?sound="+e.id}},video:{sort:[],mode:3,nItemsPerPage:40,nItemsPerRow:4,poundable:2,columns:[],compute:function(e,t,s){var i=new Date(e.date),a=(g_serverTime-i)/1e3;t.className="screenshot-cell",t.vAlign="bottom";var n=$WH.ce("a");n.href="#videos:id="+e.id,n.onclick=$WH.rf2;var o=$WH.ce("img");o.src=$WH.sprintf(vi_thumbnails[e.videoType],e.videoId),$WH.ae(n,o),$WH.ae(t,n);var r=$WH.ce("div");r.className="screenshot-cell-user";var l=null!=e.user&&e.user.length;l&&(n=$WH.ce("a"),n.href="?user="+e.user,$WH.ae(n,$WH.ct(e.user)),$WH.ae(r,$WH.ct(LANG.lvvideo_from)),$WH.ae(r,n),$WH.ae(r,$WH.ct(" ")));var c=$WH.ce("span");l?g_formatDate(c,a,i):g_formatDate(c,a,i,0,1),$WH.ae(r,c),$WH.ae(r,$WH.ct(" "+LANG.dash+" "));var n=$WH.ce("a");n.href="javascript:;",n.onclick=ContactTool.show.bind(ContactTool,{mode:5,video:e}),n.className="icon-report",g_addTooltip(n,LANG.report_tooltip,"q2"),$WH.ae(n,$WH.ct(LANG.report)),$WH.ae(r,n),$WH.ae(t,r),r=$WH.ce("div"),r.style.position="relative",r.style.height="1em";var u=null!=e.caption&&e.caption.length,d=null!=e.subject&&e.subject.length;if(u||d){var p=$WH.ce("div");if(p.className="screenshot-caption",d){var h=$WH.ce("small");$WH.ae(h,$WH.ct(LANG.types[e.type][0]+LANG.colon));var m=$WH.ce("a");$WH.ae(m,$WH.ct(e.subject)),m.href="?"+g_types[e.type]+"="+e.typeId,$WH.ae(h,m),$WH.ae(p,h),u&&e.caption.length&&$WH.ae(h,$WH.ct(" (...)")),$WH.ae(h,$WH.ce("br"))}if(u){$WH.aE(t,"mouseover",Listview.funcBox.ssCellOver.bind(p)),$WH.aE(t,"mouseout",Listview.funcBox.ssCellOut.bind(p));var f=$WH.ce("span");f.innerHTML=Markup.toHtml(e.caption,{mode:Markup.MODE_SIGNATURE}),$WH.ae(p,f)}$WH.ae(r,p)}$WH.aE(t,"click",Listview.funcBox.viCellClick.bind(this,s)),$WH.ae(t,r)},createNote:function(e){if(g_user&&g_user.roles&(U_GROUP_ADMIN|U_GROUP_BUREAU|U_GROUP_VIDEO)&&"object"==typeof g_pageInfo&&g_pageInfo.type>0){var t=$WH.ce("small"),s=$WH.ce("a");g_user.id>0?(s.href="javascript:;",s.onclick=vi_submitAVideo):s.href="?account=signin",$WH.ae(s,$WH.ct(LANG.lvvideo_suggest)),$WH.ae(t,s),$WH.ae(e,t)}},onNoData:function(e){if(!("object"==typeof g_pageInfo&&g_pageInfo.type>0))return-1;var t="<b>"+LANG.lvnodata_vi1+'</b><div class="pad2"></div>';if(g_user.id>0){var s=LANG.lvnodata_vi2;s=s.replace("<a>",'<a href="javascript:;" onclick="vi_submitAVideo()" onmousedown="return false">'),t+=s}else{var s=LANG.lvnodata_vi3;s=s.replace("<a>",'<a href="?account=signin">'),s=s.replace("<a>",'<a href="?account=signup">'),t+=s}e.style.padding="1.5em 0",e.innerHTML=t},onBeforeCreate:function(){if(location.hash&&null!=location.hash.match(/:id=([0-9]+)/)){var e=$WH.in_array(this.data,parseInt(RegExp.$1),function(e){return e.id});return this.rowOffset=this.getRowOffset(e),e}},onAfterCreate:function(e){null!=e&&setTimeout(function(){VideoViewer.show({videos:this.data,pos:e})}.bind(this),1)}},pet:{sort:[1],nItemsPerPage:-1,searchable:1,filtrable:1,columns:[{id:"name",name:LANG.name,type:"text",align:"left",value:"name",span:2,compute:function(e,t,s){var i=$WH.ce("td");i.style.width="1px",i.style.padding="0",i.style.borderRight="none",$WH.ae(i,Icon.create(e.icon,0)),$WH.ae(s,i),t.style.borderLeft="none";var a=$WH.ce("div"),n=$WH.ce("a");if(n.style.fontFamily="Verdana, sans-serif",n.href=this.getItemLink(e),$WH.ae(n,$WH.ct(e.name)),e.expansion){var o=$WH.ce("span");o.className=g_GetExpansionClassName(e.expansion),$WH.ae(o,n),$WH.ae(a,o)}else $WH.ae(a,n);if(e.exotic){a.style.position="relative";var r=$WH.ce("div");r.className="small q1",r.style.fontStyle="italic",r.style.position="absolute",r.style.right="3px",r.style.bottom="0px";var n=$WH.ce("a");n.href="?spell=53270",$WH.ae(n,$WH.ct(LANG.lvpet_exotic)),$WH.ae(r,n),$WH.ae(a,r)}$WH.ae(t,a)},getVisibleText:function(e){var t=e.name+Listview.funcBox.getExpansionText(e);return e.exotic&&(t+=" "+LANG.lvpet_exotic),t}},{id:"level",name:LANG.level,type:"range",getMinValue:function(e){return e.minlevel},getMaxValue:function(e){return e.maxlevel},compute:function(e,t){return e.minlevel>0&&e.maxlevel>0?e.minlevel!=e.maxlevel?e.minlevel+LANG.hyphen+e.maxlevel:e.minlevel:-1},sortFunc:function(e,t,s){return s>0?$WH.strcmp(e.minlevel,t.minlevel)||$WH.strcmp(e.maxlevel,t.maxlevel):$WH.strcmp(e.maxlevel,t.maxlevel)||$WH.strcmp(e.minlevel,t.minlevel)}},{id:"damage",name:LANG.damage,value:"damage",hidden:1,compute:function(e,t){$WH.ae(t,this.template.getStatPct(e.damage))}},{id:"armor",name:LANG.armor,value:"armor",hidden:1,compute:function(e,t){$WH.ae(t,this.template.getStatPct(e.armor))}},{id:"health",name:LANG.health,value:"health",hidden:1,compute:function(e,t){$WH.ae(t,this.template.getStatPct(e.health))}},{id:"abilities",name:LANG.abilities,type:"text",getValue:function(e){if(!e.spells)return"";if(e.spells.length>0){for(var t="",s=0,i=e.spells.length;s<i;++s)e.spells[s]&&(t+=g_spells[e.spells[s]]["name_"+Locale.getName()]);return t}},compute:function(e,t){if(!e.spells)return"";e.spells.length>0&&(t.style.padding="0",Listview.funcBox.createCenteredIcons(e.spells,t,"",1))},sortFunc:function(e,t){return e.spells&&t.spells?$WH.strcmp(e.spellCount,t.spellCount)||$WH.strcmp(e.spells,t.spells):0},hidden:!0},{id:"diet",name:LANG.diet,type:"text",compute:function(e,t){t&&(t.className="small");var s=0,i="";for(var a in g_pet_foods)e.diet&a&&(s++>0&&(i+=LANG.comma),i+=g_pet_foods[a]);return i},sortFunc:function(e,t){return $WH.strcmp(t.foodCount,e.foodCount)||Listview.funcBox.assocArrCmp(e.diet,t.diet,g_pet_foods)}},{id:"type",name:LANG.type,type:"text",compute:function(e,t){if(null!=e.type){t.className="small q1";var s=$WH.ce("a");s.href="?pets="+e.type,$WH.ae(s,$WH.ct(g_pet_types[e.type])),$WH.ae(t,s)}},getVisibleText:function(e){if(null!=e.type)return g_pet_types[e.type]},sortFunc:function(e,t,s){return $WH.strcmp(g_pet_types[e.type],g_pet_types[t.type])}}],getItemLink:function(e){return"?pet="+e.id},getStatPct:function(e){var t=$WH.ce("span");return!isNaN(e)&&e>0?(t.className="q2",$WH.ae(t,$WH.ct("+"+e+"%"))):!isNaN(e)&&e<0&&(t.className="q10",$WH.ae(t,$WH.ct(e+"%"))),t}},achievement:{sort:[1,2],nItemsPerPage:100,searchable:1,filtrable:1,columns:[{id:"name",name:LANG.name,type:"text",align:"left",value:"name",span:2,compute:function(e,t,s){var i=null;e.who&&e.completed&&(i="who="+e.who+"&when="+e.completed.getTime());var a=$WH.ce("td");a.style.width="1px",a.style.padding="0",a.style.borderRight="none",$WH.ae(a,g_achievements.createIcon(e.id,1)),Icon.getLink(a.firstChild).href=this.getItemLink(e),Icon.getLink(a.firstChild).rel=i,$WH.ae(s,a),t.style.borderLeft="none";var n=$WH.ce("a");if(n.style.fontFamily="Verdana, sans-serif",n.href=this.getItemLink(e),n.rel=i,$WH.ae(n,$WH.ct(e.name)),$WH.ae(t,n),null!=e.description){var o=$WH.ce("div");o.className="small",$WH.ae(o,$WH.ct(e.description)),$WH.ae(t,o)}},getVisibleText:function(e){var t=e.name;return e.description&&(t+=" "+e.description),t}},{id:"location",name:LANG.location,type:"text",width:"15%",hidden:1,compute:function(e,t){if(e.zone){var s=$WH.ce("a");s.className="q1",s.href="?zones="+e.zone,$WH.ae(s,$WH.ct(g_zones[e.zone])),$WH.ae(t,s)}},getVisibleText:function(e){
return Listview.funcBox.arrayText(e.zone,g_zones)},sortFunc:function(e,t,s){return Listview.funcBox.assocArrCmp(e.zone,t.zone,g_zones)}},{id:"side",name:LANG.side,type:"text",compute:function(e,t){if(e.side&&3!=e.side){var s=$WH.ce("span");s.className=1==e.side?"icon-alliance":"icon-horde",g_addTooltip(s,g_sides[e.side]),$WH.ae(t,s)}},getVisibleText:function(e){if(e.side)return g_sides[e.side]},sortFunc:function(e,t,s){return $WH.strcmp(g_sides[e.side],g_sides[t.side])}},{id:"points",name:LANG.points,type:"number",width:"10%",value:"points",compute:function(e,t){e.points&&Listview.funcBox.appendMoney(t,0,null,0,0,e.points)}},{id:"rewards",name:LANG.rewards,type:"text",width:"20%",compute:function(e,t){if(e.rewards){for(var s=[],i=[],a=[],n=0;n<e.rewards.length;n++)11==e.rewards[n][0]?a.push(e.rewards[n][1]):3==e.rewards[n][0]?s.push(e.rewards[n][1]):6==e.rewards[n][0]&&i.push(e.rewards[n][1]);if(s.length>0)for(var n=0;n<s.length;n++){if(!g_items[s[n]])return;var o=g_items[s[n]],r=$WH.ce("a");r.href="?item="+s[n],r.className="q"+o.quality+" icontiny tinyspecial",r.style.backgroundImage="url("+g_staticDataUrl+"/images/wow/icons/tiny/"+o.icon.toLowerCase()+".gif)",$WH.ae(r,$WH.ct(o["name_"+Locale.getName()]));var l=$WH.ce("span");$WH.ae(l,r),$WH.ae(t,l),$WH.ae(t,$WH.ce("br"))}if(i.length>0)for(var n=0;n<i.length;n++){if(!g_spells[i[n]])return;var o=g_spells[i[n]],r=$WH.ce("a");r.href="?spell="+i[n],r.className="q8 icontiny tinyspecial",r.style.backgroundImage="url("+g_staticDataUrl+"/images/wow/icons/tiny/"+o.icon.toLowerCase()+".gif)",$WH.ae(r,$WH.ct(o["name_"+Locale.getName()]));var l=$WH.ce("span");$WH.ae(l,r),$WH.ae(t,l),$WH.ae(t,$WH.ce("br"))}if(a.length>0)for(var n=0;n<a.length;n++){if(!g_titles[a[n]])return;var c=g_titles[a[n]]["name_"+Locale.getName()];c=c.replace("%s",'<span class="q0">&lt;'+LANG.name+"&gt;</span>");var l=$WH.ce("a");l.className="q1",l.href="?title="+a[n],l.innerHTML=c,$WH.ae(t,l),$WH.ae(t,$WH.ce("br"))}}else if(e.reward){var l=$WH.ce("span");l.className="q1",$WH.ae(l,$WH.ct(e.reward)),$WH.ae(t,l)}},getVisibleText:function(e){var t="";if(e.rewards)for(var s=0;s<e.rewards.length;s++)11==e.rewards[s][0]?t+=" "+g_titles[e.rewards[s][1]]["name_"+Locale.getName()].replace("%s","<"+LANG.name+">"):3==e.rewards[s][0]?t+=" "+g_items[e.rewards[s][1]]["name_"+Locale.getName()]:6==e.rewards[s][0]&&(t+=" "+g_spells[e.rewards[s][1]]["name_"+Locale.getName()]);else e.reward&&(t+=" "+e.reward);return t},sortFunc:function(e,t,s){var i=this.getVisibleText(e),a=this.getVisibleText(t);return""!=i&&""==a?-1:""!=a&&""==i?1:$WH.strcmp(i,a)}},{id:"category",name:LANG.category,type:"text",width:"15%",compute:function(e,t){if(statistic=e.type?e.type+".":"",t.className="small",path="?achievements="+statistic,-1!=e.category&&-1!=e.parentcat){var s=$WH.ce("a");s.className="q0",s.href="?achievements="+statistic+e.parentcat,$WH.ae(s,$WH.ct(g_achievement_categories[e.parentcat])),$WH.ae(t,s),$WH.ae(t,$WH.ce("br")),path=s.href+"."}var i=$WH.ce("a");i.className="q1",i.href=path+e.category,$WH.ae(i,$WH.ct(g_achievement_categories[e.category])),$WH.ae(t,i)},getVisibleText:function(e){return g_achievement_categories[e.category]},sortFunc:function(e,t,s){return $WH.strcmp(g_achievement_categories[e.category],g_achievement_categories[t.category])},hidden:!0}],getItemLink:function(e){return"?achievement="+e.id}},title:{sort:[1],nItemsPerPage:-1,searchable:1,filtrable:1,columns:[{id:"name",name:LANG.name,type:"text",align:"left",value:"name",compute:function(e,t,s){var i=$WH.ce("a"),a=$WH.ce("span"),n=$WH.ct($WH.str_replace(e.name,"%s",""));if(t.style.fontFamily="Verdana, sans-serif",i.href=this.getItemLink(e),e.who?$WH.ae(a,$WH.ct(e.who)):($WH.ae(a,$WH.ct("<"+LANG.name+">")),a.className="q0"),e.name.indexOf("%s")>0?($WH.ae(i,n),$WH.ae(i,a)):0==e.name.indexOf("%s")&&($WH.ae(i,a),$WH.ae(i,n)),e.expansion){var o=$WH.ce("span");o.className=g_GetExpansionClassName(e.expansion),$WH.ae(o,i),$WH.ae(t,o)}else $WH.ae(t,i)},sortFunc:function(e,t,s){var i=$WH.trim(e.name.replace("%s","").replace(/^[\s,]*(,|the |of the |of )/i,""));return bName=$WH.trim(t.name.replace("%s","").replace(/^[\s,]*(,|the |of the |of )/i,"")),$WH.strcmp(i,bName)},getVisibleText:function(e){return e.name+Listview.funcBox.getExpansionText(e)}},{id:"gender",name:LANG.gender,type:"text",value:"gender",compute:function(e,t){if(e.gender&&3!=e.gender){var s=g_file_genders[e.gender-1],i=$WH.ce("span");i.className="icon-"+s,g_addTooltip(i,LANG[s]),$WH.ae(t,i)}},getVisibleText:function(e){if(e.gender&&3!=e.gender)return LANG[g_file_genders[e.gender-1]]},sortFunc:function(e,t,s){return $WH.strcmp(e.gender,t.gender)}},{id:"side",name:LANG.side,type:"text",compute:function(e,t){if(e.side&&3!=e.side){var s=$WH.ce("span");s.className=1==e.side?"icon-alliance":"icon-horde",g_addTooltip(s,g_sides[e.side]),$WH.ae(t,s)}},getVisibleText:function(e){if(e.side)return g_sides[e.side]},sortFunc:function(e,t,s){return $WH.strcmp(g_sides[e.side],g_sides[t.side])}},{id:"source",name:LANG.source,type:"text",compute:function(e,t){if(e.source){$WH.nw(t),t.className="small",t.style.lineHeight="18px";var s=0;for(var i in e.source){e.source[i].sort(function(e,t){return t.s-e.s});for(var a=0,n=e.source[i].length;a<n;++a){var o=e.source[i][a];if(!e.faction||"string"==typeof o||void 0===o.s||-1==o.s||o.s==2-e.faction)if(s++>0&&$WH.ae(t,$WH.ce("br")),"string"==typeof o)$WH.ae(t,$WH.ct(o));else if(o.t){o.t;var r=$WH.ce("a");r.href="?"+g_types[o.t]+"="+o.ti,r.className="q1",1==o.s&&(r.className+=" icon-alliance"),0==o.s&&(r.className+=" icon-horde"),5==o.t&&(r.className+=" icontiny tinyspecial",r.style.backgroundImage="url("+g_staticDataUrl+"/images/wow/icons/tiny/quest_start.gif)"),$WH.ae(r,$WH.ct(o.n)),$WH.ae(t,r)}}}}},getVisibleText:function(e){var t="";if(e.source)for(var s in e.source)for(var i=0,a=e.source[s].length;i<a;++i){var n=e.source[s][i];"string"==typeof n?t+=" "+n:n.t&&(t+=" "+n.n)}return t},sortFunc:function(e,t,s){return $WH.strcmp(this.getVisibleText(e),this.getVisibleText(t))}},{id:"category",name:LANG.category,type:"text",width:"15%",compute:function(e,t){$WH.nw(t),t.className="small q1";var s=$WH.ce("a");s.href="?titles="+e.category,$WH.ae(s,$WH.ct(g_title_categories[e.category])),$WH.ae(t,s)},getVisibleText:function(e){return g_title_categories[e.category]},sortFunc:function(e,t,s){return $WH.strcmp(g_title_categories[e.category],g_title_categories[t.category])},hidden:!0}],getItemLink:function(e){return"?title="+e.id}},profile:{sort:[],nItemsPerPage:50,searchable:1,filtrable:1,columns:[{id:"name",name:LANG.name,value:"name",type:"text",align:"left",span:2,compute:function(e,t,s){if(e.level){var i=$WH.ce("td");i.style.width="1px",i.style.padding="0",i.style.borderRight="none";var a=Icon.create($WH.g_getProfileIcon(e.race,e.classs,e.gender,e.level,e.icon?e.icon:0,"medium"),1,null,this.getItemLink(e));e.captain&&(s.className="mergerow",a.className+=" "+a.className+"-gold"),$WH.ae(i,a),$WH.ae(s,i),t.style.borderLeft="none"}else t.colSpan=2;var n=$WH.ce("div");n.style.position="relative";var o=$WH.ce("a");o.style.fontFamily="Verdana, sans-serif",o.href=this.getItemLink(e),e.pinned&&(o.className="icon-star-right"),$WH.ae(o,$WH.ct(e.name)),$WH.ae(n,o);var r=$WH.ce("div");if(r.className="small",r.style.marginRight="20px",e.guild&&"number"!=typeof e.guild){var o=$WH.ce("a");o.className="q1",o.href="?guild="+e.region+"."+e.realm+"."+g_urlize(e.guild),$WH.ae(o,$WH.ct(e.guild)),$WH.ae(r,$WH.ct("<")),$WH.ae(r,o),$WH.ae(r,$WH.ct(">"))}else e.description&&$WH.ae(r,$WH.ct(e.description));var l=$WH.ce("span"),c="";l.className="q10",e.deleted&&(c=LANG.lvcomment_deleted),$WH.ae(l,$WH.ct(c)),$WH.ae(r,l),$WH.ae(n,r);var r=$WH.ce("div");r.className="small",r.style.fontStyle="italic",r.style.position="absolute",r.style.right="3px",r.style.bottom="0px",s.__status=r,0===e.published&&$WH.ae(r,$WH.ct(LANG.privateprofile)),e.renameItr&&$WH.ae(l,$WH.ct(LANG.pr_note_pendingrename)),$WH.ae(n,r),$WH.ae(t,n)},getVisibleText:function(e){var t=e.name;return e.guild&&"number"!=typeof e.guild&&(t+=" "+e.guild),t}},{id:"faction",name:LANG.faction,type:"text",compute:function(e,t){if(e.size||void 0!==e.members||e.level){var s,i=$WH.ce("div"),a=$WH.ce("div");s=Icon.create("faction_"+g_file_factions[parseInt(e.faction)+1],0),s.style.cssFloat=s.style.syleFloat="left",g_addTooltip(s,g_sides[parseInt(e.faction)+1]),i.style.margin="0 auto",i.style.textAlign="left",i.style.width="26px",a.className="clear",$WH.ae(i,s),$WH.ae(t,i),$WH.ae(t,a)}},getVisibleText:function(e){return g_sides[e.faction+1]},sortFunc:function(e,t,s){return $WH.strcmp(this.getVisibleText(e),this.getVisibleText(t))}},{id:"members",name:LANG.members,value:"members",hidden:1},{id:"size",name:"Size",value:"size",hidden:1},{id:"rank",name:"Rank",value:"rank",hidden:1},{id:"race",name:LANG.race,type:"text",compute:function(e,t){if(e.race){var s,i=$WH.ce("div"),a=$WH.ce("div");s=Icon.create("race_"+g_file_races[e.race]+"_"+g_file_genders[e.gender],0,null,"?race="+e.race),s.style.cssFloat=s.style.syleFloat="left",g_addTooltip(s,g_chr_races[e.race]),i.style.margin="0 auto",i.style.textAlign="left",i.style.width="26px",a.className="clear",$WH.ae(i,s),$WH.ae(t,i),$WH.ae(t,a)}},getVisibleText:function(e){return g_file_genders[e.gender]+" "+g_chr_races[e.race]},sortFunc:function(e,t,s){return $WH.strcmp(g_chr_races[e.race],g_chr_races[t.race])},hidden:1},{id:"classs",name:LANG.classs,type:"text",compute:function(e,t){if(!e.classs)return-1;var s,i=$WH.ce("div"),a=$WH.ce("div");s=Icon.create("class_"+g_file_classes[e.classs],0,null,"?class="+e.classs),s.style.cssFloat=s.style.syleFloat="left",g_addTooltip(s,g_chr_classes[e.classs],"c"+e.classs),i.style.margin="0 auto",i.style.textAlign="left",i.style.width="26px",a.className="clear",$WH.ae(i,s),$WH.ae(t,i),$WH.ae(t,a)},getVisibleText:function(e){if(e.classs)return g_chr_classes[e.classs]},sortFunc:function(e,t,s){return $WH.strcmp(this.getVisibleText(e),this.getVisibleText(t))},hidden:1},{id:"level",name:LANG.level,value:"level",hidden:1},{id:"talents",name:LANG.talents,type:"text",compute:function(e,t){if(e.level){var s=[e.talenttree1,e.talenttree2,e.talenttree3],i=pr_getSpecFromTalents(e.classs,s),a=$WH.ce("a");a.className="icontiny tinyspecial tip q1",a.style.backgroundImage="url("+g_staticDataUrl+"/images/wow/icons/tiny/"+i.icon.toLowerCase()+".gif)",a.rel="np",a.href=this.getItemLink(e)+"#talents",g_addTooltip(a,i.name),$WH.ae(a,$WH.ct(e.talenttree1+" / "+e.talenttree2+" / "+e.talenttree3)),$WH.ae(t,a)}},getVisibleText:function(e){return e.talenttree1||e.talenttree2||e.talenttree3?e.talentspec>0?g_chr_specs[e.classs][e.talentspec-1]:g_chr_specs[0]:g_chr_specs[-1]},sortFunc:function(e,t,s){return $WH.strcmp(this.getVisibleText(e),this.getVisibleText(t))},hidden:1},{id:"gearscore",name:LANG.gearscore,tooltip:LANG.gearscore_real,value:"gearscore",compute:function(e,t){var s=e.level?e.level:void 0!==e.members?80:0;if(!isNaN(e.gearscore)&&s)return t.className="q"+pr_getGearScoreQuality(s,e.gearscore,-1!=$WH.in_array([2,6,7,11],e.classs)),e.gearscore?$WH.number_format(e.gearscore):0},hidden:1},{id:"achievementpoints",name:LANG.points,value:"achievementpoints",tooltip:LANG.tooltip_achievementpoints,compute:function(e,t){e.achievementpoints&&Listview.funcBox.appendMoney(t,0,null,0,0,e.achievementpoints)},hidden:1},{id:"wins",name:LANG.wins,value:"wins",hidden:1},{id:"losses",name:LANG.losses,compute:function(e,t){return e.games-e.wins},sortFunc:function(e,t,s){var i=e.games-e.wins,a=t.games-t.wins;return i>a?1:i<a?-1:0},hidden:1},{id:"guildrank",name:LANG.guildrank,value:"guildrank",compute:function(e,t){if("undefined"!=typeof guild_ranks&&guild_ranks[e.guildrank]){var s=$WH.ce("span",null,$WH.ct(guild_ranks[e.guildrank]));g_addTooltip(s,$WH.sprintf(LANG.rankno,e.guildrank)),$WH.ae(t,s)}else{if(e.guildrank>0)return $WH.sprintf(LANG.rankno,e.guildrank);if(0==e.guildrank){var i=$WH.ce("b");$WH.ae(i,$WH.ct(LANG.guildleader)),$WH.ae(t,i)}}},getVisibleText:function(e){return e.guildrank>0?$WH.sprintf(LANG.rankno,e.guildrank):0==e.guildrank?LANG.guildleader:void 0},sortFunc:function(e,t,s){return $WH.strcmp(e.guildrank>=0?e.guildrank:11,t.guildrank>=0?t.guildrank:11)},hidden:1},{id:"rating",name:LANG.rating,value:"rating",hidden:1},{id:"location",name:LANG.location,type:"text",compute:function(e,t){var s;if(e.region){e.realm&&(s=$WH.ce("a"),s.className="q1",s.href="?profiles="+e.region+"."+e.realm,$WH.ae(s,$WH.ct(e.realmname)),$WH.ae(t,s),$WH.ae(t,$WH.ce("br")));var i=$WH.ce("small");s=$WH.ce("a"),s.className="q1",s.href="?profiles="+e.region,$WH.ae(s,$WH.ct(e.region.toUpperCase())),$WH.ae(i,s),e.battlegroup&&($WH.ae(i,$WH.ct(LANG.hyphen)),s=$WH.ce("a"),s.className="q1",s.href="?profiles="+e.region+"."+e.battlegroup,$WH.ae(s,$WH.ct(e.battlegroupname)),$WH.ae(i,s)),$WH.ae(t,i)}},getVisibleText:function(e){var t="";return e.region&&(t+=" "+e.region),e.battlegroup&&(t+=" "+e.battlegroup),e.realm&&(t+=" "+e.realm),$WH.trim(t)},sortFunc:function(e,t,s){return e.region!=t.region?$WH.strcmp(e.region,t.region):e.battlegroup!=t.battlegroup?$WH.strcmp(e.battlegroup,t.battlegroup):$WH.strcmp(e.realm,t.realm)}},{id:"guild",name:LANG.guild,value:"guild",type:"text",compute:function(e,t){if(e.region&&e.realm&&e.guild&&"number"!=typeof e.guild){var s=$WH.ce("a");s.className="q1",s.href="?guild="+e.region+"."+e.realm+"."+g_urlize(e.guild),$WH.ae(s,$WH.ct(e.guild)),$WH.ae(t,s)}},sortFunc:function(e,t,s){return $WH.strcmp(e.guild,t.guild)}}],getItemLink:function(e){return void 0!==e.size?"?arena-team="+e.region+"."+e.realm+"."+g_urlize(e.name):void 0!==e.members?"?guild="+e.region+"."+e.realm+"."+g_urlize(e.name):g_getProfileUrl(e)}},model:{sort:[],mode:3,nItemsPerPage:40,nItemsPerRow:4,poundable:2,columns:[],compute:function(e,t,s){t.className="screenshot-cell",t.vAlign="bottom";var i=$WH.ce("a");i.href="javascript:;",i.onclick=this.template.modelShow.bind(this.template,e.npcId,e.displayId,!1);var a=$WH.ce("img");a.src=g_staticDataUrl+"/modelviewer/thumbs/npc/"+e.displayId+".png",$WH.ae(i,a),$WH.ae(t,i);var n=$WH.ce("div");n.className="screenshot-cell-user",i=$WH.ce("a"),i.href="?npcs=1&filter="+(e.family?"fa="+e.family+";":"")+"minle=1;cr=35;crs=0;crv="+e.skin,$WH.ae(i,$WH.ct(e.skin)),$WH.ae(n,i),$WH.ae(n,$WH.ct(" ("+e.count+")")),$WH.ae(t,n),n=$WH.ce("div"),n.style.position="relative",n.style.height="1em";var o=$WH.ce("div");o.className="screenshot-caption";var r=$WH.ce("small");$WH.ae(r,$WH.ct(LANG.level+": ")),$WH.ae(r,$WH.ct((9999==e.minLevel?"??":e.minLevel)+(e.minLevel==e.maxLevel?"":LANG.hyphen+(9999==e.maxLevel?"??":e.maxLevel)))),$WH.ae(r,$WH.ce("br")),$WH.ae(o,r),$WH.ae(n,o),$WH.ae(t,n),$WH.aE(t,"click",this.template.modelShow.bind(this.template,e.npcId,e.displayId,!0))},modelShow:function(e,t,s,i){if(s){if(i=$WH.$E(i),i.shiftKey||i.ctrlKey)return;for(var a=i._target;a;){if("A"==a.nodeName)return;if("IMG"==a.nodeName)break;a=a.parentNode}}ModelViewer.show({type:1,typeId:e,displayId:t,noPound:1})}},genericmodel:{sort:[],mode:3,nItemsPerPage:40,nItemsPerRow:4,poundable:2,columns:[{value:"name",sortFunc:function(e,t){return Listview.templates.genericmodel.sortFunc(e,t)}}],compute:function(e,t,s){t.className="screenshot-cell",t.vAlign="bottom";var i,a,n,o,r;switch("modelviewer"in e?(i=e.modelviewer.displayid,r=e.modelviewer.typeid,a=e.modelviewer.type,o=e.slot):"npcmodel"in e?(i=e.npcmodel,r=e.id,a=1):"displayid"in e&&(i=e.displayid,r=e.id,a=3,o=e.slotbak||e.slot),a){case 1:n="npc";break;case 3:default:n="item"}if(i){var l=$WH.ce("a");l.href="javascript:;",l.rel=this.genericlinktype+"="+e.id+" domain="+Locale.get().domain,l.onclick=this.template.modelShow.bind(this.template,a,r,i,o,!1);var c=$WH.ce("img");c.src=g_staticDataUrl+"/modelviewer/thumbs/"+n+"/"+i+".png",$WH.ae(l,c),$WH.ae(t,l)}d=$WH.ce("div"),d.style.position="relative",d.style.height="1em";var u=$WH.ce("div");u.className="screenshot-caption";var l=$WH.ce("a");l.className="q"+("item"==this.genericlinktype?g_items[e.id].quality:""),l.style.fontFamily="Verdana,sans-serif",l.href=g_host+"?"+this.genericlinktype+"="+e.id,$WH.ae(l,$WH.ct(e.name.substr(1))),$WH.ae(u,l),$WH.ae(d,u),$WH.ae(t,d),i&&$WH.aE(t,"click",this.template.modelShow.bind(this.template,a,r,i,o,!0))},modelShow:function(e,t,s,i,a,n){if(a){if(n=$WH.$E(n),n.shiftKey||n.ctrlKey)return;for(var o=n._target;o;){if("A"==o.nodeName)return;if("IMG"==o.nodeName)break;o=o.parentNode}}var r={type:e,typeId:t,displayId:s,noPound:1};void 0!==i&&(r.slot=i),ModelViewer.show(r)},sortFunc:function(e,t,s){return $WH.strcmp(e.displayid,t.displayid)||$WH.strcmp(e.name,t.name)||-$WH.strcmp(e.level,t.level)}},currency:{sort:[1],searchable:1,filtrable:1,columns:[{id:"name",name:LANG.name,type:"text",align:"left",span:2,value:"name",compute:function(e,t,s){var i=$WH.ce("td");i.style.width="1px",i.style.padding="0",i.style.borderRight="none",$WH.ae(i,Icon.create(e.icon,0,null,this.getItemLink(e))),$WH.ae(s,i),t.style.borderLeft="none";var a=$WH.ce("div"),n=$WH.ce("a");n.style.fontFamily="Verdana, sans-serif",n.href=this.getItemLink(e),$WH.ae(n,$WH.ct(e.name)),$WH.ae(a,n),$WH.ae(t,a)}},{id:"category",name:LANG.category,type:"text",width:"15%",compute:function(e,t){t.className="small";var s=$WH.ce("a");s.className="q1",s.href="?currencies="+e.category,$WH.ae(s,$WH.ct(g_currency_categories[e.category])),$WH.ae(t,s)},getVisibleText:function(e){return g_currency_categories[e.category]},sortFunc:function(e,t,s){return $WH.strcmp(g_currency_categories[e.category],g_currency_categories[t.category])}}],getItemLink:function(e){return"?currency="+e.id}},classs:{sort:[1],searchable:1,filtrable:1,columns:[{id:"name",name:LANG.name,type:"text",align:"left",span:2,value:"name",compute:function(e,t,s){var i=$WH.ce("td");i.style.width="1px",i.style.padding="0",i.style.borderRight="none",$WH.ae(i,Icon.create("class_"+g_file_classes[e.id],0,null,this.getItemLink(e))),$WH.ae(s,i),t.style.borderLeft="none",t.style.width="270px";var a=$WH.ce("div"),n=$WH.ce("a");if(n.className="c"+e.id,n.style.fontFamily="Verdana, sans-serif",n.href=this.getItemLink(e),$WH.ae(n,$WH.ct(e.name)),e.expansion){var o=$WH.ce("span");o.className=g_GetExpansionClassName(e.expansion),$WH.ae(o,n),$WH.ae(a,o)}else $WH.ae(a,n);if(e.hero){a.style.position="relative";var r=$WH.ce("div");r.className="small",r.style.fontStyle="italic",r.style.position="absolute",r.style.right="3px",r.style.bottom="0px",$WH.ae(r,$WH.ct(LANG.lvclass_hero)),$WH.ae(a,r)}$WH.ae(t,a)}},{id:"races",name:LANG.races,type:"text",compute:function(e,t){if(e.races){var s=Listview.funcBox.assocBinFlags(e.races,g_chr_races);t.className="q1";for(var i=0,a=s.length;i<a;++i){i>0&&$WH.ae(t,$WH.ct(LANG.comma));var n=$WH.ce("a");n.href="?race="+s[i],$WH.ae(n,$WH.ct(g_chr_races[s[i]])),$WH.ae(t,n)}}},getVisibleText:function(e){if(e.races)return Listview.funcBox.arrayText(Listview.funcBox.assocBinFlags(e.races,g_chr_races),g_chr_races)},sortFunc:function(e,t,s){return Listview.funcBox.assocArrCmp(Listview.funcBox.assocBinFlags(e.races,g_chr_races),Listview.funcBox.assocBinFlags(t.races,g_chr_races),g_chr_races)}}],getItemLink:function(e){return"?class="+e.id}},race:{sort:[1],searchable:1,filtrable:1,columns:[{id:"name",name:LANG.name,type:"text",align:"left",span:2,value:"name",compute:function(e,t,s){var i,a=$WH.ce("div");a.style.margin="0 auto",a.style.textAlign="left",a.style.width="52px",i=Icon.create("race_"+g_file_races[e.id]+"_"+g_file_genders[0],0,null,this.getItemLink(e)),i.style.cssFloat=i.style.styleFloat="left",$WH.ae(a,i),i=Icon.create("race_"+g_file_races[e.id]+"_"+g_file_genders[1],0,null,this.getItemLink(e)),i.style.cssFloat=i.style.styleFloat="left",$WH.ae(a,i);var n=$WH.ce("td");n.style.width="1px",n.style.padding="0",n.style.borderRight="none",$WH.ae(n,a),$WH.ae(s,n),t.style.borderLeft="none";var o=$WH.ce("div"),r=$WH.ce("a");if(r.style.fontFamily="Verdana, sans-serif",r.href=this.getItemLink(e),$WH.ae(r,$WH.ct(e.name)),e.expansion){var l=$WH.ce("span");l.className=g_GetExpansionClassName(e.expansion),$WH.ae(l,r),$WH.ae(o,l)}else $WH.ae(o,r);$WH.ae(t,o)}},{id:"side",name:LANG.side,type:"text",compute:function(e,t){if(e.side&&3!=e.side){var s=$WH.ce("span");s.className=1==e.side?"icon-alliance":"icon-horde",g_addTooltip(s,g_sides[e.side]),$WH.ae(t,s)}},getVisibleText:function(e){if(e.side)return g_sides[e.side]},sortFunc:function(e,t,s){return $WH.strcmp(g_sides[e.side],g_sides[t.side])}},{id:"classes",name:LANG.classes,type:"text",compute:function(e,t){if(e.classes){var s=Listview.funcBox.assocBinFlags(e.classes,g_chr_classes),i=$WH.ce("div");i.style.width=26*s.length+"px",i.style.margin="0 auto";for(var a=0,n=s.length;a<n;++a)if(6!=s[a]){var o=Icon.create("class_"+g_file_classes[s[a]],0,null,"?class="+s[a]);g_addTooltip(o,g_chr_classes[s[a]],"c"+s[a]),o.style.cssFloat=o.style.styleFloat="left",$WH.ae(i,o)}$WH.ae(t,i)}},getVisibleText:function(e){if(e.classes)return Listview.funcBox.arrayText(Listview.funcBox.assocBinFlags(e.classes,g_chr_classes),g_chr_classes)},sortFunc:function(e,t,s){return Listview.funcBox.assocArrCmp(Listview.funcBox.assocBinFlags(e.classes,g_chr_classes),Listview.funcBox.assocBinFlags(t.classes,g_chr_classes),g_chr_classes)}}],getItemLink:function(e){return"?race="+e.id}}};var MENU_IDX_ID=0,MENU_IDX_NAME=1,MENU_IDX_URL=2,MENU_IDX_SUB=3,MENU_IDX_OPT=4,Menu=new function(){function e(){if(!se){se=!0;var e=$('<div class="menu"><a href="#"><span>ohai</span></a></div>').css({left:"-1000px",top:"-1000px"}).appendTo(document.body),t=e.children("a").outerHeight();e.remove(),t>15&&(te=t)}}function t(e,t){X&&X.removeClass("open"),X=t,X.addClass("open"),a(e)}function s(){X&&(X.removeClass("open"),X=null),f(0)}function i(e,t,s){clearTimeout(j),a(e,t,s)}function a(e,t,s){g(0),n(e,0,t,s),f(1)}function n(t,s,i,a){e(),E(t);var n=o(s),l=r(t),d=c(l,s);n.append(d);var p=!v(s);ie[s]=n;var m=u(n,s,i,a);n.css({left:m.x+"px",top:m.y+"px"}),h(n,p)}function o(e){if(ne[e]){var t=ne[e];return t.children().detach(),t}var t=$('<div class="menu"></div>').mouseover(R).mouseleave(F).delegate("a","mouseenter",{depth:e},q).delegate("a","click",z);return t.appendTo(document.body),ne[e]=t,t}function r(e){var t=M(e);if(oe[t])return oe[t];var s,i=[];$.each(e,function(e,t){if(L(t)){if($a=l(t),H(t))return void(s=$a);s&&(i.push(s),s=null),i.push($a)}});var a=$(i);return oe[e]=a,a}function l(e){O(e);var t=$("<a></a>");if(e.$a=t,t.data("menuItem",e),V.linkifyItem(e,t),V.updateItem(e),H(e))return t.addClass("separator"),t.text(e[MENU_IDX_NAME]),t;var s=$("<span></span>");return s.text(e[MENU_IDX_NAME]),s.appendTo(t),b(e)&&s.addClass("hassubmenu"),t}function c(e,t){var s=$(window),i=e.length,a=s.height()-2*ee-J,n=Math.floor(Math.max(0,a)/te);if(n>=i){var o=$('<div class="menu-outer"></div>'),r=$('<div class="menu-inner"></div>');return e.each(function(){r.append(this)}),o.append(r),o}for(var l=Math.min(K,Math.ceil(i/n)),c=Math.ceil(i/l),u=0,d=i,p=$("<div></div>");d>0;){var o=$('<div class="menu-outer"></div>'),r=$('<div class="menu-inner"></div>'),h=Math.min(d,c),m=u,f=m+h;e.slice(m,f).each(function(){r.append(this)}),o.append(r),p.append(o),u+=h,d-=h}return p}function u(e,t,s,i){return 0==t?d(e,t,s,i):p(e,t)}function d(e,t,s,i){var a=g_getViewport(),n=e.width(),o=e.height(),r=n+Q,l=o+J;if(null!=s&&null!=i)i+l>a.b&&(i=Math.max(a.t,a.b-l));else{var c=X,u=c.offset();s=u.left,(i=u.top+c.outerHeight())+l>a.b&&u.top>=l&&(i=u.top-l)}return s+r>a.r&&(s=Math.max(a.l,a.r-r)),{x:s,y:i}}function p(e,t){var s=g_getViewport(),i=e.width(),a=e.height(),n=i+Q,o=a+J,r=ae[t-1],l=r.offset(),c=!1;return x=l.left+r.outerWidth()-5,y=l.top-2,x+n>s.r&&(c=!0),c&&(x=Math.max(s.l,l.left-i)),y+o>s.b&&(y=Math.max(s.t,s.b-o)),{x:x,y:y}}function h(e,t){t?e.css({opacity:"0"}).show().animate({opacity:"1"},"fast",null,m):e.show()}function m(e){$(this).css("opacity","")}function f(e){for(;ie[e];)ie[e].stop().hide(),ie[e]=null,++e}function g(e){for(;ae[e];)ae[e].removeClass("open"),ae[e]=null,++e}function v(e){return null!=ie[e||0]}function _(e){return e[MENU_IDX_ID]}function H(e){return null==e[MENU_IDX_ID]}function W(e){return-1!=$WH.in_array(e,!0,H)}function b(e){return null!=e[MENU_IDX_SUB]}function w(e,t){return $WH.in_array(e,t,_)}function N(e){var t=V.getItemOpt(e);return!(t.requiredAccess&&!User.hasPermissions(t.requiredAccess))}function L(e){return!!N(e)&&!(b(e)&&!k(e[MENU_IDX_SUB]))}function k(e){return-1!=$WH.in_array(e,!0,A)}function A(e){return!H(e)&&N(e)}function M(e){return null==e.uniqueId&&(e.uniqueId=re++),e.uniqueId}function G(e,t){$.each(e,function(e,s){I(s,t)})}function I(e,t){t(e),b(e)&&G(e[MENU_IDX_SUB],t)}function C(e,t,s,i){$.each(e,function(e,a){if(void 0!==a&&!H(a)&&(null==a[MENU_IDX_URL]&&(a[MENU_IDX_URL]=t+a[MENU_IDX_ID]+s.hash),b(a))){var n=!0;s.useSimpleIds?n=!1:null!=s.useSimpleIdsAfter&&i>=s.useSimpleIdsAfter&&(n=!1);var o=t;n&&(o+=a[MENU_IDX_ID]+"."),C(a[MENU_IDX_SUB],o,s,i+1)}})}function T(e){e.sort(function(e,t){return $WH.strcmp(e[MENU_IDX_NAME],t[MENU_IDX_NAME])})}function D(e){var t=V.implode(e,{createHeadinglessGroup:!0});$.each(t,function(e,t){T(t[MENU_IDX_SUB])}),S(e,t)}function S(e,t){e.splice(0,e.length),$.each(t,function(t,s){s[MENU_IDX_NAME]&&e.push([,s[MENU_IDX_NAME]]),$.each(s[MENU_IDX_SUB],function(t,s){e.push(s)})})}function O(e){var t=V.getItemOpt(e);t.checkedUrl&&location.href.match(t.checkedUrl)&&(e.checked=!0)}function E(e){e.onBeforeShow&&e.onBeforeShow(e),$.each(e,function(e,t){var s=V.getItemOpt(t);s.onBeforeShow&&s.onBeforeShow(t)})}function U(e){clearTimeout(j);var s=$(this);if(!v())return void(j=setTimeout(t.bind(null,s.data("menu"),s),Y));t(s.data("menu"),s)}function P(e){clearTimeout(j),v()&&(j=setTimeout(s,Z))}function B(e){clearTimeout(j),V.showAtCursor($(this).data("menu"),e)}function R(e){clearTimeout(j)}function F(e){clearTimeout(j),j=setTimeout(s,Z)}function q(e){clearTimeout(j);var t=$(this),s=e.data.depth;g(s);var i=t.data("menuItem"),a=s;i&&b(i)&&(t.addClass("open"),ae[s]=t,n(i[MENU_IDX_SUB],s+1),++a),f(a+1)}function z(e){var t=$(this),s=t.data("menuItem");if(s){var i=V.getItemOpt(s);i.onClick&&i.onClick()}}var V=this;V.add=function(e,t,s){s||(s=$.noop);var i=$(e);i.data("menu",t),s.showAtCursor?i.click(B):i.mouseover(U).mouseout(P)},V.remove=function(e){$(e).data("menu",null).unbind("click",B).unbind("mouseover",U).unbind("mouseout",P)},V.show=function(e,s){t(e,$(s))},V.showAtCursor=function(e,t){i(e,t.pageX,t.pageY)},V.showAtXY=function(e,t,s){i(e,t,s)},V.hide=function(){P()},V.addButtons=function(e,t){var s=$(e);if(s.length){var i=$('<span class="menu-buttons"></span>');$.each(t,function(e,t){if(!H(t)){var s=$("<a></a>"),a=$("<span></span>",{text:t[MENU_IDX_NAME]}).appendTo(s);V.linkifyItem(t,s),b(t)&&(a.addClass("hassubmenu"),V.add(s,t[MENU_IDX_SUB])),i.append(s)}}),s.append(i)}},V.linkifyItem=function(e,t){var i=V.getItemOpt(e);if(!e[MENU_IDX_URL])return t.attr("href","javascript:;"),void t.addClass("unlinked");if("function"==typeof e[MENU_IDX_URL])t.attr("href","javascript:;"),t.click(s),t.click(e[MENU_IDX_URL]);else{var a=V.getItemUrl(e);t.attr("href",a),(i.newWindow||g_isExternalUrl(a))&&t.attr("target","_blank"),i.rel&&t.attr("rel",i.rel)}"object"==typeof e[MENU_IDX_OPT]&&e[MENU_IDX_OPT].className&&t.addClass(e[MENU_IDX_OPT].className)},V.updateItem=function(e){var t=e.$a;if(t){var s=V.getItemOpt(e);t.removeClass("checked tinyicon icon"),t.css("background-image",""),e.checked?t.addClass("checked"):s.tinyIcon?(t.addClass("tinyicon"),t.css("background-image","url("+(-1!=s.tinyIcon.indexOf("/")?s.tinyIcon:g_staticDataUrl+"/images/wow/icons/tiny/"+s.tinyIcon.toLowerCase()+".gif")+")")):s.icon?(t.addClass("icon"),t.css("background-image","url("+s.icon+")")):s.socketColor&&g_file_gems[s.socketColor]&&t.addClass("socket-"+g_file_gems[s.socketColor]);var i=s.class||s.className;i&&t.addClass(i)}},V.hasMenu=function(e){return null!=$(e).data("menu")},V.modifyUrl=function(e,t,s){var i={params:t,opt:s};I(e,function(e){e.modifyUrl=i}),PageTemplate.updateBreadcrumb()},V.fixUrls=function(e,t,s){s=s||{},s.hash=s.hash?"#"+s.hash:"",C(e,t,s,0)},V.sort=function(e){W(e)?D(e):T(e)},V.sortSubmenus=function(e,t){$.each(t,function(t,s){var i=V.findItem(e,s);i&&i[MENU_IDX_SUB]&&V.sort(i[MENU_IDX_SUB])})},V.implode=function(e,t){t||(t=$.noop);var s,i=[];return t.createHeadinglessGroup&&(s=[],i.push([0,"",null,s])),$.each(e,function(e,t){H(t)?(s=[],i.push([0,t[MENU_IDX_NAME],null,s])):s?s.push(t):i.push(t)}),i},V.findItem=function(e,t){return V.getFullPath(e,t).pop()},V.getFullPath=function(e,t){for(var s=[],i=0;i<t.length;++i){var a=w(e,t[i]);if(-1!=a){var n=e[a];n.parentMenu=e,e=n[MENU_IDX_SUB],s.push(n)}}return s},V.getItemUrl=function(e){var t=e[MENU_IDX_URL];if(!t)return null;V.getItemOpt(e);return e.modifyUrl&&(t=g_modifyUrl(t,e.modifyUrl.params,e.modifyUrl.opt)),t},V.getItemOpt=function(e){return e[MENU_IDX_OPT]||(e[MENU_IDX_OPT]={}),e[MENU_IDX_OPT]},V.removeItemById=function(e,t){var s=w(e,t);-1!=s&&e.splice(s,1)};var j,X,Y=25,Z=333,K=4,Q=6,J=6,ee=3,te=26,se=!1,ie={},ae={},ne={},oe={},re=0};Menu.fixUrls(mn_achievements,"?achievements="),Menu.fixUrls(mn_classes,"?class="),Menu.fixUrls(mn_currencies,"?currencies="),Menu.fixUrls(mn_factions,"?factions="),Menu.fixUrls(mn_items,"?items="),Menu.fixUrls(mn_itemSets,"?itemsets&filter=cl=",{hash:"0-2+1"}),Menu.fixUrls(mn_npcs,"?npcs="),Menu.fixUrls(mn_objects,"?objects="),Menu.fixUrls(mn_petCalc,"?petcalc="),Menu.fixUrls(mn_pets,"?pets="),Menu.fixUrls(mn_quests,"?quests="),Menu.fixUrls(mn_races,"?race="),Menu.fixUrls(mn_spells,"?spells="),Menu.fixUrls(mn_titles,"?titles="),Menu.fixUrls(mn_zones,"?zones="),$(document).ready(function(){Menu.sort(mn_classes),Menu.sortSubmenus(mn_items,[[4,1],[4,2],[4,3],[4,4],[1],[0],[16],[7],[6],[9]]),Menu.sort(mn_itemSets),Menu.sort(mn_npcs),Menu.sort(mn_objects),Menu.sort(mn_talentCalc),Menu.sort(mn_petCalc),Menu.sort(mn_pets),Menu.sort(mn_races),Menu.sort(mn_skills),Menu.sortSubmenus(mn_spells,[[7],[-2],[-3],[11],[9]]),Menu.sortSubmenus(mn_quests,[[0],[1],[2],[3],[4],[5],[6],[7],[8],[9],[10]])});var g_dev=!1,g_localTime=new Date,g_user={id:0,name:"",roles:0},ProgressBar=function(e){this.opts={text:"",hoverText:"",color:"rep6",width:0,progress:0},this.elements={text:null,hoverText:null,textContainer:null,progress:null,container:null},$WH.cO(this.opts,e),this.build()};ProgressBar.prototype.build=function(){var e=$("<a/>",{class:"progressbar",href:"javascript:;"});this.opts.width>0?e.css("width",this.opts.width+"px"):e.css("width","auto");var t=$("<div/>",{class:"progressbar-text"});this.opts.text&&(this.elements.text=$("<del/>",{text:this.opts.text}),t.append(this.elements.text)),this.opts.hoverText&&(this.elements.hoverText=$("<ins/>",{text:this.opts.hoverText}),t.append(this.elements.hoverText)),e.append(t);var s=$("<div/>",{class:"progressbar-"+this.opts.color,css:{width:this.opts.progress+"%"},text:String.fromCharCode(160)});return e.append(s),this.opts.text&&t.append($("<div/>",{class:"progressbar-text progressbar-hidden",text:this.opts.text})),this.elements.container=e,this.elements.progress=s,this.elements.textContainer=t,e},ProgressBar.prototype.setText=function(e){this.opts.text=e,this.elements.text?this.elements.text.text(this.opts.text):(this.elements.text=$("<del/>",{text:this.opts.text}),this.opts.hoverText?this.opts.hoverText.before(this.elements.text):this.elements.textContainer.append(this.elements.text))},ProgressBar.prototype.setHoverText=function(e){this.opts.hoverText=e,this.elements.hoverText?this.elements.hoverText.text(this.opts.hoverText):(this.elements.hoverText=$("<ins/>",{text:this.opts.hoverText}),this.elements.textContainer.append(this.elements.hoverText))},ProgressBar.prototype.setProgress=function(e){this.opts.progress=e,this.elements.progress.css("width",this.opts.progress+"%")},ProgressBar.prototype.setWidth=function(e){this.opts.width=e,this.opts.width>0?this.elements.container.css("width",this.opts.width+"px"):this.elements.container.css("width","auto")},ProgressBar.prototype.getText=function(){return this.opts.text},ProgressBar.prototype.getHoverText=function(){
return this.opts.hoverText},ProgressBar.prototype.getWidth=function(){return this.opts.width},ProgressBar.prototype.getContainer=function(){return this.elements.container};var Icon={sizes:["small","medium","large"],sizes2:[18,36,56],sizeIds:{small:0,medium:1,large:2},premiumOffsets:[[-56,-36],[-56,0],[0,0]],premiumBorderClasses:["-premium","-gold","","-premiumred","-red"],STANDARD_BORDER:2,privilegeBorderClasses:{uncommon:"-q2",rare:"-q3",epic:"-q4",legendary:"-q5"},create:function(e,t,s,i,a,n,o,r,l){var c=$WH.ce(l?"span":"div"),u=$WH.ce("ins"),d=$WH.ce("del");if(null==t&&(t=1),c.className="icon"+Icon.sizes[t],$WH.ae(c,u),o||$WH.ae(c,d),Icon.setTexture(c,t,e),i){var p=$WH.ce("a");p.href=i,-1==i.indexOf("wowhead.com")&&"http:"==i.substr(0,5)&&(p.target="_blank"),$WH.ae(c,p)}else if(e){var h=c.firstChild.style,m=-1!=h.backgroundImage.indexOf("/avatars/");if(!m&&(c.onclick=Icon.onClick,!1!==i)){var p=$WH.ce("a");p.href="javascript:;",$WH.ae(c,p)}}return r&&void 0!==p&&(p.rel=r),Icon.setNumQty(c,a,n),c},createUser:function(e,t,s,i,a,n,o){2==e&&(t=g_staticUrl+"/uploads/avatars/"+t+".jpg");var r=Icon.create(t,s,null,i,null,null,n);return a!=Icon.STANDARD_BORDER&&Icon.premiumBorderClasses[a]?r.className+=" "+r.className+Icon.premiumBorderClasses[a]:o&&Icon.privilegeBorderClasses.hasOwnProperty(o)&&(r.className+=" "+r.className+Icon.privilegeBorderClasses[o]),2==e&&Icon.moveTexture(r,s,Icon.premiumOffsets[s][0],Icon.premiumOffsets[s][1],!0),r},getPrivilegeBorder:function(e){var t=!1;return e>=5e3&&(t="uncommon"),e>=1e4&&(t="rare"),e>=15e3&&(t="epic"),e>=25e3&&(t="legendary"),t},setTexture:function(e,t,s){if(s){var i=e.firstChild.style;-1!=s.indexOf("/")||-1!=s.indexOf("?")?i.backgroundImage="url("+s+")":i.backgroundImage="url("+g_staticDataUrl+"/images/wow/icons/"+Icon.sizes[t]+"/"+escape(s.toLowerCase())+".jpg)",Icon.moveTexture(e,t,0,0)}},moveTexture:function(e,t,s,i,a){var n=e.firstChild.style;s||i?n.backgroundPosition=a?s+"px "+i+"px":-s*Icon.sizes2[t]+"px "+-i*Icon.sizes2[t]+"px":n.backgroundPosition&&(n.backgroundPosition="")},setNumQty:function(e,t,s){for(var i=$WH.gE(e,"span"),a=0,n=i.length;a<n;++a)i[a]&&$WH.de(i[a]);null!=t&&(t>1&&t<2147483647||t.length&&"0"!=t&&"1"!=t)&&(i=g_createGlow(t,"q1"),i.style.right="0",i.style.bottom="0",i.style.position="absolute",$WH.ae(e,i)),null!=s&&s>0&&(i=g_createGlow("("+s+")","q"),i.style.left="0",i.style.top="0",i.style.position="absolute",$WH.ae(e,i))},getLink:function(e){return $WH.gE(e,"a")[0]},showIconName:function(e){if(e.firstChild){var t=e.firstChild.style;if(t.backgroundImage.length&&(t.backgroundImage.indexOf(g_staticDataUrl)>=4||""==g_staticDataUrl)){var s=t.backgroundImage.lastIndexOf("/"),i=t.backgroundImage.indexOf(".jpg");-1!=s&&-1!=i&&Icon.displayIcon(t.backgroundImage.substring(s+1,i))}}},onClick:function(){Icon.showIconName(this)},displayIcon:function(e){if(!Dialog.templates.icondisplay){var t=364;switch(Locale.getId()){case LOCALE_ESES:t=380;break;case LOCALE_RURU:t=384}Dialog.templates.icondisplay={title:LANG.icon,width:t,buttons:[["arrow",LANG.original],["cancel",LANG.close]],fields:[{id:"icon",label:LANG.dialog_imagename,required:1,type:"text",labelAlign:"left",compute:function(e,t,s,i){var a=$WH.ce("div");i.style.width="300px",a.style.position="relative",a.style.cssFloat="left",a.style.paddingRight="6px",e.style.width="200px";var n=this.iconDiv=$WH.ce("div");n.style.position="absolute",n.style.top="-12px",n.style.right="-70px",n.update=function(){setTimeout(function(){e.focus(),e.select()},10),$WH.ee(n),$WH.ae(n,Icon.create(e.value,2))},$WH.ae(n,Icon.create(t,2)),$WH.ae(a,n),$WH.ae(a,e),$WH.ae(i,a)}},{id:"location",label:" ",required:1,type:"caption",compute:function(e,t,s,i,a){$WH.ee(i),i.style.padding="3px 3px 0 3px",i.style.lineHeight="17px",i.style.whiteSpace="normal";var n=$WH.ce("div");n.style.position="relative",n.style.width="250px";var o=$WH.ce("span"),r=LANG.dialog_seeallusingicon;r=r.replace("$1",'<a href="?items&filter=cr=142;crs=0;crv='+this.data.icon+'">'+LANG.types[3][3]+"</a>"),r=r.replace("$2",'<a href="?spells&filter=cr=15;crs=0;crv='+this.data.icon+'">'+LANG.types[6][3]+"</a>"),r=r.replace("$3",'<a href="?achievements&filter=cr=10;crs=0;crv='+this.data.icon+'">'+LANG.types[10][3]+"</a>"),o.innerHTML=r,$WH.ae(n,o),$WH.ae(i,n)}}],onInit:function(e){this.updateIcon=this.template.updateIcon.bind(this,e)},onShow:function(e){this.updateIcon(),location.hash&&-1==location.hash.indexOf("#icon")?this.oldHash=location.hash:this.oldHash="";var t="#icon";$WH.isset("g_pageInfo")&&g_pageInfo.type&&-1==$WH.in_array([3,6,10],g_pageInfo.type)||(t+=":"+this.data.icon),location.hash=t},onHide:function(e){this.oldHash?location.hash=this.oldHash:location.hash="#."},updateIcon:function(e){this.iconDiv.update()},onSubmit:function(e,t,s,i){if("arrow"==s){return window.open(g_staticDataUrl+"/images/wow/icons/large/"+t.icon.toLowerCase()+".jpg","_blank").focus(),!1}return!0}}}Icon.icDialog||(Icon.icDialog=new Dialog),Icon.icDialog.show("icondisplay",{data:{icon:e}})},checkPound:function(){if(location.hash&&0==location.hash.indexOf("#icon")){var e=location.hash.split(":"),t=!1;if(2==e.length)t=e[1];else if(1==e.length&&$WH.isset("g_pageInfo"))switch(g_pageInfo.type){case 3:t=g_items[g_pageInfo.typeId].icon.toLowerCase();break;case 6:t=g_spells[g_pageInfo.typeId].icon.toLowerCase();break;case 10:t=g_achievements[g_pageInfo.typeId].icon.toLowerCase()}t&&Icon.displayIcon(t)}}};DomContentLoaded.addEvent(Icon.checkPound),Rectangle.prototype={intersectWith:function(e){return!(this.l>=e.r||e.l>=this.r||this.t>=e.b||e.t>=this.b)},contains:function(e){return this.l<=e.l&&this.t<=e.t&&this.r>=e.r&&this.b>=e.b},containedIn:function(e){return e.contains(this)}};var RedButton={create:function(e,t,s){var i=$WH.ce("a"),a=$WH.ce("em"),n=$WH.ce("b"),o=$WH.ce("i"),r=$WH.ce("span");return i.href="javascript:;",i.className="button-red",$WH.ae(n,o),$WH.ae(a,n),$WH.ae(a,r),$WH.ae(i,a),RedButton.setText(i,e),RedButton.enable(i,t),RedButton.setFunc(i,s),i},setText:function(e,t){$WH.st(e.firstChild.childNodes[0].firstChild,t),$WH.st(e.firstChild.childNodes[1],t)},enable:function(e,t){t||null==t?e.className=e.className.replace("button-red-disabled",""):-1==e.className.indexOf("button-red-disabled")&&(e.className+=" button-red-disabled")},setFunc:function(e,t){e.onclick=t||null}},LiveSearch=new function(){function setText(e,t){e.value=t,e.selectionStart=e.selectionEnd=t.length}function colorDiv(e,t){lastDiv&&(lastDiv.className=lastDiv.className.replace("live-search-selected","")),lastDiv=e,lastDiv.className+=" live-search-selected",selection=e.i,t||(show(),setTimeout(setText.bind(0,currentTextbox,g_getTextContent(e.firstChild.firstChild.childNodes[1])),1),cancelNext=1)}function aOver(){colorDiv(this.parentNode.parentNode,1)}function isVisible(){return!!container&&"none"!=container.style.display}function adjust(e){if((1!=e||isVisible())&&null!=currentTextbox){var t=$WH.ac(currentTextbox);container.style.left=t[0]-2+"px",container.style.top=t[1]+currentTextbox.offsetHeight+1+"px",container.style.width=currentTextbox.offsetWidth+"px"}}function prepare(){prepared||(prepared=1,container=$WH.ce("div"),container.className="live-search",container.style.display="none",$WH.ae($WH.ge("layers"),container),$WH.aE(window,"resize",adjust.bind(0,1)),$WH.aE(document,"click",hide))}function show(){container&&!isVisible()&&(adjust(),$(container).css({opacity:"0"}).show().animate({opacity:"1"},"fast",null,doneShowing))}function doneShowing(e){$(this).css("opacity","")}function hide(e){e&&!g_isLeftClick(e)||container&&(container.style.display="none")}function highlight(e,t){return t?e:"<b><u>"+e+"</u></b>"}function display(e,t,s,i){for(prepare(),show(),lastA=null,hasData=1,selection=null;container.firstChild;)$WH.de(container.firstChild);t=t.replace(/[^a-z0-9\-]/gi," "),t=$WH.trim(t.replace(/\s+/g," "));for(var a=g_createOrRegex(t,"s"==t?"[%]":null),n=0,o=s.length;n<o;++n){var r=s[n].lastIndexOf("(");-1!=r&&(s[n]=s[n].substr(0,r-1));var l=i[n][0],c=i[n][1],u=i[n][2],d=i[n][3],p=$WH.ce("a"),h=$WH.ce("i"),m=$WH.ce("span"),f=$WH.ce("div"),g=$WH.ce("div");f.i=n,p.onmouseover=aOver,p.href="?"+g_types[l]+"="+c,e._append&&(p.rel+=e._append),1==l&&null!=u&&(f.className+=" live-search-icon-boss"),3==l&&null!=d?p.className+=" q"+d:4==l&&null!=u?p.className+=" q"+u:13==l&&(p.className+=" c"+c),3!=l&&6!=l&&9!=l&&10!=l&&13!=l&&14!=l&&15!=l&&17!=l||!u?(5==l||11==l)&&u>=1&&u<=2&&(f.className+=" live-search-icon-quest-"+(1==u?"alliance":"horde")):(f.className+=" live-search-icon",f.style.backgroundImage="url("+g_staticDataUrl+"/images/wow/icons/small/"+u.toLowerCase()+".jpg)"),$WH.ae(h,$WH.ct(LANG.types[l][0])),$WH.ae(p,h);var v=s[n];v=v.replace(a,highlight),11==l&&(v=v.replace("%s",'<span class="q0">&lt;'+LANG.name+"&gt;</span>")),m.innerHTML=v,$WH.ae(p,m),6==l&&d&&$WH.ae(p,$WH.ct(" ("+d+")")),$WH.ae(g,p),$WH.ae(f,g),$WH.ae(container,f)}}function receive(xhr,opt){var text=xhr.responseText;if("["==text.charAt(0)&&"]"==text.charAt(text.length-1)){var a=eval(text),search=a[0];search==opt.search&&(8==a.length?display(opt.textbox,search,a[1],a[7]):hide())}}function fetch(e,t){var s="?search="+$WH.urlencode(t);e._type?s+="&json&type="+e._type:s+="&opensearch",new Ajax(s,{onSuccess:receive,textbox:e,search:t})}function preFetch(e,t){if(cancelNext)return void(cancelNext=0);hasData=0,timer>0&&(clearTimeout(timer),timer=0),timer=setTimeout(fetch.bind(0,e,t),LIVESEARCH_DELAY)}function cycle(e){if(!isVisible())return void(hasData&&show());var t="EM"==container.childNodes[0].nodeName?container.childNodes[3]:container.firstChild,s=e?t:container.lastChild;if(null==lastDiv)colorDiv(s);else{var i=e?lastDiv.nextSibling:lastDiv.previousSibling;i?("STRONG"==i.nodeName&&(i=container.lastChild),colorDiv(i)):colorDiv(s)}}function onKeyUp(e){e=$WH.$E(e);var t=e._target;switch(e.keyCode){case 48:case 96:case 107:case 109:if($WH.Browser.firefox&&e.ctrlKey){adjust(t);break}}var s=$WH.trim(t.value.replace(/\s+/g," "));s!=lastSearch[t.id]&&(lastSearch[t.id]=s,s.length?preFetch(t,s):hide())}function onKeyDown(e){e=$WH.$E(e);e._target;switch(e.keyCode){case 27:hide();break;case 38:cycle(0);break;case 40:cycle(1)}}function onFocus(e){e=$WH.$E(e);var t=e._target;t!=document&&(currentTextbox=t)}var currentTextbox,lastSearch={},lastDiv,timer,prepared,container,cancelNext,hasData,summary,selection,LIVESEARCH_DELAY=500;this.attach=function(e){e=$(e),e.length&&(e=e[0],"off"!=e.getAttribute("autocomplete")&&(e.setAttribute("autocomplete","off"),$WH.aE(e,"focus",onFocus),$WH.aE(e,"keyup",onKeyUp),$WH.aE(e,"keydown",onKeyDown)))},this.reset=function(e){lastSearch[e.id]=null,e.value="",hasData=0,hide()},this.hide=function(){hide()}},Lightbox=new function(){function e(){$WH.aE(r,"click",n),$WH.aE(document,"keydown",i),$WH.aE(window,"resize",a)}function t(){$WH.dE(r,"click",n),$WH.dE(document,"keydown",i),$WH.dE(window,"resize",a)}function s(){if(!u){u=1;var e=document.body;r=$WH.ce("div"),r.className="lightbox-overlay",l=$WH.ce("div"),l.className="lightbox-outer",c=$WH.ce("div"),c.className="lightbox-inner",r.style.display=l.style.display="none",$WH.ae(e,r),$WH.ae(l,c),$WH.ae(e,l)}}function i(e){switch(e=$WH.$E(e),e.keyCode){case 27:n()}}function a(e){1234!=e&&h.onResize&&h.onResize(),r.style.height=document.body.offsetHeight+"px"}function n(){u&&(t(),h.onHide&&h.onHide(),r.style.display=l.style.display="none",g_enableScroll(!0))}function o(){r.style.display=l.style.display=p[d].style.display="",Lightbox.setSize(c.offsetWidth,c.offsetHeight,1)}var r,l,c,u,d,p={},h={};this.setSize=function(e,t,s){$WH.Browser.ie||(c.style.visibility="hidden"),s||(c.style.width=e+"px",t&&(c.style.height=t+"px")),c.style.left=-parseInt(e/2)+"px",t&&(c.style.top=-parseInt(t/2)+"px"),c.style.visibility="visible"},this.show=function(t,i,n){h=i||{},s(),e(),d!=t&&null!=p[d]&&(p[d].style.display="none"),d=t;var r,l=0;null==p[t]?(l=1,r=$WH.ce("div"),$WH.ae(c,r),p[t]=r):r=p[t],h.onShow&&h.onShow(r,l,n),a(1234),o(),g_enableScroll(!1)},this.reveal=function(){o()},this.hide=function(){n()},this.isVisible=function(){return r&&"none"!=r.style.display}};Mapper.sizes=[[488,325,"normal"],[772,515,"zoom"],[1002,668,"original"],[224,149,"small"]],Mapper.onlyOneFloor={4265:!0,4264:!0,4416:!0,4415:!0,4493:!0,4500:!0,4603:!0,4723:!0,4809:!0,4813:!0,4820:!0},Mapper.zoneLevelOffset={4273:0},Mapper.zoneDefaultLevel={3456:4,4812:4},Mapper.remappedLevels={4273:{6:5}},Mapper.multiLevelZones={},Mapper.prototype={getMap:function(){return this.parent},update:function(e,t){null!=e.zoom&&(this.zoom=e.zoom),null!=e.zone&&(this.zone=e.zone),null!=e.show&&(this.show=e.show),this.pins=[],this.nCoords=0;for(var s in this.floorPins)this.floorPins[s].parentNode&&$WH.de(this.floorPins[s]);this.floorPins={},this.floorButton&&($WH.de(this.floorButton),this.floorButton=null);var i=void 0===e.level?0:this.fixLevel(parseInt(e.level));e.preservelevel?i=this.level:this.level=0;var a=!1;if($WH.isset("g_mapperData")?a=g_mapperData:$WH.isset("g_mapper_data")&&(a=g_mapper_data),a&&a[this.zone]&&!e.coords){var n=a[this.zone],o=-1;for(var s in n){s=parseInt(s);var r=this.fixLevel(s);void 0===e.level&&n[s].count>o&&(i=parseInt(r),o=n[s].count),n[s].coords&&this.setCoords(n[s].coords,r)}this.level=i,this.floorPins[this.level]&&$WH.ae(this.span,this.floorPins[this.level])}else if(null!=e.coords){var l=999;for(var s in e.coords){s=parseInt(s);var r=this.fixLevel(s);this.setCoords(e.coords[s],r),r<l&&(l=r)}999==l||e.preservelevel||(this.level=l),this.floorPins[this.level]&&$WH.ae(this.span,this.floorPins[this.level])}else null!=e.link&&this.setLink(e.link);this.updateMap(t)},fixLevel:function(e){return void 0!==Mapper.zoneLevelOffset[this.zone]?e+=Mapper.zoneLevelOffset[this.zone]:Mapper.multiLevelZones[this.zone]&&e>0?e+=-1:void 0==Mapper.multiLevelZones[this.zone]&&(e=0),Mapper.remappedLevels[this.zone]&&void 0!==Mapper.remappedLevels[this.zone][e]&&(e=Mapper.remappedLevels[this.zone][e]),e},getZone:function(){return this.zone},setZone:function(e,t,s){return this.pins=[],this.nCoords=0,this.floorPins[this.level]&&$WH.de(this.floorPins[this.level]),this.floorPins={},this.floorButton&&($WH.de(this.floorButton),this.floorButton=null),this.zone=e,this.level=0|t,this.updateMap(s),!0},showFloors:function(e){if(Mapper.multiLevelZones[this.zone]){for(var t=[],s=Mapper.multiLevelZones[this.zone],i=g_zone_areas,a=0;a<s.length;++a){var n;n=i[this.zone]?[a,i[this.zone][a],this.setMap.bind(this,s[a],a,!0)]:[a,"[Level "+(a+1)+"]",this.setMap.bind(this,s[a],a,!0)],(a==this.level||void 0===this.level&&0==a)&&(n.checked=!0),t.push(n)}Menu.showAtCursor(t,e)}},setMap:function(e,t,s){t!=this.level&&(this.floorPins[this.level]&&$WH.de(this.floorPins[this.level]),this.floorPins[t]&&$WH.ae(this.span,this.floorPins[t]),this.level=t);var i=Locale.getName();if($WH.isset("g_ptr")&&g_ptr?i="ptr":$WH.isset("g_beta")&&g_beta?i="beta":$WH.isset("g_old")&&g_old&&(i="old"),this.span.style.background="url("+g_staticDataUrl+"/images/wow/maps/"+i+"/"+Mapper.sizes[this.zoom][2]+"/"+e+".jpg)",this.overlay&&(this.overlaySpan.style.background="url("+g_staticDataUrl+"/images/wow/maps/overlay/"+Mapper.sizes[this.zoom][2]+"/"+e+".png)"),this.sZoneLink){var a="",n=parseInt(this.zone),o=null!=g_zones[n],r=g_zone_areas;if(o&&(this.zoneLink&&(a+='<a href="?zone='+n+'">'+g_zones[n]+"</a>"),Mapper.multiLevelZones[n]&&(this.zoneLink&&(a+=": "),a+=r[n]?r[n][this.level]:"Level "+(this.level+1)),g_setInnerHtml(this.sZoneLink,a,"div"),this.zoneLink))for(var l=0;l<9;++l)4!=l&&(this.sZoneLink.childNodes[l].firstChild.style.color="black");this.sZoneLink.style.display=o?"":"none"}s&&this.onMapUpdate&&this.onMapUpdate(this)},setObjectives:function(e){for(var t in e){var s=e[t];void 0===g_mapperData[t]&&(g_mapperData[t]={});for(var i in s.levels){var a=s.levels[i],n=ShowOnMap.combinePins(a),o=n[0];g_mapperData[t][i]={count:o.length,coords:[]};for(var r=0;r<o.length;++r){var l=ShowOnMap.buildTooltip(o[r].list);g_mapperData[t][i].coords.push([o[r].coord[0],o[r].coord[1],{type:l[1],url:l[2],menu:l[3],label:l[0]}])}}}},setZones:function(e,t){if((e=$WH.ge(e))&&t&&0!=t.length&&this.objectives){var s=function(e,s,i,a){for(var n=[!1,-1],o=0;o<i.length;++o){o>0&&$WH.ae(p,$WH.ct(o==i.length-1?LANG.and:LANG.comma));var r=null;if(e.objectives[i[o][0]].mappable>0?(r=$WH.ce("a"),r.href="javascript:;",$WH.ae(r,$WH.ct(e.objectives[i[o][0]].zone)),r.onclick=function(t,s){e.update({zone:s}),g_setSelectedLink(t,"mapper")}.bind(e,r,i[o][0]),r.isLink=!0):(r=$WH.ce("a"),r.href="?zone="+i[o][0],$WH.ae(r,$WH.ct(e.objectives[i[o][0]].zone)),g_addTooltip(r,LANG.tooltip_zonelink)),t.length>1){var l=a[i[o][0]];l.start&&l.end?(r.className+=" icontiny",r.style.backgroundImage="url("+g_staticDataUrl+"/images/wow/icons/tiny/quest_startend.gif)",r.style.paddingLeft="20px"):l.start?(r.className+=" icontiny",r.style.backgroundImage="url("+g_staticDataUrl+"/images/wow/icons/tiny/quest_start.gif)",r.style.paddingLeft="14px"):l.end&&(r.className+=" icontiny",r.style.backgroundImage="url("+g_staticDataUrl+"/images/wow/icons/tiny/quest_end.gif)",r.style.paddingLeft="16px")}$WH.ae(s,r),i[o][1]>n[1]&&(n=[r,i[o][1]])}return n[0]},i=function(e,t,s){for(var i=[],a=0;a<e.length;++a)t[e[a][0]][s]&&i.push(e[a]);return i},a={},n={start:[],end:[],objective:[]};for(var o in this.objectives){void 0===a[o]&&(a[o]={});var r=this.objectives[o];for(var l in r.levels)for(var c=r.levels[l],u=0;u<c.length;++u)"start"==c[u].point||"sourcestart"==c[u].point?(n.start.push(o),a[o].start=!0):"end"==c[u].point||"sourceend"==c[u].point?(n.end.push(o),a[o].end=!0):"requirement"!=c[u].point&&"sourcerequirement"!=c[u].point||(n.objective.push(o),a[o].objective=!0)}var d=$WH.ce("h3");if($WH.ae(d,$WH.ct(LANG.mapper_relevantlocs)),$WH.ae(e,d),1==t.length&&0==this.missing){var p=$WH.ce("span");p.innerHTML=LANG.mapper_entiretyinzone.replace("$$","<b>"+this.objectives[t[0][0]].zone+"</b>."),$WH.ae(e,p),this.update({zone:t[0][0]})}else if(this.missing>0){var p=$WH.ce("span"),h=!1,m=!1,f=!1;n.objective=$WH.array_unique(n.objective),n.start=$WH.array_unique(n.start),n.end=$WH.array_unique(n.end);var g=n.start.length>0&&$WH.array_compare(n.start,n.end),v=n.start.length>0&&$WH.array_compare(n.start,n.objective),$=n.end.length>0&&$WH.array_compare(n.end,n.objective),_=i(t,a,"objective"),H=i(t,a,"start"),W=i(t,a,"end");if(g&&v){var y=LANG.mapper_happensin.split("$$");$WH.ae(p,$WH.ct(y[0])),h=s(this,p,t,a),$WH.ae(p,$WH.ct(y[1]))}else if(g&&0==n.objective.length){var y=LANG.mapper_objectives.sex.split("$$");$WH.ae(p,$WH.ct(y[0])),h=s(this,p,t,a),$WH.ae(p,$WH.ct(y[1]))}else if(g){var y=LANG.mapper_objectives.ox_sey.split("$$");$WH.ae(p,$WH.ct(y[0])),h=s(this,p,H,a),$WH.ae(p,$WH.ct(y[1])),m=s(this,p,_,a),$WH.ae(p,$WH.ct(y[2]))}else if(v&&0==n.end.length){var y=LANG.mapper_objectives.osx.split("$$");$WH.ae(p,$WH.ct(y[0])),h=s(this,p,t,a),$WH.ae(p,$WH.ct(y[1]))}else if(v){var y=LANG.mapper_objectives.osx_ey.split("$$");$WH.ae(p,$WH.ct(y[0])),h=s(this,p,_,a),$WH.ae(p,$WH.ct(y[1])),m=s(this,p,W,a),$WH.ae(p,$WH.ct(y[2]))}else if($&&0==n.start.length){var y=LANG.mapper_objectives.oex.split("$$");$WH.ae(p,$WH.ct(y[0])),h=s(this,p,t,a),$WH.ae(p,$WH.ct(y[1]))}else if($){var y=LANG.mapper_objectives.oex_sy.split("$$");$WH.ae(p,$WH.ct(y[0])),m=s(this,p,_,a),$WH.ae(p,$WH.ct(y[1])),h=s(this,p,H,a),$WH.ae(p,$WH.ct(y[2]))}else if(n.start.length>0&&n.end.length>0&&n.objective.length>0){var y=LANG.mapper_objectives.ox_sy_ez.split("$$");$WH.ae(p,$WH.ct(y[0])),h=s(this,p,H,a),$WH.ae(p,$WH.ct(y[1])),m=s(this,p,_,a),$WH.ae(p,$WH.ct(y[2])),f=s(this,p,W,a),$WH.ae(p,$WH.ct(y[3]))}else if(n.start.length>0&&n.end.length>0){var y=LANG.mapper_objectives.sx_ey.split("$$");$WH.ae(p,$WH.ct(y[0])),h=s(this,p,H,a),$WH.ae(p,$WH.ct(y[1])),m=s(this,p,W,a),$WH.ae(p,$WH.ct(y[2]))}else if(n.start.length>0&&n.objective.length>0){var y=LANG.mapper_objectives.ox_sy.split("$$");$WH.ae(p,$WH.ct(y[0])),h=s(this,p,H,a),$WH.ae(p,$WH.ct(y[1])),m=s(this,p,_,a),$WH.ae(p,$WH.ct(y[2]))}else if(n.end.length>0&&n.objective.length>0){var y=LANG.mapper_objectives.ox_ey.split("$$");$WH.ae(p,$WH.ct(y[0])),h=s(this,p,_,a),$WH.ae(p,$WH.ct(y[1])),m=s(this,p,W,a),$WH.ae(p,$WH.ct(y[2]))}else if(n.start.length>0){var y=LANG.mapper_objectives.sx.split("$$");$WH.ae(p,$WH.ct(y[0])),h=s(this,p,t,a),$WH.ae(p,$WH.ct(y[1]))}else if(n.end.length>0){var y=LANG.mapper_objectives.ex.split("$$");$WH.ae(p,$WH.ct(y[0])),h=s(this,p,t,a),$WH.ae(p,$WH.ct(y[1]))}else if(n.objective.length>0){var y=LANG.mapper_objectives.ox.split("$$");$WH.ae(p,$WH.ct(y[0])),h=s(this,p,t,a),$WH.ae(p,$WH.ct(y[1]))}else{var y=LANG.mapper_happensin.split("$$");$WH.ae(p,$WH.ct(y[0])),h=s(this,p,t,a),$WH.ae(p,$WH.ct(y[1]))}$WH.ae(e,p),h&&h.isLink?h.click():m&&m.isLink?m.click():f&&f.isLink&&f.click()}else{var y=LANG.mapper_happensin.split("$$"),p=$WH.ce("span");$WH.ae(p,$WH.ct(y[0]));var h=s(this,p,t,a);$WH.ae(p,y[1]),$WH.ae(e,p),h&&h.isLink&&h.click()}}},setSize:function(e,t){this.tempWidth=e,this.tempHeight=t,this.updateMap(!0)},getZoom:function(){return this.zoom},setZoom:function(e,t){this.zoom=e,this.tempWidth=this.tempHeight=null,this.updateMap(t)},toggleZoom:function(e){this.zoom=1-this.zoom,this.updateMap(!0),e&&this.getMousePos(e),this.sZoom&&("none"==this.sZoom.style.display?this.sZoom.style.display="":this.sZoom.style.display="none"),this.zoom&&void 0===e&&MapViewer.show({mapper:this})},getShow:function(){return this.show},setShow:function(e){this.show=e;var t=this.show?"":"none";for(var s in this.floorPins)this.floorPins[s].style.display=t;RedButton.setText(this.sToggle,this.show?LANG.mapper_hidepins:LANG.mapper_showpins)},toggleShow:function(){this.setShow(!this.show)},getCoords:function(){var e=[];for(var t in this.pins)this.pins[t].free||e.push([this.pins[t].x,this.pins[t].y]);return e},clearPins:function(){for(var e in this.pins)this.pins[e].style.display="none",this.pins[e].free=!0},setCoords:function(e,t){var s,i,a;if(void 0===t){if(this.clearPins(),e.length)a=!0,i=0;else{for(var n in e){i=n;break}if(null==i)return;e=e[i]}i=parseInt(i),a||(i=this.fixLevel(i),this.level=i)}else i=t;this.nCoords=e.length;for(var n in e){var o=e[n],r=o[2];if(void 0!==o[0]&&void 0!==o[1]){if(s=this.getPin(i),s.x=o[0],s.y=o[1],s.style.left=s.x+"%",s.style.top=s.y+"%",this.editable?s.a.onmouseup=this.delPin.bind(this,s):r&&r.url&&(s.a.href=Markup._fixUrl(r.url),s.a.rel="np",s.a.style.cursor="pointer"),r&&r.tooltip){s.a.tt="";var l=!1;for(var c in r.tooltip){""!=s.a.tt&&(s.a.tt+="<br />"),s.a.tt+='<b class="q">'+c+"</b> ($)<br />";for(var u in r.tooltip[c].info)s.a.tt+="<div>"+r.tooltip[c].info[u]+"</div>";!l&&r.tooltip[c].footer&&(s.a.tt+=r.tooltip[c].footer+"<br />",l=!0)}}else r&&r.label?s.a.tt=r.label:s.a.tt="$";if(r&&r.menu&&(s.a.menu=r.menu,Menu.add(s.a,s.a.menu,{showAtCursor:!0})),r&&r.type&&(s.className+=" pin-"+r.type),s.a.tt=$WH.str_replace(s.a.tt,"$",s.x.toFixed(1)+", "+s.y.toFixed(1)),r&&r.lines)for(var d=0,p=r.lines.length;d<p;++d)if(o[0]!=r.lines[d][0]||o[1]!=r.lines[d][1])for(var h=0,m=Mapper.sizes.length;h<m;++h){var f=Mapper.sizes[h];s=Line(o[0]*f[0]/100,o[1]*f[1]/100,r.lines[d][0]*f[0]/100,r.lines[d][1]*f[1]/100,r.type),s.className+=" "+f[2],$WH.ae(this.floorPins[i],s)}}}this.onPinUpdate&&this.onPinUpdate(this)},getLink:function(){var e="";for(var t in this.pins)this.pins[t].free||this.pins[t].floor!=this.level||(e+=(this.pins[t].x<10?"0":"")+(this.pins[t].x<1?"0":"")+(10*this.pins[t].x).toFixed(0)+(this.pins[t].y<10?"0":"")+(this.pins[t].y<1?"0":"")+(10*this.pins[t].y).toFixed(0));return(this.zone?this.zone:"")+(Mapper.multiLevelZones[this.zone]&&0!=this.level?"."+this.level:"")+(e?":"+e:"")},setLink:function(e,t){var s=[];e=e.split(":");var i=e[0],a=0;if(-1!=i.indexOf(".")){var n=i.split(".");i=n[0],a=parseInt(n[1])}if(!this.setZone(i,a,t))return!1;if(2==e.length)for(var o=0;o<e[1].length;o+=6){var r=e[1].substr(o,3)/10,l=e[1].substr(o+3,3)/10;if(isNaN(r)||isNaN(l))break;s.push([r,l])}return this.setCoords(s,a),!0},updateMap:function(e){if(this.parent.style.width=this.span.style.width=(this.tempWidth?this.tempWidth:Mapper.sizes[this.zoom][0])+"px",this.parent.style.height=this.span.style.height=(this.tempHeight?this.tempHeight:Mapper.sizes[this.zoom][1])+"px",this.editable||(this.parent.style.cssFloat=this.parent.style.styleFloat="left"),"0"==this.zone)this.span.style.background="black";else{var t=this.level;1==t&&Mapper.onlyOneFloor[this.zone]&&(t=0);var s=this.zone+(t?"-"+t:"");Mapper.multiLevelZones[this.zone]&&(s=Mapper.multiLevelZones[this.zone][t]),this.setMap(s,t),!this.floorButton&&Mapper.multiLevelZones[this.zone]?(this.floorButton=_=RedButton.create(LANG.mapper_floor,!0,this.showFloors.bind(this)),_.style.float="right",$WH.ns(_),this.buttonDiv.appendChild(_)):this.floorButton&&(this.floorButton.style.display=Mapper.multiLevelZones[this.zone]?"":"none")}if(this.sToggle&&(this.sToggle.style.display=this.toggle&&this.nCoords?"":"none"),e||$WH.g_scrollTo(this.parent,3),this.floorPins[t]){var a=this.floorPins[t].getElementsByClassName("line");for(i in a)i<a.length&&(a[i].style.display="none");a=this.floorPins[t].getElementsByClassName("line "+Mapper.sizes[this.zoom][2]);for(i in a)i<a.length&&(a[i].style.display="block")}this.onMapUpdate&&this.onMapUpdate(this)},cleanPin:function(e,t){var s=this.pins[e];return s.style.display="",s.free=!1,s.className="pin",s.a.onmousedown=$WH.rf,s.a.onmouseup=$WH.rf,s.a.href="javascript:;",s.a.style.cursor="default",s.floor=t,s},getPin:function(e){for(var t=0;t<this.pins.length;++t)if(this.pins[t].free)return this.cleanPin(t,e);var s=$WH.ce("div"),i=$WH.ce("a");return s.className="pin",s.appendChild(i),s.a=i,s.floor=e,i.onmouseover=this.pinOver,i.onmouseout=$WH.Tooltip.hide,i.onclick=$WH.sp,this.pins.push(s),this.cleanPin(this.pins.length-1,e),this.floorPins[e]||(this.floorPins[e]=$WH.ce("div"),this.floorPins[e].style.display=this.show?"":"none",e==this.level&&$WH.ae(this.span,this.floorPins[e])),$WH.ae(this.floorPins[e],s),s},addPin:function(e){if(e=$WH.$E(e),!(e._button>=2)){this.getMousePos(e);var t=this.getPin(this.level);return t.x=this.mouseX,t.y=this.mouseY,t.style.left=t.x.toFixed(1)+"%",t.style.top=t.y.toFixed(1)+"%",t.a.onmouseup=this.delPin.bind(this,t),t.a.tt=t.x.toFixed(1)+", "+t.y.toFixed(1),this.onPinUpdate&&this.onPinUpdate(this),!1}},delPin:function(e,t){t=$WH.$E(t),e.style.display="none",e.free=!0,$WH.sp(t),this.onPinUpdate&&this.onPinUpdate(this)},pinOver:function(){$WH.Tooltip.show(this,this.tt,4,0)},getMousePos:function(e){e=$WH.$E(e);var t=$WH.ac(this.parent),s=$WH.g_getScroll();this.mouseX=Math.floor((e.clientX+s.x-t[0]-3)/Mapper.sizes[this.zoom][0]*1e3)/10,this.mouseY=Math.floor((e.clientY+s.y-t[1]-3)/Mapper.sizes[this.zoom][1]*1e3)/10,this.mouseX<0?this.mouseX=0:this.mouseX>100&&(this.mouseX=100),this.mouseY<0?this.mouseY=0:this.mouseY>100&&(this.mouseY=100),this.mouse&&g_setTextNodes(this.sMouse,"("+this.mouseX.toFixed(1)+", "+this.mouseY.toFixed(1)+")")}};var MapViewer=new function(){function e(){Math.max(50,Math.min(618,$WH.g_getWindowSize().h-72));d=1,u=1,d>1&&(d=1),u>1&&(u=1),l=Math.round(772*u),c=Math.round(515*u);var e=Math.max(480,l);Lightbox.setSize(e+20,c+52)}function t(e){var t=function(e,t){return t+=":"+e.zone,e.level&&(t+="."+e.level),t},s="#map";return v?s+="="+p.getLink():Mapper.zoneDefaultLevel[p.zone]?Mapper.zoneDefaultLevel[p.zone]!=p.level&&(s=t(p,s)):0!=p.level?s=t(p,s):$WH.isset("g_mapperData")&&g_mapperData[p.zone]||$WH.isset("g_mapper_data")&&g_mapper_data[p.zone]||(s=t(p,s)),s}function s(){m&&m(p),location.replace(t(!0))}function i(i){i&&u==d&&$WH.g_getWindowSize().h>H.offsetHeight||(H.style.visibility="hidden",e(0),i||(_||(_=$WH.ce("div"),_.style.height="325px",_.style.padding="3px",_.style.marginTop="10px"),p.parent.style.borderWidth="0px",p.parent.style.marginTop="0px",p.span.style.cursor="pointer",p.span.onclick&&(h=p.span.onclick),p.span.onclick=Lightbox.hide,p.span.onmouseover=function(){y.style.display="block"},p.span.onmouseout=function(){setTimeout(function(){y.hasMouse||(y.style.display="none")},10)},p.onMapUpdate&&(m=p.onMapUpdate),p.onMapUpdate=s,v?($WH.de(v),$WH.ae(mapDiv,v)):(f=p.parent.parentNode,g=p.parent.nextSibling,f.insertBefore(_,p.parent),$WH.de(p.parent),$WH.ae(mapDiv,p.parent)),-1==location.hash.indexOf("#show")?location.replace(t(!1)):$WH.isset("mapShower")&&mapShower.onExpand()),Lightbox.reveal(),H.style.visibility="visible")}function a(){i(1)}function n(){p.span.onclick=h||null,h=null,p.onMapUpdate=m||null,m=null,p.span.style.cursor="",p.span.onmouseover=null,p.span.onmouseout=null,v?($WH.de(v),v=null):($WH.de(_),$WH.de(p.parent),p.parent.style.borderWidth="",p.parent.style.marginTop="",g?f.insertBefore(p.parent,g):$WH.ae(f,p.parent),f=g=null),p.toggleZoom(),-1==location.hash.indexOf("#show")?location.replace("#."):$WH.isset("mapShower")&&mapShower.onCollapse()}function o(e,t,s){if(p=s.mapper,H=e,t){e.className="mapviewer",W=$WH.ce("div"),W.style.width="772px",W.style.height="515px",W.className="mapviewer-screen",y=$WH.ce("a"),y.className="mapviewer-cover",y.href="javascript:;",y.onclick=Lightbox.hide,y.onmouseover=function(){y.hasMouse=!0},y.onmouseout=function(){y.hasMouse=!1};var i=$WH.ce("span"),a=$WH.ce("b");$WH.ae(a,$WH.ct(LANG.close)),$WH.ae(i,a),$WH.ae(y,i),$WH.ae(W,y),mapDiv=$WH.ce("div"),$WH.ae(W,mapDiv),$WH.ae(e,W);var n=$WH.ce("a");n.className="dialog-cancel",n.href="javascript:;",n.onclick=Lightbox.hide,$WH.ae(n,$WH.ct(LANG.close)),$WH.ae(e,n);var o=$WH.ce("div");o.className="clear",$WH.ae(e,o)}r()}function r(){i()}var l,c,u,d,p,h,m,f,g,v,_,H,W,y;this.checkPound=function(){if(location.hash&&0==location.hash.indexOf("#map")){var e=location.hash.split("=");if(2==e.length){var t=e[1];t&&MapViewer.show({link:t})}else{e=location.hash.split(":");var s=$WH.ge("sjdhfkljawelis");if(s&&s.onclick(),2==e.length){s||MapViewer.show({link:e[1]});var i=e[1].split("."),a={zone:i[0]};2==i.length&&(a.level=parseInt(i[1])+1),p.update(a)}}}},this.show=function(e){if(e.link){v=$WH.ce("div"),v.id="fewuiojfdksl",$WH.aef(document.body,v);var t=new Mapper({parent:v.id});t.setLink(e.link,!0),t.toggleZoom()}else Lightbox.show("mapviewer",{onShow:o,onHide:n,onResize:a},e)},$(document).ready(this.checkPound)},ModelViewer=new function(){function e(){}function t(){var e,t;return e=f.is(":visible")?f[0].selectedIndex>=0?f.val():"":g[0].selectedIndex>=0?g.val():"",t=v[0].selectedIndex>=0?v.val():0,{r:e,s:t}}function s(e,t){return!isNaN(e)&&e>0&&-1!=$WH.in_array(b,e,function(e){return e.id})&&!isNaN(t)&&t>=0&&t<=1}function i(){var e={model:u,modelType:p,contentPath:g_staticDataUrl+"/modelviewer/"},s={quality:"high",allowscriptaccess:"always",allowfullscreen:!0,menu:!1,bgcolor:"#181818",wmode:"direct"},i={};16==p&&W.length&&(e.equipList=W.join(",")),swfobject.embedSWF(g_staticDataUrl+"/modelviewer/ZAMviewerfp11.swf","modelviewer-generic","600","400","11.0.0",g_staticDataUrl+"/modelviewer/expressInstall.swf",e,s,i);var a=t(),n=a.r,o=a.s;if(!h.noPound){var r="#modelviewer",a=$WH.ge("view3D-button");if(!a)switch(h.type){case 1:r+=":1:"+h.displayId+":"+(0|h.humanoid);break;case 2:r+=":2:"+h.displayId;break;case 3:r+=":3:"+h.displayId+":"+(0|h.slot);break;case 4:r+=":4:"+W.join(";")}r+=n&&o?":"+n+"+"+o:":",null!=h.extraPound&&(r+=":"+h.extraPound),y=!1,location.replace($WH.rtrim(r,":"))}}function a(){var s=t(),a=s.r,n=s.s;if(a){v.is(":visible")||v.show();var s=function(e){return e.id},o=$WH.in_array(b,a,s),r=$WH.in_array(w,n,s);-1!=o&&-1!=r&&(u=b[o].model+w[r].model,p=16),g_setWowheadCookie("temp_default_3dmodel",a+","+n)}else{if(!v.is(":visible"))return;switch(v.hide(),u=W[1],h.slot){case 1:p=2;break;case 3:p=4;break;default:p=1}}e(),i()}function n(){var e=$("#modelviewer-generic");if(0!=e.length){e=e[0];var t=$("select",animDiv);t.val()&&e.isLoaded&&e.isLoaded()&&e.setAnimation(t.val())}}function o(){if(!y){var e=$("#modelviewer-generic");if(0!=e.length){e=e[0];var t=$("select",animDiv);if(t.empty(),!e.isLoaded||!e.isLoaded())return void t.append($("<option/>",{text:LANG.tooltip_loading,val:0}));for(var s={},i=e.getNumAnimations(),a=0;a<i;++a){
var n=e.getAnimation(a);n&&"EmoteUseStanding"!=n&&(s[n]=1)}var o=[];for(var n in s)o.push(n);o.sort();for(var a=0;a<o.length;++a)t.append($("<option/>",{text:o[a],val:o[a]}));y=!0}}}function r(e,t){var i,a,n=-1,o=-1;if(null!=t.race&&null!=t.sex?(n=t.race,o=t.sex,m.hide(),e=0):m.show(),-1==n&&-1==o&&location.hash){var r=location.hash.match(/modelviewer:.*?([0-9]+)\+([0-9]+)/);null!=r&&s(r[1],r[2])&&(n=r[1],o=r[2],v.show())}if(e)i=f,a=1,f.show(),f[0].selectedIndex=-1,g.hide(),-1==o&&v.hide();else{if(-1==n&&-1==o){var l=1,c=0;if(g_user&&g_user.cookies.default_3dmodel){var d=g_user.cookies.default_3dmodel.split(",");2==d.length&&(l=d[0],c=d[1]-1)}else{var h=g_getWowheadCookie("temp_default_3dmodel");if(h){var d=h.split(",");2==d.length&&(l=d[0],c=d[1])}}s(l,c)?(n=l,o=c):(n=1,o=0)}i=g,a=0,f.hide(),g.show(),v.show()}if(-1!=o&&(v[0].selectedIndex=o),-1!=n&&-1!=o){var $=function(e){return e.id},_=$WH.in_array(b,n,$),H=$WH.in_array(w,o,$);-1!=_&&-1!=H&&(u=b[_].model+w[H].model,p=16,_+=a,i[0].selectedIndex=_,v[0].selectedIndex=H)}}function l(){h.noPound||(!h.fromTag&&_&&-1==_.indexOf("modelviewer")?location.replace(_):location.replace("#.")),h.onHide&&h.onHide()}function c(t,s,l){if(!l.displayAd||g_user.premium?Lightbox.setSize(620,452):Lightbox.setSize(749,546),s){t.className="modelviewer";var c=$WH.ce("div"),h=$WH.ce("div");h.id="modelviewer-generic",$WH.ae(c,h),c.className="modelviewer-screen";var H=$WH.ce("div");H.style.backgroundColor="#181818",H.style.margin="0",$WH.ae(H,c),$WH.ae(t,H),t=$(t);var y=$("<div/>",{css:{float:"left"}});animDiv=$("<div/>",{class:"modelviewer-animation"});var N=$("<var/>",{text:LANG.animation});animDiv.append(N);var x=$("<select/>",{change:n,mouseenter:o});x.append($("<option/>",{text:LANG.dialog_mouseovertoload})),animDiv.append(x),t.append(animDiv);var L=$("<a/>",{class:"modelviewer-help",href:"?help=modelviewer",target:"_blank"}),k=$("<a/>",{class:"modelviewer-close",href:"javascript:;",click:Lightbox.hide});L.append($("<span/>")),k.append($("<span/>")),m=$("<div/>",{class:"modelviewer-model"});var A=function(e,t){return $WH.strcmp(e.name,t.name)};b.sort(A),w.sort(A),f=$("<select/>",{change:a}),g=$("<select/>",{change:a}),v=$("<select/>",{change:a}),f.append($("<option/>"));for(var M=0,G=b.length;M<G;++M){var I=$("<option/>",{val:b[M].id,text:b[M].name});f.append(I)}for(var M=0,G=b.length;M<G;++M){var I=$("<option/>",{val:b[M].id,text:b[M].name});g.append(I)}for(var M=0,G=w.length;M<G;++M){var I=$("<option/>",{val:w[M].id,text:w[M].name});v.append(I)}v.hide(),m.append($("<div/>")),m.append(f),m.append(g),m.append(v),y.append(m);var C=$("<span/>");C.append("<small>Drag to rotate<br />Control (Windows) / Cmd (Mac) + drag to pan</small>"),y.append(C),t.append(y),t.append(k),t.append(L),d=$("<div/>",{class:"clear"}),t.append(d)}switch(l.type){case 1:m.hide(),p=l.humanoid?32:8,u=l.displayId;break;case 2:m.hide(),p=64,u=l.displayId;break;case 3:if(W=[l.slot,l.displayId],-1!=$WH.in_array([4,5,6,7,8,9,10,16,19,20],l.slot))r(0,l);else{switch(l.slot){case 1:p=2;break;case 3:p=4;break;default:p=1}u=l.displayId,r(1,l)}break;case 4:W=l.equipList,r(0,l)}e(),setTimeout(i,1);var T="";if(l.fromTag)switch(T+="Custom ",l.type){case 1:T+="NPC "+l.displayId+(l.humanoid?" humanoid":"");break;case 2:T+="Object "+l.displayId;break;case 3:T+="Item "+l.displayId+" Slot "+(0|l.slot);break;case 4:T+="Item set "+W.join(".")}else switch(l.type){case 1:T+="NPC "+(l.typeId?l.typeId:" DisplayID "+l.displayId);break;case 2:T+="Object "+l.typeId;break;case 3:T+="Item "+l.typeId;break;case 4:T+="Item set "+W.join(".")}g_trackEvent("Model Viewer","Show",g_urlize(T)),_=location.hash}this.validSlots=[1,3,4,5,6,7,8,9,10,13,14,15,16,17,19,20,21,22,23,25,26],this.slotMap={1:1,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,13:21,14:22,15:22,16:16,17:21,19:19,20:5,21:21,22:22,23:22,25:21,26:21};var u,p,h,m,f,g,v,_,H,W=[],y=!1,b=[{id:10,name:g_chr_races[10],model:"bloodelf"},{id:11,name:g_chr_races[11],model:"draenei"},{id:3,name:g_chr_races[3],model:"dwarf"},{id:7,name:g_chr_races[7],model:"gnome"},{id:1,name:g_chr_races[1],model:"human"},{id:4,name:g_chr_races[4],model:"nightelf"},{id:2,name:g_chr_races[2],model:"orc"},{id:6,name:g_chr_races[6],model:"tauren"},{id:8,name:g_chr_races[8],model:"troll"},{id:5,name:g_chr_races[5],model:"scourge"}],w=[{id:0,name:LANG.male,model:"male"},{id:1,name:LANG.female,model:"female"}];this.checkPound=function(){if(location.hash&&0==location.hash.indexOf("#modelviewer")){var e=location.hash.split(":");if(e.length>=3){e.shift();var t=parseInt(e.shift()),s={type:t};switch(t){case 1:s.displayId=parseInt(e.shift());1==parseInt(e.shift())&&(s.humanoid=1);break;case 2:s.displayId=parseInt(e.shift());break;case 3:s.displayId=parseInt(e.shift()),s.slot=parseInt(e.shift());break;case 4:var i=e.shift();s.equipList=i.split(";")}(s.displayId||s.equipList)&&ModelViewer.show(s),null!=H&&e.length>0&&e[e.length-1]&&H(e[e.length-1])}else if(null!=H&&2==e.length&&e[1])H(e[1]);else{var a=$WH.ge("view3D-button");a&&a.onclick()}}},this.addExtraPound=function(e){H=e},this.show=function(e){h=e,Lightbox.show("modelviewer",{onShow:c,onHide:l},e)},DomContentLoaded.addEvent(this.checkPound)};$(document).ready(function(){g_setupChangeWarning($("form[name=addcomment]"),[$("textarea[name=commentbody]")],LANG.message_startedpost)});var ContactTool=new function(){this.general=0,this.comment=1,this.post=2,this.screenshot=3,this.character=4,this.video=5,this.guide=6;var e,t={0:[[1,!0],[2,!0],[8,!0],[3,!0],[4,!0],[5,!0],[6,!0],[7,!0]],1:[[15,function(e){return 0==(e.roles&U_GROUP_MODERATOR)}],[16,!0],[17,!0],[18,function(e){return 0==(e.roles&U_GROUP_MODERATOR)}],[19,function(e){return 0==(e.roles&U_GROUP_MODERATOR)}],[20,function(e){return 0==(e.roles&U_GROUP_MODERATOR)}]],2:[[30,function(e){return g_users&&g_users[e.user]&&0==(g_users[e.user].roles&U_GROUP_MODERATOR)}],[37,function(e){return 0==(e.roles&U_GROUP_MODERATOR)&&g_users&&g_users[e.user]&&0==(g_users[e.user].roles&U_GROUP_MODERATOR)&&2==g_users[e.user].avatar}],[31,!0],[32,!0],[33,function(e){return g_users&&g_users[e.user]&&0==(g_users[e.user].roles&U_GROUP_MODERATOR)}],[34,function(e){return g_users&&g_users[e.user]&&0==(g_users[e.user].roles&U_GROUP_MODERATOR)&&e.op&&!e.sticky}],[35,function(e){return g_users&&g_users[e.user]&&0==(g_users[e.user].roles&U_GROUP_MODERATOR)}],[36,function(e){return g_users&&g_users[e.user]&&0==(g_users[e.user].roles&U_GROUP_MODERATOR)}]],3:[[45,!0],[46,!0],[47,function(e){return g_users&&g_users[e.user]&&0==(g_users[e.user].roles&U_GROUP_MODERATOR)}],[48,function(e){return g_users&&g_users[e.user]&&0==(g_users[e.user].roles&U_GROUP_MODERATOR)}]],4:[[60,!0],[61,!0]],5:[[45,!0],[46,!0],[47,function(e){return g_users&&g_users[e.user]&&0==(g_users[e.user].roles&U_GROUP_MODERATOR)}],[48,function(e){return g_users&&g_users[e.user]&&0==(g_users[e.user].roles&U_GROUP_MODERATOR)}]],6:[[45,!0],[46,!0],[48,!0]]},s={1:LANG.ct_resp_error1,2:LANG.ct_resp_error2,3:LANG.ct_resp_error3,7:LANG.ct_resp_error7},i=null;this.displayError=function(e,t){alert(t)},this.onShow=function(){location.hash&&"#contact"!=location.hash&&(i=location.hash),0==this.data.mode&&location.replace("#contact")},this.onHide=function(){!i||-1!=i.indexOf("screenshots:")&&-1!=i.indexOf("videos:")?location.replace("#."):location.replace(i)},this.onSubmit=function(e,t,i){if(e.submitting)return!1;for(var a=0;a<i.elements.length;++a)i.elements[a].disabled=!0;var n=["contact=1","mode="+$WH.urlencode(e.mode),"reason="+$WH.urlencode(e.reason),"desc="+$WH.urlencode(e.description),"ua="+$WH.urlencode(navigator.userAgent),"appname="+$WH.urlencode(navigator.appName),"page="+$WH.urlencode(e.currenturl)];0==e.mode?(e.relatedurl&&n.push("relatedurl="+$WH.urlencode(e.relatedurl)),e.email&&n.push("email="+$WH.urlencode(e.email))):1==e.mode?n.push("id="+$WH.urlencode(e.comment.id)):2==e.mode?n.push("id="+$WH.urlencode(e.post.id)):3==e.mode?n.push("id="+$WH.urlencode(e.screenshot.id)):4==e.mode?n.push("id="+$WH.urlencode(e.profile.source)):5==e.mode?n.push("id="+$WH.urlencode(e.video.id)):6==e.mode&&n.push("id="+$WH.urlencode(e.guide.id)),e.submitting=!0;return new Ajax("?contactus",{method:"POST",params:n.join("&"),onSuccess:function(e,t){var i=e.responseText;0==i?(g_user.name?alert($WH.sprintf(LANG.ct_dialog_thanks_user,g_user.name)):alert(LANG.ct_dialog_thanks),Lightbox.hide()):s[i]?alert(s[i]):alert("Error: "+i)},onFailure:function(e,t){alert("Failure submitting contact request: "+e.statusText)},onComplete:function(t,s){for(var a=0;a<i.elements.length;++a)i.elements[a].disabled=!1;e.submitting=!1}}),!1},this.show=function(s){s||(s={});var i={mode:0};$WH.cO(i,s),i.reasons=t[i.mode],-1!=location.href.indexOf("#contact")?i.currenturl=location.href.substr(0,location.href.indexOf("#contact")):i.currenturl=location.href;var a="contactus";0!=i.mode&&(a="reportform"),e||this.init(),e.show(a,{data:i,onShow:this.onShow,onHide:this.onHide,onSubmit:this.onSubmit})},this.checkPound=function(){location.hash&&"#contact"==location.hash&&ContactTool.show()};var a=LANG.ct_dialog_contactwowhead;this.init=function(){e=new Dialog,Dialog.templates.contactus={title:a,width:550,buttons:[["okay",LANG.ok],["cancel",LANG.cancel]],fields:[{id:"reason",type:"select",label:LANG.ct_dialog_reason,required:1,options:[],compute:function(e,t,s,i){$WH.ee(e);for(var a=0;a<this.data.reasons.length;++a){var n=this.data.reasons[a][0],o=this.data.reasons[a][1];if("function"==typeof o?o(this.extra):o){var r=$WH.ce("option");r.value=n,t&&t==n&&(r.selected=!0),$WH.ae(r,$WH.ct(g_contact_reasons[n])),$WH.ae(e,r)}}e.onchange=function(){1==this.value||2==this.value||3==this.value?(s.currenturl.parentNode.parentNode.style.display="",s.relatedurl.parentNode.parentNode.style.display=""):(s.currenturl.parentNode.parentNode.style.display="none",s.relatedurl.parentNode.parentNode.style.display="none")}.bind(e),i.style.width="98%"},validate:function(e,t,s){var i="";return e&&0!=e.length||(i=LANG.ct_dialog_error_reason),""==i||(ContactTool.displayError(s.reason,i),s.reason.focus(),!1)}},{id:"currenturl",type:"text",disabled:!0,label:LANG.ct_dialog_currenturl,size:40},{id:"relatedurl",type:"text",label:LANG.ct_dialog_relatedurl,caption:LANG.ct_dialog_optional,size:40,validate:function(e,t,s){var i="",a=/^(http(s?)\:\/\/|\/)?([\w]+:\w+@)?([a-zA-Z]{1}([\w\-]+\.)+([\w]{2,5}))(:[\d]{1,5})?((\/?\w+\/)+|\/?)(\w+\.[\w]{3,4})?((\?\w+=\w+)?(&\w+=\w+)*)?/;return e=e.trim(),e.length>=250?i=LANG.ct_dialog_error_relatedurl:e.length>0&&!a.test(e)&&(i=LANG.ct_dialog_error_invalidurl),""==i||(ContactTool.displayError(s.relatedurl,i),s.relatedurl.focus(),!1)}},{id:"email",type:"text",label:LANG.ct_dialog_email,caption:LANG.ct_dialog_email_caption,compute:function(e,t,s,i,a){if(g_user.email)this.data.email=g_user.email,a.style.display="none";else{var n=function(){$WH.ge("contact-emailwarn").style.display=g_isEmailValid($WH.ge(s.email).value)?"none":"",Lightbox.reveal()};$WH.ge(e).onkeyup=n,$WH.ge(e).onblur=n}},validate:function(e,t,s){var i="";return e=e.trim(),e.length>=100?i=LANG.ct_dialog_error_emaillen:e.length>0&&!g_isEmailValid(e)&&(i=LANG.ct_dialog_error_email),""==i||(ContactTool.displayError(s.email,i),s.email.focus(),!1)}},{id:"description",type:"textarea",caption:LANG.ct_dialog_desc_caption,width:"98%",required:1,size:[10,30],validate:function(e,t,s){var i="";return e=e.trim(),(0==e.length||e.length>1e4)&&(i=LANG.ct_dialog_error_desc),""==i||(ContactTool.displayError(s.description,i),s.description.focus(),!1)}},{id:"noemailwarning",type:"caption",compute:function(e,t,s,i){var i=$WH.ge(i);i.innerHTML='<span id="contact-emailwarn" class="q10"'+(g_user.email?' style="display: none"':"")+">"+LANG.ct_dialog_noemailwarning+"</span>",i.style.whiteSpace="normal",i.style.padding="0 4px"}}],onInit:function(e){},onShow:function(e){this.data.focus&&e[this.data.focus]?setTimeout(g_setCaretPosition.bind(null,e[this.data.focus],e[this.data.focus].value.length),100):e.reason&&!e.reason.value?setTimeout($WH.bindfunc(e.reason.focus,e.reason),10):e.relatedurl&&!e.relatedurl.value?setTimeout($WH.bindfunc(e.relatedurl.focus,e.relatedurl),10):e.email&&!e.email.value?setTimeout($WH.bindfunc(e.email.focus,e.email),10):e.description&&!e.description.value&&setTimeout($WH.bindfunc(e.description.focus,e.description),10),setTimeout(Lightbox.reveal,250)}},Dialog.templates.reportform={title:LANG.ct_dialog_report,width:550,buttons:[["okay",LANG.ok],["cancel",LANG.cancel]],fields:[{id:"reason",type:"select",label:LANG.ct_dialog_reason,options:[],compute:function(e,t,s,i){switch(this.data.mode){case 1:s.firstChild.innerHTML=$WH.sprintf(LANG.ct_dialog_reportcomment,'<a href="?user='+this.data.comment.user+'">'+this.data.comment.user+"</a>");break;case 2:var a='<a href="?user='+this.data.post.user+'">'+this.data.post.user+"</a>";this.data.post.op?s.firstChild.innerHTML=$WH.sprintf(LANG.ct_dialog_reporttopic,a):s.firstChild.innerHTML=$WH.sprintf(LANG.ct_dialog_reportpost,a);break;case 3:s.firstChild.innerHTML=$WH.sprintf(LANG.ct_dialog_reportscreen,'<a href="?user='+this.data.screenshot.user+'">'+this.data.screenshot.user+"</a>");break;case 4:$WH.ee(s.firstChild),$WH.ae(s.firstChild,$WH.ct(LANG.ct_dialog_reportchar));break;case 5:s.firstChild.innerHTML=$WH.sprintf(LANG.ct_dialog_reportvideo,'<a href="?user='+this.data.video.user+'">'+this.data.video.user+"</a>");break;case 6:s.firstChild.innerHTML="Report guide"}s.firstChild.setAttribute("style",""),$WH.ee(e);var n;1==this.data.mode?n=this.data.comment:2==this.data.mode?n=this.data.post:3==this.data.mode?n=this.data.screenshot:4==this.data.mode?n=this.data.profile:5==this.data.mode?n=this.data.video:6==this.data.mode&&(n=this.data.guide),$WH.ae(e,$WH.ce("option",{selected:!t,value:-1}));for(var o=0;o<this.data.reasons.length;++o){var r=this.data.reasons[o][0],l=this.data.reasons[o][1];if("function"==typeof l?l(n):l){var c=$WH.ce("option");c.value=r,t&&t==r&&(c.selected=!0),$WH.ae(c,$WH.ct(g_contact_reasons[r])),$WH.ae(e,c)}}i.style.width="98%"},validate:function(e,t,s){var i="";return e&&-1!=e&&0!=e.length||(i=LANG.ct_dialog_error_reason),""==i||(ContactTool.displayError(s.reason,i),s.reason.focus(),!1)}},{id:"description",type:"textarea",caption:LANG.ct_dialog_desc_caption,width:"98%",required:1,size:[10,30],validate:function(e,t,s){var i="";return e=e.trim(),(0==e.length||e.length>1e4)&&(i=LANG.ct_dialog_error_desc),""==i||(ContactTool.displayError(s.description,i),s.description.focus(),!1)}}],onInit:function(e){},onShow:function(e){var t=$WH.gE(e,"select")[0],s=$WH.gE(e,"textarea")[0];this.data.focus&&e[this.data.focus]?setTimeout(g_setCaretPosition.bind(null,e[this.data.focus],e[this.data.focus].value.length),100):t.value?s.value||setTimeout($WH.bindfunc(s.focus,s),10):setTimeout($WH.bindfunc(t.focus,t),10)}}},DomContentLoaded.addEvent(this.checkPound)},Links=new function(){var e=null,t=null,s={item:1},i={29:"icondb"};this.onShow=function(){location.hash&&"#links"!=location.hash&&(t=location.hash),location.replace("#links")},this.onHide=function(){!t||-1!=t.indexOf("screenshots:")&&-1!=t.indexOf("videos:")?location.replace("#."):location.replace(t)},this.show=function(t){if(t&&t.type&&t.typeId){var a=g_types[t.type];e||this.init(),s[a]&&"armoryurl"!=Dialog.templates.links.fields[1].id&&Dialog.templates.links.fields.splice(1,0,{id:"armoryurl",type:"text",label:"Armory URL",size:40});var n="";t.linkColor&&t.linkId&&t.linkName&&(n=g_getIngameLink(t.linkColor,t.linkId,t.linkName)),t.sound&&(n='/script PlaySoundFile("'+t.sound+'", "master")'),n&&"ingamelink"!=Dialog.templates.links.fields[Dialog.templates.links.fields.length-2].id&&Dialog.templates.links.fields.splice(Dialog.templates.links.fields.length-1,0,{id:"ingamelink",type:"text",label:"游戏内链接",size:40});var o={wowheadurl:g_host+"?"+a+"="+t.typeId,armoryurl:"http://us.battle.net/wow/en/"+a+"/"+t.typeId,ingamelink:n,markuptag:"["+(i[t.type]||a)+"="+t.typeId+"]"};e.show("links",{data:o,onShow:this.onShow,onHide:this.onHide,onSubmit:function(){return!1}})}},this.checkPound=function(){location.hash&&"#links"==location.hash&&$WH.ge("open-links-button").click()},this.init=function(){e=new Dialog,Dialog.templates.links={title:LANG.pr_menu_links||"Links",width:425,buttons:[["cancel",LANG.close]],fields:[{id:"wowheadurl",type:"text",label:"数据库链接",size:40},{id:"markuptag",type:"text",label:"Markup 标签",size:40}],onInit:function(e){},onShow:function(e){setTimeout(function(){$(e.ingamelink).select()},50),setTimeout(Lightbox.reveal,100)}}},DomContentLoaded.addEvent(this.checkPound)},Announcement=function(e){e||(e={}),$WH.cO(this,e),this.parent&&(this.parentDiv=$WH.ge(this.parent),(0!=g_user.id||g_cookiesEnabled()&&"closed"!=g_getWowheadCookie("announcement-"+this.id))&&this.initialize())};Announcement.prototype={initialize:function(){this.parentDiv.style.opacity="0",void 0===this.mode||1==this.mode?this.parentDiv.className="announcement announcement-contenttop":this.parentDiv.className="announcement announcement-pagetop";var e=this.innerDiv=$WH.ce("div");e.className="announcement-inner text",this.setStyle(this.style);var t=null,s=parseInt(this.id);if(g_user&&(g_user.roles&(U_GROUP_ADMIN|U_GROUP_BUREAU))>0&&Math.abs(s)>0){if(s<0){t=$WH.ce("a"),t.style.cssFloat=t.style.styleFloat="right",t.href="?admin=announcements&id="+Math.abs(s)+"&status=2",t.onclick=function(){return confirm("Are you sure you want to delete "+this.name+"?")},$WH.ae(t,$WH.ct("Delete"));var i=$WH.ce("small");$WH.ae(i,t),$WH.ae(e,i),t=$WH.ce("a"),t.style.cssFloat=t.style.styleFloat="right",t.style.marginRight="10px",t.href="?admin=announcements&id="+Math.abs(s)+"&status="+(1==this.status?0:1),t.onclick=function(){return confirm("Are you sure you want to delete "+this.name+"?")},$WH.ae(t,$WH.ct(1==this.status?"Disable":"Enable"));var i=$WH.ce("small");$WH.ae(i,t),$WH.ae(e,i)}t=$WH.ce("a"),t.style.cssFloat=t.style.styleFloat="right",t.style.marginRight="22px",t.href="?admin=announcements&id="+Math.abs(s)+"&edit",$WH.ae(t,$WH.ct("Edit announcement"));var i=$WH.ce("small");$WH.ae(i,t),$WH.ae(e,i)}var a=$WH.ce("div");a.id=this.parent+"-markup",$WH.ae(e,a),s>=0&&(t=$WH.ce("a"),t.id="closeannouncement",t.href="javascript:;",t.className="announcement-close",this.nocookie?t.onclick=this.hide.bind(this):t.onclick=this.markRead.bind(this),$WH.ae(e,t),g_addTooltip(t,LANG.close)),$WH.ae(e,$WH.ce("div",{style:{clear:"both"}})),$WH.ae(this.parentDiv,e),this.setText(this.text),setTimeout(this.show.bind(this),500)},show:function(){this.parentDiv.style.opacity="100",this.parentDiv.style.height=this.parentDiv.offsetHeight+10+"px",g_trackEvent("Announcements","Show",""+this.name)},hide:function(){this.parentDiv.style.opacity="0",this.parentDiv.style.height="0px",setTimeout(function(){this.parentDiv.style.display="none"}.bind(this),400)},markRead:function(){g_trackEvent("Announcements","Close",""+this.name),g_setWowheadCookie("announcement-"+this.id,"closed"),this.hide()},setStyle:function(e){this.style=e,this.innerDiv.setAttribute("style",e)},setText:function(e){this.text=e,Markup.printHtml(this.text,this.parent+"-markup"),g_addAnalyticsToNode($WH.ge(this.parent+"-markup"),{category:"Announcements",actions:{"Follow link":function(e){return!0}}},this.id)}};var g_audiocontrols={__windowloaded:!1},g_audioplaylist={};window.JSON||(window.JSON={parse:function(sJSON){return eval("("+sJSON+")")},stringify:function(e){if(e instanceof Object){var t="";if(e.constructor===Array){for(var s=0;s<e.length;t+=this.stringify(e[s])+",",s++);return"["+t.substr(0,t.length-1)+"]"}if(e.toString!==Object.prototype.toString)return'"'+e.toString().replace(/"/g,"\\$&")+'"';for(var i in e)t+='"'+i.replace(/"/g,"\\$&")+'":'+this.stringify(e[i])+",";return"{"+t.substr(0,t.length-1)+"}"}return"string"==typeof e?'"'+e.replace(/"/g,"\\$&")+'"':String(e)}}),AudioControls=function(){function e(e,i,o){var r=$WH.ce("audio");r.preload="none",r.controls="true",$(r).click(function(e){e.stopPropagation()}),r.style.marginTop="5px",c.audio.parentNode.replaceChild(r,c.audio),c.audio=r,$WH.aE(c.audio,"ended",s.bind(e)),o&&(r.preload="auto",l=!0,$WH.aE(c.audio,"canplaythrough",t.bind(this))),n||(c.table.style.visibility="visible");var p;do{if((a+=i)>u.length-1&&(a=0,!n)){var h=$WH.ce("div");return h.className="minibox minibox-left",$WH.st(h,$WH.sprintf(LANG.message_browsernoaudio,p.type)),void c.table.parentNode.replaceChild(h,c.table)}a<0&&(a=u.length-1),p=u[a]}while(""==c.audio.canPlayType(p.type));var m=$WH.ce("source");if(m.src=p.url,m.type=p.type,$WH.ae(c.audio,m),c.hasOwnProperty("title"))if(d){$WH.ee(c.title);var f=$WH.ce("a");f.href=d,$WH.st(f,'"'+p.title+'"'),$WH.ae(c.title,f)}else $WH.st(c.title,'"'+p.title+'"');if(c.hasOwnProperty("trackdisplay")&&$WH.st(c.trackdisplay,a+1+" / "+u.length),!n){n=!0;for(var g=a+1;g<=u.length-1;g++)if(c.audio.canPlayType(u[g].type)){$(c.controlsdiv).children("a").removeClass("button-red-disabled");break}}c.hasOwnProperty("addbutton")&&($(c.addbutton).removeClass("button-red-disabled"),RedButton.setText(c.addbutton,LANG.add))}function t(){l&&(l=!1,c.audio.play())}function s(){e(this,1,o||a<u.length-1)}function i(e,t){return $WH.g_createButton(e,null,{disabled:t,style:"margin:0 12px; display:inline-block; float:inherit; "})}var a=-1,n=!1,o=!1,r=!1,l=!1,c={},u=[],d="";this.init=function(e,t,s){if($WH.is_array(e)&&0!=e.length){if(""==t.id||g_audiocontrols.hasOwnProperty(t.id)){for(var a=0;g_audiocontrols.hasOwnProperty("auto-audiocontrols-"+ ++a););t.id="auto-audiocontrols-"+a}if(g_audiocontrols[t.id]=this,void 0===s&&(s={}),o=!!s.loop,s.hasOwnProperty("url")&&(d=s.url),u=e,c.div=t,s.listview){r=!0;var n=$WH.ce("div");c.table=n,$WH.ae(c.div,n),c.audio=$WH.ce("div"),$WH.ae(n,c.audio),c.trackdisplay=s.trackdisplay,c.controlsdiv=$WH.ce("span"),$WH.ae(n,c.controlsdiv)}else{var l=$WH.ce("table",{className:"audio-controls"});c.table=l,c.table.style.visibility="hidden",$WH.ae(c.div,l);var p=$WH.ce("tr");$WH.ae(l,p);var h=$WH.ce("td");$WH.ae(p,h),c.audio=$WH.ce("div"),$WH.ae(h,c.audio),c.title=$WH.ce("div",{className:"audio-controls-title"}),$WH.ae(h,c.title),c.controlsdiv=$WH.ce("div",{className:"audio-controls-pagination"}),$WH.ae(h,c.controlsdiv);var m=i(LANG.previous,!0);$WH.ae(c.controlsdiv,m),$WH.aE(m,"click",this.btnPrevTrack.bind(this)),c.trackdisplay=$WH.ce("div",{className:"audio-controls-pagination-track"}),$WH.ae(c.controlsdiv,c.trackdisplay);var f=i(LANG.next,!0);$WH.ae(c.controlsdiv,f),$WH.aE(f,"click",this.btnNextTrack.bind(this))}if(g_audioplaylist.isEnabled()&&!s.fromplaylist){var g=i(LANG.add);$WH.ae(c.controlsdiv,g),$WH.aE(g,"click",this.btnAddToPlaylist.bind(this,g)),c.addbutton=g,r&&(g.style.verticalAlign="50%")}g_audiocontrols.__windowloaded&&this.btnNextTrack()}},this.btnNextTrack=function(){e(this,1,n&&c.audio.readyState>1&&!c.audio.paused)},this.btnPrevTrack=function(){e(this,-1,n&&c.audio.readyState>1&&!c.audio.paused)},this.btnAddToPlaylist=function(e){if(r)for(var t=0;t<u.length;t++)g_audioplaylist.addSound(u[t]);else g_audioplaylist.addSound(u[a]);e.className+=" button-red-disabled",RedButton.setText(e,LANG.added)},this.isPlaying=function(){return!c.audio.paused},this.removeSelf=function(){c.table.parentNode.removeChild(c.table),delete g_audiocontrols[c.div]}},$WH.aE(window,"load",function(){g_audiocontrols.__windowloaded=!0;for(var e in g_audiocontrols)"__"!=e.substr(0,2)&&g_audiocontrols[e].btnNextTrack()}),AudioPlaylist=function(){var e,t,s=!1,i=[];this.init=function(){if($WH.localStorage.isSupported()){s=!0;var e;(e=$WH.localStorage.get("AudioPlaylist"))&&(i=JSON.parse(e))}},this.savePlaylist=function(){if(!s)return!1;$WH.localStorage.set("AudioPlaylist",JSON.stringify(i))},this.isEnabled=function(){return s},this.addSound=function(e){if(!s)return!1;this.init(),i.push(e),this.savePlaylist()},this.deleteSound=function(s){s<0?i=[]:i.splice(s,1),this.savePlaylist(),e.isPlaying()||(e.removeSelf(),this.setAudioControls(t)),0==i.length&&$WH.Tooltip.hide()},this.getList=function(){for(var e=[],t=0;t<i.length;t++)e.push(i[t].title);return e},this.setAudioControls=function(a){if(!s)return!1;t=a,e=new AudioControls,e.init(i,t,{loop:!0,fromplaylist:!0})}},g_audioplaylist=new AudioPlaylist,g_audioplaylist.init(),$WH.aE(window,"load",function(){if(window.JSON&&$WH.localStorage.isSupported()){var e=$WH.localStorage.get("lvBrowse");if(e&&(e=window.JSON.parse(e))){var t=/^\?[-a-z]+=\d+/i,s=t.exec(location.search);if(s){s=s[0];for(var i=function(e,t){var s=$WH.ce("a");s.className="button-red"+(t?" button-red-disabled":"");var i=$WH.ce("em");$WH.ae(s,i);var a=$WH.ce("b");$WH.ae(i,a);var n=$WH.ce("i");$WH.ae(a,n),$WH.st(n,e);var o=$WH.ce("span");return $WH.ae(i,o),$WH.st(o,e),s},a=0;a<e.length;a++)for(var n=e[a].urls,o=0;o<n.length;o++)if(n[o]==s){var r=o>0&&n[o-1],l=o+1<n.length&&n[o+1],c=e[a].path+e[a].hash,u=$WH.ge("topbar-browse");if(!u)return;var d;return d=i(">",!l),l&&(d.href=l),$WH.ae(u,d),d=i(LANG.up,!c),c&&(d.href=c),$WH.ae(u,d),d=i("<",!r),r&&(d.href=r),void $WH.ae(u,d)}}}}});var g_file_races={1:"human",2:"orc",3:"dwarf",4:"nightelf",5:"scourge",6:"tauren",7:"gnome",8:"troll",10:"bloodelf",11:"draenei"},g_file_classes={1:"warrior",2:"paladin",3:"hunter",4:"rogue",5:"priest",6:"deathknight",7:"shaman",8:"mage",9:"warlock",11:"druid"},g_file_genders={0:"male",1:"female"},g_file_factions={1:"alliance",2:"horde"},g_file_gems={1:"meta",2:"red",4:"yellow",6:"orange",8:"blue",10:"purple",12:"green",14:"prismatic"};g_getPatchVersion.V=["1.12.0","1.12.1","1.12.2","2.0.1","2.0.3","2.0.4","2.0.5","2.0.6","2.0.7","2.0.8","2.0.10","2.0.12","2.1.0","2.1.1","2.1.2","2.1.3","2.2.0","2.2.2","2.2.3","2.3.0","2.3.2","2.3.3","2.4.0","2.4.1","2.4.2","2.4.3","3.0.2","3.0.3","3.0.8","3.0.9","3.1.0","3.1.1","3.1.2","3.1.3","3.2.0","3.2.2","3.3.0","3.3.2","3.3.3","3.3.5","?????"],g_getPatchVersion.T=[11535408e5,11592432e5,1160712e6,11652948e5,11683188e5,1168578e6,11687508e5,11695284e5,11713428e5,1171602e6,11731572e5,11755728e5,11798064e5,1181016e6,11822256e5,118404e7,11906928e5,11912976e5,11919024e5,119493e7,11997684e5,1200978e6,12064176e5,12070224e5,12106512e5,12160944e5,12239568e5,12257748e5,12324276e5,1234242e6,12396816e5,12402864e5,12427056e5,12439152e5,12493584e5,12535956e5,12602664e5,12651048e5,12693204e5,12771828e5,9999999999999];var g_npcs={},g_objects={},g_items={},g_itemsets={},g_quests={},g_spells={},g_gatheredzones={},g_factions={},g_pets={},g_achievements={},g_titles={},g_holidays={},g_classes={},g_races={},g_skills={},g_gatheredcurrencies={},g_sounds={},g_icons={},g_enchantments={},g_emotes={},g_types={1:"npc",2:"object",3:"item",4:"itemset",5:"quest",6:"spell",7:"zone",8:"faction",9:"pet",10:"achievement",11:"title",12:"event",13:"class",14:"race",15:"skill",17:"currency",19:"sound",29:"icon",501:"emote",502:"enchantment",503:"areatrigger"};$WH.cO(g_items,{add:function(e,t){null!=g_items[e]?$WH.cO(g_items[e],t):g_items[e]=t},getIcon:function(e){return null!=g_items[e]&&g_items[e].icon?g_items[e].icon:"inv_misc_questionmark"},createIcon:function(e,t,s,i){return Icon.create(g_items.getIcon(e),t,null,"?item="+e,s,i)}}),$WH.cO(g_spells,{add:function(e,t){null!=g_spells[e]?$WH.cO(g_spells[e],t):g_spells[e]=t},getIcon:function(e){return null!=g_spells[e]&&g_spells[e].icon?g_spells[e].icon:"inv_misc_questionmark"},createIcon:function(e,t,s,i){return Icon.create(g_spells.getIcon(e),t,null,"?spell="+e,s,i)}}),$WH.cO(g_achievements,{getIcon:function(e){return null!=g_achievements[e]&&g_achievements[e].icon?g_achievements[e].icon:"inv_misc_questionmark"},createIcon:function(e,t,s,i){return Icon.create(g_achievements.getIcon(e),t,null,"?achievement="+e,s,i)}}),$WH.cO(g_classes,{getIcon:function(e){return g_file_classes[e]?"class_"+g_file_classes[e]:"inv_misc_questionmark"},createIcon:function(e,t,s,i){return Icon.create(g_classes.getIcon(e),t,null,"?class="+e,s,i)}}),$WH.cO(g_races,{getIcon:function(e,t){return void 0===t&&(t=0),g_file_races[e]&&g_file_genders[t]?"race_"+g_file_races[e]+"_"+g_file_genders[t]:"inv_misc_questionmark"},createIcon:function(e,t,s,i){return Icon.create(g_races.getIcon(e),t,null,"?race="+e,s,i)}}),$WH.cO(g_skills,{getIcon:function(e){return null!=g_skills[e]&&g_skills[e].icon?g_skills[e].icon:"inv_misc_questionmark"},createIcon:function(e,t,s,i){return Icon.create(g_skills.getIcon(e),t,null,"?skill="+e,s,i)}}),$WH.cO(g_gatheredcurrencies,{getIcon:function(e,t){return null!=g_gatheredcurrencies[e]&&g_gatheredcurrencies[e].icon?$WH.is_array(g_gatheredcurrencies[e].icon)&&!isNaN(t)?g_gatheredcurrencies[e].icon[t]:g_gatheredcurrencies[e].icon:"inv_misc_questionmark"},createIcon:function(e,t,s,i){return Icon.create(g_gatheredcurrencies.getIcon(e,s>0?0:1),t,null,null,Math.abs(s),i)}}),$WH.cO(g_holidays,{getIcon:function(e){return null!=g_holidays[e]&&g_holidays[e].icon?g_holidays[e].icon:"inv_misc_questionmark"},createIcon:function(e,t,s,i){return Icon.create(g_holidays.getIcon(e),t,null,"?event="+e,s,i)}});var ConditionList=new function(){function e(e,t,s){for(var i=Listview.funcBox.assocBinFlags(e,t).sort(),a="",n=0,o=i.length;n<o;++n)o>1&&n==o-1?a+=LANG.or:n>0&&(a+=", "),a+=$WH.sprintf(s,i[n],t[i[n]]);return a}function t(t){var s="",a=["",null];if(strIdx=Math.abs(t[0]),22==strIdx||23==strIdx?strIdx=4:16!=strIdx&&30!=strIdx&&32!=strIdx||strIdx--,!g_conditions[strIdx])return"unknown condition index "+strIdx;if(-1!=$WH.in_array([13,21,24,33,34],strIdx))return g_conditions[strIdx].replace(/\$([^\$:;]*):([^\$:;]*);/,"$"+(t[0]>0?1:2));switch(Math.abs(t[0])){case 1:case 25:a[0]="[spell="+t[1]+"]";break;case 2:a[1]=t[2];case 3:a[0]="[item="+t[1]+"]";break;case 4:case 23:a[0]="[zone="+t[1]+"]";break;case 8:case 9:case 14:case 28:a[0]="[quest="+t[1]+"]";break;case 12:a[0]="[event="+t[1]+"]";break;case 17:a[0]="[achievement="+t[1]+"]";break;case 18:a[0]="[title="+t[1]+"]";break;case 6:a[0]=g_sides[t[1]];break;case 10:a[0]=g_drunk_states[t[1]];break;case 22:a[0]=g_zone_categories[t[1]];break;case 15:a[0]=e(t[1],g_chr_classes,"[class=$1]");break;case 16:a[0]=e(t[1],g_chr_races,"[race=$1]");break;case 7:a[0]="[skill="+t[1]+"]",t[2]&&(a[0]+=$WH.sprintf(LANG.qty,t[2]));break;case 5:var n={};for(i in g_reputation_standings)n[1*i+1]=g_reputation_standings[i];a[0]="[faction="+t[1]+"]",a[1]=e(t[2],n,"$2");break;case 20:0==t[1]?(a[0]=LANG.male,a[1]=g_file_genders[0]):1==t[1]?(a[0]=LANG.female,a[1]=g_file_genders[1]):a[0]=g_npc_types[10];break;case 29:a[0]="[npc="+t[1]+"]",a[1]=t[2];break;case 30:a[0]="[object="+t[1]+"]",a[1]=t[2];break;case 31:if(t[2]&&3==t[1]){a[0]="[npc="+t[2]+"]";break}if(t[2]&&5==t[1]){a[0]="[object="+t[2]+"]";break}t[1]=1<<t[1];case 32:a[0]=e(t[1],g_world_object_types,"$2");break;case 36:break;case 27:case 37:case 38:a[0]=t[1],a[1]=g_operators[t[2]];break;case 35:a[0]=t[2],a[1]=g_operators[t[3]];break;case 11:a[0]=t[1],a[1]=t[2];break;case 26:for(var o=0;t[1];)t[1]&1<<o&&(a[0]&&(a[0]+=", "),a[0]+=o+1,t[1]&=~(1<<o)),o++}return s=g_conditions[strIdx],s=s.replace(/\$([^\$:;]*):([^\$:;]*);/,"$"+(t[0]>0?1:2)),$WH.sprintf(s,a[0],a[1])}function s(){var e=Object.keys(o).length,s=[],a="";for(g in o)s[g]=Object.keys(o[g]).length,s[g]>1&&(e+=s[g]);e>1&&(a+="[tabs name=conditionSource]");for(g in o)if(g_condition_types[g]){Object.keys(o[g]).length;for(h in o[g]){var n=h.split(":");if(nGroups=Object.keys(o[g][h]).length,curGroup=1,e>1)if(s[g]>1){var r=n[1];-1!=$WH.in_array([18,21,23],g)&&(r=g_npcs[n[1]]["name_"+Locale.getName()]),a+='[tab name="'+g_condition_types[g][0]+" ("+r+')"]'}else a+='[tab name="'+g_condition_types[g][0]+'"]';a+="[h3]"+$WH.sprintf(g_condition_types[g][1],n[0],n[1]||"")+"[/h3]",nGroups>1&&(a+=LANG.note_condition_group+"[br][br]",a+="[table class=grid]");for(i in o[g][h]){var l=o[g][h][i],c=Object.keys(o[g][h][i]).length;nGroups<=1&&c>1&&(a+=LANG.note_condition+"[br][br]"),nGroups>1&&(a+="[tr][td width=70px valign=middle align=center]"+LANG.group+" "+curGroup+++LANG.colon+"[/td][td]");for(j in l)a+=t(l[j])+"[br]";nGroups>1&&(a+="[/td][/tr]")}nGroups>1&&(a+="[/tr][/table]"),e>1&&(a+="[/tab]")}}return e>1&&(a+="[/tabs]"),a}function a(){var e=[];for(g in o)for(h in o[g])for(i in o[g][h]){
var s=[],a=o[g][h][i],n=Object.keys(o[g][h][i]).length;for(j in a)n>1?s.push(t(a[j])):e.push(t(a[j]));if(s.length){var r="";for(j in s)j>0&&j==s.length-1?r+=LANG.and:j>0&&(r+=", "),r+=s[j];e.push(r)}}return e.length>1?"[ul][li]"+e.join("[/li][li]")+"[/li][/ul]":e[0]}var n=this,o=null;n.createCell=function(e){return e?(o=e,a()):null},n.createTab=function(e){return e?(o=e,s()):null}};