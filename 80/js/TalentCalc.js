function TalentCalc(){function e(e,t,a){var l=Xe[tt];glyph=g_glyphs[t],glyph&&I(e,glyph)&&(l.glyphs[e]&&(l.glyphItems[l.glyphs[e]]=0),l.glyphs[e]=t,l.glyphItems[t]=1,a||(ie(e),z()))}function t(){var e=Xe[tt];if(e.k>Ne)for(var t=ve-1;t>=0;--t)for(var a=e[t].t.length-1;a>=0;--a)for(var l=e[t].t[a].k,s=0;s<l;++s)if(y(e[t].t[a]),e.k<=Ne)return}function l(e,t){Y(-1,ct?0:ke),s(e,t)}function s(e,t){We==Ve&&$WH.Tooltip.showAtCursor(t,LANG[ct?"tc_rembon":"tc_addbon"],null,null,"q")}function n(e,t){Q(prompt($WH.sprintf(LANG.prompt_ratinglevel,Ze,Je),ot)),r(e,t),z()}function r(e,t){$WH.Tooltip.showAtCursor(t,LANG.tooltip_changelevel,null,null,"q")}function c(e,t,a){var l,s,n=$WH.ce("div");switch(n.className="talentcalc-arrow",e){case 0:t=15,l=u(1,2),l.className="talentcalc-arrow-down",s=l.firstChild.childNodes[0].childNodes[0].style,s.width="15px",s.height="4px",s=l.firstChild.childNodes[1].childNodes[0].style,s.backgroundPosition="bottom",s.height=a-4+"px";break;case 1:l=u(2,2,!0),l.className="talentcalc-arrow-leftdown",s=l.firstChild.childNodes[0].childNodes[0].style,s.backgroundPosition="left",s.width=t-4+"px",s.height="11px",s=l.firstChild.childNodes[0].childNodes[1].style,s.backgroundPosition="right",s.width="4px",s=l.firstChild.childNodes[1].childNodes[0].style,s.backgroundPosition="bottom left",s.backgroundRepeat="no-repeat",s.height=a-11+"px";break;case 2:l=u(2,2,!0),l.className="talentcalc-arrow-rightdown",s=l.firstChild.childNodes[0].childNodes[0].style,s.backgroundPosition="left",s.width="4px",s=l.firstChild.childNodes[0].childNodes[1].style,s.backgroundPosition="right",s.width=t-4+"px",s.height="11px",s=l.firstChild.childNodes[1].childNodes[0].style,s.backgroundPosition="bottom right",s.backgroundRepeat="no-repeat",s.height=a-11+"px";break;case 3:a=15,l=u(2,1),l.className="talentcalc-arrow-right",s=l.firstChild.childNodes[0].childNodes[0].style,s.backgroundPosition="left",s.width="4px",s=l.firstChild.childNodes[0].childNodes[1].style,s.backgroundPosition="right",s.width=t-4+"px";break;case 4:a=15,l=u(2,1),l.className="talentcalc-arrow-left",s=l.firstChild.childNodes[0].childNodes[0].style,s.backgroundPosition="left",s.width=t-4+"px",s=l.firstChild.childNodes[0].childNodes[1].style,s.backgroundPosition="right",s.width="4px"}return n.style.width=t+"px",n.style.height=a+"px",$WH.ae(n,l),n}function o(){var e,t,a;Oe=$WH.ce("div"),Oe.className="talentcalc-lower",Oe.style.display="none";for(var l=0;l<ve;++l)e=dt[l]=$WH.ce("div"),e.className="talentcalc-lower-tree"+(l+1),t=$WH.ce("p"),$WH.ae(t,$WH.ce("b")),$WH.ae(t,$WH.ce("span")),a=$WH.ce("a"),a.href="javascript:;",a.onclick=Qe.reset.bind(null,l),g_addTooltip(a,LANG.tc_resettree),$WH.ae(t,a),$WH.ae(e,t),$WH.ae(Oe,e);$WH.ae(qe,Oe)}function h(){Ee=$WH.ce("div"),Ee.className="talentcalc-main";var e=$WH.ce("div");e.className="clear",$WH.ae(Ee,e),$WH.ae(qe,Ee)}function p(){if(We==Ve){Fe=$WH.ce("div"),Fe.className="talentcalc-model",Fe.style.display="none",_swfModel=$WH.ce("div"),_swfModel.id="shg09yrhlnk",$WH.ae(Fe,_swfModel);var e=$WH.ce("div");e.className="clear",$WH.ae(Fe,e),$WH.ae(qe,Fe)}}function d(e){for(var t,a,l=[{}],s=0,n=g_pet_talents.length;s<n;++s){var r=g_pet_talents[s];if($WH.in_array(r.f,e)>=0){l[0].n=r.n,l[0].t=[],l[0].i=s,l[0].icon=r.icon;for(var i=0,c=r.t.length;i<c;++i)t=r.t[i],a=l[0].t[i]={},$WH.cO(a,t),t.f&&-1==$WH.in_array(t.f,e)&&(a.hidden=!0);break}}return l}function f(){var e,t,a;if(Le=$WH.ce("div"),Le.className="talentcalc-sidebar",e=$WH.ce("div"),e.className="talentcalc-sidebar-inner",t=$WH.ce("a"),t.className="talentcalc-button-help",t.href=We==Ve?"http://www.wow-petopia.com/talents/talents.html":"?help=talent-calculator",t.target="_blank",$WH.ae(t,$WH.ct(LANG.tc_help)),$WH.ae(e,t),Ae=$WH.ce("div"),Ae.className="talentcalc-sidebar-controls",Ae.style.display="none",t=$WH.ce("a"),t.className="talentcalc-button-reset",t.href="javascript:;",t.onclick=Qe.resetAll,$WH.ae(t,$WH.ct(LANG.tc_resetall)),$WH.ae(Ae,t),t=Ge=$WH.ce("a"),t.className="talentcalc-button-lock",t.href="javascript:;",t.onclick=re,$WH.ae(t,$WH.ct(LANG.tc_lock)),$WH.ae(Ae,t),t=$WH.ce("div"),t.className="clear",$WH.ae(Ae,t),$WH.ae(e,Ae),t=$WH.ce("div"),t.className="talentcalc-sidebar-controls2",a=$WH.ce("a"),a.className="talentcalc-button-import",a.href="javascript:;",a.onclick=he.profiler?Qe.promptWhBuild:Qe.promptBlizzBuild,$WH.ae(a,$WH.ct(LANG.tc_import)),$WH.ae(t,a),a=xe=$WH.ce("a"),a.className="talentcalc-button-summary",a.style.display="none",a.href="javascript:;",a.onclick=Qe.showSummary.bind(null,1),$WH.ae(a,$WH.ct(LANG.tc_summary)),$WH.ae(t,a),a=Ce=$WH.ce("a"),a.className="talentcalc-button-restore",a.style.display="none",a.href="javascript:;",a.onclick=V,$WH.ae(a,$WH.ct(LANG.tc_restore)),$WH.ae(t,a),a=Ie=$WH.ce("a"),a.className="talentcalc-button-export",a.style.display="none",a.href="javascript:;",a.target="_blank",$WH.ae(a,$WH.ct(LANG.tc_link)),$WH.ae(t,a),a=$WH.ce("div"),a.className="clear",$WH.ae(t,a),$WH.ae(e,t),t=$WH.ce("div"),$WH.ae(e,t),We==Ue){ze=$WH.ce("div"),ze.style.display="none",t=$WH.ce("h3"),$WH.ae(t,$WH.ct(LANG.tc_glyphs)),$WH.ae(ze,t),a=$WH.ce("a"),a.href="javascript:;",a.onclick=Qe.resetGlyphs,g_addTooltip(a,LANG.tc_resetglyphs),$WH.ae(a,$WH.ct("[x]")),$WH.ae(t,a),t=$WH.ce("div"),t.className="talentcalc-sidebar-majorglyphs q9",a=$WH.ce("b"),$WH.ae(a,$WH.ct(g_item_glyphs[1])),$WH.ae(t,a),$WH.ae(ze,t),t=$WH.ce("div"),t.className="talentcalc-sidebar-minorglyphs q9",a=$WH.ce("b"),$WH.ae(a,$WH.ct(g_item_glyphs[2])),$WH.ae(t,a),$WH.ae(ze,t),t=$WH.ce("div"),t.className="clear",$WH.ae(ze,t);var l,s,n,r,i,c,o=$WH.ce("table"),h=$WH.ce("tbody");o.className="icontab";for(var p=0;p<3;++p){l=$WH.ce("tr");for(var d=0;d<2;++d){var f=3*d+p;s=$WH.ce("th"),r=Icon.create("inventoryslot_empty",1,null,"javascript:;"),i=Icon.getLink(r),ht[f]=r,$WH.ae(s,r),$WH.ae(l,s),n=$WH.ce("td"),c=$WH.ce("a"),pt[f]=c,$WH.ae(n,c),$WH.ae(l,n),c.target=i.target="_blank",c.rel=i.rel="np",c.onmousedown=i.onmousedown=$WH.rf,c.onclick=i.onclick=$WH.rf,g_onClick(c,w.bind(c,f)),c.onmouseover=le.bind(null,c,f),c.onmousemove=$WH.Tooltip.cursorUpdate,c.onmouseout=$WH.Tooltip.hide,g_onClick(i,w.bind(i,f)),i.onmouseover=le.bind(null,i,f),i.onmouseout=$WH.Tooltip.hide,n.oncontextmenu=$WH.rf}$WH.ae(h,l)}$WH.ae(o,h),$WH.ae(ze,o),$WH.ae(e,ze)}$WH.ae(Le,e),t=$WH.ce("div"),t.className="talentcalc-sidebar-anchor",$WH.ae(t,Le),$WH.ae(we,t)}function u(e,t,a){for(var l,s,n=$WH.ce("table"),r=$WH.ce("tbody"),i=0;i<t;++i){l=$WH.ce("tr");for(var c=0;c<e;++c){if(a&&i>0){s=$WH.ce("th"),s.colSpan=2,$WH.ae(l,s);break}var o=$WH.ce("td");o.className="talentcalc-main-cell",$WH.ae(l,o)}$WH.ae(r,l)}return $WH.ae(n,r),n}function g(e){var t=Xe[e];t.k=0,t.div=$WH.ce("div"),t.div.style.display="none",$WH.aef(Ee,t.div);for(var a=0;a<ve;++a){t[a].k=0;var l=$WH.ce("div"),s=$WH.ce("div");l.style.backgroundRepeat="no-repeat",l.style.cssFloat=l.style.styleFloat="left",a>0&&(l.style.borderLeft="1px solid #404040"),s.style.overflow="hidden",s.style.width=We==Ue?"204px":"244px",$WH.ae(s,u(4,ye)),$WH.ae(l,s),$WH.ae(t.div,l);var n,r=$WH.gE(l,"td"),i="?"+Ke;We==Ve?(l.style.backgroundImage="url("+g_staticDataUrl+"/images/wow/hunterpettalents/bg_"+(t[0].i+1)+".jpg"+i+")",n=g_staticDataUrl+"/images/wow/hunterpettalents/icons_"+(t[0].i+1)+".jpg"+i):(l.style.backgroundImage="url("+g_staticDataUrl+"/images/wow/talents/backgrounds/"+g_file_classes[e]+"_"+(a+1)+".jpg"+i+")",n=g_staticDataUrl+"/images/wow/talents/icons/"+g_file_classes[e]+"_"+(a+1)+".jpg"+i);for(var o=t[a].t.length-1;o>=0;--o){var h=t[a].t[o],p=Icon.create(n,1,null,"javascript:;"),d=Icon.getLink(p),f=r[4*h.y+h.x+1-1];et[t[a].t[o].i]=h,d.rel="np",d.target="_blank",d.onmousedown=$WH.rf,d.onclick=$WH.rf,g_onClick(d,A.bind(d,h)),d.onmouseover=se.bind(null,d,h),d.onmouseout=$WH.Tooltip.hide;var g=$WH.ce("div"),W=$WH.ce("div");if($WH.ae(W,$WH.ct("0")),g.className="icon-border",W.className="icon-bubble",$WH.ae(p,g),$WH.ae(p,W),h.k=0,h.i=o,h.tree=a,h.classId=e,h.icon=p,h.link=d,h.border=g,h.bubble=W,h.hidden||$WH.ae(f,p),h.r){var v,y,$,H,b=t[a].t[h.r[0]],m=h.x-b.x,k=h.y-b.y,N=-1;if(null==b.links?b.links=[o]:b.links.push(o),k>0?N=0==m?0:m<0?1:2:0==k&&(m>0?N=3:m<0&&(N=4)),We==Ve?($=60*(Math.abs(m)-1),H=60*(Math.abs(k)-1)):($=50*(Math.abs(m)-1),H=50*(Math.abs(k)-1)),We==Ve)switch(N){case 0:H+=27,v=21,y=6-H}else switch(N){case 0:H+=17,v=16,y=6-H;break;case 1:$+=36,H+=42,v=16,y=6-H;break;case 2:$+=37,H+=42,v=-6,y=6-H;break;case 3:$+=15,v=-6,y=12;break;case 4:$+=15,v=37,y=12}var _=c(N,$,H);_.style.left=v+"px",_.style.top=y+"px";var w=$WH.ce("div");w.className="talentcalc-arrow-anchor",$WH.ae(w,_),h.hidden||f.insertBefore(w,f.firstChild),h.arrow=_}}}}function W(){var e,t;Te=$WH.ce("div"),Te.className="talentcalc-upper",Te.style.display="none",e=$WH.ce("span"),e.className="talentcalc-upper-class",Be=a=$WH.ce("a"),a.target="_blank",a.style.fontWeight="bold",$WH.ae(e,a),$WH.ae(e,$WH.ct(" ")),Me=$WH.ce("b"),$WH.ae(e,Me),$WH.ae(Te,e),e=$WH.ce("span"),e.className="talentcalc-upper-ptsleft",$WH.ae(e,$WH.ct(LANG.tc_ptsleft)),Se=$WH.ce("b"),$WH.ae(e,Se),$WH.ae(Te,e),We==Ve&&(t=De=$WH.ce("a"),t.href="javascript:;",t.onclick=l.bind(null,t),t.onmouseover=s.bind(null,t),t.onmousemove=$WH.Tooltip.cursorUpdate,t.onmouseout=$WH.Tooltip.hide,$WH.ae(e,t)),e=$WH.ce("span"),e.className="talentcalc-upper-reqlevel",$WH.ae(e,$WH.ct(LANG.tc_reqlevel)),je=$WH.ce("b"),$WH.ae(e,je),t=Pe=$WH.ce("a"),t.className="q1",t.href="javascript:;",t.onclick=n.bind(null,t),t.onmouseover=r.bind(null,t),t.onmousemove=$WH.Tooltip.cursorUpdate,t.onmouseout=$WH.Tooltip.hide,he.profiler||($WH.ae(e,$WH.ct(" (")),$WH.ae(e,t),$WH.ae(e,$WH.ct(")"))),$WH.ae(Te,e),e=$WH.ce("div"),e.className="clear",$WH.ae(Te,e),$WH.ae(qe,Te)}function v(e){for(var t="",a=[],l=0;l<e.length;l+=2){for(var s=0;s<2;++s)a[s]=parseInt(e.substring(l+s,l+s+1)),isNaN(a[s])&&(a[s]=0);t+=ft.charAt(6*a[0]+a[1])}return t}function y(e,t,a){var l=Xe[e.classId];if(e.k>0){if(e.links)for(n=0;n<e.links.length;++n)if(l[e.tree].t[e.links[n]].k)return;e.k--;for(var s=0,n=0;n<l[e.tree].t.length;++n){var r=l[e.tree].t[n];if(r.k&&e.y!=r.y&&s<r.y*be)return void e.k++;s+=r.k}if(l[e.tree].k--,n=l.k--,ce(e.tree,t,null,e.classId),t){if(se(a,e),n>=Ne)for(var i=0;i<ve;++i)ce(i,!0,null,e.classId);z()}}}function $(e){var t=$.L;if(null==t){t=$.L={};for(var a in H.L)t[H.L[a]]=a}return t[e]}function H(e){return H.L[e]}function b(e){for(var t=0,a=0,l=rt.length;a<l;++a){var s=rt[a];if(e>=t&&e<t+it[s].length)return s;t+=it[s].length}}function m(e){return-1==$WH.in_array(He[b(e)],e)||k(e)>ot}function k(e){var t=0;for(var a in it)for(var l=0,s=it[a].length;l<s;++l){if(t==e)return it[a][l];++t}return 0}function N(){var e,t=Xe[tt];e=We==Ve?Math.max(ct?60:0,t.k>0?4*(t.k-ct)+16:0):t.k?t.k+9:0;for(var a=0;a<$e;++a)g_glyphs[t.glyphs[a]]&&(e=Math.max(e,k(a)),e=Math.max(e,g_glyphs[t.glyphs[a]].level));return e}function _(e,t){var a=(e.d,Math.max(0,e.k-1)+(t?1:0));return e.d[a]}function w(e,t){nt||(t?O(e)&&le(this,e):(ge=e,Lightbox.show("glyphpicker",{onShow:L})))}function L(e,t,a){Lightbox.setSize(800,564);var l;if(t){e.className="talentcalc-glyphpicker listview";var s=[],n=$WH.ce("div"),r=$WH.ce("a"),i=$WH.ce("div");s.push({none:1});for(var c in g_glyphs)s.push(g_glyphs[c]);n.className="listview",$WH.ae(e,n),r.className="screenshotviewer-close",r.href="javascript:;",r.onclick=Lightbox.hide,$WH.ae(r,$WH.ce("span")),$WH.ae(e,r),i.className="clear",$WH.ae(e,i),l=new Listview({template:"glyph",id:"glyphs",parent:n,data:s,customFilter:I.bind(0,null),createNote:C}),$WH.Browser.firefox?$WH.aE(l.getClipDiv(),"DOMMouseScroll",g_pickerWheel):l.getClipDiv().onmousewheel=g_pickerWheel}else l=g_listviews.glyphs,l.clearSearch(),l.updateFilters(!0);setTimeout(function(){l.createNote(l.noteTop,l.noteBot),l.focusSearch()},1)}function A(e,t){nt||(t?y(e,!0,this):G(e,!0,this))}function G(e,t,a){var l=Xe[e.classId];if(l.k<Ne){if(e.enabled&&e.k<e.m&&(l.k++,l[e.tree].k++,e.k++,ce(e.tree,t,e,e.classId),t)){if(se(a,e),l.k==Ne)for(var s=0;s<ve;++s)s!=e.tree&&ce(s,t,null,e.classId);z()}}else We!=Ve||l.k!=Ne||t||(Y(-1,ke,!0),G(e,t,a))}function x(){var e,t,a,l=[];for(var s in g_glyphs)l.push(s);l.sort();for(var n=0,r=l.length;n<r;++n){var s=l[n];if(e=g_glyphs[s],t=e.classs,a=e.type,!Ye[t]){Ye[t]={};for(var i in it)Ye[t][i]=[]}Ye[t][a]&&(e.id=s,e.index=Ye[t][a].length,Ye[t][a].push(e.id))}}function I(e,t){if(t.none)return!0;var a=Xe[tt],l=t.classs==tt&&t.type==b(null!=e?e:ge)&&!a.glyphItems[t.id];return l&&t.level>ot&&(st=!0),l&&t.level<=ot}function C(e){e.innerHTML="",st&&(e.innerHTML+='<small><b class="q10">'+LANG.tc_glyphnote+"</b></small>")}function z(){var e=Xe[tt];if(e){Wt.mode=We,Wt.classId=tt,Wt.locked=nt,Wt.requiredLevel=N(),Wt.pointsLeft=Ne-e.k,Wt.pointsSpent=We==Ve?e[0].k:[e[0].k,e[1].k,e[2].k],Wt.bonusPoints=ct,$WH.st(Me,"("+(We==Ve?e.k:Wt.pointsSpent.join("/"))+")"),$WH.st(je,Wt.requiredLevel?Wt.requiredLevel:"-"),$WH.st(Pe,ot),$WH.st(Se,Wt.pointsLeft),nt?($WH.st(Ge,LANG.tc_unlock),Ge.className="talentcalc-button-unlock"):($WH.st(Ge,LANG.tc_lock),Ge.className="talentcalc-button-lock"),We==Ve&&(ct?($WH.st(De,"[-]"),De.className="q10"):($WH.st(De,"[+]"),De.className="q2")),Ie&&(Ie.href=(We==Ve?"?petcalc#":"?talent#")+Qe.getWhBuild()+(We==Ve?"":":"+Qe.getWhGlyphs()));for(var t=0;t<ve;++t){var a=dt[t].firstChild.childNodes[1];$WH.st(a," ("+e[t].k+")")}Re&&Re(Qe,Wt,e)}}function q(){$WH.st(Be,_e[tt]),We==Ve?(Be.href="?pet="+tt,oe(tt),Fe.style.display=""):(Be.href="?class="+tt,Be.className="c"+tt),0==lt&&(Ae.style.display="",xe.style.display="",Ie&&(Ie.style.display=""),ze&&(ze.style.display=""),Te.style.display="",Oe.style.display="");for(var e=Xe[tt],a=0;a<ve;++a){var l=dt[a].firstChild.childNodes[0];We==Ue&&(l.style.backgroundImage="url("+g_staticDataUrl+"/images/wow/talents/trees/"+g_file_classes[tt]+"_"+(a+1)+".gif)"),$WH.st(l,e[a].n)}t(),P(tt),z(),++lt}function T(e,t){var a=Xe[t],l=0,s=0,n=[];8==t&&62==e.length&&(e=e.substr(0,15)+e.substr(16));for(var r=0;r<e.length;++r){var i=Math.min(parseInt(e.charAt(r)),a[l].t[s].m);if(!isNaN(i)){for(var c=0;c<i;++c)G(a[l].t[s]);for(var o=0;o<n.length;++o)if(n[o][0].enabled&&n[o][1]>0){for(var c=0;c<n[o][1];++c)G(n[o][0]);n[o][1]=0}if(a[l].t[s].k<i&&n.push([a[l].t[s],i-a[l].t[s].k]),++s>a[l].t.length-1&&(s=0,++l>ve-1))break}}}function B(t){for(var a=(""+t).split(":",$e),l={},s=0,n=a.length;s<n&&s<$e;++s){var r=a[s],i=g_glyphs[r];if(i){var c=-1;null==l[i.type]&&(l[i.type]=0),l[i.type]<He[i.type].length&&(c=He[i.type][l[i.type]],++l[i.type]),-1!=c&&e(c,r,!0)}else++l[b(s)]}}function M(e,t){for(var a=Xe[t],l=0,s=0,n=[],r=[],i=0;i<e.length;++i){var c=e.charAt(i);if(c!=gt){var o=ft.indexOf(c);if(o<0)continue;n[1]=o%6,n[0]=(o-n[1])/6;for(var h=0;h<2;++h){o=Math.min(n[h],a[l].t[s].m);for(var p=0;p<o;++p)G(a[l].t[s]);for(var d=0;d<r.length;++d)if(r[d][0].enabled&&r[d][1]>0){for(var p=0;p<r[d][1];++p)G(r[d][0]);r[d][1]=0}if(a[l].t[s].k<o&&r.push([a[l].t[s],o-a[l].t[s].k]),++s>=a[l].t.length)break}}if((s>=a[l].t.length||c==gt)&&(s=0,++l>ve-1))return}}function j(t){for(var a=0,l=0,s=t.length;l<s&&l<$e;++l){var n=t.charAt(l);"Z"!=n?(e(a,Ye[tt][b(a)][ft.indexOf(n)],!0),++a):a=3}}function P(e){S();for(var t=0;t<ve;++t)ce(t,!0,null,e)}function S(){if(We==Ue){for(var e=0,t=0;t<$e;++t)ie(t)&&++e;ze.style.display=0==e&&nt&&he.profiler?"none":""}}function D(e,t){if(null==Xe[e]){t.n=e,Xe[e]=t;var a=Xe[e];if(a.glyphs=[],a.glyphItems={},g(e),pe&&pe.classId==e){for(var l=0;l<ve;++l)ce(l,!1,null,e);(pe.wh||pe.blizz)&&(nt=!0,pe.wh?M(pe.wh,e):T(pe.blizz,e))}else nt=!1;if(pe=null,ue&&ue.classId==e&&(ue.wh?j(ue.wh):B(ue.blizz)),ue=null,e==tt){q(),a.div.style.display="";for(var l=0;l<ve;++l)ce(l,!0,null,e)}}}function O(e,t){var a=Xe[tt];if(a.glyphs[e])return a.glyphItems[a.glyphs[e]]=0,a.glyphs[e]=0,t||(ie(e),z()),!0}function E(e){F(e),R(),P(e)}function F(e){We==Ve&&Y(-1,0,!0);for(var t=0;t<ve;++t)U(t,e,!1)}function R(e){if(Xe[tt]){for(var t=0;t<$e;++t)O(t,!e);S()}}function U(e,t,a){var l,s=Xe[t];for(l=0;l<s[e].t.length;++l)s[e].t[l].k=0;if(l=s.k<Ne,s.k-=s[e].k,s[e].k=0,a){if(l)ce(e,!0,null,t);else for(e=0;e<ve;++e)ce(e,!0,null,t);z()}}function V(){de&&(de.wh?te(de.wh):Z(de.classId,de.blizz)),fe&&fe.wh&&ae(fe.wh)}function Z(e,t){null!=_e[e]&&t&&(nt=!0,de||(de={classId:e,blizz:t},Ce.style.display=""),Xe[e]?(F(e),P(e),T(t,e),P(e)):pe={classId:e,blizz:t},K(e)||z())}function J(e){e&&(Xe[tt]?(R(),B(e),S(),z()):ue={classId:tt,blizz:e})}function K(e){if(null!=_e[e]&&e!=tt){if(at=tt,tt=e,We==Ve&&null==Xe[e])D(e,d(e));else if(Xe[e]){q();var t=Xe[e];t.div.style.display=""}else $WH.g_ajaxIshRequest("?data=talents&class="+e+"&locale="+Locale.getId()+"&"+Ke);return Xe[at]&&(Xe[at].div.style.display="none"),!0}}function Q(e){if(e=parseInt(e),!(isNaN(e)||e<Ze||e>Je)){ot=e;var t;t=We==Ve?Math.max(0,Math.floor((e-16)/4)):Math.max(0,e-9),Y(t,-1),ee(e),S()}}function X(e){nt!=e&&(nt=e,P(tt),z(1))}function Y(e,a,l){var s=Ne;-1==e&&(e=me),-1==a&&(a=ct),me=e,ct=a,Ne=e+a,-1!=tt&&(Ne<s&&t(),P(tt),l||z())}function ee(e){$e=0,He={};for(var t=0,a=0,l=rt.length;a<l;++a){var s=rt[a];He[s]=[];for(var n=0,r=it[s].length;n<r;++n)e>=it[s][n]&&(He[s].push(t),$e++),++t}}function te(e){if(e){var t,a=e,l=!1;if(We==Ve){var s=ft.indexOf(e.charAt(0));if(s>=0&&s<=4){var n=ft.indexOf(e.charAt(1));n%2==1?(Y(-1,ke,!0),--n):Y(-1,0,!0),t=10*s+n/2,null!=g_pet_families[t]&&(e=e.substr(2),l=!0)}}else{var s=ft.indexOf(e.charAt(0));if(s>=0&&s<=27){var n=s%3,t=(s-n)/3;t=$(t),null!=t&&(e=e.substr(1),l=!0)}}return l?(e.length&&(nt=!0,de||(de={wh:a},Ce.style.display="")),Xe[t]?(F(t),M(e,t),P(t)):pe={classId:t,wh:e},K(t)||z(),t):void 0}}function ae(e){e&&(fe||(fe={wh:e}),Xe[tt]?(R(),j(e),S(),z()):ue={classId:tt,wh:e})}function le(e,t){var a=Xe[tt];upper="",lower="",glyph=g_glyphs[a.glyphs[t]],locked=m(t),glyph&&!locked?(upper+="<b>"+glyph.name+"</b>",upper+='<br /><span class="q9">'+LANG[t<=2?"tc_majgly":"tc_mingly"]+"</span>",lower+='<span class="q">'+glyph.description+"</span>",nt||(lower+='<br /><span class="q10">'+LANG.tc_remgly+"</span>")):locked?(upper+='<b class="q0">'+LANG.tc_locked+"</b>",upper+='<br /><span class="q9">'+LANG[t<=2?"tc_majgly":"tc_mingly"]+"</span>",lower+='<span class="q10">'+$WH.sprintf(LANG.tc_lockgly,k(t))+"</span>"):(upper+='<b class="q0">'+LANG.tc_empty+"</b>",upper+='<br /><span class="q9">'+LANG[t<=2?"tc_majgly":"tc_mingly"]+"</span>",nt||(lower+='<span class="q2">'+LANG.tc_addgly+"</span>")),glyph&&0!=e.parentNode.className.indexOf("icon")?$WH.Tooltip.setIcon(glyph.icon):$WH.Tooltip.setIcon(null),$WH.Tooltip.show(e,"<table><tr><td>"+upper+"</td></tr></table><table><tr><td>"+lower+"</td></tr></table>")}function se(e,t){var a=Xe[t.classId],l="<table><tr><td><b>";t.z&&(l+='<span style="float: right" class="q0">'+t.z+"</span>"),l+=t.n+"</b><br />"+$WH.sprintf(LANG.tc_rank,t.k,t.m)+"<br />",t.r&&a[t.tree].t[t.r[0]].k<t.r[1]&&(l+='<span class="q10">',l+=$WH.sprintf(LANG[1==t.r[1]?"tc_prereq":"tc_prereqpl"],t.r[1],a[t.tree].t[t.r[0]].n),l+="</span><br />"),a[t.tree].k<t.y*be&&(l+='<span class="q10">'+$WH.sprintf(LANG.tc_tier,t.y*be,a[t.tree].n)+"</span><br />"),t.t&&t.t.length>=1&&(l+=t.t[0]),l+="</td></tr></table><table><tr><td>",t.t&&t.t.length>1&&(l+=t.t[1]+"<br />"),l+='<span class="q">'+_(t)+"</span><br />",nt||t.enabled&&(t.k?t.k==t.m&&(l+='<span class="q10">'+LANG.tc_unlearn+"</span><br />"):l+='<span class="q2">'+LANG.tc_learn+"</span><br />",t.k&&t.k<t.m&&(l+="<br />"+LANG.tc_nextrank+'<br /><span class="q">'+_(t,1)+"</span><br />")),l+="</td></tr></table>",$WH.Tooltip.show(e,$WH.g_setTooltipLevel(l,N()))}function ne(e){var t;switch(Locale.getId()){case 0:t=e.replace(/^Glyph of (the )?/i,"");break;case 2:t=e.replace(/^Glyphe (d'|des |de )?/i,"");break;case 3:t=e.match(/^Glyphe '(.*)'/i),t=t&&t[1]?t[1]:e;break;case 6:t=e.replace(/^Glifo (de )?/i,"");break;case 8:t=e.replace(/^Символ /i,"");break;default:return e}return t.charAt(0).toUpperCase()+t.substr(1)}function re(){return nt=!nt,P(tt),z(),nt}function ie(e){var t,a=Xe[tt],l=ht[e],s=Icon.getLink(l),n=m(e),r=pt[e];return a.glyphs[e]&&(t=g_glyphs[a.glyphs[e]],(n||t.level>ot)&&O(e)),t&&!n?(Icon.setTexture(l,1,t.icon),r.href=s.href="?item="+t.id,$WH.st(r,ne(t.name)),r.className="q1",!0):(Icon.setTexture(l,1,"inventoryslot_empty"),r.href=s.href="javascript:;",$WH.st(r,n?LANG.tc_locked:LANG.tc_empty),r.className="q0",!1)}function ce(e,t,a,l){var s,n=Xe[l];if(a&&n.k!=Ne?(s=a.i,Math.floor(n[e].k/be)*be+5):(s=0,Ne-21),null!=a&&null!=a.links)for(var r=0,i=a.links.length;r<i;++r)s>a.links[r]&&(s=a.links[r]);for(var r=s;r<n[e].t.length;++r)if(a=n[e].t[r],(n.k!=Ne||a.k)&&n[e].k>=a.y*be?a.r?n[e].t[a.r[0]].k>=a.r[1]?a.enabled=1:a.enabled=0:a.enabled=1:a.enabled=0,t){if(!a.enabled||nt&&!a.k){if(a.border.style.backgroundPosition="0 0",Icon.moveTexture(a.icon,1,r,1),a.link.className="",a.bubble.style.visibility="hidden",a.r){var c=a.arrow.firstChild;"2"==c.className.charAt(c.className.length-1)&&(c.className=c.className.substr(0,c.className.length-1))}}else if(a.k==a.m?(a.border.style.backgroundPosition="-42px 0",a.bubble.style.color="#E7BA00"):(a.border.style.backgroundPosition="-84px 0",a.bubble.style.color="#17FD17"),Icon.moveTexture(a.icon,1,r,0),a.link.className="bubbly",a.bubble.style.visibility="visible",a.r){var c=a.arrow.firstChild;"2"!=c.className.charAt(c.className.length-1)&&(c.className+="2")}a.bubble.firstChild.nodeValue=a.k,a.link.href="?spell="+a.s[Math.max(0,a.k-1)]}}function oe(e,t){var a=g_staticDataUrl;if(We==Ve){var l=Xe[e];if(l){if(g_pets[t]&&g_pets[t].family==e&&(l.npcId=t),!g_pets[l.npcId]||g_pets[l.npcId].family!=e){var s=[];for(var n in g_pets)g_pets[n].family==e&&s.push(g_pets[n].id);if(!s.length)return;l.npcId=s[Math.floor(Math.random()*s.length)]}var r={model:g_pets[l.npcId].displayId,modelType:8,contentPath:a+"/modelviewer/",blur:$WH.OS.mac?"0":"1"},i={quality:"high",allowscriptaccess:"always",allowfullscreen:!0,menu:!1,bgcolor:"#181818",wmode:"direct"},c={};swfobject.embedSWF(a+"/modelviewer/ZAMviewerfp11.swf",_swfModel.id,"100%","100%","10.0.0",a+"/modelviewer/expressInstall.swf",r,i,c)}}}var he,pe,de,fe,ue,ge,We,ve,ye,$e,He,be,me,ke,Ne,_e,we,Le,Ae,Ge,xe,Ie,Ce,ze,qe,Te,Be,Me,je,Pe,Se,De,Oe,Ee,Fe,Re,Ue=0,Ve=1,Ze=10,Je=80,Ke=85,Qe=this,Xe={},Ye={},et={},tt=-1,at=-1,lt=0,st=!1,nt=!1,rt=[1,2],it={1:[],2:[]},ct=0,ot=Je,ht={},pt={},dt=[],ft="0zMcmVokRsaqbdrfwihuGINALpTjnyxtgevElBCDFHJKOPQSUWXYZ123456789",ut="aZbYcXdWeVfUgThSiRjQkPlOmNnMoLpKqJrIsHtGuFvEwDxCyBzA0123456789_=+-.",gt="Z",Wt={};this.getTalentTrees=function(){return Xe[tt]},this.addGlyph=function(t){t?e(ge,t):O(ge),Lightbox.hide()},this.getBlizzBuild=function(){if(-1!=tt){for(var e=Xe[tt],t="",a=0;a<ve;++a)for(var l=0;l<e[a].t.length;++l)t+=e[a].t[l].k;return t=$WH.rtrim(t,"0")}},this.getBlizzGlyphs=function(){if(-1!=tt){for(var e=Xe[tt],t="",a=0;a<$e;++a)a>0&&(t+=":"),e.glyphs[a]?t+=e.glyphs[a]:t+="0";return t}},this.getGlyphs=function(){var e=[];if(-1!=tt){var t=Xe[tt];if(t)for(var a=0;a<$e;++a)t.glyphs[a]&&e.push(g_glyphs[t.glyphs[a]])}return e},this.getSpentFromBlizzBuild=function(e,t){for(var a=Xe[t],l=[],s=0;s<ve;++s)l.push(0);if(a){var n=0,r=0;8==t&&62==e.length&&(e=e.substr(0,15)+e.substr(16));for(var s=0;s<e.length;++s){var i=Math.min(parseInt(e.charAt(s)),a[n].t[r].m);if(!isNaN(i)){for(var c=0;c<i;++c)++l[n];if(++r>a[n].t.length-1&&(r=0,++n>ve-1))break}}}return l},this.getTalents=function(){var e=[];if(-1!=tt){var t=Xe[tt];if(t)for(var a=0;a<ve;++a)for(i=0;i<t[a].t.length;++i)t[a].t[i].k&&e.push(t[a].t[i])}return e},this.getTalentRanks=function(e){if(-1!=tt)return et[e]?et[e].k:0},this.getWhBuild=function(){if(-1!=tt){for(var e,t,a=Xe[tt],l="",s=0;s<ve;++s){for(e="",t=0;t<a[s].t.length;++t)e+=a[s].t[t].k;e=$WH.rtrim(e,"0"),l+=v(e),t=e.length,t%2==1&&++t,t<a[s].t.length&&(l+=gt)}var n;return n=We==Ve?ft.charAt(Math.floor(tt/10))+ft.charAt(tt%10*2+(ct?1:0)):ft.charAt(3*H(tt)),n+=$WH.rtrim(l,gt)}},this.getWhGlyphs=function(){if(-1!=tt){for(var e=Xe[tt],t={},a=0;a<$e;++a){var l=b(a);null==t[l]&&(t[l]=""),e.glyphs[a]&&(t[l]+=ft.charAt(g_glyphs[e.glyphs[a]].index))}for(var s="",n=0,r=0,i=rt.length;r<i;++r){var l=rt[r];n+=it[l].length,t[l]&&(s+=t[l]),s.length<n&&(s+=gt)}return s=$WH.rtrim(s,gt)}},this.initialize=function(e,t){we||(e=$WH.ge(e))&&(we=e,we.className="talentcalc",null==t&&(t={}),he=t,he.onChange&&(Re=he.onChange),he.mode==Ve?(We=Ve,ve=1,ye=6,be=3,me=16,ke=4,_e=g_pet_families,we.className+=" talentcalc-pet",ee(0)):(We=Ue,ve=3,ye=11,it={1:[15,30,80],2:[15,50,70]},be=5,me=71,ke=0,_e=g_chr_classes,we.className+=" talentcalc-default",$WowheadTalentCalculator=Qe,ee(Je),x()),Ne=me+ct,qe=$WH.ce("div"),qe.className="talentcalc-wrapper",$WH.ae(we,qe),f(),W(),h(),p(),o(),he.whBuild?te(he.whBuild):he.classId>0&&_e[he.classId]&&(he.blizzBuild?Z(he.classId,he.blizzBuild):K(he.classId)),he.whGlyphs?ae(he.whGlyphs):he.blizzGlyphs&&J(he.blizzGlyphs))},this.promptBlizzBuild=function(){if(We!=Ve){var e,t=prompt(LANG.prompt_importblizz,"");if(t){if(t.match(/talent-calculator#([\w=+-.])c[0-9]{2}(![\w=+-.]*![\w=+-.]*![\w=+-.]*!?[\w=+-.]*)/))return e=ut.indexOf(RegExp.$1),void Z(e,RegExp.$2);if(t.match(/\?cid=([0-9]+)&tal=([0-9]+)/))return e=parseInt(RegExp.$1),void Z(e,RegExp.$2);var a=t.indexOf("?tal=");if(-1!=a){for(var l in g_file_classes)if(-1!=t.indexOf(g_file_classes[l])){e=parseInt(l);break}if(e)return void Z(e,t.substring(a+5))}alert(LANG.alert_invalidurl)}}},this.promptWhBuild=function(){var e=prompt(LANG.prompt_importwh,"");if(e){var t=e.indexOf("=");if(-1!=t){var a=e.substr(t),l=a.substr(1).split(":"),s=l[0]||"",n=l[1]||"";te(s),ae(n)}}},this.registerClass=function(e,t){D(e,t)},this.reset=function(e){-1!=tt&&(e>ve-1||(nt=!1,U(e,tt,!0)))},this.resetAll=function(){Xe[tt]&&(nt=!1,E(tt),z())},this.resetBuild=function(){Xe[tt]&&(nt=!1,F(tt),P(tt),z())},this.resetGlyphs=function(){R(),z()},this.restore=function(){V()},this.setBlizzBuild=function(e,t){Z(e,t)},this.setBlizzGlyphs=function(e){-1!=tt&&J(e)},this.setBonusPoints=function(){We==Ve&&Y(-1,ke)},this.getBonusPoints=function(e){return ct},this.setClass=function(e){return K(e)},this.setLevelCap=function(e){Q(e)},this.setLock=function(e){-1!=tt&&X(e)},this.setWhBuild=function(e){return te(e)},this.setWhGlyphs=function(e){-1!=tt&&ae(e)},this.setPetModel=function(e){oe(tt,e)},this.showSummary=function(e){if(-1!=tt){var t,a,l,s=Xe[tt],n=window.open("?talent=summary","","toolbar=no,menubar=yes,status=yes,scrollbars=yes,resizable=yes"),r="<html><head><title>"+document.title+'</title></head><body style="font-family: Arial, sans-serif; font-size: 13px">';if(n.document.open(),e){for(r+="<h2>",r+=We==Ve?$WH.sprintf(LANG.tc_printh,N(),g_pet_families[s.n]):$WH.sprintf(LANG.tc_printh,N(),g_chr_classes[s.n])+" ("+s[0].k+"/"+s[1].k+"/"+s[2].k+")",r+="</h2>",r+="<p></p>",void 0!==$WowheadTalentCalculator&&(r+="<h3>"+LANG.tc_export+LANG.colon+"</h3>",r+="<blockquote style=\"font-family: 'Courier New';\">?cid="+tt+"&tal="+$WowheadTalentCalculator.getBlizzBuild()+"</blockquote>",r+="<p></p>"),t=0;t<ve;++t){for(r+="<h3>"+s[t].n+" ("+s[t].k+" "+LANG[1==s[t].k?"tc_point":"tc_points"]+")</h3>",r+="<blockquote>",l=0,a=0;a<s[t].t.length;++a)s[t].t[a].k&&(l&&(r+="<br /><br />"),r+="<b>"+s[t].t[a].n+"</b>"+LANG.hyphen+$WH.sprintf(LANG.tc_rank,s[t].t[a].k,s[t].t[a].m)+"<br />",r+=_(s[t].t[a]),++l);0==l&&(r+=LANG.tc_none),r+="</blockquote>"}for(r+="<h3>"+LANG.tc_glyphs+"</h3>",r+="<blockquote>",glyphCount=0,t=0;t<$e;++t)glyph=g_glyphs[s.glyphs[t]],glyph&&(glyphCount&&(r+="<br /><br />"),r+="<b>"+glyph.name+"</b> ",1==glyph.type?r+="("+LANG.tc_majgly+")<br />":r+="("+LANG.tc_mingly+")<br />",r+=glyph.description,glyphCount++);0==glyphCount&&(r+=LANG.tc_none),r+="</blockquote>"}else{for(r+="<pre>",t=0;t<ve;++t){for(r+="<b>"+s[t].n+" ("+s[t].k+" "+LANG[1==s[t].k?"tc_point":"tc_points"]+")</b>\n\n",l=0,a=0;a<s[t].t.length;++a)s[t].t[a].k&&(r+="&nbsp;&nbsp;&nbsp;&nbsp;"+s[t].t[a].k+"/"+s[t].t[a].m+" "+s[t].t[a].n+"\n",++l);0==l&&(r+="&nbsp;&nbsp;&nbsp;&nbsp;"+LANG.tc_none+"\n"),r+="\n"}r+="</pre>"}r+="</body></html>",n.document.write(r),n.document.close()}},this.simplifyGlyphName=function(e){return ne(e)},this.toggleLock=function(){-1!=tt&&re()},H.L={6:9,11:0,3:1,8:2,2:3,5:4,4:5,7:6,9:7,1:8}}var $WowheadTalentCalculator;TalentCalc.MODE_DEFAULT=0,TalentCalc.MODE_PET=1,Listview.templates.glyph={sort:[1],nItemsPerPage:-1,hideBands:2,hideNav:3,hideHeader:1,searchable:1,searchDelay:100,poundable:0,filtrable:0,clip:{w:780,h:486},onBeforeCreate:function(){this.applySort()},onSearchSubmit:function(e){1==this.nRowsVisible&&$WowheadTalentCalculator.addGlyph(e.id)},columns:[{id:"glyph",type:"text",align:"left",value:"name",span:2,compute:function(e,t,a){if(!e.none){var l=$WH.ce("td");l.style.width="1px",l.style.padding="0",l.style.borderRight="none";var s=Icon.create(e.icon,0,null,"?item="+e.id),n=Icon.getLink(s);$WH.ae(l,s),$WH.ae(a,l),t.style.borderLeft="none",n.onclick=$WH.rf;var r=$WH.ce("a");r.style.fontFamily="Verdana, sans-serif",r.href="?item="+e.id,$WH.ae(r,$WH.ct($WowheadTalentCalculator.simplifyGlyphName(e.name))),t.style.whiteSpace="nowrap",$WH.ae(t,r),a.onclick=function(t){2==t.which&&t.target==r||(t.preventDefault(),$WowheadTalentCalculator.addGlyph.bind(null,e.id)())}}},sortFunc:function(e,t,a){return e.none?-1:$WH.strcmp(e.name,t.name)}},{id:"description",type:"text",align:"left",value:"description",compute:function(e,t){if(!e.none){var a=$WH.ce("div");a.className="small crop",t.title=e.description,$WH.ae(a,$WH.ct(e.description)),$WH.ae(t,a)}}},{id:"level",type:"text",align:"center",value:"level",compute:function(e,t){if(!e.none)return t.className="small q0",t.style.whiteSpace="nowrap",LANG.tc_level.replace("%s",e.level)}},{id:"skill",type:"text",align:"center",getValue:function(e){if(!e.none)return g_spell_skills[e.skill]},compute:function(e,t,a){if(e.none)return $WH.ee(a),a.onclick=$WowheadTalentCalculator.addGlyph.bind(null,0),t.colSpan=5,t.style.fontWeight="bold",t.style.textAlign="center",LANG.dash+LANG.tc_nonegly+LANG.dash;if(e.skill){t.className="small q1",t.style.whiteSpace="nowrap";var l=$WH.ce("a");l.style.fontFamily="Verdana, sans-serif",l.href="?skill="+e.skill,$WH.ae(l,$WH.ct(g_spell_skills[e.skill])),$WH.ae(t,l)}}}]};