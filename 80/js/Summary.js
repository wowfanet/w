function Summary(e){if($WH.cO(this,e),this.id){var t=this.id;if(this.parent){var s=$WH.ce("div");s.id=t,$WH.ae($WH.ge(this.parent),s),this.container=s}else this.container=$WH.ge(t);if(this.template){this.templateName=this.template,this.template=Summary.templates[this.template],g_summaries[this.id]=this,null==this.editable&&(null!=this.template.editable?this.editable=this.template.editable:this.editable=1),null==this.draggable&&(null!=this.template.draggable?this.draggable=this.template.draggable:this.draggable=this.editable),null==this.searchable&&(null!=this.template.searchable?this.searchable=this.template.searchable:this.searchable=this.editable&&this.draggable),null==this.weightable&&(null!=this.template.weightable?this.weightable=this.template.weightable:this.weightable=this.editable),null==this.textable&&(null!=this.template.textable?this.textable=this.template.textable:this.textable=0),null==this.enhanceable&&(null!=this.template.enhanceable?this.enhanceable=this.template.enhanceable:this.enhanceable=this.editable),null==this.level&&(null!=this.template.level?this.level=this.template.level:this.level=80);var i=$WH.g_getGets();if(this.autoSave=1,i.compare&&(this.autoSave=0),i.l&&!isNaN(i.l))this.level=parseInt(i.l);else{var a=g_getWowheadCookie("compare_level");a&&(this.level=a)}if(null==this.groups&&(this.groups=[],i.compare?this.readGroups(i.compare):this.readGroups(g_getWowheadCookie("compare_groups"))),null==this.weights&&(this.weights=[],this.weightable&&(i.compare?this.readWeights(i.weights):this.readWeights(g_getWowheadCookie("compare_weights")))),this.showTotal=0,null!=this.template.total&&(this.total=this.template.total,this.showTotal=this.template.columns[this.total].hidden),null!=this.template.clone&&(this.clone={},$WH.cO(this.clone,this.template.columns[this.template.clone]),this.clone.i=this.template.clone),i.compare&&null!=i.focus){var r=0|parseInt(i.focus);r>=0&&r<this.groups.length&&(this.selected=this.clone.i+r)}setTimeout(this.initialize.bind(this),250)}}}var g_summaries={},fi_type="items";Summary.prototype={initialize:function(){this.controls=$WH.ce("div"),this.controls.style.display="none",this.controls.className="summary-controls",this.textNames=$WH.ce("div"),this.textNames.style.display="none",this.textNames.className="summary-textnames";var e;null!=this.onBeforeCreate&&(e=this.onBeforeCreate()),this.updateGroups(),this.updateTraits(),this.updateColumns(),this.updateVisibility(),0==this.traits.length&&(this.visibility.shift(),this.visibility.shift()),this.noData=$WH.ce("div"),this.noData.className="listview-nodata text",this.table=$WH.ce("table"),this.thead=$WH.ce("thead"),this.tbody=$WH.ce("tbody"),this.table.id="su_table",this.table.className="grid",this.refreshHeader(),$WH.ae(this.table,this.thead),$WH.ae(this.table,this.tbody),this.refreshRows(),$WH.ae(this.container,this.controls),$WH.ae(this.container,this.textNames),$WH.ae(this.container,this.table),this.itemTip=$WH.ce("div"),this.itemTip.className="summary-tip",this.itemTip.style.display="none";var t=$WH.ce("span");t.innerHTML=LANG.su_itemtip,$WH.ae(this.itemTip,t),$WH.ae(this.container,this.itemTip),this.refreshLink(),null!=this.onAfterCreate&&this.onAfterCreate(e),"compare"==this.templateName&&ModelViewer.addExtraPound(this.viewIn3dFromPound.bind(this))},updateGroups:function(){for(var e=0,t=this.groups.length;e<t;++e){for(var s=0,i=this.groups[e].length;s<i;++s)(0==this.groups[e][s][0]||i>1&&-1==this.groups[e][s][0]||!g_items[this.groups[e][s][0]])&&(this.groups[e].splice(s,1),--s,--i);0==i&&(null!=this.selected&&this.__selected.i==e&&(this.selected=null),this.groups.splice(e,1),--e,--t)}this.editable&&this.updateControls()},updateTraits:function(){this.traits=[];for(var e,t=!1,s=[],i=0,a=this.groups.length;i<a;++i){for(var r=0,n=this.groups[i].length;r<n;++r){var o=this.groups[i][r];if(g_items[o[0]]){if(s.push(g_items[o[0]].jsonequip),!this.enhanceable)continue;g_items[o[0]].jsonequip.subitems&&g_items[o[0]].jsonequip.subitems[o[1]]&&s.push(g_items[o[0]].jsonequip.subitems[o[1]].jsonequip),g_enchants[o[2]]&&s.push(g_enchants[o[2]].jsonequip),g_enchants[o[3]]&&s.push(g_enchants[o[3]].jsonequip);for(var l=4;l<8;++l)g_gems[o[l]]&&s.push(g_gems[o[l]].jsonequip);this.hasExtraSocket(o)&&s.push({nsockets:1}),this.hasSocketBonus(o)&&s.push(g_items[o[0]].jsonequip.socketbonusstat)}}(e=this.getSetBonuses(this.groups[i]))&&s.push(e)}for(var i=0,a=this.template.traits.length;i<a;++i){var c=this.template.traits[i];if("sep"!=c.type){var h=[c.id];if(c.json)var h=c.json;for(var u=!1,r=0,n=s.length;r<n;++r){for(var l=0,d=h.length;l<d;++l)if(s[r]&&s[r][h[l]]&&("gains"!=c.id||this.editable&&this.groups.length>1)&&("score"!=c.id||this.weights.length)){t&&this.traits.push({}),t=!1,this.traits.push(c),u=!0;break}if(u)break}}else t=!0}},updateColumns:function(){if(this.columns=this.template.columns.slice(0),null!=this.template.newgroup&&(this.newgroup=this.template.newgroup),null!=this.total?this.__total=this.columns[this.total]:this.__total={},this.__total.total={},this.minValue={},this.maxValue={},this.ratings={},null!=this.clone){this.columns.splice(this.clone.i,1);for(var e=0,t=0,s=this.groups.length;t<s;++t)if(!(this.groups[t].length<1)){e>0&&null!=this.newgroup&&this.newgroup++;var i=$WH.dO(this.clone);i.id="group"+t,i.group=this.groups[t],i.i=t,this.columns.splice(this.clone.i+t,0,i),e++}for(var t=0,s=this.columns.length;t<s;++t)this.calcTraitTotals(this.columns[t],this.__total,this.level);if(null!=this.selected){this.__selected=this.columns[this.selected];for(var t=0,s=this.groups.length;t<s;++t)this.clone.i+t!=this.selected&&this.calcTraitDifference(this.columns[this.clone.i+t],this.__selected)}else this.__selected={};null==this.total||1!=e&&null==this.selected?this.__total.hidden=this.showTotal:this.__total.hidden=1}},updateVisibility:function(){this.visibility=[];var e=[],t=[];null!=this.visibleCols&&$WH.array_walk(this.visibleCols,function(t){e[t]=1}),null!=this.hiddenCols&&$WH.array_walk(this.hiddenCols,function(e){t[e]=1});for(var s=0,i=this.columns.length;s<i;++s){var a=this.columns[s];(null!=e[a.id]||!a.hidden&&null==t[a.id])&&this.visibility.push(s)}this.groups.length>1&&this.textable?this.showTextNames():this.textNames.style.display="none"},updateDraggable:function(){for(var e=0,t=this.dragHeaders.length;e<t;++e){var s=this.dragHeaders[e];s._targets=this.dragTargets,Draggable.init(s,{container:this.table,onDrag:Summary.dragGroup.bind(this),onDrop:Summary.moveGroup.bind(this)})}for(var e=0,t=this.dragIcons.length;e<t;++e){var s=this.dragIcons[e];s._targets=this.dragTargets,Draggable.init(s,{container:this.table,onDrop:Summary.moveGroupItem.bind(this)})}},updateWeights:function(e){var t=$WH.ge("su_weight"),s=t.childNodes[0].childNodes[0],i=0;for(var a in e)if(LANG.traits[a]){i++>0&&(s=this.addWeight());for(var r=s.getElementsByTagName("option"),n=0,o=r.length;n<o;++n)if(r[n].value==a){r[n].selected=!0;break}this.refreshWeights(s,e[a])}},addWeight:function(e){var t=$WH.ge("su_weight"),s=$WH.ge("su_addweight");t.childNodes.length>=14&&(s.style.display="none"),s=t.childNodes[0].lastChild,"A"!=s.nodeName?($WH.ae(t.childNodes[0],$WH.ct(String.fromCharCode(160,160))),$WH.ae(t.childNodes[0],this.createControl(LANG.firemove,"","",this.deleteWeight.bind(this,t.childNodes[0].firstChild)))):(s.firstChild.nodeValue=LANG.firemove,s.onmouseup=this.deleteWeight.bind(this,t.childNodes[0].firstChild));var i=$WH.ce("div"),a=t.childNodes[0].childNodes[0].cloneNode(!0);return $WH.ae(t,i),a.onchange=a.onkeyup=this.refreshWeights.bind(this,a),$WH.ae(i,a),$WH.ae(i,$WH.ct(String.fromCharCode(160,160))),$WH.ae(i,this.createControl(LANG.firemove,"","",this.deleteWeight.bind(this,a))),e&&$WH.sp($WH.$E(e)),a},deleteWeight:function(e,t){var s=e.parentNode,i=s.parentNode;if($WH.de(s),1==i.childNodes.length){var a=i.firstChild;if(a.firstChild.selectedIndex>0){var r=a.lastChild;r.firstChild.nodeValue=LANG.ficlear,r.onmouseup=this.resetWeights.bind(this)}else for(;a.childNodes.length>1;)$WH.de(a.childNodes[1])}var r=$WH.ge("su_addweight");i.childNodes.length<15&&(r.style.display=""),t&&$WH.sp($WH.$E(t))},showDetails:function(e){var t=$WH.ge("su_weight");g_toggleDisplay(t),t=t.nextSibling,e.firstChild.nodeValue=g_toggleDisplay(t)?LANG.fihidedetails:LANG.fishowdetails},saveScale:function(){if(g_user.id){var e,t=$WH.gE($WH.ge("su_presets"),"option");for(i in t)if(t[i].selected){e=t[i];break}var s=$WH.ge("su_scale").value,a=0|(e._weights?e._weights.id:0),r={id:a,name:s},n=$WH.ge("su_weight"),o=0;for(i=0;i<n.childNodes.length;++i){var l,c=fi_Lookup($WH.gE(n.childNodes[i],"select")[0].value),h=$WH.gE(n.childNodes[i],"input");for(j in h)if(h[j]){l=h[j].value;break}c&&l&&0!=l&&(r[c.name]=l,++o)}if(!s||o<1||(!e._weights||!e._weights.id)&&g_user.weightscales&&g_user.weightscales.length>=5)return alert(LANG.message_weightscalesaveerror);var u=["save=1","name="+$WH.urlencode(s)];a&&u.push("id="+a),r.name=s,o=0;var d="";for(var c in r)LANG.traits[c]&&(o++>0&&(d+=","),d+=c+":"+r[c]);u.push("scale="+d),new Ajax("?account=weightscales",{method:"post",params:u.join("&"),onSuccess:function(e,t){var s=parseInt(e.responseText);if(s>0){null==g_user.weightscales&&(g_user.weightscales=[]),r.id&&(g_user.weightscales=$WH.array_filter(g_user.weightscales,function(e){return e.id!=r.id})),r.id=s,g_user.weightscales.push(r);var i,a=$WH.ge("su_classes"),n=$WH.gE(a,"option");for(o in n)if(-1==n[o].value){i=n[o];break}i||(i=$WH.ce("option"),i.value=-1,$WH.ae(i,$WH.ct(LANG.ficustom)),$WH.aef(a,i),$WH.aef(a,$WH.gE(a,"option")[1])),i._presets={custom:{}};for(var o=0,l=g_user.weightscales.length;o<l;++o)i._presets.custom[g_user.weightscales[o].id]=g_user.weightscales[o];i.selected=!0,i.parentNode.onchange();var c,n=$WH.gE($WH.ge("su_presets"),"option");for(o in n)if(n[o].value==r.id){c=n[o];break}c&&(c.text=r.name,c.selected=!0,c.parentNode.onchange()),alert(LANG.message_saveok)}else alert(LANG.message_weightscalesaveerror)}})}},deleteScale:function(){if(g_user.id){var e,t=$WH.ge("su_classes"),s=$WH.gE(t,"option");for(a in s)if(s[a].selected){e=s[a];break}if(-1==e.value){var i,s=$WH.gE($WH.ge("su_presets"),"option");for(a in s)if(s[a].selected){i=s[a];break}if(i.value&&confirm(LANG.confirm_deleteweightscale)){if(new Ajax("?account=weightscales",{method:"post",params:"delete=1&id="+i.value}),g_user.weightscales=$WH.array_filter(g_user.weightscales,function(e){return e.id!=i.value}),g_user.weightscales.length){e._presets={custom:{}};for(var a=0,r=g_user.weightscales.length;a<r;++a)e._presets.custom[g_user.weightscales[a].id]=g_user.weightscales[a]}else $WH.de(e);$WH.de(i),$("#su_classes, #su_presets").change()}}}},calcTraitTotals:function(e,t,s){if(e.group){e.total={},e.difference={};var i={sum:function(e,t){return(isNaN(e)?0:e)+t},min:function(e,t){return Math.min(isNaN(e)?t:e,t)},max:function(e,t){return Math.max(isNaN(e)?0:e,t)},avg:function(e,t,s){return(isNaN(e)?0:e)+t/s},text:function(e,t,s,i,a,r,n){return a&&(a=a.bind(this),t=a(t,r,i,n)),$WH.in_array(e,t)<0?t:null},custom:function(e,t,s,i,a,r,n){return a&&(a=a.bind(this))(t,e,r,i,n),e}},a=function(e,i,a,r,n,o,l,c){var h=$WH.dO(e);h.scadist&&h.scaflags&&$WH.g_setJsonItemLevel(h,s);var u="text"==a.type||"custom"==a.type?h:h[i]&&"object"!=typeof h[i]?h[i]:0;if("nsockets"==i&&c&&(u+=c),u){var d=n(r.total[a.id],u,r.group.length,l,o,0,c),p=n(t.total[a.id],u,r.group.length,l,o,1,c);"text"==a.type?(d&&r.total[a.id].push(d),p&&t.total[a.id].push(p)):(r.total[a.id]=d,t.total[a.id]=p)}};for(var r in this.traits)if(r=this.traits[r],r.id&&r.type){var n,o=i[r.type].bind(this),l=r.calcTotal,c=[r.id];r.json&&(c=r.json),null==e.total[r.id]&&("text"==r.type?e.total[r.id]=[]:"custom"==r.type&&(e.total[r.id]={})),null==t.total[r.id]&&("text"==r.type?t.total[r.id]=[]:"custom"==r.type&&(t.total[r.id]={}));for(var h=0,u=e.group.length;h<u;++h)for(var d=this.hasExtraSocket(e.group[h]),p=0,m=c.length;p<m;++p)if(g_items[e.group[h][0]]&&g_items[e.group[h][0]]){if(a(g_items[e.group[h][0]].jsonequip,c[p],r,e,o,l,e.group[h],d),!this.enhanceable||r.itemonly)continue;g_items[e.group[h][0]].jsonequip.subitems&&g_items[e.group[h][0]].jsonequip.subitems[e.group[h][1]]&&a(g_items[e.group[h][0]].jsonequip.subitems[e.group[h][1]].jsonequip,c[p],r,e,o,l,e.group[h]),g_enchants[e.group[h][2]]&&a(g_enchants[e.group[h][2]].jsonequip,c[p],r,e,o,l,e.group[h]),g_enchants[e.group[h][3]]&&a(g_enchants[e.group[h][3]].jsonequip,c[p],r,e,o,l,e.group[h]);for(var g=4;g<8;++g)g_gems[e.group[h][g]]&&a(g_gems[e.group[h][g]].jsonequip,c[p],r,e,o,l,e.group[h]);this.hasSocketBonus(e.group[h])&&a(g_items[e.group[h][0]].jsonequip.socketbonusstat,c[p],r,e,o,l,e.group[h])}if(n=this.getSetBonuses(e.group))for(var p=0,m=c.length;p<m;++p)a(n,c[p],r,e,o,l,[]);if(r.rating&&(this.ratings[r.id]=r.rating),"sum"==r.type)null==e.total[r.id]?this.minValue[r.id]=0:(null==this.minValue[r.id]||this.minValue[r.id]>e.total[r.id])&&(this.minValue[r.id]=e.total[r.id]),(null==this.maxValue[r.id]||this.maxValue[r.id]<e.total[r.id])&&(this.maxValue[r.id]=e.total[r.id]);else if("custom"==r.type){null==this.minValue[r.id]&&(this.minValue[r.id]={}),null==this.maxValue[r.id]&&(this.maxValue[r.id]={});for(var f in e.total[r.id])(null==this.minValue[r.id][f]||this.minValue[r.id][f]>e.total[r.id][f])&&(this.minValue[r.id][f]=e.total[r.id][f]),(null==this.maxValue[r.id][f]||this.maxValue[r.id][f]<e.total[r.id][f])&&(this.maxValue[r.id][f]=e.total[r.id][f])}}}},calcTraitDifference:function(e,t){e.difference={};var s={sum:function(e,t){return(isNaN(t)?0:t)-(isNaN(e)?0:e)},min:function(e,t){return(isNaN(t)?0:t)-(isNaN(e)?0:e)},max:function(e,t){return(isNaN(t)?0:t)-(isNaN(e)?0:e)},avg:function(e,t){return(isNaN(t)?0:t)-(isNaN(e)?0:e)},text:function(e,t){for(var s=[],i=0,a=t.length;i<a;++i)if(-1==$WH.in_array(e,t[i])){var r=$WH.ce("span");r.className="q2",$WH.ae(r,$WH.ct("+"+t[i])),s.push(r)}for(var i=0,a=e.length;i<a;++i)if(-1==$WH.in_array(t,e[i])){var r=$WH.ce("span");r.className="q10",$WH.ae(r,$WH.ct("-"+e[i])),s.push(r)}return s},custom:function(e,t,s){return s?(s=s.bind(this))(t,e):{}}};for(var i in this.traits)if(i=this.traits[i],i.id&&i.type){var a=s[i.type].bind(this),r=i.calcDifference;e.difference[i.id]=a(t.total[i.id],e.total[i.id],r)}},resetAll:function(){this.groups=[],this.weights=[],this.refreshAll()},refreshAll:function(){this.updateGroups(),this.updateTraits(),this.updateColumns(),this.updateVisibility(),this.refreshHeader(),this.refreshRows(),this.refreshLink(),this.refreshSort(),this.autoSave?this.saveComparison(0):this.editable&&!$WH.Browser.ie&&(window.onbeforeunload=function(e){return LANG.message_savebeforeexit})},refreshHeader:function(){for(this.groups.length&&"thead"!=this.thead.nodeName.toLowerCase()&&(this.thead=$WH.ce("thead"),$WH.ae(this.table,this.thead));this.thead.firstChild;)this.thead.removeChild(this.thead.firstChild);this.dragHeaders=[],this.dragIcons=[],this.dragTargets=[],this.selectLevel=$WH.ce("div"),this.selectLevel.style.display="none";var e=$WH.ce("tr");if(!this.groups.length){var t=$WH.ce("th");return $WH.ae(e,t),$WH.ae(this.thead,e),void this.showNoData(t)}for(var s=0,i=0,a=this.visibility.length;i<a;++i){var r=this.visibility[i],n=this.columns[r],t=$WH.ce("th");if("total"==n.id?t.style.verticalAlign="middle":"name"==n.id?t.style.verticalAlign="bottom":t.style.verticalAlign="top",n.__th=t,t.__col=n,null!=n.width&&(t.style.width=n.width),null!=n.align&&(t.style.textAlign=n.align),null!=n.span&&(t.colSpan=n.span),null!=this.selected&&this.__selected.id==n.id&&(t.className="checked"),"name"==n.id){$WH.ae(t,this.selectLevel);var o=$WH.ce("select");o.onchange=function(e){this.level=e.options[e.selectedIndex].value,this.refreshAll()}.bind(this,o);for(var i=80;i>0;--i){var l=$WH.ce("option");i==this.level&&(l.selected=!0),$WH.st(l,i),$WH.ae(o,l)}$WH.ae(this.selectLevel,$WH.ct(LANG.su_level+" ")),$WH.ae(this.selectLevel,o)}if(n.group){if(this.dragTargets.push(t),this.editable){var c=$WH.ce("div");c.className="summary-group",f=$WH.ce("div"),f.className="summary-group-controls";var h=$WH.ce("a");if(h.href="javascript:;",h.className="summary-group-dropdown",$WH.ae(h,$WH.ce("span")),h.menu=[[0,LANG.su_export,"?compare="+this.getGroupData(s),null,{newWindow:!0}]],this.viewableIn3d(n)&&h.menu.push([0,LANG.su_viewin3d,this.viewIn3d.bind(this,n)]),n.group.length>1&&h.menu.push([0,LANG.su_split,this.splitColumn.bind(this,n)]),this.enhanceable&&this.hasEnhancements(n.group)&&h.menu.push([0,LANG.pr_menu_clearenh,this.clearEnhancements.bind(this,n)]),Menu.add(h,h.menu,{showAtCursor:!0}),$WH.ae(f,h),this.groups.length>1){h=$WH.ce("a"),h.href="javascript:;",h.className="summary-group-focus";var o=$WH.ce("span");h.onclick=this.selectColumn.bind(this,n),this.selected&&this.__selected.id==n.id?(h.onmouseover=function(){$WH.Tooltip.show(this,LANG.tooltip_removefocus,0,0,"q")},o.className="selected"):h.onmouseover=function(){$WH.Tooltip.show(this,LANG.tooltip_setfocus,0,0,"q")},h.onmousemove=$WH.Tooltip.cursorUpdate,h.onmouseout=$WH.Tooltip.hide,$WH.ae(h,o),$WH.ae(f,h)}h=$WH.ce("a"),h.href="javascript:;",h.className="summary-group-delete",h.onclick=this.deleteColumn.bind(this,n),$WH.ae(h,$WH.ce("span")),$WH.ae(f,h),this.draggable&&(h=$WH.ce("a"),h.href="javascript:;",h.className="summary-group-drag",$WH.ae(h,$WH.ce("span")),$WH.ae(f,h),c.__col=n,c._handle=h,this.dragHeaders.push(c)),$WH.ae(c,f),$WH.ae(t,c),this.draggable&&this.groups.length>1&&(c.style.minWidth="80px")}var u=n.group.length,d=1,p=3,m=44;u>3&&(d=0,p=5,m=26);var c=$WH.ce("div");c.style.margin="0 auto",c.style.clear="both";var g=$WH.ce("div"),f=c.cloneNode(!0);this.editable&&(g.className="summary-group-bottom");for(var W=0;W<u;++W){W%p==0&&(f.style.width=m*p+"px",f=c.cloneNode(!0),$WH.ae(g,f));var $=g_items.createIcon(n.group[W][0],d);$.__col=n,$.i=W,this.enhanceable&&this.refreshItem(n,W,Icon.getLink($)),this.dragIcons.push($),$WH.ae(f,$)}n.group.length&&(f.style.width=m*(u%p==0?p:u%p)+"px"),$WH.ae(g,f),this.editable?(t.style.padding="0",f=$WH.ce("div"),f.className="clear",$WH.ae(g,f),f=$WH.ce("div"),f.className="clear",$WH.ae(t.firstChild,f),$WH.ae(t.firstChild,g)):$WH.ae(t,g),s++}else if(n.name){var H=$WH.ce("b");$WH.ae(H,$WH.ct(n.name)),$WH.ae(t,H)}this.editable&&r==this.newgroup&&this.dragTargets.push(t),$WH.ae(e,t)}$WH.ae(this.thead,e),this.draggable&&this.updateDraggable()},refreshItem:function(e,t,s){var i=e.group[t],a=i[0],r=[],n=this.hasExtraSocket(i);if(null!=g_items[a].jsonequip.subitems&&r.push([0,i[1]?LANG.pr_menu_repsubitem:LANG.pr_menu_addsubitem,this.openSubitemPicker.bind(this,e,t)]),this.canBeEnchanted(g_items[a].jsonequip.slotbak,g_items[a].jsonequip.subclass)){var o=[0,i[2]?LANG.pr_menu_repenchant:LANG.pr_menu_addenchant,this.openEnchantPicker.bind(this,e,t),null,{}];i[2]&&g_enchants[i[2]]&&(o[4].tinyIcon=g_enchants[i[2]].icon),r.push(o)}if(g_items[a].jsonequip.nsockets||n)for(var l=0,c=(0|g_items[a].jsonequip.nsockets)+n;l<c;++l){var h=i[l+4]>0?i[l+4]:0,u=n&&l==c-1?14:g_items[a].jsonequip["socket"+(l+1)],o=[0,h?LANG.pr_menu_repgem:LANG.pr_menu_addgem,this.openGemPicker.bind(this,e,t,4+l,u),null,{}];h?o[4].tinyIcon=g_gems[h].icon:o[4].socketColor=u,r.push(o)}if(this.canBeSocketed(g_items[a].jsonequip.slotbak)){var o=[0,LANG.pr_menu_extrasock,Summary.toggleExtraSocket.bind(this,e,t,s)];o.checked=n,r.push(o)}this.hasEnhancements([i])&&r.push([0,LANG.pr_menu_clearenh,this.clearEnhancements.bind(this,e,t)]),r.push([0,LANG.pr_menu_remove,this.removeItem.bind(this,e.group,t)]),s.rel=this.getItemRel(i,e),s.oncontextmenu=$WH.rf,s.onclick=this.onMouseClick.bind(0,s),s.onmouseup=this.onMouseUp,s.menu=r},removeItem:function(e,t){e.splice(t,1),this.refreshAll()},refreshRows:function(){for(this.groups.length&&$WH.ae(this.table,this.tbody);this.tbody.firstChild;)this.tbody.removeChild(this.tbody.firstChild);this.selectLevel.style.display="none";for(var e=0,t=this.visibility.length;e<t;++e){var s=this.visibility[e],i=this.columns[s];if(i.group)for(var a=0,r=i.group.length;a<r;++a){var n=i.group[a][0];if(g_items[n].jsonequip.scadist&&g_items[n].jsonequip.scaflags){this.selectLevel.style.display="";break}}}var e=0;for(trait in this.traits)this.traits[trait].id&&(this.traits[trait].i=++e),$WH.ae(this.tbody,this.getRow(trait,e));if(!e){!this.groups.length&&this.tbody.parentNode&&$WH.de(this.tbody);var o=$WH.ce("tr"),l=$WH.ce("td"),c=$WH.ce("span");this.visibility&&this.visibility.length&&(l.colSpan=this.visibility.length),l.style.textAlign="center",$WH.ae(c,$WH.ct("The items in this set don't have any comparable stats.")),$WH.ae(l,c),$WH.ae(o,l),$WH.ae(this.tbody,o)}},getLink:function(e,t,s,i){var a="?compare";return e&&(a+="="+e,80!=s&&(a+="&l="+s),t[1].length&&t[2].length&&(a+="&weights="+t.join(";")),void 0!==i&&(a+="&focus="+i)),a},refreshLink:function(){var e=$WH.ge("su_link"),t=this.getGroupData(),s=this.getWeightData();if(this.editable&&t?this.itemTip.style.display="":this.itemTip.style.display="none",e){var i=this.getLink(t,s,this.level,this.selected?this.__selected.i:void 0);e.href=i,e.target="_blank"}},refreshSort:function(e){if(!this.sortWeighted){var t=$WH.ce("small");t.style.display="none";var s=$WH.ce("span");s.style.padding="0 8px",s.style.color="white",$WH.ae(s,$WH.ct("|")),$WH.ae(t,s),$WH.ae(t,$WH.ct(LANG.pr_note_sort+" "));var i=$WH.ce("select");$WH.ae(t,i),this.sortWeighted=t}var i=$WH.gE(this.sortWeighted,"select")[0],a=$WH.ce("option");if($WH.ee(i),$WH.ae(i,a),this.weights&&this.weights.length)for(var r=0,n=this.weights.length;r<n;++r)a=$WH.ce("option"),a.scale=this.weights[r],a.selected=a.scale==this.currentScale,$WH.st(a,this.weights[r].name),$WH.ae(i,a);this.sortWeighted.style.display=i.childNodes.length>1?"":"none",e&&($WH.ae($WH.ce("div"),this.sortWeighted),$WH.gE(this.sortWeighted,"span")[0].style.display=$WH.gE(e.getNoteTopDiv(),"small").length?"":"none",$WH.ae(e.getNoteTopDiv(),this.sortWeighted),i.onchange=this.sortPickerWindow.bind(this,e,1),i.onchange())},refreshClasses:function(e){for(var t=e.options[e.selectedIndex],s=$WH.ge("su_presets");s.firstChild;)$WH.de(s.firstChild);if($WH.ae(s,$WH.ce("option")),e.selectedIndex>0){for(var i in t._presets){var a=t._presets[i];if(null!=LANG.presets[i]){var r=$WH.ce("optgroup");r.label=LANG.presets[i]}else r=s;for(var n in a){var o=$WH.ce("option");o.value=n,o._weights=a[n],$WH.ae(o,$WH.ct(a[n].name?a[n].name:LANG.presets[n])),$WH.ae(r,o)}null!=LANG.presets[i]&&r&&r.childNodes.length>0&&$WH.ae(s,r)}s.childNodes.length>1&&(s.parentNode.style.display="")}else s.parentNode.style.display="none";this.resetWeights()},refreshPresets:function(e){this.resetWeights();var t=$WH.ge("su_classes"),s=e.options[e.selectedIndex];if(e.selectedIndex>0&&(this.updateWeights(s._weights),$WH.ge("su_scale").value=(-1!=t.options[t.selectedIndex].value?t.options[t.selectedIndex].text+LANG.hyphen:"")+s.text),g_user.id>0){$WH.ge("su_remscale").style.display=s._weights&&s._weights.name?"":"none"}},resetWeights:function(){var e=$WH.ge("su_weight");for($WH.ge("su_scale").value="";e.childNodes.length>=2;)e.removeChild(e.childNodes[1]);for(var t=e.childNodes[0];t.childNodes.length>1;)t.removeChild(t.childNodes[1]);t.firstChild.selectedIndex=0;var s=$WH.ge("su_addweight");e.childNodes.length<15&&(s.style.display="")},refreshWeights:function(e,t){for(var s=e.parentNode;s.childNodes.length>1;)$WH.de(s.childNodes[1]);if(e.selectedIndex>0){$WH.ae(s,$WH.ct(" "));var i=$WH.ce("input");i.type="text",i.value=0|t,i.maxLength=7,i.style.textAlign="center",i.style.width="4.5em",i.setAttribute("autocomplete","off"),i.onchange=this.sortWeights.bind(this,i),$WH.ae(s,i),this.sortWeights(i)}1==s.parentNode.childNodes.length?e.selectedIndex>0&&($WH.ae(s,$WH.ct(String.fromCharCode(160,160))),$WH.ae(s,this.createControl(LANG.ficlear,"","",this.resetWeights.bind(this)))):s.parentNode.childNodes.length>1&&($WH.ae(s,$WH.ct(String.fromCharCode(160,160))),$WH.ae(s,this.createControl(LANG.firemove,"","",this.deleteWeight.bind(this,e))))},sortWeights:function(e){for(var t=$WH.ge("su_weight"),s=Number(e.value),i=e.parentNode,a=0,r=0,n=t.childNodes.length;r<n;++r){var o=t.childNodes[r];if(5==o.childNodes.length&&"SELECT"==o.childNodes[0].tagName&&"INPUT"==o.childNodes[2].tagName){if(s>Number(o.childNodes[2].value))return void t.insertBefore(i,o);++a}}a<n?t.insertBefore(i,t.childNodes[a]):$WH.ae(t,i)},saveComparison:function(e){window.onbeforeunload=null,g_setWowheadCookie("compare_groups",this.getGroupData(),!0),g_setWowheadCookie("compare_weights",$WH.rtrim(this.getWeightData(1).join(";"),";"),!0),g_setWowheadCookie("compare_level",this.level,!0),e&&(document.location.href="?compare")},viewSavedComparison:function(e){window.onbeforeunload=null,document.location.href="?compare"},getGroupData:function(e){var t=0,s=this.groups.length;isNaN(e)||(t=e,s=e+1);for(var i="",a=0,r=t;r<s;++r)if(!(this.groups[r].length<1)){a++>0&&(i+=";");for(var a=0,n=this.groups[r].length;a<n;++a)a>0&&(i+=":"),i+=this.writeItem(this.groups[r][a])}return i},getWeightData:function(e){for(var t,s="",i="",a="",r=0,n=this.weights.length;r<n;++r){r>0&&(i+=";",a+=";",s+=";"),s+=e?this.weights[r].name:$WH.urlencode(this.weights[r].name);var o=0;for(var l in this.weights[r])LANG.traits[l]&&(t=fi_Lookup(l,"items"))&&(o++>0&&(i+=":",a+=":"),i+=t.id,a+=this.weights[r][l])}return[s,i,a]},showNoData:function(e){for(var t=this.textNames;t.firstChild;)$WH.de(t.firstChild);for(t.style.display="none",t=this.noData;t.firstChild;)$WH.de(t.firstChild);$WH.ae(e,t);var s=-1;this.template.onNoData&&(s=this.template.onNoData.bind(this,t)()),-1==s&&$WH.ae(t,$WH.ct(LANG.su_additems||LANG.lvnodata))},showTextNames:function(){var e=this.textNames;for(e.style.display="",e.style.paddingTop="10px";e.firstChild;)$WH.de(e.firstChild);$WH.ae(e,$WH.ct(LANG.su_comparing));for(var t=0,s=0,i=this.visibility.length;s<i;++s){var a=this.visibility[s],r=this.columns[a];if(r.group&&r.group.length)if(t++>0&&$WH.ae(e,$WH.ct(LANG.su_comparewith)),1==r.group.length){var n=g_items[r.group[0][0]].jsonequip,o=$WH.ce("a");o.className="q"+(7-parseInt(n.name.charAt(0))),o.href="?item="+n.id,o.rel=this.getItemRel(r.group[0],r),$WH.ae(o,$WH.ct("["+this.getItemName(r.group[0])+"]")),$WH.ae(e,o)}else{var l=$WH.ce("span");l.onmouseover=Summary.groupOver.bind(o,r.group),l.onmousemove=$WH.Tooltip.cursorUpdate,l.onmouseout=$WH.Tooltip.hide,l.className="tip",$WH.ae(l,$WH.ct("["+r.group.length+" "+LANG.types[3][3]+"]")),$WH.ae(e,l)}}},updateControls:function(){if(null==this.__lastCtrlUpdate||!(this.__lastCtrlUpdate==this.groups.length||this.groups.length>1)){this.__lastCtrlUpdate=this.groups.length;var e,t=this.controls;for(t.style.display="";t.firstChild;)$WH.de(t.firstChild);var s=$WH.ce("div");s.className="summary-controls-right",$WH.ae(t,s),e=this.createControl(LANG.su_help,null,"icon-help",null,"?help=item-comparison"),e.target="_blank",$WH.ae(s,e),this.searchable&&(e=this.createControl(LANG.su_addset,"su_addset","icon-add",this.openItemPicker.bind(this,4)),$WH.ae(s,e),e=this.createControl(LANG.su_additem,"su_additem","icon-add",this.openItemPicker.bind(this,3)),$WH.ae(s,e)),this.groups.length&&this.weightable&&(e=this.createControl(LANG.su_addscale,"su_addscale","icon-add",this.toggleOptions.bind(this,"su_weights","su_addscale")),$WH.ae(s,e)),$WH.aE(document,"click",this.toggleOptions.bind(this,null,null));var i=$WH.ce("div");if(i.className="clear",$WH.ae(s,i),this.weightable){var a=$WH.ce("div"),r=$WH.ce("div");a.style.display="none",a.id="su_weights",r.className="summary-weights-inner",$WH.ae(a,r),$WH.ae(s,a);var n=$WH.ce("table"),o=$WH.ce("tbody"),l=$WH.ce("tr"),c=$WH.ce("td");$WH.ae(n,o),$WH.ae(o,l),$WH.ae(l,c),$WH.ae(c,$WH.ct(LANG.su_preset)),c=$WH.ce("td"),$WH.ae(l,c);var h=$WH.ce("select");if(h.id="su_classes",h.onchange=h.onkeyup=this.refreshClasses.bind(this,h),$WH.ae(h,$WH.ce("option")),$WH.ae(c,h),null!=g_user.weightscales&&g_user.weightscales.length){var u=$WH.ce("option");u.value=-1,u._presets={custom:{}},$WH.ae(u,$WH.ct(LANG.ficustom)),$WH.ae(h,u);for(var d=0,p=g_user.weightscales.length;d<p;++d)u._presets.custom[g_user.weightscales[d].id]=g_user.weightscales[d]}var m=[];for(var g in wt_presets)m.push(g);m.sort(function(e,t){return $WH.strcmp(g_chr_classes[e],g_chr_classes[t])});for(var d=0,p=m.length;d<p;++d){var g=m[d],u=$WH.ce("option");u.value=g,u._presets=wt_presets[g],$WH.ae(u,$WH.ct(g_chr_classes[g])),$WH.ae(h,u)}i=$WH.ce("span"),i.style.display="none",$WH.ae(i,$WH.ct(" ")),$WH.ae(c,i),h=$WH.ce("select"),h.id="su_presets",h.onchange=h.onkeyup=this.refreshPresets.bind(this,h),$WH.ae(h,$WH.ce("option")),$WH.ae(i,h),$WH.ae(c,$WH.ct(" ")),e=$WH.ce("a"),e.href="javascript:;",$WH.ae(e,$WH.ct(LANG.fishowdetails)),e.onclick=this.showDetails.bind(this,e),$WH.ae(c,e),g_user.id>0&&($WH.ae(c,$WH.ct(" ")),e=$WH.ce("a"),e.href="javascript:;",e.className="icon-save",e.appendChild($WH.ct(LANG.fisavescale)),e.onclick=this.saveScale,e.onmousedown=$WH.rf,$WH.ae(c,e),$WH.ae(c,$WH.ct(" ")),e=$WH.ce("a"),e.href="javascript:;",e.id="su_remscale",e.className="icon-delete",e.style.display="none",e.appendChild($WH.ct(LANG.fideletescale)),e.onclick=this.deleteScale,e.onmousedown=$WH.rf,$WH.ae(c,e)),l=$WH.ce("tr"),c=$WH.ce("td"),$WH.ae(o,l),$WH.ae(l,c),$WH.ae(c,$WH.ct(LANG.su_name)),c=$WH.ce("td"),$WH.ae(l,c);var d=$WH.ce("input");d.type="text",d.id="su_scale",$WH.ae(c,d),$WH.ae(c,$WH.ct(" ")),$WH.ae(r,n);var f=$WH.ce("div");f.style.display="none",f.id="su_weight",$WH.ae(r,f),i=$WH.ce("div"),$WH.ae(f,i),h=$WH.ce("select"),h.onchange=h.onkeyup=this.refreshWeights.bind(this,h),$WH.ae(h,$WH.ce("option")),$WH.ae(i,h),i=!1;for(var d=0,p=this.template.traits.length;d<p;++d){var W=this.template.traits[d];if("sep"==W.type)i&&i.childNodes.length>0&&$WH.ae(h,i),i=$WH.ce("optgroup"),i.label=LANG.traits[W.id]?LANG.traits[W.id]:W.name;else if("custom"!=W.type){var u=$WH.ce("option");u.value=W.id,$WH.ae(u,$WH.ct((W.indent?"- ":"")+(LANG.traits[W.id]?LANG.traits[W.id][0]:W.name))),$WH.ae(i,u)}}i&&i.childNodes.length>0&&$WH.ae(h,i),i=$WH.ce("div"),i.style.display="none",e=this.createControl(LANG.su_addweight,"su_addweight","",this.addWeight.bind(this)),$WH.ae(i,e),$WH.ae(r,i),i=$WH.ce("div"),i.className="summary-weights-buttons",e=$WH.ce("a"),e.className="icon-help",e.href="?help=stat-weighting",e.target="_blank",e.style.border="none",e.style.cssFloat=e.style.styleFloat="right",$WH.ae(e,$WH.ct(LANG.su_help)),$WH.ae(i,e),d=$WH.ce("input"),d.type="button",d.value=LANG.su_applyweight,d.onclick=Summary.addWeightScale.bind(this),$WH.ae(i,d),$WH.ae(i,$WH.ct(" ")),d=$WH.ce("input"),d.type="button",d.value=LANG.su_resetweight,d.onclick=Summary.resetScale.bind(this),$WH.ae(i,d),$WH.ae(r,i)}this.autoSave?e=this.createControl(LANG.su_autosaving,null,"icon-refresh selected"):(g_getWowheadCookie("compare_groups")&&(e=this.createControl(LANG.su_viewsaved,"su_viewsaved","icon-save",this.viewSavedComparison.bind(this,1)),$WH.ae(t,e)),e=this.createControl(LANG.su_savecompare,"su_save","icon-save",this.saveComparison.bind(this,1))),$WH.ae(t,e),this.groups.length&&(e=this.createControl(LANG.su_linkcompare,"su_link","icon-link"),$WH.ae(t,e),e=this.createControl(LANG.su_clear,null,"icon-delete",this.resetAll.bind(this)),$WH.ae(t,e))}},getRow:function(e){var t=this.traits[e];return this.createRow(t),t.__tr},createRow:function(e){var t=$WH.ce("tr");e.__tr=t;for(var s=0,i=this.visibility.length;s<i;++s){var a=this.visibility[s],r=this.columns[a],n=$WH.ce("td"),o=n;if(null!=r.align&&(n.style.textAlign=r.align),(null!=this.total&&this.__total.id==r.id||null!=this.selected&&this.__selected.id==r.id)&&"gains"!=e.id&&(n.style.fontWeight="bold",n.className+="q1",null!=this.selected&&this.__selected.id==r.id&&(n.className+=" checked")),!e.type){o.colSpan=i,o.style.borderBottomWidth="2px",o.style.padding="0",$WH.ae(t,n);break}var l=null,c="";if(r.compute)l=r.compute.bind(this,e,o,t,a)();else if(e.compute)l=e.compute.bind(this,r,o,t,a)();else if(r.total&&(null!=this.selected&&this.__selected.id!=r.id&&r.difference?(l=r.difference[e.id],l>0?o.className+=" q2":l<0?o.className+=" q10":0==l&&(l=null)):l=r.total[e.id],null!=l))if(l.join){
for(var h=0,u=l.length;h<u;++h)h>0&&$WH.ae(o,$WH.ct(", ")),l[h].appendChild?$WH.ae(o,l[h]):$WH.ae(o,$WH.ct(l[h]));l=null}else if(!isNaN(l)){var d=Math.pow(10,null!=e.digits?e.digits:4);l=Math.round(d*l)/d,l>0&&null!=this.selected&&this.__selected.id!=r.id&&(c="+"),e.rating?this.selectLevel.style.display="":l=(l<0?"-":"")+$WH.number_format(Math.abs(l))}if(this.groups.length>1&&!this.selected&&r.total&&r.total[e.id]==this.maxValue[e.id]&&this.maxValue[e.id]!=this.minValue[e.id]&&"total"!=r.id&&(o.style.fontWeight="bold",o.className+=" q2"),null!=l)if(e.rating&&!isNaN(l)){var p=(l<0?-1:1)*$WH.g_convertRatingToPercent(this.level,e.rating,Math.abs(l));p=$WH.number_format(Math.round(100*p)/100),12!=e.rating&&37!=e.rating&&(p+="%");var m=$WH.ce("a");m.className=o.className?o.className:"q1",m.style.borderBottom="1px dotted #808080",m.onmouseover=function(e,t,s,i){$WH.Tooltip.show(this,e+" "+i+" ("+$WH.sprintf(LANG.tooltip_combatrating,t,s)+')<br /><span class="q2">'+LANG.su_toggle+"</span>",0,0,"q")}.bind(m,l,p,this.level,LANG.traits[e.id][0]),m.onmousemove=$WH.Tooltip.cursorUpdate,m.onmouseout=$WH.Tooltip.hide,m.onclick=this.toggleRatings.bind(this),$WH.ae(m,$WH.ct(c+(this.ratingMode?p:l))),$WH.aef(o,m)}else $WH.aef(o,$WH.ct(c+l));e.hidden||$WH.ae(t,n)}},toggleOptions:function(e,t,s){if((s=$WH.$E(s))&&s._button>=2)return!1;var i=[$WH.ge("su_weights")],a=[$WH.ge("su_addscale")],r=null;if(!$WH.Browser.ie||!s||e||-1==$WH.in_array(a,s._target)){if(t&&(t=$WH.ge(t)),e&&t)-1!=t.className.indexOf("selected")?t=null:r=$WH.ge(e);else if(s){var n=s._target;if(!n.parentNode)return;for(;n.parentNode;){if(-1!=$WH.in_array(i,n))return!1;n=n.parentNode}}for(var o=0,l=i.length;o<l;++o)i[o]&&i[o]!=r&&(i[o].style.display="none");for(var o=0,l=a.length;o<l;++o)a[o]&&a[o]!=t&&(a[o].className=a[o].className.replace("selected",""));t&&(t.className+=" selected",r&&(r.style.display="")),s&&e&&t&&$WH.sp(s)}},toggleWeights:function(){++this.scoreMode>2&&(this.scoreMode=0),this.refreshAll()},toggleRatings:function(){this.ratingMode=!this.ratingMode,this.refreshAll()},createControl:function(e,t,s,i,a){var r=$WH.ce("a");return a?(r.href=a,r.target="_blank"):r.href="javascript:;",t&&(r.id=t),s&&(r.className=s),i&&(r.onclick=i),$WH.ae(r,$WH.ct(e)),r},createColumn:function(){this.groups.push([this.readItem(-1)]),this.refreshAll()},selectColumn:function(e){$WH.Tooltip.hide(),this.selected=this.__selected.id==e.id?null:this.clone.i+e.i,this.refreshAll()},deleteColumn:function(e,t){return $WH.Tooltip.hide(),t=$WH.$E(t),t.shiftKey?this.groups=[this.groups[e.i]]:this.groups.splice(e.i,1),!this.editable||this.groups.length<=1||this.__selected.id==e.id?this.selected=null:this.selected&&(this.selected+=this.clone.i+e.i>this.selected?0:-1),this.refreshAll(),!1},createWeightScale:function(){var e=$WH.ge("su_weight"),t=$WH.ge("su_scale"),s={},i=!1;s.name=t.value,s.name=$WH.trim(s.name),s.name=s.name.replace(/'/g,"");for(var a=0,r=e.childNodes.length;a<r;++a)5==e.childNodes[a].childNodes.length&&"SELECT"==e.childNodes[a].childNodes[0].tagName&&"INPUT"==e.childNodes[a].childNodes[2].tagName&&(s[e.childNodes[a].childNodes[0].options[e.childNodes[a].childNodes[0].selectedIndex].value]=Number(e.childNodes[a].childNodes[2].value),i=!0);return i?s:null},deleteWeightScale:function(e){if($WH.Tooltip.hide(),this.weights.splice(e,1),!this.weights.length){var t=$WH.ge("enchants-default-sort");t&&t.onclick()}this.refreshAll()},calcScores:function(e,t){for(var s=0,i=e.length;s<i;++s){var a=e[s];if(a.__tr=null,a.score=t?0:null,a.jsonequip&&t){for(var r in t)LANG.traits[r]&&(isNaN(a.jsonequip[r])||(a.score+=a.jsonequip[r]*t[r]/(this.scoreMode?2==this.scoreMode?.01*t.m:1:t.f)));this.scoreMode?2==this.scoreMode&&(a.score=a.score.toFixed(1)+"%"):a.score=a.score.toFixed(2)}}return e},sortPickerWindow:function(e,t){this.sortWeighted&&($("option:selected",this.sortWeighted)[0]&&(this.currentScale=$("option:selected",this.sortWeighted)[0].scale),e.setSort([1],!0,!1),e.setData(this.calcScores(e.data,this.currentScale)),this.currentScale&&e.setSort([2],!0,!1),t&&"items"==e.id&&this.onSearchKeyUp(0))},openItemPicker:function(e){this.searchType=e,Lightbox.show("compare",{onShow:this.onItemPickerShow.bind(this)})},createItemPickerNote:function(e){var t=$WH.ce("small"),s=$WH.ce("span");this.currentSearch="",this.searchTimer=0,$WH.ae(t,$WH.ct(LANG.su_note_name)),this.searchName=$WH.ce("input"),this.searchName.type="text",$WH.aE(this.searchName,"keyup",this.onSearchKeyUp.bind(this,333)),$WH.aE(this.searchName,"keydown",this.onSearchKeyDown.bind(this)),$WH.ae(t,this.searchName),this.searchMsg=s,this.searchMsg.style.fontWeight="bold",$WH.ae(t,this.searchMsg),$WH.ae(e,t)},getSetBonuses:function(e){for(var t={},s={},i={},a=0,r=e.length;a<r;++a){var n=e[a][0];if(g_items[n]){var o=g_items[n].jsonequip.itemset,l=g_itemsets[o];l&&(o=l.idbak,null==s[o]&&(s[o]={}),s[o][n]=1,i[o]=l)}}for(var o in s){var c=i[o],h=0;if(c.setbonus){for(var n in s[o])h++;for(var u in c.setbonus){if(u>h)break;for(var d in c.setbonus[u])null==t[d]&&(t[d]=0),t[d]+=c.setbonus[u][d]}}}return t},onItemPickerShow:function(e,t,s){Lightbox.setSize(800,564);var i;if(t){e.className="summary-picker listview";var a=$WH.ce("div"),r=$WH.ce("a"),n=$WH.ce("div");a.className="listview",$WH.ae(e,a),r=$WH.ce("a"),r.className="screenshotviewer-close",r.href="javascript:;",r.onclick=Lightbox.hide,$WH.ae(r,$WH.ce("span")),$WH.ae(e,r),n.className="clear",$WH.ae(e,n),i=new Listview({template:"compare",id:"items",parent:a,data:[],clip:{w:780,h:478},createNote:this.createItemPickerNote.bind(this)}),$WH.Browser.firefox?$WH.aE(i.getClipDiv(),"DOMMouseScroll",g_pickerWheel):i.getClipDiv().onmousewheel=g_pickerWheel}else i=g_listviews.items;var o=this.searchItems.bind(this),l=this.searchName;this.refreshSort(i),setTimeout(function(){o("",this.searchType),l.value="",l.focus()},1)},openSubitemPicker:function(e,t){this.currentItem={col:e,i:t,item:e.group[t]},Lightbox.show("subitempicker",{onShow:this.onSubitemPickerShow.bind(this)})},onSubitemPickerShow:function(e,t,s){Lightbox.setSize(800,564);var i,a=[],r=this.currentItem.item[0];for(var n in g_items[r].jsonequip.subitems){var o=g_items[r].jsonequip.subitems[n];o.id=n,o.item=r,o._summary=this,a.push(o)}if(t){e.className="summary-picker listview";var l=$WH.ce("div"),c=$WH.ce("a"),h=$WH.ce("div");l.className="listview",$WH.ae(e,l),c=$WH.ce("a"),c.className="screenshotviewer-close",c.href="javascript:;",c.onclick=Lightbox.hide,$WH.ae(c,$WH.ce("span")),$WH.ae(e,c),h.className="clear",$WH.ae(e,h),i=new Listview({template:"subitempicker",id:"subitems",parent:l,data:a}),$WH.Browser.firefox?$WH.aE(i.getClipDiv(),"DOMMouseScroll",g_pickerWheel):i.getClipDiv().onmousewheel=g_pickerWheel}else i=g_listviews.subitems,i.setData(a),i.clearSearch(),i.updateFilters(!0);this.refreshSort(i),setTimeout(function(){i.focusSearch()},1)},openEnchantPicker:function(e,t){this.currentItem={col:e,i:t,item:e.group[t]},Lightbox.show("enchantpicker",{onShow:this.onEnchantPickerShow.bind(this)})},createEnchantPickerNote:function(e){var t,s=$WH.ce("small");$WH.ae(s,$WH.ct(LANG.pr_note_source)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=this.filterEnchants.bind(this,t,0,null),$WH.ae(t,$WH.ct(LANG.pr_note_all)),g_setSelectedLink(t,"enchants0"),$WH.ae(s,t),$WH.ae(s,$WH.ct(LANG.comma)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=this.filterEnchants.bind(this,t,0,1),$WH.ae(t,$WH.ct(LANG.pr_note_items)),$WH.ae(s,t),$WH.ae(s,$WH.ct(LANG.comma)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=this.filterEnchants.bind(this,t,0,2),$WH.ae(t,$WH.ct(LANG.pr_note_profs)),$WH.ae(s,t),$WH.ae(e,s),s=$WH.ce("small");var i=$WH.ce("span");i.style.padding="0 8px",i.style.color="white",$WH.ae(i,$WH.ct("|")),$WH.ae(s,i),$WH.ae(s,$WH.ct(LANG.su_note_stats+": ")),t=$WH.ce("a"),t.href="javascript:;",t.onclick=this.filterEnchants.bind(this,t,1,null),$WH.ae(t,$WH.ct(LANG.pr_note_all)),g_setSelectedLink(t,"enchants1"),$WH.ae(s,t),$WH.ae(s,$WH.ct(LANG.comma)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=this.filterEnchants.bind(this,t,1,"sta"),$WH.ae(t,$WH.ct(LANG.traits.sta[0])),$WH.ae(s,t),$WH.ae(s,$WH.ct(LANG.comma)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=this.filterEnchants.bind(this,t,1,"str"),$WH.ae(t,$WH.ct(LANG.traits.str[0])),$WH.ae(s,t),$WH.ae(s,$WH.ct(LANG.comma)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=this.filterEnchants.bind(this,t,1,"agi"),$WH.ae(t,$WH.ct(LANG.traits.agi[0])),$WH.ae(s,t),$WH.ae(s,$WH.ct(LANG.comma)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=this.filterEnchants.bind(this,t,1,"int"),$WH.ae(t,$WH.ct(LANG.traits.int[0])),$WH.ae(s,t),$WH.ae(s,$WH.ct(LANG.comma)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=this.filterEnchants.bind(this,t,1,"spi"),$WH.ae(t,$WH.ct(LANG.traits.spi[0])),$WH.ae(s,t),$WH.ae(s,$WH.ct(LANG.comma)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=this.filterEnchants.bind(this,t,1,-1),$WH.ae(t,$WH.ct(LANG.su_note_other)),this.enchantStat=null,$WH.ae(s,t),$WH.ae(e,s)},canBeEnchanted:function(e,t){return(1==e||3==e||16==e||5==e||20==e||9==e||10==e||6==e||7==e||8==e||11==e||21==e||13==e||17==e||22==e||14==e||15==e||26==e||23==e)&&19!=t},isValidEnchant:function(e){if(e.none)return!0;var t=1<<g_items[this.currentItem.item[0]].jsonequip.slot-1;return e.slots&t&&(null==this.enchantSource||1==this.enchantSource&&e.source<0||2==this.enchantSource&&e.source>0)&&(null==this.enchantStat||-1==this.enchantStat&&!e.jsonequip.hasOwnProperty("sta")&&!e.jsonequip.hasOwnProperty("str")&&!e.jsonequip.hasOwnProperty("agi")&&!e.jsonequip.hasOwnProperty("int")&&!e.jsonequip.hasOwnProperty("spi")||e.jsonequip.hasOwnProperty(this.enchantStat))},filterEnchants:function(e,t,s){switch(t){case 0:this.enchantSource=s;break;case 1:this.enchantStat=s;break;default:return}return e&&"A"==e.nodeName&&g_setSelectedLink(e,"enchants"+t),g_listviews.enchants.updateFilters(!0),!1},onEnchantPickerShow:function(e,t,s){Lightbox.setSize(800,564);var i;if(t){e.className="summary-picker listview";var a=[],r=$WH.ce("div"),n=$WH.ce("a"),o=$WH.ce("div");a.push({none:1,__alwaysvisible:1,_summary:this});for(var l in g_enchants){var c={id:l,_summary:this};if($WH.cO(c,g_enchants[l]),"string"==typeof c.name)a.push(c);else for(var h=0,u=g_enchants[l].name.length;h<u;++h){var d=$WH.dO(c);d.name=c.name[h],d.source=c.source[h],d.slots=c.slots[h],a.push(d)}}r.className="listview",$WH.ae(e,r),n=$WH.ce("a"),n.className="screenshotviewer-close",n.href="javascript:;",n.onclick=Lightbox.hide,$WH.ae(n,$WH.ce("span")),$WH.ae(e,n),o.className="clear",$WH.ae(e,o),i=new Listview({template:"enchantpicker",id:"enchants",parent:r,data:a,createNote:this.createEnchantPickerNote.bind(this),customFilter:this.isValidEnchant.bind(this)}),$WH.Browser.firefox?$WH.aE(i.getClipDiv(),"DOMMouseScroll",g_pickerWheel):i.getClipDiv().onmousewheel=g_pickerWheel}else i=g_listviews.enchants,i.clearSearch(),i.updateFilters(!0);this.refreshSort(i),setTimeout(function(){i.focusSearch()},1)},openGemPicker:function(e,t,s,i){this.currentItem={col:e,i:t,item:e.group[t],socket:s,color:i},Lightbox.show("gempicker",{onShow:this.onGemPickerShow.bind(this)})},createGemPickerNote:function(e){var t,s=$WH.ce("small");$WH.ae(s,$WH.ct(LANG.pr_note_source)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=this.filterGems.bind(this,t,0,null),$WH.ae(t,$WH.ct(LANG.pr_note_all)),$WH.ae(s,t),$WH.ae(s,$WH.ct(LANG.comma)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=this.filterGems.bind(this,t,0,1),$WH.ae(t,$WH.ct(LANG.pr_note_bc)),$WH.ae(s,t),$WH.ae(s,$WH.ct(LANG.comma)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=this.filterGems.bind(this,t,0,2),$WH.ae(t,$WH.ct(LANG.pr_note_wotlk)),this.gemSource=2,g_setSelectedLink(t,"gems0"),$WH.ae(s,t),$WH.ae(e,s),s=$WH.ce("small");var i=$WH.ce("span");i.style.padding="0 8px",i.style.color="white",$WH.ae(i,$WH.ct("|")),$WH.ae(s,i),$WH.ae(s,$WH.ct(LANG.pr_note_color)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=this.filterGems.bind(this,t,1,null),$WH.ae(t,$WH.ct(LANG.pr_note_all)),$WH.ae(s,t),$WH.ae(s,$WH.ct(LANG.comma)),t=$WH.ce("a"),t.href="javascript:;",t.onclick=this.filterGems.bind(this,t,1,1),$WH.ae(t,$WH.ct(LANG.pr_note_match)),this.gemColor=1,g_setSelectedLink(t,"gems1"),$WH.ae(s,t),$WH.ae(e,s)},matchGemSocket:function(e,t){for(var s=1;s<=8;s*=2)if(t&s&&e&s)return!0;return!1},canBeSocketed:function(e){return 9==e||10==e||6==e},hasExtraSocket:function(e){return this.enhanceable&&(e[this.getExtraSocketPos(e[0])]?1:0)},getExtraSocketPos:function(e){return e&&g_items[e]?4+(0|g_items[e].jsonequip.nsockets):4},hasSocketBonus:function(e){var t=0;if(!g_items[e[0]]||!g_items[e[0]].jsonequip.nsockets)return!1;for(var s=0;s<3;++s)e[s+4]&&g_gems[e[s+4]]&&this.matchGemSocket(g_gems[e[s+4]].colors,g_items[e[0]].jsonequip["socket"+(s+1)])&&++t;return t==g_items[e[0]].jsonequip.nsockets},isValidGem:function(e){return!!e.none||(null==this.gemSource||e.expansion==this.gemSource)&&(1!=this.currentItem.color&&1!=e.colors&&null==this.gemColor||this.matchGemSocket(e.colors,this.currentItem.color))},filterGems:function(e,t,s){switch(t){case 0:this.gemSource=s;break;case 1:this.gemColor=s;break;default:return}return e&&"A"==e.nodeName&&g_setSelectedLink(e,"gems"+t),g_listviews.gems.updateFilters(!0),!1},onGemPickerShow:function(e,t,s){Lightbox.setSize(800,564);var i;if(t){e.className="summary-picker listview";var a=[],r=$WH.ce("div"),n=$WH.ce("a"),o=$WH.ce("div");a.push({none:1,__alwaysvisible:1,_summary:this});for(var l in g_gems){var c={id:l,_summary:this};$WH.cO(c,g_gems[l]),a.push(c)}r.className="listview",$WH.ae(e,r),n=$WH.ce("a"),n.className="screenshotviewer-close",n.href="javascript:;",n.onclick=Lightbox.hide,$WH.ae(n,$WH.ce("span")),$WH.ae(e,n),o.className="clear",$WH.ae(e,o),i=new Listview({template:"gempicker",id:"gems",parent:r,data:a,createNote:this.createGemPickerNote.bind(this),customFilter:this.isValidGem.bind(this)}),$WH.Browser.firefox?$WH.aE(i.getClipDiv(),"DOMMouseScroll",g_pickerWheel):i.getClipDiv().onmousewheel=g_pickerWheel}else i=g_listviews.gems,i.clearSearch(),i.updateFilters(!0);var h=i.getNoteTopDiv(),u=$WH.gE(h,"small");$WH.gE(h,"a");1==this.currentItem.color||14==this.currentItem.color?u[1].style.display="none":u[1].style.display="",this.refreshSort(i),setTimeout(function(){i.focusSearch()},1)},onMouseClick:function(e,t){if(t=$WH.$E(t),3==t._button||t.shiftKey||t.ctrlKey)return!1},onMouseUp:function(e){if(e=$WH.$E(e),3==e._button||e.shiftKey||e.ctrlKey){var t=$WH.g_getCursorPos(e);setTimeout(Menu.showAtXY.bind(null,this.menu,t.x,t.y),1),$WH.Tooltip.hide()}return!1},onSearchKeyUp:function(e){var t=$WH.trim(this.searchName.value.replace(/\s+/g," "));t==this.currentSearch&&isNaN(e)||(this.currentSearch=t,this.prepareSearch(t,e))},onSearchKeyDown:function(e){switch(e=$WH.$E(e),e.keyCode){case 13:g_listviews.items.submitSearch(e)}},prepareSearch:function(e,t){isNaN(t)&&(t=1e3),this.searchTimer>0&&(clearTimeout(this.searchTimer),this.searchTimer=0),e&&$WH.st(this.searchMsg,$WH.sprintf(LANG["su_searching"+this.searchType],e)),this.searchMsg.className="",this.searchTimer=setTimeout(this.searchItems.bind(this,e,this.searchType),t)},searchItems:function(search,type){var lv=g_listviews.items,_this=this,searchResults=[{none:1}];if(lv.searchable=!1,lv.setData(searchResults),lv.clearSearch(),lv.updateFilters(!0),this.searchMsg.className="",!search&&!this.currentScale)return void $WH.st(this.searchMsg,LANG["su_specifyitem"+this.searchType]);$WH.st(this.searchMsg,$WH.sprintf(LANG["su_searching"+this.searchType],search)),new Ajax("?search="+$WH.urlencode(search)+"&json&type="+type+pr_getScaleFilter(this.currentScale,1),{method:"POST",search:search,onSuccess:function(xhr,opt){var text=xhr.responseText;if("["==text.charAt(0)&&"]"==text.charAt(text.length-1)){var a=eval(text);if(search==opt.search&&3==a.length&&a[1].length){for(var i=0,len=a[1].length;i<len;++i){var row={};row.id=a[1][i].id,row.name=row["name_"+Locale.getName()]=a[1][i].name.substring(1),row.quality=7-a[1][i].name.charAt(0),row.icon=a[1][i].icon,row.level=a[1][i].level,row.classs=a[1][i].classs,row.subclass=a[1][i].subclass,row.jsonequip=$WH.dO(a[1][i]),row._type=3,row._summary=_this,g_items.add(a[1][i].id,row),_this.searchType==row._type&&searchResults.push(row)}for(var i=0,len=a[2].length;i<len;++i){var row={};row.id=a[2][i].id,row.name=row["name_"+Locale.getName()]=a[2][i].name.substring(1),row.quality=7-a[2][i].name.charAt(0),row.minlevel=a[2][i].minlevel,row.maxlevel=a[2][i].maxlevel,row.type=a[2][i].type,row.pieces=a[2][i].pieces,row.jsonequip={};for(var j=0,len2=row.pieces.length;j<len2;++j)if(g_items[row.pieces[j]]){var item=g_items[row.pieces[j]];for(var k in item.jsonequip)null!=LANG.traits[k]&&(row.jsonequip[k]||(row.jsonequip[k]=0),row.jsonequip[k]+=item.jsonequip[k])}row._type=4,row._summary=_this,_this.searchType==row._type&&searchResults.push(row)}lv.searchable=!0,$WH.ee(_this.searchMsg)}else $WH.st(_this.searchMsg,$WH.sprintf(LANG.su_noresults,opt.search)),_this.searchMsg.className="q10";lv.setData(searchResults),lv.clearSearch(),lv.updateFilters(!0),_this.sortPickerWindow(lv)}}})},ignoredSlots:{2:1,11:1,12:1,18:1,24:1,28:1},viewableIn3d:function(e){for(var t=0,s=e.group.length;t<s;++t){var i=g_items[e.group[t][0]].jsonequip;if(i.slotbak>0&&i.displayid>0&&!this.ignoredSlots[i.slotbak])return!0}return!1},viewIn3dFromPound:function(e){var t=0|parseInt(e);t>=0&&t<this.groups.length&&this.viewIn3d(this.columns[this.clone.i+t])},viewIn3d:function(e){for(var t=[],s=0,i=e.group.length;s<i;++s){var a=g_items[e.group[s][0]].jsonequip;a.slotbak>0&&a.displayid>0&&!this.ignoredSlots[a.slotbak]&&(t.push(a.slotbak),t.push(a.displayid))}ModelViewer.show({type:4,typeId:9999,equipList:t,extraPound:e.i,noPound:this.autoSave?1:null})},splitColumn:function(e){this.groups.splice(e.i,1);for(var t=0,s=e.group.length;t<s;++t)this.groups.splice(e.i,0,[e.group[t]]);this.refreshAll()},hasEnhancements:function(e){for(var t=0,s=e.length;t<s;++t)for(var i=1;i<8;++i)if(0!=e[t][i])return!0;return!1},clearEnhancements:function(e,t){var s=0,i=e.group.length;isNaN(t)||(s=t,i=t+1);for(var a=s;a<i;++a)e.group[a]=this.readItem(e.group[a][0]+"."+e.group[a][1]);this.refreshAll()},readGroups:function(e){if(e)for(var t=e.split(";"),s=0,i=t.length;s<i;++s){for(var a=[],r=t[s].split(":"),n=0,o=r.length;n<o;++n){var l=this.readItem(r[n]);g_items[l[0]]&&a.push(l)}a.length&&this.groups.push(a)}},readItem:function(e){e+="";for(var t=e.split(".",8);t.length<8;)t.push(0);for(var s=0;s<8;++s)t[s]=parseInt(t[s]);return t},writeItem:function(e){return e[0]?e.join(".").replace(/(\.0)+$/,""):""},getItemName:function(e){if(g_items[e[0]]){var t=g_items[e[0]].jsonequip.name.substr(1);return g_items[e[0]].jsonequip.subitems&&g_items[e[0]].jsonequip.subitems[e[1]]&&(t+=" "+g_items[e[0]].jsonequip.subitems[e[1]].name),t}},getItemRel:function(e,t){if(g_items[e[0]]){var s=this.hasExtraSocket(e),i=[],a=[],r=[];e[1]&&i.push("rand="+e[1]),e[2]&&i.push("ench="+e[2]);for(var n=0,o=(0|g_items[e[0]].jsonequip.nsockets)+s;n<o;++n)a.push(e[4+n]>0?e[4+n]:0);if(a.length&&i.push("gems="+a.join(":")),s&&i.push("sock"),g_items[e[0]].jsonequip.itemset){for(var n=0,o=t.group.length;n<o;++n){var l=t.group[n][0];g_items[l]&&g_items[l].jsonequip.itemset&&r.push(l)}i.push("pcs="+r.join(":"))}this.level<80&&i.push("lvl="+this.level);var c=i.join("&");return c&&(c="&"+c),c}},readWeights:function(e){if(e){var t=e.split(";"),s=parseInt(t.length/3);if(s>0)for(var i=0;i<s;++i){var a=t[i],r=t[i+s].split(":"),n=t[i+2*s].split(":");if(r.length>0&&r.length==n.length){for(var o={name:a},l=!1,c=0,h=r.length;c<h;++c){var u=fi_Lookup(r[c],"items");u&&"num"==u.type&&(o[u.name]=parseInt(n[c]),l=!0)}l&&this.weights.push(o)}}}}},Summary.dragGroup=function(e,t,s){t.style.width=s.offsetWidth+"px"},Summary.moveGroup=function(e,t,s,i){if(t.__col.group.length){var a,r=[];if($WH.cO(r,this.groups[t.__col.i]),!s)return void(confirm(LANG.message_deletegroup)&&this.deleteColumn(t.__col,e));if(i&&null!=this.newgroup&&s.__col.id==this.columns[this.newgroup].id)a=this.groups.length-1;else{if(!i||s.__col.id==t.__col.id)return;a=s.__col.i}e.shiftKey||(null!=this.selected&&this.clone.i+t.__col.i<=this.selected&&this.selected--,this.groups.splice(t.__col.i,1)),this.__selected.id==t.__col.id?this.selected=this.clone.i+a:null!=this.selected&&this.clone.i+a<=this.selected&&this.selected++,this.groups.splice(a,0,r),this.refreshAll()}},Summary.moveGroupItem=function(e,t,s){if(t.__col.group.length){var i=[];if($WH.cO(i,t.__col.group[t.i]),!s||s.__col.group&&!s.__col.group.length)return void(confirm($WH.sprintf(LANG.message_deleteitem,g_items[t.__col.group[t.i][0]].jsonequip.name.substring(1)))&&(t.__col.group.splice(t.i,1),this.refreshAll()));if(null!=this.newgroup&&s.__col.id==this.columns[this.newgroup].id)this.groups.push([i]);else if(s.__col.id!=t.__col.id)s.__col.group.push(i);else{if(!e.shiftKey)return;t.__col.group.push(i)}e.shiftKey||t.__col.group.splice(t.i,1),this.refreshAll()}},Summary.addGroupItem=function(e,t){if(3==e)this.groups.push([this.readItem(t.id)]);else if(4==e){var s=[];for(var i in g_items)g_items[i].jsonequip&&g_items[i].jsonequip.itemset==t.id&&s.push(this.readItem(i));this.groups.push(s)}if(this.refreshAll(),Lightbox.hide(),3==e&&g_items[t.id].jsonequip.subitems){for(var a,i=0,r=this.visibility.length;i<r;++i){var n=this.visibility[i],o=this.columns[n];o.group&&o.group[0][0]==t.id&&(a=o)}a&&this.openSubitemPicker(a,0)}return!1},Summary.groupOver=function(e,t){for(var s="",i={},a=0,r=e.length;a<r;++a)i[e[a][0]]=1+(0|i[e[a][0]]);for(var a=0,r=e.length;a<r;++a){var n=e[a][0];g_items[n]&&(s+="<tr>",s+='<td style="text-align: right">x'+i[n]+"</td>",s+='<td><div class="indent q'+g_items[n].quality+'">',s+='<span class="icontiny" style="background: url('+g_staticDataUrl+"/images/wow/icons/tiny/"+g_items[n].icon.toLowerCase()+'.gif) left center no-repeat">'+g_items[n]["name_"+Locale.getName()]+"</span>",s+="</div></td>",s+='<td><div class="indent q1"><small><em>'+LANG.level+" "+g_items[n].jsonequip.level+"</em></small></div></td>",s+="</tr>")}s&&$WH.Tooltip.showAtCursor(t,'<table style="white-space: nowrap">'+s+"</table>")},Summary.addWeightScale=function(e){e=this.createWeightScale(),e&&this.weights.push(e),this.toggleOptions(),this.refreshAll()},Summary.resetScale=function(){var e=$WH.ge("su_classes");e.selectedIndex=0,e.onchange()},Summary.weightOver=function(e,t){var s,i='<b class="q">'+e.name+"</b>",a="",r="",n=!1;s=0;for(var o in e)null!=LANG.traits[o]&&(s++>0&&(a+="<br />"),a+=e[o],n=!0);if(n){s=0;for(var o in e)null!=LANG.traits[o]&&(s++>0&&(r+="<br />"),r+=LANG.traits[o][1]);i+='<table style="white-space: nowrap"><tr><td style="text-align: right">'+a+'</td><td><div class="indent">'+r+'</td></tr></table><span class="q2">'+LANG.su_toggle+"</span>"}$WH.Tooltip.showAtCursor(t,i)},Summary.socketOver=function(e,t){var s="";for(var i in e)g_gems[i]&&(s+="<tr>",s+='<td style="text-align: right"><div class="gem'+g_gems[i].colors+'">x'+e[i]+"</div></td>",s+='<td><div class="indent q'+g_gems[i].quality+'">',s+='<span class="icontiny" style="background: url('+g_staticDataUrl+"/images/wow/icons/tiny/"+g_gems[i].icon.toLowerCase()+'.gif) left center no-repeat">'+g_gems[i].name+"</span>",s+="</div></td>",s+='<td><div class="indent q1"><small><em>'+g_gems[i].enchantment+"</em></small></div></td>",s+="</tr>");s&&$WH.Tooltip.showAtCursor(t,'<table style="white-space: nowrap">'+s+"</table>")},Summary.addItemSubitem=function(e){var t=this.currentItem.col,s=this.currentItem.i;t.group[s][1]=e,this.refreshAll(),Lightbox.hide()},Summary.addItemEnchant=function(e){var t=this.currentItem.col,s=this.currentItem.i;t.group[s][2]=e,this.refreshAll(),Lightbox.hide()},Summary.addItemGem=function(e){var t=this.currentItem.col,s=this.currentItem.i,i=this.currentItem.socket;t.group[s][i]=e,this.refreshAll(),Lightbox.hide()},Summary.toggleExtraSocket=function(e,t,s){var i=e.group[t];i[this.getExtraSocketPos(i[0])]=this.hasExtraSocket(i)?0:-1,this.refreshAll()},Summary.funcBox={createSockets:function(e,t,s,i,a,r){if(e){var n,o={1:"meta",2:"red",4:"yellow",8:"blue",14:"prismatic"},l=0;for(n in o)null!=e[n]&&0!=e[n]&&++l;if(0!=l){var c=$WH.ce("div");c.style.paddingBottom="3px",$WH.ae(t,c);var h=0,l=0;for(n in o){if(null!=e[n]&&0!=e[n]){if(l>0)if(l%2==0){var c=$WH.ce("div");c.style.paddingBottom="3px",$WH.ae(t,c)}else $WH.ae(c,$WH.ct(String.fromCharCode(160,160)));var u=$WH.ce("a");if(u.href="?items=3&filter="+(14==n?"gb=1;cr=81:81:81;crs=2:3:4;crv=0:0:0;ma=1":"cr=81;crs="+(h+1)+";crv=0"),u.className="moneysocket"+o[n],r&&r[n]){for(var d in r[n])if(g_gems[d]){u.className+=" tip",u.style.borderBottom="1px dotted #808080";break}u.onmouseover=Summary.socketOver.bind(u,r[n]),u.onmousemove=$WH.Tooltip.cursorUpdate,u.onmouseout=$WH.Tooltip.hide}s?(u.className+=" "+(e[n]>0?"q2":"q10"),e[n]>0&&$WH.ae(u,$WH.ct("+"))):i&&a&&i[n]!=a[n]&&e[n]==a[n]&&(u.style.fontWeight="bold",u.className+=" q2"),$WH.ae(u,$WH.ct(e[n])),$WH.ae(c,u),++l}++h}}}}},Summary.templates={compare:{total:1,clone:2,newgroup:3,textable:1,enhanceable:1,columns:[{id:"name",align:"left",compute:function(e,t,s,i){this.__total.total[e.id]||(s.style.display="none"),t.style.whiteSpace="nowrap",t.style.paddingLeft="4px",t.style.paddingRight="20px";var a=LANG.traits[e.id]?LANG.traits[e.id][0]:e.name;if("gains"!=e.id)return a;var r=$WH.ce("span");r.className="tip",r.onmouseover=function(){$WH.Tooltip.show(this,LANG.tooltip_gains,0,0,"q")},r.onmousemove=$WH.Tooltip.cursorUpdate,r.onmouseout=$WH.Tooltip.hide,$WH.ae(r,$WH.ct(a)),$WH.ae(t,r)}},{id:"total",name:"Total",align:"center",hidden:1},{align:"center"},{id:"newgroup",align:"center",width:"100%"}],traits:[{id:"sepgeneral",type:"sep"},{id:"score",name:LANG.score,type:"custom",json:["id"],calcTotal:function(e,t,s){null==this.scoreMode&&(this.scoreMode=0);for(var i=0,a=this.weights.length;i<a;++i){var r=0,n=0,o=this.weights[i];for(var l in o)LANG.traits[l]&&(n+=o[l],isNaN(e[l])||(r+=e[l]*o[l]));t[i]=(0|t[i])+r,this.weights[i].f=n,!s&&(null==this.weights[i].m||t[i]>this.weights[i].m)&&(this.weights[i].m=t[i])}},calcDifference:function(e,t){for(var s={},i=0,a=this.weights.length;i<a;++i)s[i]=e[i]-t[i];return s},compute:function(e,t){if(e.total&&e.difference){var s=0,i=null!=this.selected&&this.__selected.id!=e.id;t.style.whiteSpace="nowrap",t.style.padding="4px";for(var a=0,r=this.weights.length;a<r;++a){var n=this.weights[a],o=i?e.difference.score[a]:e.total.score[a];n.name;if(null!=o){switch(n.name||(n.name=$WH.sprintf(LANG.su_customscale,++s)),this.scoreMode){case 0:o=(0!=n.f?o/n.f:0).toFixed(2);break;case 2:o=(n.m?100*o/n.m:0).toFixed(1)+"%"}var l=$WH.ce("a");l.className="summary-score-remove",l.href="javascript:;",l.onclick=this.deleteWeightScale.bind(this,a),$WH.ae(l,$WH.ct("x")),$WH.ae(t,l);var c=$WH.ce("div");c.className="summary-score-row"+a%2,$WH.ae(t,c);var l=$WH.ce("a");l.className=i?o>0?"q2":"q10":"q1",l.style.borderBottom="1px dotted #808080",l.href="javascript:;",l.onclick=this.toggleWeights.bind(this),l.onmouseover=Summary.weightOver.bind(l,n),l.onmousemove=$WH.Tooltip.cursorUpdate,l.onmouseout=$WH.Tooltip.hide,$WH.ae(l,$WH.ct(o)),$WH.ae(c,l)}}}}},{id:"sepgeneral",type:"sep"},{id:"level",type:"avg",digits:1,itemonly:1},{id:"reqlevel",type:"max"},{id:"sepbasestats",type:"sep"},{id:"agi",type:"sum"},{id:"int",type:"sum"},{id:"sta",type:"sum"},{id:"spi",type:"sum"},{id:"str",type:"sum"},{id:"health",type:"sum"},{id:"mana",type:"sum"},{id:"healthrgn",type:"sum"},{id:"manargn",type:"sum"},{id:"sepdefensivestats",type:"sep"},{id:"armor",type:"sum"},{id:"blockrtng",type:"sum",rating:15},{id:"block",type:"sum"},{id:"defrtng",type:"sum",rating:12},{id:"dodgertng",type:"sum",rating:13},{id:"parryrtng",type:"sum",rating:14},{id:"resirtng",type:"sum",rating:35},{id:"sepoffensivestats",type:"sep"},{id:"atkpwr",type:"sum"},{id:"feratkpwr",type:"sum",indent:1},{id:"armorpenrtng",type:"sum",rating:44},{id:"critstrkrtng",type:"sum",rating:32},{id:"exprtng",type:"sum",rating:37},{id:"hastertng",type:"sum",rating:36},{id:"hitrtng",type:"sum",rating:31},{id:"splpen",type:"sum"},{id:"splpwr",type:"sum"},{id:"arcsplpwr",type:"sum",indent:1},{id:"firsplpwr",type:"sum",indent:1},{id:"frosplpwr",type:"sum",indent:1},{id:"holsplpwr",type:"sum",indent:1},{id:"natsplpwr",type:"sum",indent:1},{id:"shasplpwr",type:"sum",indent:1},{id:"sepweaponstats",type:"sep"},{id:"dmg",type:"sum"},{id:"mledps",type:"sum"},{id:"rgddps",type:"sum"},{id:"mledmgmin",type:"sum"},{id:"rgddmgmin",type:"sum"},{id:"mledmgmax",type:"sum"},{id:"rgddmgmax",type:"sum"},{id:"mlespeed",type:"avg"},{id:"rgdspeed",type:"avg"},{id:"sepresistances",type:"sep"},{id:"arcres",type:"sum"},{id:"firres",type:"sum"},{id:"frores",type:"sum"},{id:"holres",type:"sum"},{id:"natres",type:"sum"},{id:"shares",type:"sum"},{id:"sepindividualstats",type:"sep"},{id:"mleatkpwr",type:"sum"},{id:"mlecritstrkrtng",type:"sum",rating:19},{id:"mlehastertng",type:"sum",rating:28},{id:"mlehitrtng",type:"sum",rating:16},{id:"rgdatkpwr",type:"sum"},{id:"rgdcritstrkrtng",type:"sum",rating:20},{id:"rgdhastertng",type:"sum",rating:29},{id:"rgdhitrtng",type:"sum",rating:17},{id:"splcritstrkrtng",type:"sum",rating:21},{id:"splhastertng",type:"sum",rating:30},{id:"splhitrtng",type:"sum",rating:18},{id:"spldmg",type:"sum"},{id:"splheal",type:"sum"},{id:"",name:LANG.sockets,type:"sep"},{id:"gems",name:LANG.gems,type:"custom",json:["id"],itemonly:1,calcTotal:function(e,t,i,a,r){for(var n=1;n<=8;n*=2)null==t[n]&&(t[n]={});null==t[14]&&(t[14]={});for(var n=1;n<4;++n)(s=e["socket"+n])&&a[n+3]&&(t[s][a[n+3]]=1+(0|t[s][a[n+3]]));n=4+(0|e.nsockets),r&&a[n]&&(t[14][a[n]]=1+(0|t[14][n]))},hidden:1},{id:"sockets",name:LANG.sockets,type:"custom",json:["socket1"],calcTotal:function(e,t,i,a,r){for(var n=1;n<=8;n*=2)t[n]=0|t[n];t[14]=0|t[14];for(var n=1;n<4;++n)(s=e["socket"+n])&&t[s]++;r&&t[14]++},calcDifference:function(e,t){for(var s={},i=1;i<=8;i*=2)null==e[i]&&null==t[i]||(s[i]=(0|e[i])-(0|t[i]));return s},compute:function(e,t){var s=null!=this.selected&&this.__selected.id!=e.id,i=s?e.difference:e.total;i&&(this.groups.length>1?Summary.funcBox.createSockets(i.sockets,t,s,this.minValue.sockets,this.maxValue.sockets,i.gems):Summary.funcBox.createSockets(i.sockets,t,s,null,null,i.gems))}},{id:"nsockets",type:"sum"},{id:"",type:"sep"},{id:"gains",name:LANG.gains,type:"custom",json:["id"],compute:function(e,t){if(e.id!=this.columns[this.total].id&&e.total){t.style.whiteSpace="nowrap",t.style.textAlign="left";var s=0;for(var i in this.minValue)if(e.total[i]>this.minValue[i]){s++>0&&$WH.ae(t,$WH.ce("br"));var a=Math.round(1e3*(e.total[i]-this.minValue[i]))/1e3;if($WH.ae(t,$WH.ct(a+" "+LANG.traits[i][1])),null!=this.ratings[i]){var r=$WH.g_convertRatingToPercent(this.level,this.ratings[i],a);r=$WH.number_format(Math.round(100*r)/100),12!=this.ratings[i]&&37!=this.ratings[i]&&(r+="%");var n=$WH.ce("small");$WH.ae(n,$WH.ct(" ("+r+")")),$WH.ae(t,n)}}}}}]},itemset:{total:1,clone:2,editable:0,columns:[{id:"name",align:"left",compute:function(e,t,s,i){return this.__total.total[e.id]||(s.style.display="none"),LANG.traits[e.id]?LANG.traits[e.id][0]:e.name}},{id:"total",name:"Total",align:"center"},{align:"center"}],traits:[{id:"str",type:"sum"},{id:"agi",type:"sum"},{id:"sta",type:"sum"},{id:"int",type:"sum"},{id:"spi",type:"sum"},{id:"health",type:"sum"},{id:"mana",type:"sum"},{id:"healthrgn",type:"sum"},{id:"manargn",type:"sum"},{id:"armor",type:"sum"},{id:"block",type:"sum"},{id:"defrtng",type:"sum",rating:12},{id:"dodgertng",type:"sum",rating:13},{id:"parryrtng",type:"sum",rating:14},{id:"resirtng",type:"sum",rating:35},{id:"blockrtng",type:"sum",rating:15},{id:"atkpwr",type:"sum"},{id:"feratkpwr",type:"sum"},{id:"armorpenrtng",type:"sum",rating:44},{id:"critstrkrtng",type:"sum",rating:32},{id:"exprtng",type:"sum",rating:37},{id:"hastertng",type:"sum",rating:36},{id:"hitrtng",type:"sum",rating:31},{id:"splpen",type:"sum"},{id:"splpwr",type:"sum"},{id:"arcsplpwr",type:"sum"},{id:"firsplpwr",type:"sum"},{id:"frosplpwr",type:"sum"},{id:"holsplpwr",type:"sum"},{id:"natsplpwr",type:"sum"},{id:"shasplpwr",
type:"sum"},{id:"dps",type:"sum"},{id:"dmg",type:"sum"},{id:"arcres",type:"sum"},{id:"firres",type:"sum"},{id:"frores",type:"sum"},{id:"holres",type:"sum"},{id:"natres",type:"sum"},{id:"shares",type:"sum"},{id:"mleatkpwr",type:"sum"},{id:"mlecritstrkrtng",type:"sum",rating:19},{id:"mlehastertng",type:"sum",rating:28},{id:"mlehitrtng",type:"sum",rating:16},{id:"rgdatkpwr",type:"sum"},{id:"rgdcritstrkrtng",type:"sum",rating:20},{id:"rgdhastertng",type:"sum",rating:29},{id:"rgdhitrtng",type:"sum",rating:17},{id:"splcritstrkrtng",type:"sum",rating:21},{id:"splhastertng",type:"sum",rating:30},{id:"splhitrtng",type:"sum",rating:18},{id:"spldmg",type:"sum"},{id:"splheal",type:"sum"},{id:"sockets",name:LANG.sockets,type:"custom",json:["socket1"],calcTotal:function(e,t){for(var i=1;i<=8;i*=2)t[i]=0|t[i];for(var i=1;i<4;++i)(s=e["socket"+i])&&t[s]++},calcDifference:function(e,t){for(var s={},i=1;i<=8;i*=2)null==e[i]&&null==t[i]||(s[i]=(0|e[i])-(0|t[i]));return s},compute:function(e,t){var s=null!=this.selected&&this.__selected.id!=e.id,i=s?e.difference:e.total;i&&(this.groups.length>1?Summary.funcBox.createSockets(i.sockets,t,s,this.minValue.sockets,this.maxValue.sockets):Summary.funcBox.createSockets(i.sockets,t,s))}}]}},Listview.templates.compare={sort:[1],nItemsPerPage:-1,hideBands:2,hideNav:3,hideHeader:1,searchable:1,searchDelay:100,poundable:0,filtrable:0,clip:{w:780,h:486},onBeforeCreate:function(){this.applySort()},onSearchSubmit:function(e){1==this.nRowsVisible&&Summary.addGroupItem.bind(e._summary,e._type,e)()},columns:[{id:"item",type:"text",align:"left",value:"name",compute:function(e,t,s){if(e.none)return void(s.style.display="none");var i=$WH.ce("a");switch(i.className="q"+e.quality,i.style.fontFamily="Verdana, sans-serif",e._type){case 3:this.template.columns[0].span=2;var a=$WH.ce("td");a.style.width="1px",a.style.padding="0",a.style.borderRight="none";var r=Icon.create(e.icon,0,null,"?item="+e.id),n=Icon.getLink(r);$WH.ae(a,r),$WH.ae(s,a),t.style.borderLeft="none",n.onclick=$WH.rf,i.href="?item="+e.id;break;case 4:i.href="?itemset="+e.id}$WH.ae(i,$WH.ct(e.name)),$WH.nw(t),$WH.ae(t,i),s.onclick=function(t){t=$WH.$E(t),2==t._button&&t._target==i||(t.preventDefault(),Summary.addGroupItem.bind(e._summary,e._type,e)())}},sortFunc:function(e,t,s){return e.none?-1:t.none?1:-$WH.strcmp(e.level|e.minlevel,t.level|t.minlevel)||-$WH.strcmp(e.quality,t.quality)||$WH.strcmp(e.name,t.name)}},{id:"level",name:LANG.level,type:"range",getMinValue:function(e){return e.minlevel|e.level},getMaxValue:function(e){return e.maxlevel|e.level},compute:function(e,t,s){if(!e.none)switch(e._type){case 3:return e.level;case 4:return e.minlevel>0&&e.maxlevel>0?e.minlevel!=e.maxlevel?e.minlevel+LANG.hyphen+e.maxlevel:e.minlevel:-1}},sortFunc:function(e,t,s){return e.none?-1:t.none?1:-$WH.strcmp(e.score,t.score)||$WH.strcmp(e.name,t.name)}},{id:"pieces",name:LANG.pieces,getValue:function(e){return e.pieces?e.pieces.length:null},compute:function(e,t){e.pieces?(t.style.padding="0",Listview.funcBox.createCenteredIcons(e.pieces,t)):t.style.display="none"}},{id:"type",name:LANG.type,type:"text",compute:function(e,t,s){t.className="small q1",$WH.nw(t);var i=$WH.ce("a");switch(e._type){case 3:var a=Listview.funcBox.getItemType(e.classs,e.subclass,e.subsubclass);i.href=a.url,$WH.ae(i,$WH.ct(a.text));break;case 4:$WH.ae(i,$WH.ct(g_itemset_types[e.type]))}$WH.ae(t,i)},getVisibleText:function(e){return Listview.funcBox.getItemType(e.classs,e.subclass,e.subsubclass).text}},{id:"score",align:"center",compute:function(e,t,s){if(null!=e.score){var i=parseFloat(e.score),a=$WH.ce("div");a.className="small q"+(i?i>0?2:10:0),$WH.st(a,i?(i>0?"+":"-")+e.score:0),$WH.ae(t,a)}else t.style.display="none"}}]},Listview.templates.subitempicker={sort:[1],nItemsPerPage:-1,hideBands:2,hideNav:3,hideHeader:1,searchable:1,searchDelay:100,poundable:0,filtrable:0,clip:{w:780,h:486},onBeforeCreate:function(){this.applySort()},onSearchSubmit:function(e){2==this.nRowsVisible&&e.id&&Summary.addItemSubitem.bind(e._summary,e.id)()},columns:[{id:"subitem",type:"text",align:"left",value:"name",compute:function(e,t,s){if(!e.none){var i="?item="+e.item,a=g_items[e.item],r=$WH.ce("td");r.style.width="1px",r.style.padding="0",r.style.borderRight="none";var n=Icon.create(a.icon,0,null,i),o=Icon.getLink(n);$WH.ae(r,n),$WH.ae(s,r),t.style.borderLeft="none",o.onclick=$WH.rf,o.rel="rand="+e.id;var l=$WH.ce("a");-1!=e.quality&&(l.className="q"+a.quality),l.style.fontFamily="Verdana, sans-serif",l.href=i,l.rel="rand="+e.id,$WH.ae(l,$WH.ct(a["name_"+Locale.getName()]+" "+e.name)),$WH.nw(t),$WH.ae(t,l),s.onclick=function(t){t=$WH.$E(t),2==t._button&&t._target==l||(t.preventDefault(),Summary.addItemSubitem.bind(e._summary,e.id)())}}}},{id:"enchantment",type:"text",align:"left",value:"enchantment",compute:function(e,t,s){if(!e.none){var i=$WH.ce("div");i.className="small crop",t.title=e.enchantment,$WH.ae(i,$WH.ct(e.enchantment)),$WH.ae(t,i)}},sortFunc:function(e,t,s){return e.none?-1:t.none?1:-$WH.strcmp(e.score,t.score)||$WH.strcmp(e.name,t.name)}},{id:"score",align:"center",compute:function(e,t,s){if(!e.none&&null!=e.score){var i=parseFloat(e.score),a=$WH.ce("div");a.className="small q"+(i?i>0?2:10:0),$WH.st(a,i?(i>0?"+":"-")+e.score:0),$WH.ae(t,a)}}}]},Listview.templates.enchantpicker={sort:[1],nItemsPerPage:-1,hideBands:2,hideNav:3,hideHeader:1,searchable:1,searchDelay:100,poundable:0,filtrable:0,clip:{w:780,h:486},onBeforeCreate:function(){this.applySort()},onSearchSubmit:function(e,t){2==this.nRowsVisible&&e.id&&Summary.addItemEnchant.bind(e._summary,e.id)()},columns:[{id:"enchant",type:"text",align:"left",value:"name",span:2,compute:function(e,t,s){if(!e.none){var i=(e.source>0?"?spell=":"?item=")+Math.abs(e.source),a=$WH.ce("td");a.style.width="1px",a.style.padding="0",a.style.borderRight="none";var r=Icon.create(e.icon,0,null,i),n=Icon.getLink(r);$WH.ae(a,r),$WH.ae(s,a),t.style.borderLeft="none",n.onclick=$WH.rf;var o=$WH.ce("a");-1!=e.quality&&(o.className="q"+e.quality),o.style.fontFamily="Verdana, sans-serif",o.href=i,$WH.ae(o,$WH.ct(e.name)),$WH.nw(t),$WH.ae(t,o),s.onclick=function(t){t=$WH.$E(t),2==t._button&&t._target==o||(t.preventDefault(),Summary.addItemEnchant.bind(e._summary,e.id)())}}},sortFunc:function(e,t,s){return e.none?-1:t.none?1:-$WH.strcmp(e.quality,t.quality)||$WH.strcmp(e.type,t.type)||$WH.strcmp(e.name,t.name)}},{id:"enchantment",type:"text",align:"left",value:"enchantment",compute:function(e,t,s){if(!e.none){var i=$WH.ce("div");i.className="small crop",t.title=e.enchantment,$WH.ae(i,$WH.ct(e.enchantment)),$WH.ae(t,i)}},sortFunc:function(e,t,s){return e.none?-1:t.none?1:-$WH.strcmp(e.score,t.score)||$WH.strcmp(e.name,t.name)}},{id:"skill",type:"text",compute:function(e,t,s){if(!e.none)return t.className="small q0",$WH.nw(t),e.skill>0?g_spell_skills[e.skill]:LANG.types[3][0]},getVisibleText:function(e){if(!e.none)return e.skill>0?g_spell_skills[e.skill]:LANG.types[3][0]}},{id:"score",align:"center",compute:function(e,t,s){if(e.none)return $WH.ee(s),s.onclick=Summary.addItemEnchant.bind(e._summary,0),t.colSpan=5,t.style.fontWeight="bold",t.style.textAlign="center",LANG.dash+LANG.pr_noneenchant+LANG.dash;if(null!=e.score){var i=parseFloat(e.score),a=$WH.ce("div");a.className="small q"+(i?i>0?2:10:0),$WH.st(a,i?(i>0?"+":"-")+e.score:0),$WH.ae(t,a)}}}]},Listview.templates.gempicker={sort:[1],nItemsPerPage:-1,hideBands:2,hideNav:3,hideHeader:1,searchable:1,searchDelay:100,poundable:0,filtrable:0,clip:{w:780,h:486},onBeforeCreate:function(){this.applySort()},onSearchSubmit:function(e){2==this.nRowsVisible&&e.id&&Summary.addItemGem.bind(e._summary,e.id)()},columns:[{id:"gem",type:"text",align:"left",value:"name",span:2,compute:function(e,t,s){if(!e.none){var i=$WH.ce("td");i.style.width="1px",i.style.padding="0",i.style.borderRight="none";var a=Icon.create(e.icon,0,null,"?item="+e.id),r=Icon.getLink(a);$WH.ae(i,a),$WH.ae(s,i),t.style.borderLeft="none",r.onclick=$WH.rf;var n=$WH.ce("a");n.className="q"+e.quality,n.style.fontFamily="Verdana, sans-serif",n.href="?item="+e.id,$WH.ae(n,$WH.ct(e.name)),$WH.nw(t),$WH.ae(t,n),s.onclick=function(t){t=$WH.$E(t),2==t._button&&t._target==n||(t.preventDefault(),Summary.addItemGem.bind(e._summary,e.id)())}}},sortFunc:function(e,t,s){return e.none?-1:t.none?1:-$WH.strcmp(e.quality,t.quality)||$WH.strcmp(e.colors,t.colors)||$WH.strcmp(e.icon,t.icon)||$WH.strcmp(e.name,t.name)}},{id:"enchantment",type:"text",align:"left",value:"enchantment",compute:function(e,t,s){if(!e.none){var i=$WH.ce("div");i.className="small crop",t.title=e.enchantment,$WH.ae(i,$WH.ct(e.enchantment)),$WH.ae(t,i)}},sortFunc:function(e,t,s){return e.none?-1:t.none?1:-$WH.strcmp(e.score,t.score)||$WH.strcmp(e.name,t.name)}},{id:"colors",compute:function(e,t,s){if(!e.none)return t.className="small gem"+e.colors,$WH.nw(t),g_gem_colors[e.colors]},getVisibleText:function(e){if(!e.none)return g_gem_colors[e.colors]}},{id:"score",align:"center",compute:function(e,t,s){if(e.none)return $WH.ee(s),s.onclick=Summary.addItemGem.bind(e._summary,0),t.colSpan=5,t.style.fontWeight="bold",t.style.textAlign="center",LANG.dash+LANG.pr_nonegem+LANG.dash;if(null!=e.score){var i=parseFloat(e.score),a=$WH.ce("div");a.className="small q"+(i?i>0?2:10:0),$WH.st(a,i?(i>0?"+":"-")+e.score:0),$WH.ae(t,a)}}}]};